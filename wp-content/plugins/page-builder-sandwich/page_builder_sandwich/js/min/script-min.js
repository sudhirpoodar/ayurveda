function isBlankPage(){return PBS.controller.contentProvider.content.match(/^\s*<p>\s*<\/p>\s*$/)}function openPageTemplates(ev){ev.preventDefault(),PBSEditor.pageTemplateFrame.open({title:pbsParams.labels.page_templates,button:isBlankPage()?pbsParams.labels.use_page_template:pbsParams.labels.replace_contents_with_template,successCallback:function(view){}.bind(this)})}!function(view){var constructors,dummy,innerHTMLPropDesc;if(window.MSInputMethodContext&&document.documentMode||-1!==navigator.appVersion.indexOf("MSIE 10")){if(constructors=["SVGSVGElement","SVGGElement"],dummy=document.createElement("dummy"),!constructors[0]in view)return!1;if(Object.defineProperty){innerHTMLPropDesc={get:function(){return dummy.innerHTML="",Array.prototype.slice.call(this.childNodes).forEach(function(node,index){dummy.appendChild(node.cloneNode(!0))}),dummy.innerHTML},set:function(content){var self=this,allNodes=Array.prototype.slice.call(self.childNodes),fn=function(to,node){var newNode;if(1!==node.nodeType)return!1;newNode=document.createElementNS("http://www.w3.org/2000/svg",node.nodeName),Array.prototype.slice.call(node.attributes).forEach(function(attribute){newNode.setAttribute(attribute.name,attribute.value)}),"TEXT"===node.nodeName&&(newNode.textContent=node.innerHTML),to.appendChild(newNode),node.childNodes.length&&Array.prototype.slice.call(node.childNodes).forEach(function(node,index){fn(newNode,node)})};content=content.replace(/<(\w+)([^<]+?)\/>/,"<$1$2></$1>"),allNodes.forEach(function(node,index){node.parentNode.removeChild(node)}),dummy.innerHTML=content,Array.prototype.slice.call(dummy.childNodes).forEach(function(node){fn(self,node)})},enumerable:!0,configurable:!0};try{constructors.forEach(function(constructor,index){Object.defineProperty(window[constructor].prototype,"innerHTML",innerHTMLPropDesc)})}catch(ex){}}else Object.prototype.__defineGetter__&&constructors.forEach(function(constructor,index){window[constructor].prototype.__defineSetter__("innerHTML",innerHTMLPropDesc.set),window[constructor].prototype.__defineGetter__("innerHTML",innerHTMLPropDesc.get)})}}(window),void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){var results=/function\s([^(]{1,})\(/.exec(this.toString());return results&&results.length>1?results[1].trim():""},set:function(){}}),function(){function CustomEvent(event,params){var evt;return params=params||{bubbles:!1,cancelable:!1,detail:void 0},(evt=document.createEvent("CustomEvent")).initCustomEvent(event,params.bubbles,params.cancelable,params.detail),evt}(window.MSInputMethodContext&&document.documentMode||-1!==navigator.appVersion.indexOf("MSIE 10"))&&(CustomEvent.prototype=window.Event.prototype,window.CustomEvent=CustomEvent)}(),function(win){"use strict";function FastDom(){var self=this;self.reads=[],self.writes=[],self.raf=raf.bind(win),debug("initialized",self)}function scheduleFlush(fastdom){fastdom.scheduled||(fastdom.scheduled=!0,fastdom.raf(flush.bind(null,fastdom)),debug("flush scheduled"))}function flush(fastdom){debug("flush");var error,writes=fastdom.writes,reads=fastdom.reads;try{debug("flushing reads",reads.length),runTasks(reads),debug("flushing writes",writes.length),runTasks(writes)}catch(e){error=e}if(fastdom.scheduled=!1,(reads.length||writes.length)&&scheduleFlush(fastdom),error){if(debug("task errored",error.message),!fastdom.catch)throw error;fastdom.catch(error)}}function runTasks(tasks){debug("run tasks");for(var task;task=tasks.shift();)task()}function remove(array,item){var index=array.indexOf(item);return!!~index&&!!array.splice(index,1)}function mixin(target,source){for(var key in source)source.hasOwnProperty(key)&&(target[key]=source[key])}var debug=function(){},raf=win.requestAnimationFrame||win.webkitRequestAnimationFrame||win.mozRequestAnimationFrame||win.msRequestAnimationFrame||function(cb){return setTimeout(cb,16)};FastDom.prototype={constructor:FastDom,measure:function(fn,ctx){debug("measure");var task=ctx?fn.bind(ctx):fn;return this.reads.push(task),scheduleFlush(this),task},mutate:function(fn,ctx){debug("mutate");var task=ctx?fn.bind(ctx):fn;return this.writes.push(task),scheduleFlush(this),task},clear:function(task){return debug("clear",task),remove(this.reads,task)||remove(this.writes,task)},extend:function(props){if(debug("extend",props),"object"!=typeof props)throw new Error("expected object");var child=Object.create(this);return mixin(child,props),child.fastdom=this,child.initialize&&child.initialize(),child},catch:null};var exports=win.fastdom=win.fastdom||new FastDom;"f"==(typeof define)[0]?define(function(){return exports}):"o"==(typeof module)[0]&&(module.exports=exports)}("undefined"!=typeof window?window:this);var PBS={};ContentEdit.INDENT="",ContentEdit.DEFAULT_MAX_ELEMENT_WIDTH=2e3,ContentTools.HIGHLIGHT_HOLD_DURATION=999999,ContentEdit.RESIZE_CORNER_SIZE=0;var initPBS=function(){var editor,extraWrapper,editableWrappers,i,starterInterval;if(document.querySelector('[data-name="main-content"]')){if((editableWrappers=document.querySelectorAll('.pbs-main-wrapper[data-editable][data-name="main-content"]')).length>1)for(i=1;i<editableWrappers.length;i++)editableWrappers[i].removeAttribute("data-editable"),editableWrappers[i].removeAttribute("data-name");for(;document.querySelectorAll('.pbs-main-wrapper[data-name="main-content"]').length>1;)(extraWrapper=document.querySelectorAll('.pbs-main-wrapper[data-name="main-content"]')[1]).removeAttribute("data-name"),null!==extraWrapper.getAttribute("data-editable")&&extraWrapper.removeAttribute("data-editable");localStorage&&localStorage.getItem("pbs-open-"+pbsParams.post_id)&&(localStorage.removeItem("pbs-open-"+pbsParams.post_id),starterInterval=setInterval(function(){PBS.isReady&&(PBS.edit(),clearInterval(starterInterval))},200)),window.location.hash&&0===window.location.hash.indexOf("#pbs-edit")&&(starterInterval=setInterval(function(){PBS.isReady&&(PBS.edit(),clearInterval(starterInterval))},200)),editor=ContentTools.EditorApp.get(),wp.hooks.addAction("pbs.stop",function(){var i;if(fastdom){for(i=fastdom.reads.length-1;i>=0;i--)fastdom.clear(fastdom.reads[i]);for(i=fastdom.writes.length-1;i>=0;i--)fastdom.clear(fastdom.writes[i])}}),editor.bind("start",function(){clearInterval(editor._toolbox._updateToolsTimeout),editor._toolbox._updateToolsTimeout=setInterval(editor._toolbox._updateTools,300)}),editor.bind("start",function(){editor._toolboxScrollCheckInterval=setInterval(function(){var toolbox,elements=document.querySelectorAll(".media-modal-backdrop"),hasModal=!1;elements&&Array.prototype.forEach.call(elements,function(el){0===el.offsetWidth&&0===el.offsetHeight||(hasModal=!0)}),(toolbox=document.querySelector(".ct-toolbox"))&&toolbox.style["overflow-y"]!==(hasModal?"hidden":"")&&(toolbox.style["overflow-y"]=hasModal?"hidden":"")},300)}),editor.bind("stop",function(){clearInterval(editor._toolboxScrollCheckInterval)}),editor.bind("start",function(){this._handleHighlightOn=function(){},this._handleHighlightOff=function(){}}),editor.bind("stop",function(){window._pbsBodyTransitionIntervalNum=0,clearInterval(window._pbsBodyTransitionInterval),window._pbsBodyTransitionInterval=setInterval(function(){window._pbsBodyTransitionIntervalNum++,window.dispatchEvent(new CustomEvent("resize")),window._pbsBodyTransitionIntervalNum>=30&&clearInterval(window._pbsBodyTransitionInterval)},16)}),ContentEdit.Root.get().bind("focus",function(element){document.body.setAttribute("data-pbs-focused",element.constructor.name)}),ContentEdit.Root.get().bind("blur",function(){document.body.removeAttribute("data-pbs-focused")}),editor.bind("start",function(){for(var curElement,element=document.querySelector(".pbs-main-wrapper");element&&"body"!==element.tagName;){for(curElement=element;curElement.previousSibling;)1===curElement.previousSibling.nodeType?curElement.previousSibling.querySelector(".pbs-title-editor")?curElement=curElement.previousSibling:(curElement.previousSibling.classList&&curElement.previousSibling.classList.add("pbs-ignore-while-editing"),curElement=curElement.previousSibling):curElement=curElement.previousSibling;element=element.parentNode}}),editor.bind("stop",function(){var elements=document.querySelectorAll(".pbs-ignore-while-editing");elements&&Array.prototype.forEach.call(elements,function(el){el.classList.remove("pbs-ignore-while-editing")})}),wp.hooks.doAction("pbs.init")}};ContentEdit.DRAG_HOLD_DURATION=400,ContentEdit.Root.get().bind("drag",function(){document.querySelector('[data-name="main-content"]').classList.add("dragging")}),ContentEdit.Root.get().bind("drop",function(){document.querySelector('[data-name="main-content"]').classList.remove("dragging"),window.pbsFixRowWidths&&window.pbsFixRowWidths()}),window.cssToStyleObject=function(cssString){for(var match,regex=/([\w-]*)\s*:\s*([^;]*)/g,properties={};match=regex.exec(cssString);)properties[match[1]]=match[2];return properties},window.cssToStyleString=function(cssObject){var i,s="";for(i in cssObject)cssObject.hasOwnProperty(i)&&(s+=i+":"+cssObject[i]+";");return s},ContentEdit.Element.prototype._onMouseMove=function(){};var i,l,key,__slice,__indexOf,__hasProp,__extends,__bind;__slice=[].slice,__indexOf=[].indexOf||function(item){for(i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},PBSI=class{constructor(controller){this._controller=controller}get isReady(){return this._controller.isReady}get isEditing(){return this._controller.isEditing}get controller(){return this._controller}init(){this._controller.init()}edit(){this.isEditing||this._controller.edit()}save(){this.isEditing&&this._controller.save()}cancel(){this.isEditing&&this._controller.cancel()}},PBSButton={},PBSButton.ButtonI=class{isMounted(){}get domElement(){}mount(){}unmount(){}},PBSButton.Button=class extends PBSButton.ButtonI{constructor(domElement,id,callback=function(){}){super(),this._domElement=domElement,this.id=id,this.callback=callback,this._isMounted=!1}isMounted(){return this._isMounted}get domElement(){return this._domElement}mount(){this.isMounted()||(this._domElement.classList.add("pbs-ignition-button"),this._domElement.classList.add("pbs-ignition-button--"+this.id),this._callbackBound=this._callback.bind(this),this._domElement.addEventListener("click",this._callbackBound),this._isMounted=!0)}unmount(){this.isMounted()&&(this._domElement.classList.remove("pbs-ignition-button"),this._domElement.classList.remove("pbs-ignition-button--"+this.id),this._domElement.removeEventListener("click",this._callbackBound),this._isMounted=!1)}_callback(ev){ev.preventDefault(),wp.hooks.applyFilters("pbs.button.click."+this.id,!0,ev)&&this.callback(ev)}},PBSController={},PBSController.ControllerI=class{constructor(contentDom,contentProvider,saveProvider){}get isEditing(){}get isReady(){}set isReady(isReady){}get isBusy(){}set isBusy(isBusy){}get contentProvider(){}init(){}edit(){}cancel(){}save(callback=function(){}){}destroy(){}},PBSController.Controller=class extends PBSController.ControllerI{constructor(contentDom,contentProvider,saveProvider){super(contentDom,contentProvider),this._contentDom=contentDom,this._contentProvider=contentProvider,this._saveProvider=saveProvider,this._isEditing=!1,this._isReady=!1,this._isBusy=!1}get contentProvider(){return this._contentProvider}get isReady(){return this._isReady}set isReady(isReady){this._isReady!==!!isReady&&(this._isReady=!!isReady,this._isReady&&(document.body.parentNode.classList.add("pbs-ready"),wp.hooks.doAction("pbs.ready")))}get isEditing(){return this._isEditing}get isBusy(){return this._isBusy}set isBusy(isBusy){this._isBusy!==!!isBusy&&(this._isBusy=!!isBusy,this._isBusy?(document.body.parentNode.classList.add("pbs-busy"),wp.hooks.doAction("pbs.busy")):(document.body.parentNode.classList.remove("pbs-busy"),wp.hooks.doAction("pbs.notbusy")))}init(){this.isReady=!0}edit(){return!!this.isReady&&(!!wp.hooks.applyFilters("pbs.edit.continue",!0)&&(document.body.parentNode.classList.add("pbs-editing"),this._contentDom.classList.add("pbs-editing"),this._isEditing=!0,wp.hooks.doAction("pbs.edit"),wp.hooks.doAction("pbs.start"),this._saveProvider.clearData(),!0))}cancel(){document.body.parentNode.classList.remove("pbs-editing"),this._contentDom.classList.remove("pbs-editing"),this._isEditing=!1,wp.hooks.doAction("pbs.cancel"),wp.hooks.doAction("pbs.stop")}save(callback=function(){}){wp.hooks.doAction("pbs.save.before",this);var content=this._contentProvider.content;content=wp.hooks.applyFilters("pbs.save",content).replace(/\\/g,"\\\\"),this._saveProvider.addData("main-content",content),this.isBusy=!0,this._saveProvider.save(this._saveCallback.bind(this,callback))}_saveCallback(callback=function(){}){"function"==typeof callback&&callback(),this.isBusy=!1,document.body.parentNode.classList.remove("pbs-editing"),this._contentDom.classList.remove("pbs-editing"),this._isEditing=!1,wp.hooks.doAction("pbs.stop"),wp.hooks.doAction("pbs.save.after",this)}destroy(){document.body.parentNode.classList.remove("pbs-ready"),document.body.parentNode.classList.remove("pbs-busy"),document.body.parentNode.classList.remove("pbs-editing"),this._contentDom.classList.remove("pbs-editing"),this._isEditing=!1,this.isReady=!1,this.isBusy=!1,wp.hooks.doAction("pbs.destroy")}},PBSController.CTController=class extends PBSController.Controller{constructor(CTEditor,contentDom,contentProvider,saveProvider){super(contentDom,contentProvider,saveProvider),this._editor=CTEditor,wp.hooks.addAction("pbs.ct.mounted",this.ctMounted.bind(this)),wp.hooks.addAction("pbs.save.before",window.PBSEditor.updateModifiedContent),this._editor.bind("stop",this.ctStopped.bind(this))}edit(){if(!this._editor._ignition)throw"Content Tools is not mounted yet";super.edit()&&this._editor._ignition.trigger("start")}cancel(){if(!this._editor._ignition)throw"Content Tools is not mounted yet";return this._editor._ignition.trigger("stop",!1)}save(callback=function(){}){if(!this._editor._ignition)throw"Content Tools is not mounted yet";return super.save(callback),this._editor._ignition.trigger("stop",!0)}ctMounted(){this.isReady=!0}ctStopped(){super.cancel()}init(){window._contentToolsShim(this._editor),this._editor.init([this._contentDom],"data-name")}destroy(){super.destroy(),this._editor.destroy()}},PBSController.PostCTController=class extends PBSController.CTController{constructor(CTEditor,contentDom,contentProvider,saveProvider){super(CTEditor,contentDom,contentProvider,saveProvider)}save(callback=function(){}){var reloadPageIfPreviewBound=function(xhr){this.reloadPageIfPreview(xhr),wp.hooks.removeAction("pbs.save.post.xhr",reloadPageIfPreviewBound)}.bind(this);this._saveProvider.addData("action","gambit_builder_save_content"),this._saveProvider.addData("save_nonce",pbsParams.nonce),this._saveProvider.addData("post_id",pbsParams.post_id);var styleData="";return document.querySelector("style#pbs-style")&&(styleData=document.querySelector("style#pbs-style").innerHTML),this._saveProvider.addData("style",styleData),wp.hooks.doAction("pbs.save.post.before",this),wp.hooks.addAction("pbs.save.post.xhr",reloadPageIfPreviewBound),super.save(callback)}reloadPageIfPreview(xhr){var currentHref;xhr.responseText.match(/(http|https):\/\//)&&(currentHref=window.location.href.replace(/#\.*$/,""),xhr.responseText!==currentHref)?window.location.href=xhr.responseText:!!document.querySelector(".pbs-orig-page-content")&&window.location.reload()}},PBSContent={},PBSContent.ContentI=class{constructor(contentElement,styleElement){}get content(){}set content(html){}get styles(){}set styles(styles){}get contentElement(){}get styleElement(){}},PBSContent.Content=class extends PBSContent.ContentI{constructor(contentElement,styleElement){super(contentElement,styleElement),this._contentElement=contentElement,this._styleElement=styleElement}get content(){return this._contentElement.innerHTML}set content(html){return this._contentElement.innerHTML=html,this}get styles(){return this._styleElement?this._styleElement.innerHTML:""}set styles(styles){return this._styleElement.innerHTML=html,this}get contentElement(){return this._contentElement}get styleElement(){return this._styleElement}},PBSContent.CTContent=class extends PBSContent.Content{constructor(ctEditor,contentElement,styleElement){super(contentElement,styleElement),this._editor=ctEditor}get content(){var regions=this._editor.regions();return regions.hasOwnProperty("main-content")?regions["main-content"].html():""}set content(html){var regions=this._editor.regions();if(!regions.hasOwnProperty("main-content"))throw"The content dom cannot be found";return regions["main-content"].setContent(html),this}set styles(styles){return super.styles(styles)}get styles(){return super.styles}},PBSSaver={},PBSSaver.SaverI=class{constructor(){}get data(){}set data(data){}save(callback=function(){}){}addData(name,value){}clearData(){}},PBSSaver.Saver=class extends PBSSaver.SaverI{constructor(){super(),this._data={}}save(callback=function(){}){return super.save(callback),callback(),this}get data(){return this._data}set data(data){return this._data=data,this}addData(name,value){return this._data[name]=value,this}clearData(){this._data={}}},PBSSaver.AjaxSaver=class extends PBSSaver.Saver{constructor(){super(),this._data=new FormData}save(callback=function(){}){var xhr=new XMLHttpRequest;xhr.onload=this._postCallback.bind(this,xhr,callback),xhr.open("POST",pbsParams.ajax_url),xhr.send(this.data)}_postCallback(xhr,callback=function(){}){if(!(xhr.status>=200&&xhr.status<400))throw alert&&alert("Oops! I encountered an error during saving: "+xhr.statusText),"There was an ajax error during saving: "+xhr.statusText;super.save(callback)}addData(name,value){return this._data.append(name,value),this}clearData(){this._data=new FormData}},PBSSaver.AjaxPostSaver=class extends PBSSaver.AjaxSaver{save(callback=function(){}){this.data=wp.hooks.applyFilters("pbs.save.payload",this.data),super.save(callback),wp.hooks.doAction("pbs.save.payload.after",this.data)}_postCallback(xhr,callback=function(){}){super._postCallback(xhr,callback),xhr.status>=200&&xhr.status<400&&wp.hooks.doAction("pbs.save.post.xhr",xhr,this)}},PBSAdminBar={},PBSAdminBar.AdminBarI=class{constructor(controller,saveProvider,domElement,editElement,saveElement,cancelElement,busyIndicatorElement,{savePublishElement:savePublishElement,saveDraftElement:saveDraftElement,savePendingElement:savePendingElement}){}get domElement(){}addButton(name,button){}getButton(name){}getButtons(){}removeButton(name){}},PBSAdminBar.AdminBar=class extends PBSAdminBar.AdminBarI{constructor(controller,saveProvider,domElement,editElement,saveElement,cancelElement,busyIndicatorElement,{savePublishElement:savePublishElement,saveDraftElement:saveDraftElement,savePendingElement:savePendingElement,postStatus:postStatus}){super(controller,saveProvider,domElement,editElement,saveElement,cancelElement,busyIndicatorElement,{savePublishElement:savePublishElement,saveDraftElement:saveDraftElement,savePendingElement:savePendingElement,postStatus:postStatus}),this._controller=controller,this._saveProvider=saveProvider,this._domElement=domElement,this._editElement=editElement,this._saveElement=saveElement,this._cancelElement=cancelElement,this._busyIndicatorElement=busyIndicatorElement,this.buttons={},this._domElement.classList.add("pbs-adminbar"),this.addButton("edit",new PBSButton.Button(this._editElement,"edit",this._controller.edit.bind(this._controller))),this.addButton("save",new PBSButton.Button(this._saveElement,"save",this._save.bind(this))),this.addButton("cancel",new PBSButton.Button(this._cancelElement,"cancel",this._controller.cancel.bind(this._controller))),this.addButton("busy",new PBSButton.Button(this._busyIndicatorElement,"busy")),savePublishElement&&this.addButton("save-publish",new PBSButton.Button(savePublishElement,"save-publish",this._savePublish.bind(this))),saveDraftElement&&this.addButton("save-draft",new PBSButton.Button(saveDraftElement,"save-draft",this._saveDraft.bind(this))),savePendingElement&&this.addButton("save-pending",new PBSButton.Button(savePendingElement,"save-pending",this._savePending.bind(this))),postStatus&&this.applyPostStatusClass(postStatus)}applyPostStatusClass(postStatus){var status,allStatus=["publish","draft","pending"];if(this._domElement){for(status of allStatus)status!==postStatus&&this._domElement.classList.remove("pbs-post-status-"+status);this._domElement.classList.add("pbs-post-status-"+postStatus)}}_save(){this._controller.save.call(this._controller)}_savePublish(){this._saveProvider.addData("post_status","publish"),this.applyPostStatusClass("publish"),this._controller.save.call(this._controller)}_saveDraft(){this._saveProvider.addData("post_status","draft"),this.applyPostStatusClass("draft"),this._controller.save.call(this._controller)}_savePending(){this._saveProvider.addData("post_status","pending"),this.applyPostStatusClass("pending"),this._controller.save.call(this._controller)}get domElement(){return this._domElement}addButton(name,button){this.buttons[name]=button,button.mount()}getButton(name){return void 0!==this.buttons[name]?this.buttons[name]:null}removeButton(name){var button=this.getButton(name);button&&(button.unmount(),this.buttons[name]=void 0,delete this.buttons[name])}getButtons(){return this.buttons}},PBSAdminBar.CTAdminBar=class extends PBSAdminBar.AdminBar{constructor(controller,saveProvider,domElement,editElement,saveElement,cancelElement,busyIndicatorElement,{savePublishElement:savePublishElement,saveDraftElement:saveDraftElement,savePendingElement:savePendingElement,postStatus:postStatus}){super(controller,saveProvider,domElement,editElement,saveElement,cancelElement,busyIndicatorElement,{savePublishElement:savePublishElement,saveDraftElement:saveDraftElement,savePendingElement:savePendingElement,postStatus:postStatus}),wp.hooks.addAction("pbs.ct.mounted.pre",this.mountButtons.bind(this),1)}mountButtons(ignition){ignition._domElement=this.domElement,ignition._domEdit=this.getButton("edit").domElement,ignition._domConfirm=this.getButton("save").domElement,ignition._domCancel=this.getButton("cancel").domElement,ignition._domBusy=this.getButton("busy").domElement}},PBSModal={},PBSModal.ModalI=class{constructor(template){}get element(){}init(){}destroy(){}show(){}hide(){}},PBSModal.Modal=class extends PBSModal.ModalI{constructor(template){super(template),this._template=template,this._domElement=null}get element(){return this._domElement}init(){var closeButton;super.init(),this._domElement=document.createElement("DIV"),this._domElement.classList.add("pbs-modal-background"),this._domElement.innerHTML=wp.template("pbs-modal")(),this._domElement.querySelector(".pbs-modal-content-wrapper").setAttribute("id","pbs-modal-"+this._template),(closeButton=this._domElement.querySelector(".pbs-modal-close"))&&closeButton.addEventListener("click",this.hide.bind(this)),this._domElement.addEventListener("click",function(ev){ev.currentTarget===ev.target&&this.hide()}.bind(this)),this._domElement.querySelector(".pbs-modal-content").innerHTML=wp.template(this._template)(),document.body.appendChild(this._domElement),wp.hooks.doAction("pbs.modal.init",this)}destroy(){super.destroy(),this._domElement&&(this._domElement.parentNode.removeChild(this._domElement),this._domElement=null,wp.hooks.doAction("pbs.modal.destroy",this))}show(){if(!this._domElement)throw"Modal has not been initialized yet.";super.show(),this._domElement.classList.add("pbs-modal-show"),setTimeout(function(){this._domElement&&this._domElement.classList.add("pbs-modal-anim")}.bind(this),50),wp.hooks.doAction("pbs.modal.show",this)}hide(){if(!this._domElement)throw"Modal has not been initialized yet.";super.hide(),this._domElement.classList.remove("pbs-modal-show"),this._domElement.classList.remove("pbs-modal-anim"),wp.hooks.doAction("pbs.modal.hide",this)}},new function(){var ready=function(){var editor=ContentTools.EditorApp.get(),pbsMainWrapper=document.querySelector(".pbs-main-wrapper"),pbsStyle=document.querySelector("style#pbs-style"),saveProvider=new PBSSaver.AjaxPostSaver;pbsStyle||((pbsStyle=document.createElement("STYLE")).setAttribute("id","pbs-style"),document.body.appendChild(pbsStyle));var contentProvider=new PBSContent.CTContent(editor,pbsMainWrapper,pbsStyle),ignitionController=new PBSController.PostCTController(editor,pbsMainWrapper,contentProvider,saveProvider);PBS=new PBSI(ignitionController);var adminBar=new PBSAdminBar.CTAdminBar(ignitionController,saveProvider,document.querySelector("#wpadminbar"),document.querySelector("#wp-admin-bar-gambit_builder_edit"),document.querySelector("#wp-admin-bar-gambit_builder_save"),document.querySelector("#wp-admin-bar-gambit_builder_cancel"),document.querySelector("#wp-admin-bar-gambit_builder_busy"),{savePublishElement:document.querySelector("#wp-admin-bar-gambit_builder_save_options #pbs-save-publish"),saveDraftElement:document.querySelector("#wp-admin-bar-gambit_builder_save_options #pbs-save-draft"),savePendingElement:document.querySelector("#wp-admin-bar-gambit_builder_save_options #pbs-save-pending"),postStatus:pbsParams.post_status}),helpButton=new PBSButton.Button(document.querySelector("#wp-admin-bar-pbs_help_docs"),"help",function(ev){ev.preventDefault(),window.HS?HS.beacon.open():window.open("http://docs.pagebuildersandwich.com/","_blank")});adminBar.addButton("help",helpButton),PBS.init()};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)},window.PBSEditor={},window.PBSEditor.getToolUI=function(name){var tool;return window.PBSEditor.ToolboxFormatting&&(tool=window.PBSEditor.ToolboxFormatting.getInstance().getTool(name))?tool:ContentTools.EditorApp.get()._toolboxElements._toolUIs[name]?ContentTools.EditorApp.get()._toolboxElements._toolUIs[name]:ContentTools.EditorApp.get()._toolbox._toolUIs[name]},ContentEdit.Root.get().bind("mount",function(element){element.domElement()._ceElement=element}),ContentTools.EditorApp.get().highlightRegions=function(){},window.PBSEditor.updateModifiedContent=function(){var i,regions=ContentTools.EditorApp.get().regions();for(i in regions)regions.hasOwnProperty(i)&&window.PBSEditor.updateModifiedContentRecursive(regions[i])},window.PBSEditor.updateModifiedContentRecursive=function(element){var ctElement,k,children=element.children;if(children)for(k=0;k<children.length;k++)void 0!==(ctElement=children[k]).content&&ctElement.content.html()!==ctElement._domElement.innerHTML&&window.PBSEditor.updateElementContent(ctElement,ctElement._domElement.innerHTML),window.PBSEditor.updateModifiedContentRecursive(ctElement)},window.PBSEditor.updateElementContent=function(element,newContent){"Shortcode"!==element.constructor.name&&(element.content=new HTMLString.String(newContent,element.content.preserveWhitespace()).trim(),element.updateInnerHTML(),element.taint())},window.PBSEditor.getUniqueClassName=function(domElement){var classes,matches;return domElement.getAttribute("class")&&(classes=domElement.getAttribute("class"),matches=classes.match(/pbsguid-\w+/))?matches[0]:null},window.PBSEditor.removeUniqueClassName=function(domElement){var classes,matches;return!!(domElement.getAttribute("class")&&(classes=domElement.getAttribute("class"),matches=classes.match(/pbsguid-\w+/)))&&(domElement.classList.remove(matches[0]),!0)},window.PBSEditor.generateUniqueClassName=function(){var name;do{name="pbsguid-"+window.PBSEditor.generateHash()}while(document.querySelector("."+name));return name},window.PBSEditor.generateHash=function(){return Math.floor(4294967296*(1+Math.random())).toString(36).substring(1)},window.PBSEditor.addPseudoElementStylesRaw=function(styles){var currentStyles,mainRegion,styleTag=document.querySelector("style#pbs-style");return styleTag||((styleTag=document.createElement("style")).setAttribute("id","pbs-style"),document.body.appendChild(styleTag)),currentStyles=styleTag.innerHTML+styles,void 0===(mainRegion=ContentTools.EditorApp.get().regions()["main-content"])._debouncedTaint&&(mainRegion._debouncedTaint=_.debounce(function(){this.taint()}.bind(mainRegion),400)),mainRegion._debouncedTaint(),styleTag.innerHTML=currentStyles,styles},window.PBSEditor.addPseudoElementStyles=function(selector,styles){var currentStyles,styleName,value,escapedSelector,re,mainRegion,styleString="",selectorStillExists=window.PBSEditor.removePseudoElementStyles(selector,Object.keys(styles)),styleTag=document.querySelector("style#pbs-style");styleTag||((styleTag=document.createElement("style")).setAttribute("id","pbs-style"),document.body.appendChild(styleTag)),currentStyles=styleTag.innerHTML;for(styleName in styles)styles.hasOwnProperty(styleName)&&((value=styles[styleName]).trim&&(value=value.trim()),value&&(styleString+=styleName+": "+value+";"));return escapedSelector=selector.replace(/\./g,"\\."),selectorStillExists?(re=new RegExp("("+escapedSelector+"\\s*\\{)","gm"),currentStyles=currentStyles.replace(re,"$1"+styleString)):currentStyles+=selector+" {"+styleString+"}",void 0===(mainRegion=ContentTools.EditorApp.get().regions()["main-content"])._debouncedTaint&&(mainRegion._debouncedTaint=_.debounce(function(){this.taint()}.bind(mainRegion),400)),mainRegion._debouncedTaint(),styleTag.innerHTML=currentStyles,styleString},window.PBSEditor.getPseudoElementStyles=function(selector,style){var currentStyles,selectorPattern,re,matches,stylesMatch,k,styleMatch,value,styleTag=document.querySelector("style#pbs-style");if(!styleTag)return null;if(currentStyles=styleTag.innerHTML,selectorPattern=selector.replace(/\./g,"\\."),re=new RegExp(selectorPattern+"\\s*\\{([\\s\\S]*?)\\}","m"),!(matches=currentStyles.match(re)))return null;for(stylesMatch=matches[1].replace(/;$/,"").split(";"),k=0;k<stylesMatch.length;k++)if(styleMatch=stylesMatch[k].match(new RegExp("^"+style+"\\s*:([\\s\\S]*$)")))return(value=styleMatch[1].trim())&&(value=value.replace(/\s*!important/,"")),value;return null},window.PBSEditor.removePseudoElementStyles=function(selector,styles){var styleTag,selectorPattern,re,stylesMatch,currentStyles,i,styleName,matches,k;if("string"==typeof styles&&(styles=[styles]),!(styleTag=document.querySelector("style#pbs-style")))return!1;for(selectorPattern=selector.replace(/\./g,"\\."),currentStyles=styleTag.innerHTML,i=0;i<styles.length;i++)if(styleName=styles[i],re=new RegExp(selectorPattern+"\\s*\\{([\\s\\S]*?)\\}","m"),matches=currentStyles.match(re)){for(stylesMatch=matches[1].replace(/;$/,"").split(";"),k=0;k<stylesMatch.length;k++)if(stylesMatch[k].match(new RegExp("^"+styleName+"\\s*:"))){stylesMatch.splice(k,1);break}stylesMatch=stylesMatch.join(";"),currentStyles=currentStyles.replace(matches[0],""),currentStyles+=selector+" {"+stylesMatch+"}"}return(currentStyles=currentStyles.replace(/(^|[^\}])+\{[\s]*\}/gm,"").trim())?(styleTag.innerHTML=currentStyles,re=new RegExp(selectorPattern+"\\s*\\{","gm"),!!styleTag.innerHTML.match(re)):(styleTag.parentNode.removeChild(styleTag),!1)},window.PBSEditor.convertSVGToBackgroundImage=function(svgElement){var svgString;return svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg"),svgString=svgElement.outerHTML,svgString=svgString.replace(/"/g,"'"),svgString=svgString.replace(/</g,"%3C"),svgString=svgString.replace(/>/g,"%3E"),svgString=svgString.replace(/&/g,"%26"),svgString=svgString.replace(/#/g,"%23"),svgString=svgString.replace(/\n/g,""),svgString='url("data:image/svg+xml,'+svgString+'")'},window.PBSEditor.isCtrlDown=!1,window.PBSEditor.isShiftDown=!1,function(){var ready=function(){document.addEventListener("keydown",function(ev){(ev.ctrlKey||ev.metaKey)&&(window.PBSEditor.isCtrlDown=!0),ev.shiftKey&&(window.PBSEditor.isShiftDown=!0)}),document.addEventListener("keyup",function(ev){ev.ctrlKey||ev.metaKey||(window.PBSEditor.isCtrlDown=!1),ev.shiftKey||(window.PBSEditor.isShiftDown=!1)})};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),function(){var _Root=ContentEdit.Root.get(),proxied=_Root._getDropPlacement;_Root._getDropPlacement=function(x,y){var placements,rect,_ref,vert,horz;return this._dropTarget?-1===(placements=this._dropTarget.constructor.placements).indexOf("center")&&-1!==placements.indexOf("left")&&-1!==placements.indexOf("right")?(rect=this._dropTarget.domElement().getBoundingClientRect(),_ref=[x-rect.left,y-rect.top],x=_ref[0],y=_ref[1],horz="center",horz=x<rect.width/2?"left":"right",vert="above",y>rect.height/2&&(vert="below"),[vert,horz]):proxied.call(this,x,y):null}}(),function(){var ready=function(){document.body.addEventListener("click",function(ev){PBS.isEditing&&"A"===ev.target.tagName&&window.pbsSelectorMatches(ev.target,".pbs-main-wrapper *")&&ev.preventDefault()})};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),ContentEdit.Element.prototype.style=function(name,value){var style;if(void 0===value)return this._domElement?(style=this._domElement.style[name])||(style=window.getComputedStyle(this._domElement))[name]:null;if(!this._domElement)return value;if(this._domElement.style[name]===value)return value;if(this._domElement.style[name]=value,null===(style=this._domElement.getAttribute("style")))return this._attributes.style="",this.isMounted()&&this._domElement.removeAttribute("style"),void 0===this.debouncedTaint&&(this.debouncedTaint=_.debounce(function(){this.taint()}.bind(this),400)),this.debouncedTaint();for(;style.match(/(rgba\(\s*\d+,\s*\d+,\s*\d+,\s*\d+.\d{2})\d+/i);)style=style.replace(/(rgba\(\s*\d+,\s*\d+,\s*\d+,\s*\d+.\d{2})\d+/i,"$1");return this.attr("style",style)},ContentEdit.Element.prototype.defaultStyle=function(name){var origStyleAttribute,defaultStyle;return this._domElement?(origStyleAttribute=this._domElement.getAttribute("style"),this._domElement.style[name]="",defaultStyle=window.getComputedStyle(this._domElement),defaultStyle=void 0!==defaultStyle[name]?defaultStyle[name]:0,origStyleAttribute?this._domElement.setAttribute("style",origStyleAttribute):this._domElement.removeAttribute("style"),defaultStyle):""},function(){var proxy=ContentEdit.Element.prototype.removeAttr;ContentEdit.Element.prototype.removeAttr=function(name){return name=name.toLowerCase(),!this._attributes[name]&&this._attributes.hasOwnProperty(name)?(delete this._attributes[name],this.isMounted()&&"class"!==name.toLowerCase()&&this._domElement.removeAttribute(name),this.taint()):proxy.call(this,name)}}(),ContentEdit.Element.prototype.attr=function(name,value,forceSet){return name=name.toLowerCase(),void 0===value?this._attributes[name]:this._attributes[name]!==value?(this._attributes[name]=value,this.isMounted()&&"class"!==name.toLowerCase()&&(""!==value||forceSet?this._domElement.setAttribute(name,value):this._domElement.removeAttribute(name)),void 0===this.debouncedTaint&&(this.debouncedTaint=_.debounce(function(){this.taint()}.bind(this),400)),ContentEdit.Root.get().trigger("debounced_taint",this),this.debouncedTaint()):void 0},ContentEdit.Element.prototype.removeAllCSSClasses=function(){var i;if(this._domElement&&this._domElement.classList)for(i=this._domElement.classList.length-1;i>=0;i--)this.removeCSSClass(this._domElement.classList.item(i))},window._contentToolsShim=function(editor){editor.start=function(){ContentTools.EditorApp.getCls().prototype.start.call(this),editor.trigger("start")},editor.stop=function(){ContentTools.EditorApp.getCls().prototype.stop.call(this),editor.trigger("stop")}},function(){var proxied=ContentEdit.Element.prototype._addCSSClass,ignoredClasses=["ce-element--drop","ce-element--drop-above","ce-element--drop-below","ce-element--drop-left","ce-element--drop-right","ce-element--drop-center","ce-element--over","ce-element--resize-top-left","ce-element--resize-top-right","ce-element--resize-bottom-left","ce-element--resize-bottom-right","ce-element--resize","ce-element--resizing","ce-element--focused"];ContentEdit.Element.prototype._addCSSClass=function(className){if(-1===ignoredClasses.indexOf(className))return"ce-element--over"===className&&ContentEdit.Root.get().trigger("over",this),proxied.call(this,className)}}(),function(){var proxied=ContentEdit.Element.prototype._removeCSSClass,ignoredClasses=["ce-element--drop","ce-element--drop-above","ce-element--drop-below","ce-element--drop-left","ce-element--drop-right","ce-element--drop-center","ce-element--over","ce-element--resize-top-left","ce-element--resize-top-right","ce-element--resize-bottom-left","ce-element--resize-bottom-right","ce-element--resize","ce-element--resizing","ce-element--focused"];ContentEdit.Element.prototype._removeCSSClass=function(className){if(-1===ignoredClasses.indexOf(className))return"ce-element--over"===className&&ContentEdit.Root.get().trigger("out",this),proxied.call(this,className)}}(),function(){var ready=function(){var starterInterval;document.querySelector('[data-name="main-content"]')&&(starterInterval=setInterval(function(){document.querySelector(".ct-widget--active")&&(wp.hooks.doAction("pbs.ct.ready"),clearInterval(starterInterval))},200))};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),ContentTools.IgnitionUIOriginal=ContentTools.IgnitionUI,ContentTools.IgnitionUI=function(_super){function IgnitionUI(){IgnitionUI.__super__.constructor.call(this)}return __extends(IgnitionUI,_super),IgnitionUI.prototype.mount=function(){wp.hooks.doAction("pbs.ct.mounted.pre",this),wp.hooks.doAction("pbs.ct.mounted",this)},IgnitionUI}(ContentTools.IgnitionUIOriginal),function(){var proxied=ContentTools.History.prototype.undo;ContentTools.History.prototype.undo=function(){var ret=proxied.call(this);return wp.hooks.doAction("pbs.undo"),ret}}(),function(){var proxied=ContentTools.History.prototype.redo;ContentTools.History.prototype.redo=function(){var ret=proxied.call(this);return wp.hooks.doAction("pbs.redo"),ret}}(),function(){var proxied=ContentEdit.ResizableElement.prototype.size;ContentEdit.ResizableElement.prototype.size=function(newSize){var height,width,rect;return!newSize&&this._domElement?(rect=this._domElement.getBoundingClientRect(),width=parseInt(rect.width||1,10),height=parseInt(rect.height||1,10),[width,height]):proxied.call(this,newSize)}}(),function(){var proxied=ContentEdit.ResizableElement.prototype.size;ContentEdit.ResizableElement.prototype.size=function(newSize){var ratio,parentWidth,ret=proxied.call(this,newSize);return newSize&&2===newSize.length&&this.parent()&&this.parent()._domElement&&(parentWidth=window.pbsGetBoundingClientRect(this.parent()._domElement).width,newSize[0]>parentWidth&&(ratio=newSize[1]/newSize[0],newSize[0]=parentWidth,newSize[1]=newSize[0]*ratio),this._domElement.style.width=newSize[0]+"px",this._domElement.style.height=newSize[1]+"px"),ret}}(),function(){var proxied=ContentEdit.ResizableElement.prototype._onMouseDown;ContentEdit.ResizableElement.prototype._onMouseDown=function(ev){this._getResizeCorner(ev.clientX,ev.clientY)&&window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown&&(this.style("width","auto"),this.style("height","auto"),this.attr("height",""),this.attr("width","")),proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Element.prototype.drop;ContentEdit.Element.prototype.drop=function(element,placement){var root=ContentEdit.Root.get();return element&&void 0!==element.type&&!this.constructor.droppers[element.type()]&&!element.constructor.droppers[this.type()]&&element.constructor.droppers["*"]?(element._removeCSSClass("ce-element--drop"),element._removeCSSClass("ce-element--drop-"+placement[0]),element._removeCSSClass("ce-element--drop-"+placement[1]),element.constructor.droppers["*"](this,element,placement),void root.trigger("drop",this,element,placement)):proxied.call(this,element,placement)}}(),function(){var proxied=ContentEdit.Element.prototype._onOver;ContentEdit.Element.prototype._onOver=function(ev){var root,dragging,ret=proxied.call(this,ev);if(!ret){if(root=ContentEdit.Root.get(),!(dragging=root.dragging()))return;if(dragging===this)return;if(root._dropTarget)return;if(this.constructor.droppers["*"])return this._addCSSClass("ce-element--drop"),root._dropTarget=this}return ret}}(),ContentEdit.ResizableElement.prototype._getResizeCorner=function(){return null},ContentTools.WidgetUI.prototype.hide=function(){this.removeCSSClass("ct-widget--active")},PBSEditor.Frame=wp.media.view.Frame.extend({className:"pbs-icon-modal",template:wp.template("pbs-icon-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked"},initialize:function(){wp.media.view.Frame.prototype.initialize.apply(this,arguments),_.defaults(this.options,{title:"My Modal",button:"My Button",modal:!0}),this.options.modal&&(this.modal=new wp.media.view.Modal({controller:this}),this.modal.content(this),this.modal.on("open",_.bind(function(){this._onOpen()},this)),this.modal.on("close",_.bind(function(){this._onClose()},this)))},open:function(args){args||(args={}),this.options=_.defaults(args,this.options),args.content&&this.modal.content(args.content(this)),this.modal.open(),this.modal.el.children[0].classList.add("pbs-modal-frame"),this.className&&this.modal.el.children[0].classList.add(this.className),this.modal.el.querySelector(".media-frame-title h1")&&(this.modal.el.querySelector(".media-frame-title h1").textContent=this.options.title),this.modal.el.querySelector(".media-toolbar-primary button")&&(this.modal.el.querySelector(".media-toolbar-primary button").textContent=this.options.button),this.modal.el.children[0].classList.add("pbs-frame-hide"),setTimeout(function(){this.modal.el.children[0].classList.remove("pbs-frame-hide")}.bind(this),50)},close:function(){this.modal.close()},_primaryClicked:function(){this.modal.close(),this.options.successCallback&&this.options.successCallback(this)},_onOpen:function(){this.options.openCallback&&this.options.openCallback(this)},_onClose:function(){this.options.closeCallback&&this.options.closeCallback(this)}}),PBSEditor.SearchFrame=PBSEditor.Frame.extend({className:"pbs-icon-modal",template:wp.template("pbs-icon-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked"},_onOpen:function(){PBSEditor.Frame.prototype._onOpen.apply(this),setTimeout(function(){var searchInput=this.modal.el.querySelector('input[type="search"]');searchInput.focus(),searchInput.select()}.bind(this),1),this.selected||this.modal.el.querySelector(".media-toolbar-primary button").setAttribute("disabled","disabled"),this.modal.el.querySelector(".pbs-no-results").style.display=""},_onClose:function(){this.modal.el.querySelector('input[type="search"]').focus()},searchKeyup:function(ev){clearTimeout(this._searchTimeout),this._searchTimeout=setTimeout(function(){this.doSearch(ev)}.bind(this),400)},reset:function(){this.selected=null,this.model.el.querySelector(".pbs-no-results").style.display="",this.modal.el.querySelector(".media-toolbar-primary button").setAttribute("disabled","disabled")},doSearch:function(ev){var keyword=ev.target.value.trim().toLowerCase(),shortcodes=this.modal.el.querySelectorAll(".pbs-search-list > *"),hasResult=!1;Array.prototype.forEach.call(shortcodes,function(el){""===keyword||-1!==el.textContent.trim().toLowerCase().indexOf(keyword)?(el.style.display="",hasResult=!0):el.style.display="none"}),this.modal.el.querySelector(".pbs-no-results").style.display=hasResult?"":"flex"},select:function(ev){for(var target=ev.target;!target.parentNode.classList.contains("pbs-search-list");)target=target.parentNode;this.selected=target,this.modal.el.querySelector(".pbs-selected")&&this.modal.el.querySelector(".pbs-selected").classList.remove("pbs-selected"),target.classList.add("pbs-selected"),this.modal.el.querySelector(".media-toolbar-primary button").removeAttribute("disabled"),this._justClicked===target&&this._primaryClicked(),this._justClicked=target,clearTimeout(this._justClickedTimeout),this._justClickedTimeout=setTimeout(function(){this._justClicked=!1}.bind(this),300)}}),PBSEditor._IconFrame=PBSEditor.Frame.extend({className:"pbs-icon-modal",template:wp.template("pbs-icon-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked",'keyup [type="search"]':"searchKeyup","click .pbs-icon-display [data-name]":"selectIcon"},_onOpen:function(){PBSEditor.Frame.prototype._onOpen.apply(this),setTimeout(function(){var searchInput=this.modal.el.querySelector('input[type="search"]');""===searchInput.value&&(searchInput.value="dashicons",this.searchKeyup({target:searchInput})),searchInput.focus(),searchInput.select()}.bind(this),1),this.selected||this.modal.el.querySelector(".media-toolbar-primary button").setAttribute("disabled","disabled")},_onClose:function(){this.modal.el.querySelector('input[type="search"]').focus()},searchKeyup:function(ev){clearTimeout(this._searchTimeout),this._searchTimeout=setTimeout(function(){this.doSearch(ev)}.bind(this),400)},reset:function(){var item;for(this._searchResults=[],this.modal.el.querySelector(".pbs-no-results").style.display="";this.modal.el.querySelector(".pbs-search-list > *:not(.pbs-no-results)");)(item=this.modal.el.querySelector(".pbs-search-list > *:not(.pbs-no-results)")).parentNode.removeChild(item);this._prevKeyword="",this.selected=null,this._currentGroup=null,this.modal.el.querySelector(".media-toolbar-primary button").setAttribute("disabled","disabled")},doSearch:function(ev){var request,keyword=ev.target.value.trim();keyword&&this._prevKeyword!==keyword&&(this.reset(),this._prevKeyword=keyword,void 0===pbsParams.icon_searches&&(pbsParams.icon_searches=[]),void 0!==ev.keyCode&&pbsParams.icon_searches.push(keyword),(request=new XMLHttpRequest).open("POST",pbsParams.ajax_url,!0),request.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),request.onload=function(){var response;if(request.status>=200&&request.status<400){if(request.responseText)return void 0!==(response=JSON.parse(request.responseText)).length||0===response.length?void this.displayNoResults():(this._searchResults=response,void this.displayResults());this.displayNoResults()}}.bind(this),request.send("action=pbs_icon_search&nonce="+pbsParams.nonce+"&s="+keyword))},displayNoResults:function(){this.modal.el.querySelector(".pbs-no-results").style.display="flex"},displayResults:function(){var key,result,currGroup,item,groupRegex,icon,groupLabel,keys=Object.keys(this._searchResults);if(keys.length){if(key=keys[0],result=this._searchResults[Object.keys(this._searchResults)[0]],delete this._searchResults[key],void 0===this.groups){this.groups={};for(groupLabel in pbsParams.icon_groups)pbsParams.icon_groups.hasOwnProperty(groupLabel)&&(this.groups[groupLabel]=new RegExp(pbsParams.icon_groups[groupLabel],"i"))}currGroup="";for(groupLabel in this.groups)if(this.groups.hasOwnProperty(groupLabel)&&(groupRegex=this.groups[groupLabel],key.match(groupRegex))){currGroup=groupLabel;break}this._currentGroup!==currGroup&&((item=document.createElement("h4")).innerHTML=groupLabel,item.classList.add("pbs-icon-group-title"),this.modal.el.querySelector(".pbs-icon-display").appendChild(item),this._currentGroup=currGroup),(icon=document.createElement("div")).innerHTML=result,icon.setAttribute("data-name",key),this.modal.el.querySelector(".pbs-icon-display").appendChild(icon),keys.length>1&&setTimeout(function(){this.displayResults()}.bind(this),5),this.modal.el.querySelector(".pbs-no-results").style.display=""}},selectIcon:function(ev){for(var target=ev.target;!target.getAttribute("data-name");)target=target.parentNode;this.selected=target,this.modal.el.querySelector(".pbs-icon-display .pbs-selected")&&this.modal.el.querySelector(".pbs-icon-display .pbs-selected").classList.remove("pbs-selected"),target.classList.add("pbs-selected"),this.modal.el.querySelector(".media-toolbar-primary button").removeAttribute("disabled"),this._justClicked===target&&this._primaryClicked(),this._justClicked=target,clearTimeout(this._justClickedTimeout),this._justClickedTimeout=setTimeout(function(){this._justClicked=!1}.bind(this),300)}}),function(){var ready=function(){PBSEditor.iconFrame=new PBSEditor._IconFrame};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),wp.hooks.addFilter("pbs.save.payload",function(payload){return void 0!==pbsParams.icon_searches&&payload.append("icon_searches",pbsParams.icon_searches),payload}),PBSEditor._WidgetFrame=PBSEditor.SearchFrame.extend({className:"pbs-widget-modal",template:wp.template("pbs-widget-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked",'keyup [type="search"]':"searchKeyup","click [data-widget-slug]":"select"}}),function(){var ready=function(){PBSEditor.widgetFrame=new PBSEditor._WidgetFrame};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),PBSEditor._ShortcodeFrame=PBSEditor.SearchFrame.extend({className:"pbs-shortcode-modal",template:wp.template("pbs-shortcode-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked",'keyup [type="search"]':"searchKeyup","click [data-shortcode-tag]":"select","click .pbs-refresh-mappings":"refreshShortcodeMappings"},_onOpen:function(){PBSEditor.SearchFrame.prototype._onOpen.apply(this),this.initShortcodeList()},initShortcodeList:function(){var sc,tag,i,div,title,desc,owner,preview,map,allShortcodes=[],shortcodeArea=this.modal.el.querySelector(".pbs-search-list");if(!shortcodeArea.querySelector("*:not(.pbs-no-results)")){for(i=0;i<pbsParams.shortcodes.length;i++)if(tag=pbsParams.shortcodes[i],void 0===pbsParams.shortcodes_to_hide||-1===pbsParams.shortcodes_to_hide.indexOf(tag)){if(sc={tag:tag,name:tag.replace(/[\-_]/g," "),desc:"",owner:"",ownerslug:"",image:"",isMapped:!1},pbsParams.shortcode_mappings[tag]){if("1"===(map=pbsParams.shortcode_mappings[tag]).is_hidden)continue;sc.desc=map.description,sc.owner=map.owner,sc.ownerslug=map["owner-slug"],sc.image="http://ps.w.org/"+sc.ownerslug+"/assets/icon-128x128.png), url(http://ps.w.org/"+sc.ownerslug+"/assets/icon.svg), url("+pbsParams.plugin_url+"page_builder_sandwich/assets/element-icons/shortcode_single.svg",map.owner===pbsParams.theme&&(sc.image=pbsParams.stylesheet_directory_uri+"screenshot.png"),sc.isMapped=!0,map.name&&(sc.name=map.name)}if(PBSInspectorOptions.Shortcode[pbsParams.shortcodes[i]]){if("1"===(map=PBSInspectorOptions.Shortcode[pbsParams.shortcodes[i]]).is_hidden)continue;map.label&&(sc.name=map.label),map.name&&(sc.name=map.name),map.desc&&(sc.desc=map.desc),map.owner&&(sc.owner=map.owner),map.image&&(sc.image=map.image),sc.isMapped=!0}allShortcodes.push(sc)}allShortcodes.sort(function(a,b){var x=a.name.toLowerCase(),y=b.name.toLowerCase(),ret=x<y?-1:x>y?1:0,xMap=a.isMapped;return xMap===b.isMapped?ret:xMap?-1:1});for(tag in allShortcodes)allShortcodes.hasOwnProperty(tag)&&(sc=allShortcodes[tag],(div=document.createElement("DIV")).setAttribute("data-shortcode-tag",sc.tag),(title=document.createElement("H4")).innerHTML=sc.name,div.appendChild(title),sc.desc&&((desc=document.createElement("P")).innerHTML=sc.desc,div.appendChild(desc)),(owner=document.createElement("P")).classList.add("pbs-shortcode-owner"),owner.innerHTML=sc.owner+" ["+sc.tag+"]",div.appendChild(owner),sc.isMapped&&((preview=document.createElement("DIV")).classList.add("pbs-shortcode-owner-image"),sc.image&&preview.setAttribute("style","background-image: url("+sc.image+")"),div.appendChild(preview),div.classList.add("pbs-has-owner-image")),shortcodeArea.appendChild(div))}},refreshShortcodeMappings:function(ev){var payload,xhr;if(ev.preventDefault(),!this._isUpdatingShortcodes)return this._isUpdatingShortcodes=!0,this.modal.$el.addClass("pbs-busy"),(payload=new FormData).append("action","pbs_update_shortcode_mappings"),payload.append("nonce",pbsParams.nonce),xhr=new XMLHttpRequest,xhr.onload=function(){var response,shortcode,shortcodeArea,noResults;if(this.modal.$el.removeClass("pbs-busy"),xhr.status>=200&&xhr.status<400&&(this._isUpdatingShortcodes=null,response=JSON.parse(xhr.responseText))){for(shortcode in pbsParams.shortcode_mappings)pbsParams.shortcode_mappings.hasOwnProperty(shortcode)&&window.pbsRemoveInspector(shortcode);for(pbsParams.shortcode_mappings=response,(noResults=(shortcodeArea=this.modal.el.querySelector(".pbs-search-list")).querySelector(".pbs-no-results")).parentNode.removeChild(noResults);shortcodeArea.firstChild;)shortcodeArea.removeChild(shortcodeArea.firstChild);shortcodeArea.appendChild(noResults),this.initShortcodeList()}}.bind(this),xhr.onerror=function(){this.modal.$el.removeClass("pbs-busy"),this._isUpdatingShortcodes=null},xhr.open("POST",pbsParams.ajax_url),xhr.send(payload),!1}}),function(){var ready=function(){PBSEditor.shortcodeFrame=new PBSEditor._ShortcodeFrame};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),PBSEditor._PredesignedFrame=PBSEditor.SearchFrame.extend({className:"pbs-predesigned-modal",template:wp.template("pbs-predesigned-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked",'keyup [type="search"]':"searchKeyup","click [data-template]":"select"},_onOpen:function(){PBSEditor.SearchFrame.prototype._onOpen.apply(this),this.initList()},initList:function(){var container,designElements;this.modal.el.querySelector(".pbs-search-list > *:not(.pbs-no-results)")||(container=this.modal.el.querySelector(".pbs-search-list"),designElements=document.querySelectorAll("[data-design-element-template]"),Array.prototype.forEach.call(designElements,function(el){var elem,templateID=el.getAttribute("id"),name=el.getAttribute("data-name"),description=el.getAttribute("data-description"),image=el.getAttribute("data-image"),button=document.createElement("DIV");button.setAttribute("data-template",templateID),button.setAttribute("data-root-only",el.getAttribute("data-root-only")),image&&((elem=document.createElement("img")).setAttribute("src",image),elem.setAttribute("alt",name||templateID),button.appendChild(elem)),name&&((elem=document.createElement("h4")).innerHTML=name,button.appendChild(elem)),description&&((elem=document.createElement("p")).classList.add("description"),elem.innerHTML=description,button.appendChild(elem)),container.appendChild(button)}))}}),function(){var ready=function(){PBSEditor.predesignedFrame=new PBSEditor._PredesignedFrame};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),PBSEditor._PageTemplateFrame=PBSEditor.SearchFrame.extend({className:"pbs-page-template-modal",template:wp.template("pbs-page-template-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked",'keyup [type="search"]':"searchKeyup","click [data-template]":"select"},_onOpen:function(){PBSEditor.SearchFrame.prototype._onOpen.apply(this),this.initList()},initList:function(){var container,designElements;this.modal.el.querySelector(".pbs-search-list > *:not(.pbs-no-results)")||(container=this.modal.el.querySelector(".pbs-search-list"),designElements=document.querySelectorAll("[data-page-template-template]"),Array.prototype.forEach.call(designElements,function(el){var elem,templateID=el.getAttribute("id"),name=el.getAttribute("data-name"),description=el.getAttribute("data-description"),image=el.getAttribute("data-image"),button=document.createElement("DIV");button.setAttribute("data-template",templateID),button.setAttribute("data-root-only",el.getAttribute("data-root-only")||!1),pbsParams.is_lite&&(button.classList.add("pbs-lite-template"),button.setAttribute("data-preview",el.getAttribute("data-preview")),button.addEventListener("click",function(){window.open(this.getAttribute("data-preview"),"pbs-preview")})),image&&((elem=document.createElement("img")).setAttribute("src",image),elem.setAttribute("alt",name||templateID),button.appendChild(elem)),pbsParams.is_lite&&((elem=document.createElement("button")).classList.add("preview"),elem.innerHTML=pbsParams.labels.view_template,button.appendChild(elem)),name&&((elem=document.createElement("h4")).innerHTML=name,pbsParams.is_lite&&(elem.innerHTML+=" <span>("+pbsParams.labels.premium+")</span>"),button.appendChild(elem)),description&&((elem=document.createElement("p")).classList.add("description"),elem.innerHTML=description,button.appendChild(elem)),container.appendChild(button)}))}}),function(){var ready=function(){PBSEditor.pageTemplateFrame=new PBSEditor._PageTemplateFrame};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),PBSEditor._HtmlFrame=PBSEditor.Frame.extend({className:"pbs-html-modal",template:wp.template("pbs-html-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked","keydown textarea":"tabHandler"},_onOpen:function(){PBSEditor.Frame.prototype._onOpen.apply(this),setTimeout(function(){var input=this.modal.el.querySelector("textarea");input.focus(),""===input.value&&(input.value="<div>\n\t<p>Sample HTML</p>\n</div>",input.select())}.bind(this),1)},_onClose:function(){this.modal.el.querySelector("textarea").focus()},tabHandler:function(e){var val,start,end;if(9===e.keyCode)return val=e.target.value,start=e.target.selectionStart,end=e.target.selectionEnd,e.target.value=val.substring(0,start)+"\t"+val.substring(end),e.target.selectionStart=e.target.selectionEnd=start+1,e.preventDefault(),!1},getHtml:function(){var html=this.modal.el.querySelector("textarea").value.trim(),dummy=document.createElement("div");return dummy.innerHTML=html,dummy.innerHTML.replace(/\s{2,}/g," ")},setHtml:function(html){html=html.trim(),html=this.formatXml(html).trim(),this.modal.el.querySelector("textarea").value=html},formatXml:function(xml){var pad,nodes,node,n,indent,padding,i,formatted="",reg=/(>)(<)(\/*)/g;pad=0,nodes=(xml=xml.toString().replace(reg,"$1\r\n$2$3")).split("\r\n");for(n in nodes){for(indent=0,(node=nodes[n]).match(/.+<\/\w[^>]*>$/)?indent=0:node.match(/^<\/\w/)?0!==pad&&(pad-=1):indent=node.match(/^<\w[^>]*[^\/]>.*$/)?1:0,padding="",i=0;i<pad;i++)padding+="  ";formatted+=padding+node+"\r\n",pad+=indent}return formatted}}),function(){var ready=function(){PBSEditor.htmlFrame=new PBSEditor._HtmlFrame};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),PBSEditor._AdminFrame=PBSEditor.Frame.extend({className:"pbs-admin-modal",template:wp.template("pbs-admin-frame"),events:{},_onOpen:function(){PBSEditor.Frame.prototype._onOpen.apply(this),sessionStorage.setItem("pbs_in_admin_iframe",1),setTimeout(function(){var iframe;this.modal.el.classList.add("pbs-busy"),(iframe=this.modal.el.querySelector("iframe")).onload=function(){this.modal.el.classList.remove("pbs-busy")}.bind(this),iframe.setAttribute("src",this.options.url)}.bind(this),1)},_onClose:function(){sessionStorage.removeItem("pbs_in_admin_iframe"),this.modal.el.querySelector("iframe").setAttribute("src",""),PBSEditor.Frame.prototype._onClose.apply(this)}}),function(){var ready=function(){PBSEditor.adminFrame=new PBSEditor._AdminFrame};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),window.pbsLinkFrame={callback:null,open:function(args,callback){void 0===args&&(args={}),wpLink.open("dummy-wplink-textarea"),document.querySelector("#wp-link-url, #link-options #url-field").value=args.url||"",document.querySelector("#wp-link-text, #link-options #link-title-field").value=args.text||"",document.querySelector("#wp-link-target, #link-options #link-target-checkbox").checked=!!args.target,void 0===args.hasText?document.querySelector("#wp-link-wrap").classList.add("has-text-field"):args.hasText?document.querySelector("#wp-link-wrap").classList.add("has-text-field"):document.querySelector("#wp-link-wrap").classList.remove("has-text-field"),void 0===args.hasNewWindow?document.querySelector("#wp-link .link-target").style.display="":document.querySelector("#wp-link .link-target").style.display=args.hasNewWindow?"":"none",this.callback=callback,this.clickHandler=function(){var url=document.querySelector("#wp-link-url, #link-options #url-field").value,text=document.querySelector("#wp-link-text, #link-options #link-title-field").value,target=document.querySelector("#wp-link-target, #link-options #link-target-checkbox").checked;this.callback(url,text,target),document.querySelector("#wp-link-submit").removeEventListener("click",this.clickHandler),wpLink.close()}.bind(this),document.querySelector("#wp-link-submit").addEventListener("click",this.clickHandler)}},PBSEditor.Overlays=[],PBSEditor.Overlay=function(){function Overlay(){var editor=ContentTools.EditorApp.get();this.showOnTaint=!0,this._domElement=null,this._active=!1,this._shown=!1,this._isMounted=!1,this._classname="",PBSEditor.Overlays.push(this),wp.hooks.addAction("pbs.element.out",function(element){this.element&&element&&element._domElement&&(this.element._domElement===element._domElement||element._domElement.contains(this.element._domElement))&&0===this.constructor.name.toLowerCase().indexOf("toolbar")&&this._hide()}.bind(this)),wp.hooks.addAction("pbs.element.over",function(element){var applyToElem;Overlay.active||ContentEdit.Root.get().dragging()||element._domElement&&(this.element&&!this.element._domElement&&(this.element=null),this.canApplyTo&&((applyToElem=this.canApplyTo(element))?(this._show(applyToElem),this.element=applyToElem):this._shown&&this._hide()))}.bind(this)),ContentEdit.Root.get().bind("unmount",function(element){element===this.element&&this._hide()}.bind(this)),ContentEdit.Root.get().bind("drag",function(){this._hide()}.bind(this)),ContentEdit.Root.get().bind("drop",function(){this._hide()}.bind(this)),document.addEventListener("mouseover",function(ev){this._isMounted&&(Overlay.active||window.pbsSelectorMatches(ev.target,'[data-name="main-content"], [data-name="main-content"] *, .pbs-quick-action-overlay, .pbs-quick-action-overlay *, .pbs-toolbar, .pbs-toolbar *'))}.bind(this)),ContentEdit.Root.get().bind("taint",function(element){this.showOnTaint&&this.element===element&&this._show(element)}.bind(this)),ContentEdit.Root.get().bind("debounced_taint",function(element){this.showOnTaint&&this.element===element&&this._show(element)}.bind(this)),wp.hooks.addAction("pbs.edit",function(){this._domElement=this.createElement(),this.mount()}.bind(this)),editor.bind("stop",function(){this.unmount()}.bind(this))}return Overlay.prototype.mount=function(){this._domElement.classList.add("pbs-quick-action-overlay"),this._domElement.classList.add("pbs-overlay-"+this.constructor.name.toLowerCase()),this._classname&&this._domElement.classList.add(this._classname),document.body.appendChild(this._domElement),this.addEventHandlers(),this._isMounted=!0},Overlay.prototype.unmount=function(){this.element=null,this.removeEventHandlers(),document.body.removeChild(this._domElement),this._isMounted=!1},Overlay.prototype.addEventHandlers=function(){this._mousedownBound=this._mousedown.bind(this),this._mousemoveBound=this._mousemove.bind(this),this._mouseupBound=this._mouseup.bind(this),this._mouseenterBound=this._mouseenter.bind(this),this._mouseleaveBound=this._mouseleave.bind(this),this._domElement.addEventListener("mousedown",this._mousedownBound),this._domElement.addEventListener("mouseenter",this._mouseenterBound),this._domElement.addEventListener("mouseleave",this._mouseleaveBound),document.addEventListener("mousemove",this._mousemoveBound),document.addEventListener("mouseup",this._mouseupBound)},Overlay.prototype.removeEventHandlers=function(){this._domElement.removeEventListener("mousedown",this._mousedownBound),this._domElement.removeEventListener("mouseenter",this._mouseenterBound),this._domElement.removeEventListener("mouseleave",this._mouseleaveBound),document.removeEventListener("mousemove",this._mousemoveBound),document.removeEventListener("mouseup",this._mouseupBound)},Overlay.prototype._mousedown=function(ev){var root=ContentEdit.Root.get();this.canApply()?(root.focused()&&root.focused().blur(),this._active=!0,this.startX=parseInt(ev.screenX,10),this.startY=parseInt(ev.screenY,10),this.deltaX=0,this.deltaY=0,Overlay.active=!0,this._domElement.classList.add("pbs-active"),document.body.classList.add("pbs-overlay-is-active"),document.body.classList.add("pbs-overlay-"+this.constructor.name.toLowerCase()),this.onClick(ev),this.onMoveStart(ev)):this._active=!1},Overlay.prototype._mousemove=function(ev){this._active&&(this.prevMouseMoveTimeStamp&&ev.timeStamp-this.prevMouseMoveTimeStamp<60||(this.prevMouseMoveTimeStamp=ev.timeStamp,this.deltaX=parseInt(ev.screenX,10)-this.startX,this.deltaY=parseInt(ev.screenY,10)-this.startY,ev.preventDefault(),ev.stopPropagation(),wp.hooks.doAction("pbs.overlay.drag"),this.onMove(ev),clearTimeout(Overlay._hideOverlayTimeout),Overlay._hideOverlayTimeout=setTimeout(function(){Overlay.hideOtherOverlays(this)}.bind(this),10)))},Overlay.hideOtherOverlays=function(callingOverlay){Array.prototype.forEach.call(PBSEditor.Overlays,function(overlay){overlay!==callingOverlay&&overlay._hide()})},Overlay.hideAll=function(){Array.prototype.forEach.call(PBSEditor.Overlays,function(overlay){overlay._hide()})},Overlay.prototype._mouseup=function(){this._active=!1,Overlay.active=!1,this._domElement.classList.remove("pbs-active"),document.body.classList.remove("pbs-overlay-is-active"),document.body.classList.remove("pbs-overlay-active-"+this.constructor.name.toLowerCase())},Overlay.prototype._mouseenter=function(ev){this._domElement.classList.add("pbs-over"),document.body.classList.add("pbs-overlay-hovered"),document.body.classList.add("pbs-overlay-hovered-"+this.constructor.name.toLowerCase()),this.onEnter(ev)},Overlay.prototype._mouseleave=function(){this._domElement.classList.remove("pbs-over"),document.body.classList.remove("pbs-overlay-hovered"),document.body.classList.remove("pbs-overlay-hovered-"+this.constructor.name.toLowerCase()),this.onLeave()},Overlay.prototype._show=function(element){if(!ContentEdit.Root.get().dragging()&&element){if(this._domElement.classList.add("pbs-overlay-show"),this.shown&&this.element===element)return;this.show(element),this._shown=!0}},Overlay.prototype._hide=function(){this._domElement&&this._domElement.classList.remove("pbs-overlay-show"),this.hide(),this._shown=!1},Overlay.active=!1,Overlay.prevOverElement=null,Overlay.prototype.canApply=function(){return!Overlay.active},Overlay.prototype.createElement=function(){},Overlay.prototype.onMoveStart=function(){},Overlay.prototype.onMove=function(){},Overlay.prototype.onClick=function(){},Overlay.prototype.show=function(element){},Overlay.prototype.hide=function(){},Overlay.prototype.onEnter=function(){},Overlay.prototype.onLeave=function(){},Overlay.prototype.canApplyTo=function(element){return!1},Overlay}(),function(){var proxied=ContentEdit.Element.prototype._onMouseDown;ContentEdit.Element.prototype._onMouseDown=function(ev){if(!PBSEditor.Overlay.active)return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Element.prototype._onMouseMove;ContentEdit.Element.prototype._onMouseMove=function(ev){if(!PBSEditor.Overlay.active)return ContentEdit.Root.get().trigger("mousemove",this),proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Element.prototype._onMouseOver;ContentEdit.Element.prototype._onMouseOver=function(ev){if(!PBSEditor.Overlay.active)return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Element.prototype._onMouseOut;ContentEdit.Element.prototype._onMouseOut=function(ev){if(!PBSEditor.Overlay.active)return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Element.prototype._onMouseUp;ContentEdit.Element.prototype._onMouseUp=function(ev){if(!PBSEditor.Overlay.active)return proxied.call(this,ev)}}(),function(){var currentOverElement=null,currentTarget=null,pbsOverElement=_.throttle(function(target){if(currentTarget!==target){if(!target._ceElement){for(wp.hooks.doAction("pbs.nonelement.over",target);!target._ceElement;)if(!(target=target.parentNode)||"BODY"===target.tagName)return;if("Region"===target._ceElement.constructor.name)return}null!==currentOverElement&&target._ceElement&&wp.hooks.doAction("pbs.element.out",currentOverElement),PBSEditor.Overlay.active||(currentTarget=target,currentOverElement=target._ceElement,wp.hooks.doAction("pbs.element.over",target._ceElement))}else wp.hooks.doAction("pbs.element.over",currentOverElement)},50),mouseListener=function(ev){pbsOverElement(ev.target)};ContentTools.EditorApp.get().bind("start",function(){window.addEventListener("mousemove",mouseListener),window.addEventListener("mouseover",mouseListener),window.addEventListener("mouseleave",mouseListener)}),ContentTools.EditorApp.get().bind("stop",function(){window.removeEventListener("mousemove",mouseListener),window.removeEventListener("mouseover",mouseListener),window.removeEventListener("mouseleave",mouseListener)})}(),PBSEditor.OverlayControls=function(_super){function OverlayControls(controls){OverlayControls.__super__.constructor.call(this),this.showOnTaint=!1,this.shown=!1,void 0===controls&&(controls=[]),this.controls=controls,ContentEdit.Root.get().bind("taint",function(){this.updatePosition(this.element)}.bind(this)),ContentEdit.Root.get().bind("focus",function(){this._hide()}.bind(this)),document.addEventListener("mousedown",function(ev){var focused=ContentEdit.Root.get().focused();focused&&focused._domElement===ev.target&&this._hide()}.bind(this)),ContentEdit.Root.get().bind("focus",function(){this._hide()}.bind(this)),document.addEventListener("keydown",function(ev){-1===[40,37,39,38,9,8,46,13,16,91,18].indexOf(ev.keyCode)&&this._hide()}.bind(this)),window.addEventListener("resize",function(){this._hide()}.bind(this))}return __extends(OverlayControls,_super),OverlayControls.prototype.createElement=function(){var wrapper,i,control,element=document.createElement("DIV");if(!this.controls.length)return element;for((wrapper=document.createElement("DIV")).classList.add("pbs-overlay-wrapper"),element.appendChild(wrapper),i=0;i<this.controls.length;i++)(control=document.createElement("DIV")).classList.add("pbs-overlay-"+this.controls[i].name),control.control=this.controls[i],this.controls[i]._domElement=control,control.addEventListener("mouseenter",function(overlay){overlay._domElement.classList.add("pbs-over-"+this.control.name),this.control._domElement.classList.add("pbs-control-over")}.bind(control,this)),control.addEventListener("mouseleave",function(overlay){overlay._domElement.classList.add("pbs-over-"+this.control.name),this.control._domElement.classList.remove("pbs-control-over")}.bind(control,this)),wrapper.appendChild(control);return this._locationDragging=null,element},OverlayControls.prototype.updatePosition=function(element){element&&element._domElement&&fastdom.measure(function(){var styles,rect,top,height,left,width;element&&element._domElement&&(styles=this._cachedStyles,rect=this._cachedRect,styles=window.pbsGetComputedStyle(element._domElement),rect=window.pbsGetBoundingClientRect(element._domElement),this._cachedStyles===styles&&this._cachedRect===rect||(top=rect.top,height=rect.height,left=rect.left,width=rect.width,fastdom.mutate(function(){var i,hide;for(this._domElement.style.top=top+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._domElement.style.height=height+"px",this._domElement.style.left=left+"px",this._domElement.style.width=width+"px",i=0;i<this.controls.length;i++)hide=!1,"function"==typeof this.controls[i].display&&(this.controls[i].display(element)||(hide=!0)),this.controls[i]._domElement.style.display=hide?"none":"",hide||"function"!=typeof this.controls[i].refresh||this.controls[i].refresh(this,element,styles,rect);this._cachedStyles=styles,this._cachedRect=rect}.bind(this))))}.bind(this))},OverlayControls.prototype._hide=function(){if(!this._domElement||-1===this._domElement.getAttribute("class").indexOf("pbs-active-"))return this.shown=!1,OverlayControls.__super__._hide.call(this)},OverlayControls.prototype.hide=function(){this._domElement},OverlayControls.prototype.show=function(element){this.shown=!0,this.updatePosition(element)},OverlayControls.prototype.onMoveStart=function(ev){var i,styles=getComputedStyle(this.element._domElement),rect=this.element._domElement.getBoundingClientRect();for(i=0;i<this.controls.length;i++)this._locationDragging===this.controls[i].name&&this.controls[i].onMoveStart&&this.controls[i].onMoveStart(this,this.element,styles,rect,ev)},OverlayControls.prototype.onMove=function(ev){var i;for(i=0;i<this.controls.length;i++)if(this._locationDragging===this.controls[i].name){this.controls[i].onMove&&this.controls[i].onMove(this,this.element,this.deltaX,this.deltaY,ev);break}this.updatePosition(this.element)},OverlayControls.prototype.onClick=function(ev){var i;for(this._locationDragging=null,i=0;i<this.controls.length;i++)this._domElement.classList.remove("pbs-active-"+this.controls[i].name),this.controls[i].onClick&&this.controls[i].onClick(this,this.element);for(i=0;i<this.controls.length;i++)if(ev.target===this.controls[i]._domElement){this._locationDragging=this.controls[i].name,this._domElement.classList.add("pbs-active-"+this.controls[i].name),this._domElement.classList.add("pbs-active"),this.controls[i]._domElement.classList.add("pbs-control-active");break}this.updatePosition(this.element)},OverlayControls.prototype._mouseup=function(ev){var i,ret=OverlayControls.__super__._mouseup.call(this,ev);for(i=0;i<this.controls.length;i++)this._domElement.classList.remove("pbs-active-"+this.controls[i].name),this.controls[i]._domElement.classList.remove("pbs-control-active"),this._locationDragging===this.controls[i].name&&this.controls[i].onMoveStop&&this.controls[i].onMoveStop(this,this.element,ev);return this._locationDragging=null,ret},OverlayControls}(PBSEditor.Overlay),PBSEditor.OverlayElement=function(_super){function OverlayElement(){var controls=[{name:"resize-bottom-left",display:function(element){return"Image"===element.constructor.name||"Icon"===element.constructor.name},refresh:function(overlay,element,styles,rect){fastdom.measure(function(){var height=rect.height,width=rect.width;fastdom.mutate(function(){var side;height<150||width<150?(side=height,height>width&&(side=width),side*=.3,this._domElement.style.width=side+"px",this._domElement.style.height=side+"px"):(this._domElement.style.width="",this._domElement.style.height="")}.bind(this))}.bind(this))},onMoveStart:function(overlay,element,styles,rect){var label;this._initWidth=rect.width,this._initHeight=rect.height,this._aspectRatio=rect.width/rect.height,label=rect.width+" &times; "+parseInt(rect.height,10)+" px","Image"===element.constructor.name&&("100%"===element.attr("width")&&(label="100%"),wp.hooks.doAction("pbs.element.out",element)),this._overlaySize=document.createElement("DIV"),this._overlaySize.classList.add("pbs-size-indicator"),this._overlaySize.innerHTML=label,this._overlaySize.style.top=rect.top+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._overlaySize.style.left=rect.right+"px",document.body.appendChild(this._overlaySize)},onMove:function(overlay,element,deltaX){var height,width=-deltaX+this._initWidth;window.PBSEditor.isShiftDown&&(width-=width%10),width=parseInt(width,10),height=1/this._aspectRatio*width,fastdom.mutate(function(){var rect,rectWidth,rectTop,rectRight,label;element.style("height",height+"px"),element.style("width",width+"px"),"Image"===element.constructor.name&&(element.attr("width",width),element.attr("height",parseInt(height,10))),rectWidth=(rect=element._domElement.getBoundingClientRect()).width,rectTop=rect.top,rectRight=rect.right,label=width+" &times; "+parseInt(height,10)+" px","Image"===element.constructor.name&&width>rectWidth&&(element.style("width","100%"),element.style("height","auto"),label="100%"),this._overlaySize.style.top=rectTop+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._overlaySize.style.left=rectRight+"px",this._overlaySize.innerHTML=label}.bind(this))},onMoveStop:function(overlay,element){document.body.removeChild(this._overlaySize),"Image"===element.constructor.name&&(element.style("height","auto"),wp.hooks.doAction("pbs.element.over",element))}},{name:"resize-top-left",display:function(element){return"Image"===element.constructor.name||"Icon"===element.constructor.name},refresh:function(overlay,element,styles,rect){fastdom.measure(function(){var height=rect.height,width=rect.width;fastdom.mutate(function(){var side;height<150||width<150?(side=height,height>width&&(side=width),side*=.3,this._domElement.style.width=side+"px",this._domElement.style.height=side+"px"):(this._domElement.style.width="",this._domElement.style.height="")}.bind(this))}.bind(this))},onMoveStart:function(overlay,element,styles,rect){var label;this._initWidth=rect.width,this._initHeight=rect.height,this._aspectRatio=rect.width/rect.height,label=rect.width+" &times; "+parseInt(rect.height,10)+" px","Image"===element.constructor.name&&("100%"===element.attr("width")&&(label="100%"),wp.hooks.doAction("pbs.element.out",element)),this._overlaySize=document.createElement("DIV"),this._overlaySize.classList.add("pbs-size-indicator"),this._overlaySize.innerHTML=label,this._overlaySize.style.top=rect.top+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._overlaySize.style.left=rect.right+"px",document.body.appendChild(this._overlaySize)},onMove:function(overlay,element,deltaX){var height,width=-deltaX+this._initWidth;window.PBSEditor.isShiftDown&&(width-=width%10),width=parseInt(width,10),height=1/this._aspectRatio*width,fastdom.mutate(function(){var rect,rectWidth,rectTop,rectRight,label;element.style("height",height+"px"),element.style("width",width+"px"),"Image"===element.constructor.name&&(element.attr("width",width),element.attr("height",parseInt(height,10))),rectWidth=(rect=element._domElement.getBoundingClientRect()).width,rectTop=rect.top,rectRight=rect.right,label=width+" &times; "+parseInt(height,10)+" px","Image"===element.constructor.name&&width>rectWidth&&(element.style("width","100%"),element.style("height","auto"),label="100%"),this._overlaySize.style.top=rectTop+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._overlaySize.style.left=rectRight+"px",this._overlaySize.innerHTML=label}.bind(this))},onMoveStop:function(overlay,element){document.body.removeChild(this._overlaySize),"Image"===element.constructor.name&&(element.style("height","auto"),wp.hooks.doAction("pbs.element.over",element))}},{name:"resize-top-right",display:function(element){return"Image"===element.constructor.name||"Icon"===element.constructor.name},refresh:function(overlay,element,styles,rect){fastdom.measure(function(){var height=rect.height,width=rect.width;fastdom.mutate(function(){var side;height<150||width<150?(side=height,height>width&&(side=width),side*=.3,this._domElement.style.width=side+"px",this._domElement.style.height=side+"px"):(this._domElement.style.width="",this._domElement.style.height="")}.bind(this))}.bind(this))},onMoveStart:function(overlay,element,styles,rect){var label;this._initWidth=rect.width,this._initHeight=rect.height,this._aspectRatio=rect.width/rect.height,label=rect.width+" &times; "+parseInt(rect.height,10)+" px","Image"===element.constructor.name&&("100%"===element.attr("width")&&(label="100%"),wp.hooks.doAction("pbs.element.out",element)),this._overlaySize=document.createElement("DIV"),this._overlaySize.classList.add("pbs-size-indicator"),this._overlaySize.innerHTML=label,this._overlaySize.style.top=rect.top+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._overlaySize.style.left=rect.right+"px",document.body.appendChild(this._overlaySize)},onMove:function(overlay,element,deltaX){var height,width=deltaX+this._initWidth;window.PBSEditor.isShiftDown&&(width-=width%10),width=parseInt(width,10),height=1/this._aspectRatio*width,fastdom.mutate(function(){var rect,rectWidth,rectTop,rectRight,label;element.style("height",height+"px"),element.style("width",width+"px"),"Image"===element.constructor.name&&(element.attr("width",width),element.attr("height",parseInt(height,10))),rectWidth=(rect=element._domElement.getBoundingClientRect()).width,rectTop=rect.top,rectRight=rect.right,label=width+" &times; "+parseInt(height,10)+" px","Image"===element.constructor.name&&width>rectWidth&&(element.style("width","100%"),element.style("height","auto"),label="100%"),this._overlaySize.style.top=rectTop+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._overlaySize.style.left=rectRight+"px",this._overlaySize.innerHTML=label}.bind(this))},onMoveStop:function(overlay,element){document.body.removeChild(this._overlaySize),"Image"===element.constructor.name&&(element.style("height","auto"),wp.hooks.doAction("pbs.element.over",element))}},{name:"resize-bottom-right",display:function(element){return"Image"===element.constructor.name||"Icon"===element.constructor.name},refresh:function(overlay,element,styles,rect){fastdom.measure(function(){var height=rect.height,width=rect.width;fastdom.mutate(function(){var side;height<150||width<150?(side=height,height>width&&(side=width),side*=.3,this._domElement.style.width=side+"px",this._domElement.style.height=side+"px"):(this._domElement.style.width="",this._domElement.style.height="")}.bind(this))}.bind(this))},onMoveStart:function(overlay,element,styles,rect){var label;this._initWidth=rect.width,this._initHeight=rect.height,this._aspectRatio=rect.width/rect.height,label=rect.width+" &times; "+parseInt(rect.height,10)+" px","Image"===element.constructor.name&&("100%"===element.attr("width")&&(label="100%"),wp.hooks.doAction("pbs.element.out",element)),this._overlaySize=document.createElement("DIV"),this._overlaySize.classList.add("pbs-size-indicator"),this._overlaySize.innerHTML=label,this._overlaySize.style.top=rect.top+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._overlaySize.style.left=rect.right+"px",document.body.appendChild(this._overlaySize)},onMove:function(overlay,element,deltaX){var height,width=deltaX+this._initWidth;window.PBSEditor.isShiftDown&&(width-=width%10),width=parseInt(width,10),height=1/this._aspectRatio*width,fastdom.mutate(function(){var rect,rectWidth,rectTop,rectRight,label;element.style("height",height+"px"),element.style("width",width+"px"),"Image"===element.constructor.name&&(element.attr("width",width),element.attr("height",parseInt(height,10))),rectWidth=(rect=element._domElement.getBoundingClientRect()).width,rectTop=rect.top,rectRight=rect.right,label=width+" &times; "+parseInt(height,10)+" px","Image"===element.constructor.name&&width>rectWidth&&(element.style("width","100%"),element.style("height","auto"),label="100%"),this._overlaySize.style.top=rectTop+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._overlaySize.style.left=rectRight+"px",this._overlaySize.innerHTML=label}.bind(this))},onMoveStop:function(overlay,element){document.body.removeChild(this._overlaySize),"Image"===element.constructor.name&&(element.style("height","auto"),wp.hooks.doAction("pbs.element.over",element))}},{name:"resize-bottom",display:function(element){return"Map"===element.constructor.name||"Spacer"===element.constructor.name},refresh:function(overlay,element,styles,rect){fastdom.measure(function(){var height=rect.height,width=rect.width;fastdom.mutate(function(){var side;height<150||width<150?(side=height,height>width&&(side=width),side*=.3,this._domElement.style.width=side+"px",this._domElement.style.height=side+"px"):(this._domElement.style.width="",this._domElement.style.height="")}.bind(this))}.bind(this))},onMoveStart:function(overlay,element,styles,rect){this._initWidth=rect.width,this._initHeight=rect.height,this._domElement.style.top=this._overlaySize=document.createElement("DIV"),this._overlaySize.classList.add("pbs-size-indicator"),this._overlaySize.innerHTML=rect.height+" px",this._overlaySize.style.top=rect.top+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._overlaySize.style.left=rect.right+"px",document.body.appendChild(this._overlaySize)},onMove:function(overlay,element,deltaX,deltaY){var height=deltaY+this._initHeight;window.PBSEditor.isShiftDown&&(height-=height%10),height=parseInt(height,10),fastdom.measure(function(){var rect=element._domElement.getBoundingClientRect(),rectTop=rect.top,rectRight=rect.right,rectHeight=rect.height;fastdom.mutate(function(){element.style("height",height+"px"),this._overlaySize.style.top=rectTop+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._overlaySize.style.left=rectRight+"px",this._overlaySize.innerHTML=rectHeight+" px"}.bind(this))}.bind(this))},onMoveStop:function(overlay,element){document.body.removeChild(this._overlaySize),"Image"===element.constructor.name&&fastdom.mutate(function(){element.style("height","auto")})}},{name:"margin-top",display:function(element){return"Shortcode"!==element.constructor.name&&("Title"!==element.constructor.name&&("Spacer"!==element.constructor.name&&("Embed"!==element.constructor.name&&("Text"!==element.constructor.name||!element.content.isWhitespace()))))},refresh:function(overlay,element,styles,rect){var marginTop=element._domElement.style.marginTop;marginTop||(marginTop=styles.marginTop),this._domElement.getAttribute("data-value")!=="margin-"+marginTop&&(rect.width>100?this._domElement.setAttribute("data-label",pbsParams.labels.margin+": "+marginTop):this._domElement.setAttribute("data-label",marginTop),parseInt(marginTop,10)<0?this._domElement.style.height="0px":this._domElement.style.height=marginTop,this._domElement.setAttribute("data-value","margin-"+marginTop))},onMoveStart:function(overlay,element,styles){this._initValue=parseInt(styles.marginTop,10)},onMove:function(overlay,element,deltaX,deltaY){var margin=deltaY+this._initValue;window.PBSEditor.isShiftDown&&(margin-=margin%10),element.style("margin-top",margin+"px")}},{name:"margin-bottom",display:function(element){return"Shortcode"!==element.constructor.name&&("Title"!==element.constructor.name&&("Embed"!==element.constructor.name&&("Spacer"!==element.constructor.name&&("Text"!==element.constructor.name||!element.content.isWhitespace()))))},refresh:function(overlay,element,styles,rect){var marginBottom=element._domElement.style.marginBottom;marginBottom||(marginBottom=styles.marginBottom),this._domElement.getAttribute("data-value")!=="margin-"+marginBottom&&(rect.width>100?this._domElement.setAttribute("data-label",pbsParams.labels.margin+": "+marginBottom):this._domElement.setAttribute("data-label",marginBottom),parseInt(marginBottom,10)<0?this._domElement.style.height="0px":this._domElement.style.height=marginBottom,this._domElement.setAttribute("data-value","margin-"+marginBottom))},onMoveStart:function(overlay,element,styles){this._initValue=parseInt(styles.marginBottom,10)},onMove:function(overlay,element,deltaX,deltaY){var margin=deltaY+this._initValue;window.PBSEditor.isShiftDown&&(margin-=margin%10),fastdom.mutate(function(){element.style("margin-bottom",margin+"px")})}}];OverlayElement.__super__.constructor.call(this,controls),this.showOnTaint=!1}return __extends(OverlayElement,_super),OverlayElement.prototype.canApplyTo=function(element){return this.element===element?element:"Static"!==element.constructor.name&&(-1!==["List","ListItem","ListItemText"].indexOf(element.constructor.name)?"List"===element.constructor.name?element:"ListItem"===element.constructor.name?element.parent():element.parent().parent():-1!==["Tab","TabPanelContainer"].indexOf(element.constructor.name)?"TabContainer"===element.parent().constructor.name?element.parent():"TabContainer"===element.parent().parent().constructor.name&&element.parent():-1===["TableRow","TableSection"].indexOf(element.constructor.name)&&(-1===["Div","DivRow","DivCol","Region"].indexOf(element.constructor.name)&&element))},OverlayElement}(PBSEditor.OverlayControls),PBSEditor.OverlayColumn=function(_super){function OverlayColumn(){var controls=[{name:"padding-top",refresh:function(overlay,element,styles){fastdom.measure(function(){var paddingTop=element._domElement.style.paddingTop;paddingTop||(paddingTop=styles.paddingTop),fastdom.mutate(function(){this._domElement.getAttribute("data-value")!=="padding-"+paddingTop&&(this._domElement.setAttribute("data-label",pbsParams.labels.padding+": "+paddingTop),this._domElement.setAttribute("data-value","padding-"+paddingTop),this._domElement.style.height=paddingTop)}.bind(this))}.bind(this))},onMoveStart:function(overlay,element,styles){this._initValue=parseInt(styles.paddingTop,10)},onMove:function(overlay,element,deltaX,deltaY){var padding=deltaY+this._initValue;padding<0&&(padding=0),window.PBSEditor.isShiftDown&&(padding-=padding%10),element.style("padding-top",padding+"px")}},{name:"padding-bottom",refresh:function(overlay,element,styles){fastdom.measure(function(){var paddingBottom=element._domElement.style.paddingBottom;paddingBottom||(paddingBottom=styles.paddingBottom),fastdom.mutate(function(){this._domElement.getAttribute("data-value")!=="padding-"+paddingBottom&&(this._domElement.setAttribute("data-label",pbsParams.labels.padding+": "+paddingBottom),this._domElement.setAttribute("data-value","padding-"+paddingBottom),this._domElement.style.height=paddingBottom)}.bind(this))}.bind(this))},onMoveStart:function(overlay,element,styles){this._initValue=parseInt(styles.paddingBottom,10)},onMove:function(overlay,element,deltaX,deltaY){var padding=-deltaY+this._initValue;padding<0&&(padding=0),window.PBSEditor.isShiftDown&&(padding-=padding%10),element.style("padding-bottom",padding+"px")}},{name:"padding-left",refresh:function(overlay,element,styles,rect){fastdom.measure(function(){var paddingLeft=element._domElement.style.paddingLeft;paddingLeft||(paddingLeft=styles.paddingLeft),fastdom.mutate(function(){this._domElement.getAttribute("data-value")!=="padding-"+paddingLeft&&(parseInt(rect.height,10)>100?this._domElement.setAttribute("data-label",pbsParams.labels.padding+": "+paddingLeft):this._domElement.setAttribute("data-label",paddingLeft),this._domElement.setAttribute("data-value","padding-"+paddingLeft),this._domElement.style.width=paddingLeft)}.bind(this))}.bind(this))},onMoveStart:function(overlay,element,styles){this._initValue=parseInt(styles.paddingLeft,10)},onMove:function(overlay,element,deltaX){var padding=deltaX+this._initValue;padding<0&&(padding=0),window.PBSEditor.isShiftDown&&(padding-=padding%10),element.style("padding-left",padding+"px")}},{name:"padding-right",refresh:function(overlay,element,styles,rect){fastdom.measure(function(){var paddingRight=element._domElement.style.paddingRight;paddingRight||(paddingRight=styles.paddingRight),fastdom.mutate(function(){this._domElement.getAttribute("data-value")!=="padding-"+paddingRight&&(parseInt(rect.height,10)>100?this._domElement.setAttribute("data-label",pbsParams.labels.padding+": "+paddingRight):this._domElement.setAttribute("data-label",paddingRight),this._domElement.setAttribute("data-value","padding-"+paddingRight),this._domElement.style.width=paddingRight)}.bind(this))}.bind(this))},onMoveStart:function(overlay,element,styles){this._initValue=parseInt(styles.paddingRight,10)},onMove:function(overlay,element,deltaX){var padding=-deltaX+this._initValue;padding<0&&(padding=0),window.PBSEditor.isShiftDown&&(padding-=padding%10),element.style("padding-right",padding+"px")}}];OverlayColumn.__super__.constructor.call(this,controls),this.showOnTaint=!1}return __extends(OverlayColumn,_super),OverlayColumn.prototype.canApplyTo=function(element){if(this.element===element)return element;if(this.element!==element&&this.element&&this.element._domElement.parentNode&&this.element._domElement.parentNode.classList.contains(".pbs-col")&&this.element._domElement.parentNode.contains(element._domElement))return element;if("DivCol"===element.constructor.name)return element;if("DivCol"!==element.constructor.name)for(element=element.parent();element&&"Region"!==element.constructor.name;){if("DivCol"===element.constructor.name)return element;element=element.parent()}return!1},OverlayColumn}(PBSEditor.OverlayControls),PBSEditor.OverlayRow=function(_super){function OverlayRow(){OverlayRow.__super__.constructor.call(this),this.showOnTaint=!1,this.shown=!1,ContentEdit.Root.get().bind("focus",function(){this._hide()}.bind(this)),document.addEventListener("mousedown",function(ev){var focused=ContentEdit.Root.get().focused();focused&&focused._domElement===ev.target&&this._hide()}.bind(this)),ContentEdit.Root.get().bind("focus",function(){this._hide()}.bind(this)),document.addEventListener("keydown",function(ev){-1===[40,37,39,38,9,8,46,13,16,91,18].indexOf(ev.keyCode)&&this._hide()}.bind(this)),window.addEventListener("resize",function(){this._hide()}.bind(this))}return __extends(OverlayRow,_super),OverlayRow.showOnTaint=!1,OverlayRow.prototype.createElement=function(){var element=document.createElement("DIV");return this._topMargin=document.createElement("DIV"),this._topMargin.classList.add("pbs-overlay-margin-top"),this._topMargin.addEventListener("mouseenter",function(){this._domElement.classList.add("pbs-over-margin-top")}.bind(this)),this._topMargin.addEventListener("mouseleave",function(){this._domElement.classList.remove("pbs-over-margin-top")}.bind(this)),element.appendChild(this._topMargin),this._bottomMargin=document.createElement("DIV"),this._bottomMargin.classList.add("pbs-overlay-margin-bottom"),this._bottomMargin.addEventListener("mouseenter",function(){this._domElement.classList.add("pbs-over-margin-bottom")}.bind(this)),this._bottomMargin.addEventListener("mouseleave",function(){this._domElement.classList.remove("pbs-over-margin-bottom")}.bind(this)),element.appendChild(this._bottomMargin),this._bottomResize=document.createElement("DIV"),this._bottomResize.classList.add("pbs-overlay-resize-bottom"),this._bottomResize.addEventListener("mouseenter",function(){this._domElement.classList.add("pbs-over-resize-bottom")}.bind(this)),this._bottomResize.addEventListener("mouseleave",function(){this._domElement.classList.remove("pbs-over-resize-bottom")}.bind(this)),element.appendChild(this._bottomResize),this._columnControls=[],this._columnLabels=[],element},OverlayRow.prototype.updatePosition=function(element){fastdom.measure(function(){var rect=window.pbsGetBoundingClientRect(element._domElement);fastdom.mutate(function(){this._domElement.style.top=rect.top+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._domElement.style.height=rect.height+"px",this._domElement.style.left=rect.left+"px",this._domElement.style.width=rect.width+"px"}.bind(this))}.bind(this))},OverlayRow.prototype.hide=function(){OverlayRow.__super__.hide.call(this),this.shown=!1,document.body.classList.remove("pbs-overlay-is-nested-row")},OverlayRow.prototype.show=function(element){var styles,label,o,i,margin,columnRect,marginTop,marginBottom,topMarginDataValue,bottomMarginDataValue,rowLeftPadding,height,elementName=element.parent().constructor.name,totalWidth=0,totalWidthNoMargin=0;for(this.shown=!0,fastdom.mutate(function(){this._topMargin.style.display="",this._bottomMargin.style.display="",this._bottomResize.style.display="","Div"===elementName?(this._topMargin.style.display="none",this._bottomMargin.style.display="none",this._bottomResize.style.display="none"):"TabPanelContainer"===elementName?(this._topMargin.style.display="none",this._bottomMargin.style.display="none",this._bottomResize.style.display="none"):"Carousel"===elementName&&(this._topMargin.style.display="none",this._bottomMargin.style.display="none"),this._domElement.classList.remove("pbs-active-margin-top"),this._domElement.classList.remove("pbs-active-margin-bottom"),this._domElement.classList.remove("pbs-active-resize-bottom")}.bind(this)),this.updatePosition(element),fastdom.measure(function(){styles=window.pbsGetComputedStyle(element._domElement),(marginTop=element._domElement.style.marginTop)||(marginTop=styles.marginTop),(marginBottom=element._domElement.style.marginBottom)||(marginBottom=styles.marginBottom),topMarginDataValue=this._topMargin.getAttribute("data-value"),bottomMarginDataValue=this._bottomMargin.getAttribute("data-value"),fastdom.mutate(function(){topMarginDataValue!=="margin-"+marginTop&&(this._topMargin.setAttribute("data-label",pbsParams.labels.margin+": "+marginTop),this._topMargin.setAttribute("data-value","margin-"+marginTop),this._topMargin.style.height=marginTop),bottomMarginDataValue!=="margin-"+marginBottom&&(this._bottomMargin.setAttribute("data-label",pbsParams.labels.margin+": "+marginBottom),this._bottomMargin.style.height=marginBottom,this._bottomMargin.setAttribute("data-value","margin-"+marginBottom))}.bind(this))}.bind(this)),i=this._columnControls.length-1;i>=0;i--)this._columnControls[i].parentNode.removeChild(this._columnControls[i]);for(i=this._columnLabels.length-1;i>=0;i--)this._columnLabels[i].parentNode.removeChild(this._columnLabels[i]);for(this._columnControls=[],this._columnLabels=[],this._columnWidths=[],this._columnMarginRight=[],height=window.pbsGetBoundingClientRect(element._domElement).height,rowLeftPadding=parseInt(element.style("padding-left"),10),i=0;i<element.children.length;i++)columnRect=window.pbsGetBoundingClientRect(element.children[i]._domElement),this._columnWidths.push(columnRect.width),this._columnMarginRight.push(element.children[i]._domElement.style.marginRight);for(i=0;i<element.children.length-1;i++)(o=document.createElement("DIV")).classList.add("pbs-overlay-column-width-"+i),o.classList.add("pbs-overlay-column-width"),o._index=i,o._this=this,height>100?o.setAttribute("data-label",pbsParams.labels.column_width):o.setAttribute("data-label",pbsParams.labels.width),o.addEventListener("mouseenter",function(){this._this._domElement.classList.add("pbs-over-column-width-"+this._index),this._this._domElement.classList.add("pbs-overlay-column-width")}),o.addEventListener("mouseleave",function(){this._this._domElement.classList.remove("pbs-over-column-width-"+this._index),this._this._domElement.classList.remove("pbs-overlay-column-width")}),totalWidth+=this._columnWidths[i],totalWidthNoMargin+=this._columnWidths[i],o.style.left=rowLeftPadding+totalWidth+"px",this._columnMarginRight[i]&&(totalWidth+=margin=parseInt(this._columnMarginRight[i],10),o.style.width=margin+"px",o.style.marginLeft="0px"),this._domElement.appendChild(o),this._columnControls.push(o);for(element.children.length&&(totalWidthNoMargin+=this._columnWidths[element.children.length-1]),totalWidth=0,i=0;i<element.children.length;i++)(label=document.createElement("DIV")).classList.add("pbs-overlay-column-label"),label.innerHTML=(this._columnWidths[i]/totalWidthNoMargin*100).toFixed(1)+"%",label.style.left=i?rowLeftPadding+totalWidth+"px":totalWidth+"px",totalWidth+=this._columnWidths[i],this._columnMarginRight[i]&&(totalWidth+=parseInt(this._columnMarginRight[i],10)),this._domElement.appendChild(label),this._columnLabels.push(label);fastdom.mutate(function(){"DivCol"===element.parent().constructor.name?document.body.classList.add("pbs-overlay-is-nested-row"):document.body.classList.remove("pbs-overlay-is-nested-row")})},OverlayRow.prototype.onMoveStart=function(){var i,styles=getComputedStyle(this.element._domElement),rect=this.element._domElement.getBoundingClientRect(),rectHeight=rect.height;for(this.marginTopInitialValue=parseInt(styles.marginTop,10),this.marginBottomInitialValue=parseInt(styles.marginBottom,10),this.resizeBottomInitialValue=parseInt(styles.minHeight,10),parseInt(rectHeight,10)>this.resizeBottomInitialValue&&(this.resizeBottomInitialValue=parseInt(rectHeight,10)),this.columnWidthInitialValues=[],i=0;i<this.element.children.length;i++)rect=this.element.children[i]._domElement.getBoundingClientRect(),this.columnWidthInitialValues.push(rect.width)},OverlayRow.prototype.onMove=function(){var label,width,margin,height,rect,totalWidth,totalWidthNoMargin,i,change,colRect,columnRect,rowLeftPadding;if(rect=this.element._domElement.getBoundingClientRect(),"margin-top"===this._locationDragging)margin=this.deltaY+this.marginTopInitialValue,window.PBSEditor.isShiftDown&&(margin-=margin%10),this.element.style("margin-top",margin+"px"),this._topMargin.setAttribute("data-label",pbsParams.labels.margin+": "+margin+"px"),this._topMargin.style.height=margin+"px",this._topMargin.setAttribute("data-value","margin-"+margin+"px");else if("margin-bottom"===this._locationDragging)margin=this.deltaY+this.marginBottomInitialValue,window.PBSEditor.isShiftDown&&(margin-=margin%10),this.element.style("margin-bottom",margin+"px"),rect.width>100?this._bottomMargin.setAttribute("data-label",pbsParams.labels.margin+": "+margin+"px"):this._bottomMargin.setAttribute("data-label",margin+"px"),this._bottomMargin.style.height=margin+"px",this._bottomMargin.setAttribute("data-value","margin-"+margin+"px");else if("resize-bottom"===this._locationDragging)height=this.deltaY+this.resizeBottomInitialValue,window.PBSEditor.isShiftDown&&(height-=height%10),this.element.style("min-height",height+"px"),label=parseInt(height,10),parseInt(rect.height,10)>label&&(label=parseInt(rect.height,10)),this._overlaySize.innerHTML=parseInt(label,10)+"px";else if(0===this._locationDragging.indexOf("column-")){for(width=this.deltaX+this.columnWidthInitialValues[this._columnDragging],window.PBSEditor.isShiftDown&&(width-=width%10),change=this.columnWidthInitialValues[this._columnDragging]-width,totalWidth=0,totalWidthNoMargin=0,i=0;i<this.element.children.length;i++)totalWidth+=(colRect=this.element.children[i]._domElement.getBoundingClientRect()).width,totalWidthNoMargin+=colRect.width,i<this.element.children.length-1&&(this._columnControls[i].style.left=totalWidth+"px",this.element.children[i]._domElement.style.marginRight&&(totalWidth+=parseInt(this.element.children[i]._domElement.style.marginRight,10)));for(this.element._domElement.classList.add("pbs-overlay-changing-cols"),i=0;i<this.element.children.length;i++)this.element.children[i].style("flex-grow",""),i===this._columnDragging?this.element.children[i].style("flex-basis",width/totalWidthNoMargin*100+"%"):i===this._columnDragging+1?this.element.children[i].style("flex-basis",(this.columnWidthInitialValues[i]+change)/totalWidthNoMargin*100+"%"):this.element.children[i].style("flex-basis",this.columnWidthInitialValues[i]/totalWidthNoMargin*100+"%")}for(rect=window.pbsGetBoundingClientRect(this.element._domElement),this._domElement.style.top=rect.top+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._domElement.style.height=rect.height+"px",this._domElement.style.left=rect.left+"px",this._domElement.style.width=rect.width+"px",rowLeftPadding=parseInt(this.element.style("padding-left"),10),totalWidthNoMargin=0,totalWidth=0,i=0;i<this.element.children.length;i++)totalWidthNoMargin+=(columnRect=this.element.children[i]._domElement.getBoundingClientRect()).width;for(i=0;i<this.element.children.length;i++)columnRect=this.element.children[i]._domElement.getBoundingClientRect(),this._columnLabels[i].classList.add("pbs-overlay-column-label"),this._columnLabels[i].innerHTML=(columnRect.width/totalWidthNoMargin*100).toFixed(1)+"%",this._columnLabels[i].style.left=i?rowLeftPadding+totalWidth+"px":totalWidth+"px",totalWidth+=columnRect.width,this.element.children[i]._domElement.style.marginRight&&(totalWidth+=parseInt(this.element.children[i]._domElement.style.marginRight,10));wp.hooks.doAction("pbs.overlay.row.move",this,this._locationDragging)},OverlayRow.prototype.canApplyTo=function(element){if(this.element===element)return element;if(this.element!==element&&this.element&&this.element._domElement.parentNode){if(this.element._domElement.parentNode.classList.contains(".pbs-row")&&this.element._domElement.parentNode.contains(element._domElement))return element;if(this.element._domElement.parentNode.classList.contains(".pbs-col")&&this.element._domElement.parentNode.parentNode.contains(element._domElement))return element}if("DivRow"===element.constructor.name)return element;if("DivRow"!==element.constructor.name)for(element=element.parent();element&&"Region"!==element.constructor.name;){if("DivRow"===element.constructor.name)return element;element=element.parent()}return!1},OverlayRow.prototype._mouseup=function(){var i;for(OverlayRow.__super__._mouseup.call(this),this._domElement.classList.remove("pbs-active-margin-top"),this._domElement.classList.remove("pbs-active-margin-bottom"),this._domElement.classList.remove("pbs-active-resize-bottom"),this.element&&this.element._domElement&&this.element._domElement.classList.remove("pbs-overlay-changing-cols"),this._domElement.classList.remove("pbs-active-overlay-column"),i=0;i<10;i++)this._domElement.classList.remove("pbs-active-column-"+i);this._overlaySize&&(this._overlaySize.parentNode.removeChild(this._overlaySize),this._overlaySize=null)},OverlayRow.prototype.onClick=function(ev){var i,styles,rect,label;if(this._locationDragging=null,this._domElement.classList.remove("pbs-active-overlay-column"),ev.target===this._topMargin)this._locationDragging="margin-top";else if(ev.target===this._bottomMargin)this._locationDragging="margin-bottom";else if(ev.target===this._bottomResize)this._locationDragging="resize-bottom";else for(i=0;i<this._columnControls.length;i++)if(ev.target===this._columnControls[i]){this._locationDragging="column-"+this._columnControls[i]._index,this._columnDragging=this._columnControls[i]._index,this._domElement.classList.add("pbs-active-overlay-column");break}for(this._domElement.classList.remove("pbs-active-margin-top"),this._domElement.classList.remove("pbs-active-margin-bottom"),this._domElement.classList.remove("pbs-active-bottom-resize"),i=0;i<10;i++)this._domElement.classList.remove("pbs-active-column-"+i);this._locationDragging&&this._domElement.classList.add("pbs-active-"+this._locationDragging),"resize-bottom"===this._locationDragging&&(styles=getComputedStyle(this.element._domElement),rect=this.element._domElement.getBoundingClientRect(),this._overlaySize=document.createElement("DIV"),this._overlaySize.classList.add("pbs-size-indicator"),label=parseInt(styles.minHeight,10),parseInt(rect.height,10)>label&&(label=parseInt(rect.height,10)),this._overlaySize.innerHTML=label+"px",this._overlaySize.style.top=rect.top+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._overlaySize.style.left=rect.right+"px",document.body.appendChild(this._overlaySize))},OverlayRow}(PBSEditor.Overlay),function(){var proxiedCancelDragging,proxiedOnStopDragging,proxiedOnMouseOut,proxiedOnMouseOver,proxiedDrop,showDropIndicator,hideDropIndicator,proxiedStartDragging,pbsOverElement,mouseListener,_Root=ContentEdit.Root.get(),indicatorTimeout=null,dropIndicator=null,prevDropTarget=null,prevDropPlacement=null,proxiedGetDropPlacement=_Root._getDropPlacement;_Root._getDropPlacement=function(x,y){var placement=proxiedGetDropPlacement.call(this,x,y);return placement&&(placement[1]="center",showDropIndicator(placement)),placement},proxiedCancelDragging=_Root.cancelDragging,_Root.cancelDragging=function(){return this._dragging&&hideDropIndicator(),proxiedCancelDragging.call(this)},proxiedOnStopDragging=_Root._onStopDragging,_Root._onStopDragging=function(ev){return proxiedOnStopDragging.call(this,ev)},proxiedOnMouseOut=ContentEdit.Element.prototype._onMouseOut,ContentEdit.Element.prototype._onMouseOut=function(ev){var ret=proxiedOnMouseOut.call(this,ev);return ContentEdit.Root.get().dragging()&&hideDropIndicator(),ret},proxiedOnMouseOver=ContentEdit.Element.prototype._onMouseOver,ContentEdit.Element.prototype._onMouseOver=function(ev){var ret=proxiedOnMouseOver.call(this,ev);return ContentEdit.Root.get().dragging()===this&&(hideDropIndicator(),ev.stopPropagation(),ev.preventDefault()),ret},proxiedDrop=ContentEdit.Element.prototype.drop,ContentEdit.Element.prototype.drop=function(element,placement){var ret=proxiedDrop.call(this,element,placement);return element&&hideDropIndicator(),ret},showDropIndicator=function(placement){var dropTargetDom,styles,rect,toolbarHeight,scrollY,marginTop,dropIndicatorJustCreated=!1,root=ContentEdit.Root.get();dropIndicator||((dropIndicator=document.createElement("DIV")).classList.add("pbs-drop-indicator"),dropIndicator.appendChild(document.createElement("SPAN")),dropIndicator.appendChild(document.createElement("SPAN")),dropIndicatorJustCreated=!0),dropTargetDom=root._dropTarget._domElement,prevDropTarget===dropTargetDom&&prevDropPlacement===placement[0]||(prevDropTarget=dropTargetDom,prevDropPlacement=placement[0],clearTimeout(indicatorTimeout),dropIndicator.firstChild.innerHTML=pbsParams.labels.move_above_s.replace(/%s/,root._dropTarget.typeName()),dropIndicator.firstChild.nextSibling.innerHTML=pbsParams.labels.move_below_s.replace(/%s/,root._dropTarget.typeName()),styles=window.pbsGetComputedStyle(root._dropTarget._domElement),rect=window.pbsGetBoundingClientRect(root._dropTarget._domElement),toolbarHeight=window.formattingToolbarHeight(),scrollY=window.pbsScrollY(),rect.height+parseInt(styles.marginTop,10)+parseInt(styles.marginBottom,10)<60?dropIndicator.classList.add("pbs-drop-indicator-small"):dropIndicator.classList.remove("pbs-drop-indicator-small"),dropIndicator.classList.add("pbs-drop-indicator-"+placement[0]),"above"===placement[0]?dropIndicator.classList.remove("pbs-drop-indicator-below"):dropIndicator.classList.remove("pbs-drop-indicator-above"),"P"===dropTargetDom.tagName&&"DIV"===dropTargetDom.parentNode.tagName&&dropTargetDom.parentNode.classList&&dropTargetDom.classList&&dropTargetDom.parentNode.classList.contains("pbs-col")&&dropTargetDom.classList.contains("ce-element--empty")&&(dropIndicator.firstChild.innerHTML=pbsParams.labels.move_inside_column,dropIndicator.firstChild.nextSibling.innerHTML=pbsParams.labels.move_inside_column,dropIndicator.classList.remove("pbs-drop-indicator-above"),dropIndicator.classList.add("pbs-drop-indicator-below")),marginTop=0,parseInt(styles.marginTop,10)>0&&(marginTop=parseInt(styles.marginTop,10)),dropIndicator.style.top=rect.top+scrollY-toolbarHeight-32-marginTop+"px",dropIndicator.style.left=rect.left+"px",dropIndicator.style.width=rect.width+"px",dropIndicator.style.height=rect.height+marginTop+parseInt(styles.marginBottom,10)+"px",dropIndicatorJustCreated&&(setTimeout(function(){dropIndicator&&dropIndicator.classList.add("pbs-drop-indicator-show")},10),document.body.appendChild(dropIndicator)))},hideDropIndicator=function(){prevDropTarget=null,prevDropPlacement=null,clearTimeout(indicatorTimeout),indicatorTimeout=setTimeout(function(){dropIndicator&&(document.body.removeChild(dropIndicator),dropIndicator=null)},10)},proxiedStartDragging=_Root.startDragging,_Root.startDragging=function(element,x,y){var ret=proxiedStartDragging.call(this,element,x,y);if(this._dragging)return setTimeout(function(){this._draggingDOMElement&&this._draggingDOMElement.classList.add("pbs-drag-helper-show")}.bind(this),10),ret},pbsOverElement=_.throttle(function(ev){var elements,pointerY,closestDistance,closestElement,placement,doExit,root=ContentEdit.Root.get();if(root.dragging()){if(window.pbsSelectorMatches(ev.target,".ct-widget, .ct-widget *"))return hideDropIndicator(),void(root._dropTarget=null);elements=document.querySelectorAll(".pbs-main-wrapper > .ce-element, .pbs-main-wrapper > [data-ce-tag]"),pointerY=ev.pageY,closestDistance=999999999,closestElement=null,placement=["above","center"],doExit=!1,Array.prototype.forEach.call(elements,function(el){var rect,scrollY,top,bottom,elemY,dist;el._ceElement&&el._ceElement!==root.dragging()&&(window.pbsSelectorMatches(el,".ce-element *, [data-ce-tag] *")?doExit=!0:(rect=window.pbsGetBoundingClientRect(el),scrollY=window.pbsScrollY(),bottom=(top=rect.top+scrollY)+rect.height,elemY=pointerY<=top?top:pointerY>=bottom?bottom:pointerY,0!==(dist=Math.abs(pointerY-elemY))?dist<closestDistance&&(closestDistance=dist,closestElement=el._ceElement,placement[0]=pointerY<=top+rect.height/2?"above":"below"):doExit=!0))}),doExit||closestElement&&(root._dropTarget=closestElement,showDropIndicator(placement))}},30),mouseListener=function(ev){pbsOverElement(ev)},ContentTools.EditorApp.get().bind("start",function(){window.addEventListener("mousemove",mouseListener),window.addEventListener("mouseover",mouseListener)}),ContentTools.EditorApp.get().bind("stop",function(){window.removeEventListener("mousemove",mouseListener),window.removeEventListener("mouseover",mouseListener)})}(),function(){var proxiedRemove,proxiedAdd;proxiedAdd=ContentEdit.Element.prototype._addCSSClass,ContentEdit.Element.prototype._addCSSClass=function(className){if(-1===className.indexOf("ce-element--drop"))return proxiedAdd.call(this,className)},proxiedRemove=ContentEdit.Element.prototype._removeCSSClass,ContentEdit.Element.prototype._removeCSSClass=function(className){if(-1===className.indexOf("ce-element--drop"))return proxiedRemove.call(this,className)}}(),function(){var ready=function(){var i,titles,editor,origTitles=[],findInThese=["h1","h2","h3","h4",""],titleMarkers=null;for(i=0;i<findInThese.length;i++)document.querySelectorAll(findInThese[i]+" [data-pbs-title-marker-post-id]").length&&(titleMarkers=document.querySelectorAll(findInThese[i]+" [data-pbs-title-marker-post-id]"));if(titleMarkers||(titleMarkers=document.querySelectorAll("[data-pbs-title-marker-post-id]")),titles=[],Array.prototype.forEach.call(titleMarkers,function(marker){var titleElement=marker.parentNode,postID=marker.getAttribute("data-pbs-title-marker-post-id");titleElement.classList.add("pbs-title-editor"),titleElement.getAttribute("pbs-post-id",postID),titles.push(titleElement)}),titleMarkers=document.querySelectorAll("[data-pbs-title-marker-post-id]"),Array.prototype.forEach.call(titleMarkers,function(marker){marker.parentNode.removeChild(marker)}),titles.length){for(editor=ContentTools.EditorApp.get(),PBSEditor.Title=function(){function Title(domElement){this._domElement=domElement}return Title.prototype.mount=function(){this._domElement.setAttribute("contenteditable","true"),this._onPasteBound=Title.prototype._onPaste.bind(this),this._domElement.addEventListener("paste",this._onPasteBound),this._onKeyDownBound=Title.prototype._onKeyDown.bind(this),this._domElement.addEventListener("keydown",this._onKeyDownBound),this._onFocusBound=Title.prototype._onFocus.bind(this),this._domElement.addEventListener("focus",this._onFocusBound),this._onBlurBound=Title.prototype._onBlur.bind(this),this._domElement.addEventListener("blur",this._onBlurBound),this._onMouseEnterBound=Title.prototype._onMouseEnter.bind(this),this._domElement.addEventListener("mouseenter",this._onMouseEnterBound),this._onMouseLeaveBound=Title.prototype._onMouseLeave.bind(this),this._domElement.addEventListener("mouseleave",this._onMouseLeaveBound)},Title.prototype.unmount=function(){this._domElement.removeEventListener("paste",this._onKeyDownBound),this._domElement.removeEventListener("keydown",this._onKeyDownBound),this._domElement.removeEventListener("focus",this._onFocusBound),this._domElement.removeEventListener("blur",this._onBlurBound),this._domElement.removeEventListener("mouseenter",this._onMouseEnterBound),this._domElement.removeEventListener("mouseleave",this._onMouseLeaveBound),this._domElement.removeAttribute("contenteditable"),this._domElement.classList.remove("ce-element--focused")},Title.prototype._onKeyDown=function(ev){(ev.ctrlKey||ev.metaKey)&&(-1!==[82,73,66].indexOf(ev.keyCode)&&ev.preventDefault(),-1!==[90].indexOf(ev.keyCode)&&ev.stopPropagation())},Title.prototype._onPaste=function(ev){var text="";ev.preventDefault(),ev.clipboardData||ev.originalEvent.clipboardData?text=(ev.originalEvent||ev).clipboardData.getData("text/plain"):window.clipboardData&&(text=window.clipboardData.getData("Text")),document.queryCommandSupported("insertText")?document.execCommand("insertText",!1,text):document.execCommand("paste",!1,text)},Title.prototype._onFocus=function(){var root=ContentEdit.Root.get();root.focused()&&root.focused().blur(),this._domElement.classList.add("ce-element--focused"),PBSEditor.Overlay.hideOtherOverlays(null)},Title.prototype._onBlur=function(){this._domElement.classList.remove("ce-element--focused")},Title.prototype._onMouseEnter=function(){wp.hooks.doAction("pbs.element.over",this)},Title.prototype._onMouseLeave=function(){},Title.prototype.parent=function(){return null},Title}(),i=0;i<titles.length;i++)titles[i]=new PBSEditor.Title(titles[i]);editor.bind("start",function(){var i;for(origTitles=[],i=0;i<titles.length;i++)titles[i].mount(),origTitles.push(titles[i]._domElement.textContent)}),editor.bind("stop",function(){var i;for(i=0;i<titles.length;i++)titles[i].unmount()}),wp.hooks.addAction("pbs.save.post.before",function(pbsController){var i;for(i=titles.length-1;i>=0;i--)if(origTitles[i]!==titles[i]._domElement.textContent){pbsController._saveProvider.addData("title",titles[i]._domElement.textContent);break}})}};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),PBSEditor.Toolbar=function(_super){function Toolbar(elementName,tools){Toolbar.__super__.constructor.call(this),this.tools=tools,this.elementName=elementName}return __extends(Toolbar,_super),Toolbar.toolClickHandler=function(ev){this.tool.onClick&&(this.tool.onClick(this.toolbar.element,this,ev),this.toolbar.updatePosition(this.toolbar.element))},Toolbar.toolMouseDownHandler=function(ev){this.tool.onMouseDown&&(this.tool.onMouseDown(this.toolbar.element,this,ev),this.toolbar.updatePosition(this.toolbar.element))},Toolbar.toolMouseEnterHandler=function(ev){this.tool.onMouseEnter&&(this.tool.onMouseEnter(this.toolbar.element,this.toolbar,ev),this.toolbar.updatePosition(this.toolbar.element))},Toolbar.toolMouseLeaveHandler=function(ev){this.tool.onMouseLeave&&(this.tool.onMouseLeave(this.toolbar.element,this.toolbar,ev),this.toolbar.updatePosition(this.toolbar.element))},Toolbar.prototype.createElement=function(){var tool,i,buttonExists,element=document.createElement("DIV"),buttonContainer=document.createElement("DIV");for(element.style.display="none",element.classList.add("pbs-overlay-toolbar"),element.classList.add("pbs-toolbar-"+this.elementName.toLowerCase().replace(/[^\w\d]/,"-")),buttonContainer.classList.add("pbs-toolbar-wrapper"),element.appendChild(buttonContainer),this._buttonContainer=buttonContainer,i=0;i<this.tools.length;i++)(tool=document.createElement("DIV")).classList.add("pbs-toolbar-tool"),this.tools[i].id&&tool.setAttribute("data-toolbar-id",this.tools[i].id),tool.toolbar=this,tool.tool=this.tools[i],this.tools[i].label?(tool.classList.add("pbs-toolbar-label"),tool.innerHTML=this.tools[i].label,buttonContainer.appendChild(tool)):(tool.classList.add("pbs-toolbar-tool-"+this.tools[i].id),this.tools[i].tooltip&&tool.setAttribute("data-tooltip",this.tools[i].tooltip),tool.addEventListener("click",Toolbar.toolClickHandler.bind(tool)),tool.addEventListener("mousedown",Toolbar.toolMouseDownHandler.bind(tool)),tool.addEventListener("mouseenter",Toolbar.toolMouseEnterHandler.bind(tool)),tool.addEventListener("mouseleave",Toolbar.toolMouseLeaveHandler.bind(tool)),buttonExists=!1,this.tools[i].id&&(buttonExists=buttonContainer.querySelector('[data-toolbar-id="'+this.tools[i].id+'"]')),buttonExists?buttonExists.parentNode.replaceChild(tool,buttonExists):buttonContainer.appendChild(tool));return element},Toolbar.prototype.canApplyTo=function(element){return this.element===element?element:!(!element.constructor||element.constructor.name!==this.elementName)&&element},Toolbar.prototype.checkIfTooSmall=function(element){fastdom.measure(function(){var width=window.pbsGetBoundingClientRect(element._domElement).width;fastdom.mutate(function(){width<=150?this._domElement.classList.add("pbs-toolbar-top"):this._domElement.classList.remove("pbs-toolbar-top")}.bind(this))}.bind(this))},Toolbar.prototype.checkIfTooShort=function(element){fastdom.measure(function(){var height=window.pbsGetBoundingClientRect(element._domElement).height;fastdom.mutate(function(){height<=28?this._domElement.classList.add("pbs-toolbar-short"):this._domElement.classList.remove("pbs-toolbar-short")}.bind(this))}.bind(this))},Toolbar.prototype.checkIfTooHigh=function(element){fastdom.measure(function(){var top=window.pbsGetBoundingClientRect(element._domElement).top;fastdom.mutate(function(){top<=82?this._domElement.classList.add("pbs-toolbar-too-high"):this._domElement.classList.remove("pbs-toolbar-too-high")}.bind(this))}.bind(this))},Toolbar.prototype.updateTools=function(element){var tool,tools=this._buttonContainer.querySelectorAll(".pbs-toolbar-tool");Array.prototype.forEach.call(tools,function(el){el.tool&&((tool=el.tool).class&&el.classList.add(tool.class),"function"==typeof tool.tooltip&&el.setAttribute("data-tooltip",tool.tooltip(element)),"function"==typeof tool.label&&(el.innerHTML=tool.label(element)),el.classList.remove("pbs-toolbar-tool-hide"),"function"==typeof tool.display&&(tool.display(element,el)||el.classList.add("pbs-toolbar-tool-hide")))}.bind(this))},Toolbar.prototype.show=function(element){Toolbar.__super__.show.call(this,element),this.checkIfTooSmall(element),this.checkIfTooHigh(element),this.checkIfTooShort(element),this.updateTools(element)},Toolbar.prototype._mouseenter=function(ev){Toolbar.__super__._mouseenter.call(this,ev)},Toolbar}(PBSEditor.OverlayControls),PBSEditor.ToolbarElement=function(_super){function ToolbarElement(){ToolbarElement.__super__.constructor.call(this,"Text",[{id:"move",tooltip:pbsParams.labels.move,display:function(element){return!element.content.isWhitespace()},onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"settings",tooltip:pbsParams.labels.properties,display:function(element){return!element.content.isWhitespace()},onClick:function(element){element.inspect()}},{id:"clone",tooltip:pbsParams.labels.clone,display:function(element){return!element.content.isWhitespace()},onClick:function(element){"IconLabel"!==element.parent().constructor.name?element.clone():element.parent().clone()}},{id:"remove",tooltip:pbsParams.labels.delete,display:function(element){return!element.content.isWhitespace()},onClick:function(element){"IconLabel"!==element.parent().constructor.name?element.parent().detach(element):element.parent().parent().detach(element.parent())}}])}return __extends(ToolbarElement,_super),ToolbarElement}(PBSEditor.Toolbar),PBSEditor.ToolbarImage=function(_super){function ToolbarImage(){ToolbarImage.__super__.constructor.call(this,"Image",toolbars)}var toolbars=[];return __extends(ToolbarImage,_super),toolbars.push({label:function(element){return element.a?element.a.href||pbsParams.labels.image:pbsParams.labels.image}},{id:"move",tooltip:pbsParams.labels.move,onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"settings",tooltip:pbsParams.labels.properties,onClick:function(element){element.inspect()}},{id:"clone",tooltip:pbsParams.labels.clone,onClick:function(element){element.clone()}},{id:"remove",tooltip:pbsParams.labels.delete,onClick:function(element){element.remove()}}),ToolbarImage}(PBSEditor.Toolbar),PBSEditor.ToolbarNewsletter=function(_super){function ToolbarNewsletter(){ToolbarNewsletter.__super__.constructor.call(this,"Newsletter",[{label:pbsParams.labels.newsletter},{id:"move",tooltip:pbsParams.labels.move,onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"settings",tooltip:pbsParams.labels.properties,onClick:function(element){element.inspect()}},{id:"remove",tooltip:pbsParams.labels.delete,onClick:function(element){element.remove()}}])}return __extends(ToolbarNewsletter,_super),ToolbarNewsletter}(PBSEditor.Toolbar),PBSEditor.ToolbarHtml=function(_super){function ToolbarHtml(){ToolbarHtml.__super__.constructor.call(this,"Html",[{label:pbsParams.labels.html},{id:"move",tooltip:pbsParams.labels.move,onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"settings",tooltip:pbsParams.labels.properties,onClick:function(element){element.inspect()}},{id:"clone",tooltip:pbsParams.labels.clone,onClick:function(element){element.clone()}},{id:"remove",tooltip:pbsParams.labels.delete,onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarHtml,_super),ToolbarHtml}(PBSEditor.Toolbar),PBSEditor.ToolbarIframe=function(_super){function ToolbarIframe(){ToolbarIframe.__super__.constructor.call(this,"IFrame",[{label:pbsParams.labels.iframe},{id:"move",tooltip:pbsParams.labels.move,onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"edit",tooltip:pbsParams.labels.edit,onClick:function(element){element._onDoubleClick()}},{id:"remove",tooltip:pbsParams.labels.delete,onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarIframe,_super),ToolbarIframe}(PBSEditor.Toolbar),PBSEditor.ToolbarEmbed=function(_super){function ToolbarEmbed(){ToolbarEmbed.__super__.constructor.call(this,"Embed",[{label:pbsParams.labels.embedded_url},{id:"move",tooltip:pbsParams.labels.move,onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"settings",tooltip:pbsParams.labels.properties,onClick:function(element){element.inspect()}},{id:"clone",tooltip:pbsParams.labels.clone,onClick:function(element){element.clone()}},{id:"remove",tooltip:pbsParams.labels.delete,onClick:function(element){element.remove()}}])}return __extends(ToolbarEmbed,_super),ToolbarEmbed}(PBSEditor.Toolbar),PBSEditor.ToolbarMap=function(_super){function ToolbarMap(){ToolbarMap.__super__.constructor.call(this,"Map",[{label:pbsParams.labels.map},{id:"move",tooltip:pbsParams.labels.move,onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"settings",tooltip:pbsParams.labels.properties,onClick:function(element){element.inspect()}},{id:"clone",tooltip:pbsParams.labels.clone,onClick:function(element){element.clone()}},{id:"remove",tooltip:pbsParams.labels.delete,onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarMap,_super),ToolbarMap}(PBSEditor.Toolbar),PBSEditor.ToolbarIcon=function(_super){function ToolbarIcon(){ToolbarIcon.__super__.constructor.call(this,"Icon",[{label:pbsParams.labels.icon},{id:"move",tooltip:pbsParams.labels.move,display:function(element){return"IconLabel"!==element.parent().constructor.name},onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"settings",tooltip:pbsParams.labels.properties,onClick:function(element){element.inspect()}},{id:"clone",tooltip:pbsParams.labels.clone,display:function(element){return"IconLabel"!==element.parent().constructor.name},onClick:function(element){element.clone()}},{id:"remove",tooltip:pbsParams.labels.delete,display:function(element){return"IconLabel"!==element.parent().constructor.name},onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarIcon,_super),ToolbarIcon}(PBSEditor.Toolbar),PBSEditor.ToolbarShortcode=function(_super){function ToolbarShortcode(){ToolbarShortcode.__super__.constructor.call(this,"Shortcode",[{label:function(element){var label=wp.hooks.applyFilters("pbs.toolbar.shortcode.label",element.sc_base);return PBSInspectorOptions.Shortcode[element.sc_base]&&PBSInspectorOptions.Shortcode[element.sc_base].label&&(label=wp.hooks.applyFilters("pbs.toolbar.shortcode.label",PBSInspectorOptions.Shortcode[element.sc_base].label)),label}},{id:"move",tooltip:pbsParams.labels.move,onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"settings",tooltip:pbsParams.labels.properties,onClick:function(element){element.inspect()}},{id:"clone",tooltip:pbsParams.labels.clone,onClick:function(element){element.clone()}},{id:"remove",tooltip:pbsParams.labels.delete,onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarShortcode,_super),ToolbarShortcode}(PBSEditor.Toolbar),PBSEditor.ToolbarList=function(_super){function ToolbarList(){ToolbarList.__super__.constructor.call(this,"List",[{label:pbsParams.labels.list},{id:"move",tooltip:pbsParams.labels.move,onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"settings",tooltip:pbsParams.labels.properties,onClick:function(element){element.inspect()}},{id:"clone",tooltip:pbsParams.labels.clone,onClick:function(element){element.clone()}},{id:"remove",tooltip:pbsParams.labels.delete,onClick:function(element){element.remove()}}])}return __extends(ToolbarList,_super),ToolbarList.prototype.canApplyTo=function(element){var ret=ToolbarList.__super__.canApplyTo.call(element);if(!ret&&element.constructor){if("ListItem"===element.constructor.name)return element.parent();if(element.parent()&&"ListItem"===element.parent().constructor.name)return element.parent().parent()}return ret},ToolbarList}(PBSEditor.Toolbar),PBSEditor.ToolbarButton=function(_super){function ToolbarButton(){ToolbarButton.__super__.constructor.call(this,"Button",[{label:function(element){var button=element._domElement.querySelector(".pbs-button");return button.getAttribute("href")?button.getAttribute("href"):pbsParams.labels.button}},{id:"move",tooltip:pbsParams.labels.move,display:function(element){return!element.content.isWhitespace()},onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"settings",tooltip:pbsParams.labels.properties,onClick:function(element){element.inspect()}},{id:"clone",tooltip:pbsParams.labels.clone,onClick:function(element){element.clone()}},{id:"remove",tooltip:pbsParams.labels.delete,onClick:function(element){element.remove()}}])}return __extends(ToolbarButton,_super),ToolbarButton}(PBSEditor.Toolbar),PBSEditor.ToolbarRow=function(_super){function ToolbarRow(){ToolbarRow.__super__.constructor.call(this,"DivRow",[{id:"move",tooltip:pbsParams.labels.move,display:function(element){return"TabPanelContainer"!==element.parent().constructor.name&&"Toggle"!==element.parent().constructor.name},onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),"Carousel"===element.parent().constructor.name&&(element=element.parent()),element.drag(ev.pageX,ev.pageY)}},{id:"settings",tooltip:pbsParams.labels.properties,onClick:function(element){ContentTools.EditorApp.get()._toolboxProperties.inspect(element.children[0]),"Carousel"!==element.parent().constructor.name?document.querySelector('.pbs-toolbox-properties [data-name="DivRow"]').dispatchEvent(new CustomEvent("click")):document.querySelector('.pbs-toolbox-properties [data-name="Carousel"]').dispatchEvent(new CustomEvent("click"))}},{id:"add",tooltip:function(element){return"Carousel"===element.parent().constructor.name?pbsParams.labels.add_slide:pbsParams.labels.add_column},display:function(element){return"Toggle"!==element.parent().constructor.name},onClick:function(element){var root=ContentEdit.Root.get();"Carousel"!==element.parent().constructor.name?(root.focused()&&root.focused().blur&&root.focused().blur(),element.addNewColumn(1)):element.parent().addSlide()}},{id:"clone",tooltip:function(element){return"Carousel"===element.parent().constructor.name?pbsParams.labels.clone_slide:pbsParams.labels.clone_row},display:function(element){return"TabPanelContainer"!==element.parent().constructor.name&&"Toggle"!==element.parent().constructor.name},onClick:function(element){var newRow;"Carousel"!==element.parent().constructor.name?(newRow=element.clone(),window._pbsFixRowWidth(newRow._domElement)):element.parent().cloneSlide()}},{id:"responsive_hide",tooltip:function(){return window.innerWidth<=400?pbsParams.labels.hide_in_phones:pbsParams.labels.hide_in_tablets},display:function(element,button){return"Carousel"!==element.parent().constructor.name&&("TabPanelContainer"!==element.parent().constructor.name&&("Toggle"!==element.parent().constructor.name&&(!(window.innerWidth>800)&&(window.innerWidth>400?element.attr("data-pbs-hide-tablet")?button.classList.add("pbs-responsive-hidden"):button.classList.remove("pbs-responsive-hidden"):"1"===element.attr("data-pbs-hide-phone")||"2"===element.attr("data-pbs-hide-phone")?button.classList.add("pbs-responsive-hidden"):button.classList.remove("pbs-responsive-hidden"),!0))))},onClick:function(element,button){window.innerWidth>400?element.attr("data-pbs-hide-tablet")?(element.removeAttr("data-pbs-hide-tablet"),"2"===element.attr("data-pbs-hide-phone")&&element.removeAttr("data-pbs-hide-phone"),button.classList.remove("pbs-responsive-hidden")):(element.attr("data-pbs-hide-tablet","1"),"0"!==element.attr("data-pbs-hide-phone")&&"1"!==element.attr("data-pbs-hide-phone")&&element.attr("data-pbs-hide-phone","2"),button.classList.add("pbs-responsive-hidden")):"0"!==element.attr("data-pbs-hide-phone")?(element.attr("data-pbs-hide-phone","0"),button.classList.remove("pbs-responsive-hidden")):(element.attr("data-pbs-hide-phone","1"),button.classList.add("pbs-responsive-hidden"))}},{id:"remove2",tooltip:function(element){return"Carousel"===element.parent().constructor.name?pbsParams.labels.delete_slide:pbsParams.labels.delete_column},display:function(element){return"TabPanelContainer"!==element.parent().constructor.name&&"Toggle"!==element.parent().constructor.name},onClick:function(element){"Carousel"!==element.parent().constructor.name?element.children[0].remove():element.parent().removeSlide()},onMouseLeave:function(){document.querySelector(".pbs-toolbar-divcol").classList.remove("pbs-col-delete-highlight")},onMouseEnter:function(){document.querySelector(".pbs-toolbar-divcol").classList.add("pbs-col-delete-highlight")}},{id:"remove",tooltip:function(element){return"Carousel"===element.parent().constructor.name?pbsParams.labels.delete_carousel:pbsParams.labels.delete_row},display:function(element){return"TabPanelContainer"!==element.parent().constructor.name&&"Toggle"!==element.parent().constructor.name},onClick:function(element){"Carousel"!==element.parent().constructor.name?element.remove():element.parent().remove()},onMouseLeave:function(){document.querySelector(".pbs-toolbar-divrow").classList.remove("pbs-row-delete-highlight")},onMouseEnter:function(){document.querySelector(".pbs-toolbar-divrow").classList.add("pbs-row-delete-highlight")}}])}return __extends(ToolbarRow,_super),ToolbarRow.prototype.canApplyTo=function(element){if(this._domElement.classList.remove("pbs-col-first-selected"),"DivCol"===element.constructor.name&&0===element.parent().children.indexOf(element)&&this._domElement.classList.add("pbs-col-first-selected"),this._domElement.classList.remove("pbs-row-selected"),"DivRow"===element.constructor.name)return this._domElement.classList.add("pbs-row-selected"),element;if("DivRow"!==element.constructor.name)for(element=element.parent();element&&"Region"!==element.constructor.name;){if("DivCol"===element.constructor.name&&0===element.parent().children.indexOf(element)&&this._domElement.classList.add("pbs-col-first-selected"),"DivRow"===element.constructor.name)return element;element=element.parent()}return!1},ToolbarRow.prototype.show=function(element){ToolbarRow.__super__.show.call(this,element)},ToolbarRow}(PBSEditor.Toolbar),PBSEditor.ToolbarColumn=function(_super){function ToolbarColumn(){ToolbarColumn.__super__.constructor.call(this,"DivCol",[{id:"settings",tooltip:pbsParams.labels.properties,display:function(element){return 0!==element.parent().children.indexOf(element)},onClick:function(element){ContentTools.EditorApp.get()._toolboxProperties.inspect(element)}},{id:"add",tooltip:pbsParams.labels.add_column,display:function(element){return 0!==element.parent().children.indexOf(element)},onClick:function(element){var root,index;(root=ContentEdit.Root.get()).focused()&&root.focused().blur&&root.focused().blur(),index=element.parent().children.indexOf(element)+1,element.parent().addNewColumn(index)}},{id:"clone",tooltip:pbsParams.labels.clone,display:function(element){return(!element.parent()||!element.parent().parent()||"Toggle"!==element.parent().parent().constructor.name)&&0!==element.parent().children.indexOf(element)},onClick:function(element){element.clone()}},{id:"remove",tooltip:pbsParams.labels.delete_column,display:function(element){return 0!==element.parent().children.indexOf(element)},onClick:function(element){element.remove()},onMouseLeave:function(){document.querySelector(".pbs-toolbar-divcol").classList.remove("pbs-col-delete-highlight")},onMouseEnter:function(){document.querySelector(".pbs-toolbar-divcol").classList.add("pbs-col-delete-highlight")}}])}return __extends(ToolbarColumn,_super),ToolbarColumn.prototype.canApplyTo=function(element){if("DivCol"===element.constructor.name)return element;if("DivCol"!==element.constructor.name)for(element=element.parent();element&&"Region"!==element.constructor.name;){if("DivCol"===element.constructor.name)return element;element=element.parent()}return!1},ToolbarColumn.prototype.show=function(element){ToolbarColumn.__super__.show.call(this,element),element.parent()&&(0===element.parent().children.indexOf(element)?this._domElement.classList.add("pbs-col-on-first"):this._domElement.classList.remove("pbs-col-on-first"))},ToolbarColumn}(PBSEditor.Toolbar),PBSEditor.ToolbarTabContainer=function(_super){function ToolbarTabContainer(){ToolbarTabContainer.__super__.constructor.call(this,"TabContainer",toolbar)}var toolbar=[];return __extends(ToolbarTabContainer,_super),toolbar.push({id:"move",tooltip:pbsParams.labels.move,onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.parent().drag(ev.pageX,ev.pageY)}},{id:"add",tooltip:pbsParams.labels.add_tab,onClick:function(element){element.parent().addTab()}},{id:"settings",tooltip:pbsParams.labels.properties,onClick:function(element){element.inspect()}},{id:"clone",tooltip:pbsParams.labels.clone,onClick:function(element){element.parent().clone()}},{id:"remove",tooltip:pbsParams.labels.delete,onClick:function(element){element.parent().remove()}}),ToolbarTabContainer.prototype.canApplyTo=function(element){return"Tab"===element.constructor.name?element.parent():ToolbarTabContainer.__super__.canApplyTo.call(this,element)},ToolbarTabContainer}(PBSEditor.Toolbar),PBSEditor.ToolbarTable=function(_super){function ToolbarTable(){ToolbarTable.__super__.constructor.call(this,"Table",[{label:pbsParams.labels.table},{id:"move",tooltip:pbsParams.labels.move,onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"remove",tooltip:pbsParams.labels.delete,onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarTable,_super),ToolbarTable}(PBSEditor.Toolbar),PBSEditor.ToolbarTitle=function(_super){function ToolbarTitle(){ToolbarTitle.__super__.constructor.call(this,"Title",[{label:pbsParams.labels.post_title}])}return __extends(ToolbarTitle,_super),ToolbarTitle}(PBSEditor.Toolbar),PBSEditor.ToolbarSpacer=function(_super){function ToolbarSpacer(){ToolbarSpacer.__super__.constructor.call(this,"Spacer",[{label:pbsParams.labels.spacer},{id:"move",tooltip:pbsParams.labels.move,onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"clone",tooltip:pbsParams.labels.clone,onClick:function(element){element.clone()}},{id:"remove",tooltip:pbsParams.labels.delete,onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarSpacer,_super),ToolbarSpacer}(PBSEditor.Toolbar),PBSEditor.ToolbarHr=function(_super){function ToolbarHr(){ToolbarHr.__super__.constructor.call(this,"Hr",[{id:"move",tooltip:pbsParams.labels.move,onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"settings",tooltip:pbsParams.labels.properties,onClick:function(element){element.inspect()}},{id:"clone",tooltip:pbsParams.labels.clone,onClick:function(element){element.clone()}},{id:"remove",tooltip:pbsParams.labels.delete,onClick:function(element){element.remove()}}])}return __extends(ToolbarHr,_super),ToolbarHr}(PBSEditor.Toolbar),PBSEditor.Tooltip=function(){function Tooltip(name,selector,labelFunction,tools){this._domElement=null,this.name=name||this.constructor.name.toLowerCase(),this.labelFunction=labelFunction||function(){},this.selector=selector||"",this.tools=tools||[],this.init()}return Tooltip.prototype.init=function(){this._onMouseOverBound=this._onMouseOver.bind(this),this._onMouseOutBound=this._onMouseOut.bind(this),ContentTools.EditorApp.get().bind("start",function(){var label,i,tool;for(this._domElement=document.createElement("DIV"),this._domElement.classList.add("pbs-tooltip--"+this.name),this._domElement.classList.add("pbs-tooltip"),label=document.createElement("DIV"),this._domElement.appendChild(label),i=0;i<this.tools.length;i++)(tool=document.createElement("DIV")).classList.add("pbs-tooltip-button"),tool.classList.add("pbs-tooltip-button-"+this.tools[i].name),tool.addEventListener("click",this.tools[i].onClick.bind(this)),this._domElement.appendChild(tool);document.body.appendChild(this._domElement),document.addEventListener("mouseover",this._onMouseOverBound),document.addEventListener("mouseout",this._onMouseOutBound)}.bind(this)),ContentTools.EditorApp.get().bind("stop",function(){this.hide(),document.removeEventListener("mouseover",this._onMouseOverBound),document.removeEventListener("mouseout",this._onMouseOutBound),this._domElement.parentNode.removeChild(this._domElement),this._domElement=null}.bind(this))},Tooltip.prototype._onMouseOver=function(ev){var target;if(pbsSelectorMatches(ev.target,".pbs-main-wrapper "+this.selector+", .pbs-main-wrapper "+this.selector+" *")){for(target=ev.target;!pbsSelectorMatches(target,".pbs-main-wrapper "+this.selector);)target=target.parentNode;this.target=target,this.show(target)}},Tooltip.prototype._onMouseOut=function(ev){ev.relatedTarget?(!pbsSelectorMatches(ev.target,".pbs-main-wrapper "+this.selector)&&!pbsSelectorMatches(ev.target,".pbs-main-wrapper "+this.selector+" *")||ev.relatedTarget!==this._domElement&&!this._domElement.contains(ev.relatedTarget))&&(this._domElement!==ev.target&&!this._domElement.contains(ev.target)||!pbsSelectorMatches(ev.relatedTarget,".pbs-main-wrapper "+this.selector)&&!pbsSelectorMatches(ev.relatedTarget,".pbs-main-wrapper "+this.selector+" *"))&&(this._domElement!==ev.target&&!this._domElement.contains(ev.target)||this._domElement!==ev.relative&&!this._domElement.contains(ev.relatedTarget))&&this.hide():this.hide()},Tooltip.prototype.show=function(domElementTarget){var rect=window.pbsGetBoundingClientRect(domElementTarget);this._domElement.style.top=rect.top+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._domElement.style.left=rect.left+rect.width/2+"px","function"==typeof this.labelFunction?this._domElement.firstChild.innerHTML=this.labelFunction(domElementTarget):this._domElement.firstChild.innerHTML=this.labelFunction,this._domElement.classList.add("pbs-tooltip-show"),this.element=domElementTarget},Tooltip.prototype.hide=function(){this._domElement.classList.remove("pbs-tooltip-show")},Tooltip}(),PBSEditor.TooltipLink=function(_super){function TooltipLink(){TooltipLink.__super__.constructor.call(this,"link",".ce-element--type-text a:not(.pbs-button)",function(element){var link=element.getAttribute("href");return link.length>70&&(link=link.substr(0,70)+"..."),link},[{name:"visit",onClick:function(){window.open(this.target.getAttribute("href"),"_linktool"),this.hide()}},{name:"edit",onClick:function(){window.pbsLinkFrame.open({url:this.target.getAttribute("href"),text:this.target.innerHTML,target:this.target.getAttribute("target")||!1,hasText:this.target.innerText===this.target.innerHTML},function(url,text,target){this.target.innerText=text,this.target.setAttribute("href",url),target?this.target.setAttribute("target",target):this.target.removeAttribute("target"),this.target.parentNode._ceElement._syncContent()}.bind(this)),this.hide()}},{name:"unlink",onClick:function(){var element=this.target.parentNode._ceElement,textNode=document.createTextNode(this.target.innerHTML);this.target.parentNode.replaceChild(textNode,this.target),element._syncContent(),this.hide()}}])}return __extends(TooltipLink,_super),TooltipLink}(PBSEditor.Tooltip),PBSEditor.TooltipInput=function(_super){function TooltipInput(){TooltipInput.__super__.constructor.call(this,"input",'p[class*="ce-element--"] input[type="text"]',pbsParams.labels.input_field,[{name:"settings",onClick:function(){ContentTools.EditorApp.get()._toolboxProperties.inspect(this.element)}}])}return __extends(TooltipInput,_super),TooltipInput}(PBSEditor.Tooltip),PBSEditor.TooltipTab=function(_super){function TooltipTab(){TooltipTab.__super__.constructor.call(this,"button",'[data-ce-tag="tab"]',pbsParams.labels.tab,[{name:"remove",onClick:function(){this.element._ceElement.parent().parent().removeTab(this.element._ceElement),this.hide()}}])}return __extends(TooltipTab,_super),TooltipTab}(PBSEditor.Tooltip),function(){var ready=function(){ContentEdit.Root.get().bind("detach",function(){"undefined"!=typeof AOS&&AOS.refresh()})};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}();var elemsWithBoundingRects=[],elemsWithComputedStyles=[],showActualRect=!1;window.pbsGetBoundingClientRect=function(element){return!showActualRect&&element._boundingClientRect||(element._boundingClientRect=element.getBoundingClientRect(),elemsWithBoundingRects.push(element)),element._boundingClientRect},window.pbsGetComputedStyle=function(element){return element._computedStyle||(element._computedStyle=getComputedStyle(element),elemsWithComputedStyles.push(element)),element._computedStyle},window.pbsScrollY=function(){return window._prevScrollY||(window._prevScrollY=window.scrollY||window.pageYOffset),window._prevScrollY},window.addEventListener("scroll",function(){window._prevScrollY=null}),window.formattingToolbarHeight=function(){var toolbar;return this._formattingToolbarHeight?this._formattingToolbarHeight:window.PBSEditor.ToolboxFormatting?(toolbar=window.PBSEditor.ToolboxFormatting.getInstance()._domElement,toolbar=window.pbsGetBoundingClientRect(toolbar),this._formattingToolbarHeight=toolbar.height,this._formattingToolbarHeight):0},function(){var clearClientRects=function(){var i;for(i=0;i<elemsWithBoundingRects.length;i++)elemsWithBoundingRects[i]&&(elemsWithBoundingRects[i]._boundingClientRect=null);for(elemsWithBoundingRects=[],i=0;i<elemsWithComputedStyles.length;i++)elemsWithComputedStyles[i]&&(elemsWithComputedStyles[i]._computedStyle=null);elemsWithComputedStyles=[]},mousedown=!1,mouseDownListener=function(){mousedown=!0,clearClientRects()},mouseUpListener=function(){mousedown=!1,showActualRect=!1,clearClientRects()},mouseMoveListener=function(){mousedown&&clearClientRects()},overlayDragListener=function(){showActualRect=!0,clearClientRects()},clearRectsAndOverlays=function(){this._clearRectsAndOverlaysTimeout||(this._clearRectsAndOverlaysTimeout=setTimeout(function(){PBSEditor.Overlay.hideAll(),clearClientRects(),this._clearRectsAndOverlaysTimeout=null}.bind(this),100))},clearWhenTransitionEnds=function(ev){if(ev.target.classList){if(ev.target.classList.contains("pbs-overlay-toolbar"))return;if(ev.target.classList.contains("pbs-toolbar-tool"))return}ev.target.parentNode.classList&&ev.target.parentNode.classList.contains("pbs-quick-action-overlay")||(void 0!==ev.target._ceElement?clearRectsAndOverlays():void 0!==ev.target.parentNode._ceElement&&clearRectsAndOverlays())};ContentTools.EditorApp.get().bind("start",function(){setTimeout(function(){clearRectsAndOverlays()},401),this.clearInterval=setInterval(function(){fastdom.measure(function(){Math.abs(this._oldBodyHeight-document.body.clientHeight)>15&&(this._oldBodyHeight=document.body.clientHeight,fastdom.mutate(function(){clearRectsAndOverlays()}))})},500),window.addEventListener("mouseup",mouseUpListener),window.addEventListener("mousedown",mouseDownListener),window.addEventListener("mousemove",mouseMoveListener),window.addEventListener("keydown",clearClientRects),window.addEventListener("keyup",clearClientRects),window.addEventListener("resize",clearClientRects),window.addEventListener("scroll",clearClientRects),document.addEventListener("transitionend",clearWhenTransitionEnds),document.addEventListener("transitionstart",clearWhenTransitionEnds),document.addEventListener("transitioncancel",clearWhenTransitionEnds),wp.hooks.addAction("pbs.rects.changed",clearClientRects),wp.hooks.addAction("pbs.overlay.drag",overlayDragListener),wp.hooks.addAction("pbs.image.mounted",clearRectsAndOverlays),wp.hooks.addAction("pbs.embed.update_embed_content",clearRectsAndOverlays),wp.hooks.addAction("pbs.iframe.resized",clearRectsAndOverlays),wp.hooks.addAction("pbs.carousel.repositioned",clearRectsAndOverlays),wp.hooks.addAction("pbs.dom.reposition",clearRectsAndOverlays),ContentEdit.Root.get().bind("unmount",clearRectsAndOverlays),ContentEdit.Root.get().bind("mount",clearRectsAndOverlays)}),ContentTools.EditorApp.get().bind("stop",function(){clearInterval(this.clearInterval),window.removeEventListener("mouseup",mouseUpListener),window.removeEventListener("mousedown",mouseDownListener),window.removeEventListener("mousemove",mouseMoveListener),window.removeEventListener("keydown",clearClientRects),window.removeEventListener("keyup",clearClientRects),window.removeEventListener("resize",clearClientRects),window.removeEventListener("scroll",clearClientRects),document.removeEventListener("transitionend",clearWhenTransitionEnds),document.removeEventListener("transitionstart",clearWhenTransitionEnds),document.removeEventListener("transitioncancel",clearWhenTransitionEnds),wp.hooks.removeAction("pbs.rects.changed",clearClientRects),wp.hooks.removeAction("pbs.overlay.drag",overlayDragListener),wp.hooks.removeAction("pbs.image.mounted",clearRectsAndOverlays),wp.hooks.removeAction("pbs.embed.update_embed_content",clearRectsAndOverlays),wp.hooks.removeAction("pbs.iframe.resized",clearRectsAndOverlays),wp.hooks.removeAction("pbs.carousel.repositioned",clearRectsAndOverlays),wp.hooks.removeAction("pbs.dom.reposition",clearRectsAndOverlays),ContentEdit.Root.get().unbind("unmount",clearRectsAndOverlays),ContentEdit.Root.get().unbind("mount",clearRectsAndOverlays)})}(),PBSEditor.allDroppers={Carousel:ContentEdit.Element._dropVert,DivRow:ContentEdit.Element._dropVert,Div:ContentEdit.Element._dropVert,Embed:ContentEdit.Element._dropVert,Hr:ContentEdit.Element._dropVert,IFrame:ContentEdit.Element._dropVert,Shortcode:ContentEdit.Element._dropVert,Static:ContentEdit.Element._dropVert,Text:ContentEdit.Element._dropVert,Image:ContentEdit.Element._dropVert,List:ContentEdit.Element._dropVert,PreText:ContentEdit.Element._dropVert,Table:ContentEdit.Element._dropVert,Video:ContentEdit.Element._dropVert,Tabs:ContentEdit.Element._dropVert,Toggle:ContentEdit.Element._dropVert,IconLabel:ContentEdit.Element._dropVert},PBSEditor.isNewStaticLikeElement=function(element){return"Static"!==element.constructor.name&&("Icon"!==element.constructor.name&&void 0!==element._content)},ContentEdit.Text.prototype._elementOverrideKeyLeft=ContentEdit.Text.prototype._keyLeft,ContentEdit.Text.prototype._keyLeft=function(ev){var elem;return 0===ContentSelect.Range.query(this._domElement).get()[0]&&(elem=this.previousContent())&&elem.focus&&PBSEditor.isNewStaticLikeElement(elem)?(ev.preventDefault(),ev.stopPropagation(),void elem.focus()):this._elementOverrideKeyLeft(ev)},ContentEdit.Text.prototype._elementOverrideKeyRight=ContentEdit.Text.prototype._keyRight,ContentEdit.Text.prototype._keyRight=function(ev){var elem,selection=ContentSelect.Range.query(this._domElement);return this._atEnd(selection)&&(elem=this.nextContent())&&elem.focus&&PBSEditor.isNewStaticLikeElement(elem)?(ev.preventDefault(),ev.stopPropagation(),void elem.focus()):this._elementOverrideKeyRight(ev)},function(){var ready=function(){var editor=ContentEdit.Root.get();document.addEventListener("keydown",function(ev){var sc,p,elem,parent,index;if(editor.focused()&&(!ev.target||-1===["INPUT","TEXTAREA"].indexOf(ev.target.tagName))&&PBSEditor.isNewStaticLikeElement(editor.focused())&&-1!==["body","html"].indexOf(ev.target.tagName.toLowerCase())&&-1===[16,17,18,91,92].indexOf(ev.which))if(sc=editor.focused(),index=sc.parent().children.indexOf(sc),-1!==[13,8,46].indexOf(ev.which)&&ev.preventDefault(),8===ev.which?(sc.blur(),sc.parent().children[index-1]?((elem=sc.parent().children[index-1]).focus(),elem.content&&new ContentSelect.Range(elem.content.length(),elem.content.length()).select(elem._domElement)):sc.parent().children[index+1]?((elem=sc.parent().children[index+1]).focus(),elem.content&&new ContentSelect.Range(elem.content.length(),elem.content.length()).select(elem._domElement)):(parent=sc.parent(),setTimeout(function(){parent.children[0].focus()},10))):46===ev.which&&(sc.blur(),sc.parent().children[index+1]?sc.parent().children[index+1].focus():sc.parent().children[index-1]?sc.parent().children[index-1].focus():(parent=sc.parent(),setTimeout(function(){parent.children[0].focus()},10))),8!==ev.which&&46!==ev.which){if((40===ev.which||39===ev.which)&&sc.nextContent()&&sc.parent().children.indexOf(sc)!==sc.parent().children.length-1)return ev.preventDefault(),void sc.nextContent().focus();if((38===ev.which||37===ev.which)&&sc.previousContent()&&0!==sc.parent().children.indexOf(sc))return ev.preventDefault(),void sc.previousContent().focus();38!==ev.which&&37!==ev.which&&index++,p=new ContentEdit.Text("p"),sc.parent().attach(p,index),sc.blur(),p.focus()}else sc.parent().detach(sc)})};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),ContentEdit.Node.prototype._overridePreviousContent=ContentEdit.Node.prototype.previousContent,ContentEdit.Node.prototype.previousContent=function(){return this.previousWithTest(function(node){return void 0!==node.content||PBSEditor.isNewStaticLikeElement(node)})},ContentEdit.Node.prototype._overrideNextContent=ContentEdit.Node.prototype.nextContent,ContentEdit.Node.prototype.nextContent=function(){return this.nextWithTest(function(node){return void 0!==node.content||PBSEditor.isNewStaticLikeElement(node)})},function(){var proxied=ContentEdit.Element.prototype._addDOMEventListeners;ContentEdit.Element.prototype._addDOMEventListeners=function(){return this._syncContent&&(this._domElement.oninput=function(){if(this._syncContent)return this._syncContent()}.bind(this)),proxied.call(this)}}(),ContentEdit.Element.prototype.clone=function(){var newElem;return this.blur&&this.blur(),newElem=document.createElement("DIV"),newElem.innerHTML=this.html(),newElem=this.constructor.fromDOMElement(newElem.firstChild),this.parent().attach(newElem,this.parent().children.indexOf(this)+1),newElem},ContentEdit.Element.prototype.inspect=function(){ContentTools.EditorApp.get()._toolboxProperties.inspect(this)},ContentEdit.Element.prototype.remove=function(){this.blur&&this.blur(),this.isMounted()&&this.parent().detach(this)},ContentEdit.Root.get().bind("attach",function(element,attachedElement){var i;if("NewElementDragHelper"!==attachedElement.constructor.name&&!(element.children.length<2))for(i=element.children.length-1;i>=0;i--)element.children[i]!==attachedElement&&element.children[i].content&&element.children[i].content.isWhitespace&&element.children[i].content.isWhitespace()&&element.children[i].remove()}),function(){var proxied=ContentEdit.Static.prototype._onMouseUp;ContentEdit.Static.prototype._onMouseUp=function(ev){proxied.call(this,ev),clearTimeout(this._dragTimeout),clearTimeout(this._doubleClickTimeout),this._doubleClickTimeout=setTimeout(function(_this){return function(){_this._doubleClickCount=0}}(this),500),this._doubleClickCount++}}(),function(){var proxied=ContentEdit.Static.prototype._onMouseOut;ContentEdit.Static.prototype._onMouseOut=function(ev){proxied.call(this,ev),this._doubleClickCount=0,clearTimeout(this._dragTimeout)}}(),function(){var proxied=ContentEdit.Static.prototype._onMouseMove;ContentEdit.Static.prototype._onMouseMove=function(ev){proxied.call(this,ev),this._doubleClickCount=0}}(),function(){var proxied=ContentEdit.Static.prototype._onMouseDown;ContentEdit.Static.prototype._onMouseDown=function(ev){ev.preventDefault(),proxied.call(this,ev),clearTimeout(this._dragTimeout),this.domElement()===ev.target&&(this._dragTimeout=setTimeout(function(_this){return function(){return _this.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION/2),clearTimeout(this._doubleClickTimeout),this._doubleClickTimeout=setTimeout(function(_this){return function(){_this._doubleClickCount=0}}(this),500),3===++this._doubleClickCount&&(clearTimeout(this._dragTimeout),this._doubleClickCount=0,"function"==typeof this._onDoubleClick&&this._onDoubleClick(ev)))}}(),ContentEdit.Static.prototype.convertToText=function(text,keepSize){var elem,index,rect,marginBottom;return void 0===keepSize&&(keepSize=!1),elem=document.createElement("P"),elem.innerHTML=text,elem=ContentEdit.Text.fromDOMElement(elem),this.blur(),index=this.parent().children.indexOf(this),rect=this._domElement.getBoundingClientRect(),marginBottom=0,this._domElement.nextElementSibling&&(marginBottom=this._domElement.nextElementSibling.getBoundingClientRect().top-rect.bottom),this.parent().attach(elem,index),this.parent().detach(this),keepSize&&(elem._domElement.style.minHeight=rect.height+"px",elem._domElement.style.marginBottom=marginBottom+"px"),elem.focus(),function(elem){setTimeout(function(){var selection=new ContentSelect.Range(elem.content.length(),elem.content.length());elem._domElement&&selection.select(elem._domElement)},1)}(elem),elem},ContentEdit.StaticEditable=function(_super){function StaticEditable(tagName,attributes,content){this._doubleClickCount=0,StaticEditable.__super__.constructor.call(this,tagName,attributes),this._content=content}return __extends(StaticEditable,_super),StaticEditable.droppers=PBSEditor.allDroppers,StaticEditable.prototype.blur=function(){var root=ContentEdit.Root.get();if(this.isFocused())return this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)},StaticEditable.prototype._onMouseOver=function(ev){return StaticEditable.__super__._onMouseOver.call(this,ev),this._addCSSClass("ce-element--over")},StaticEditable.prototype.focus=function(supressDOMFocus){var root;if(root=ContentEdit.Root.get(),!this.isFocused())return root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.isMounted()&&!supressDOMFocus&&this.domElement().focus(),root.trigger("focus",this)},StaticEditable.prototype.cssTypeName=function(){return"staticeditable"},StaticEditable.prototype.typeName=function(){return"StaticEditable"},StaticEditable}(ContentEdit.Static),function(){var proxied=ContentEdit.Text.prototype._keyReturn;ContentEdit.Text.prototype._keyReturn=function(ev){var selection,tip,tail,cursor,br;return this.content.isWhitespace()?proxied.call(this,ev):ev.shiftKey||ev.metaKey||ev.ctrlKey?(this.storeState(),ContentSelect.Range.query(this._domElement),selection=ContentSelect.Range.query(this._domElement),tip=this.content.substring(0,selection.get()[0]),tail=this.content.substring(selection.get()[1]),cursor=selection.get()[0]+1,br=new HTMLString.String("<br><br>",!0),0!==tail.length()&&(br=new HTMLString.String("<br>",!0)),this.content=tip.concat(br,tail),this.updateInnerHTML(),this.restoreState(),selection.set(cursor,cursor),this.selection(selection),this.taint()):proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Text.prototype._keyReturn;ContentEdit.Text.prototype._keyReturn=function(ev){var selection,tip,tail,style,focused;return this.content.isWhitespace()?proxied.call(this,ev):(ContentSelect.Range.query(this._domElement),selection=ContentSelect.Range.query(this._domElement),tip=this.content.substring(0,selection.get()[0]),tail=this.content.substring(selection.get()[1]),tip.length()&&tail.length()?(proxied.call(this,ev),void((focused=ContentEdit.Root.get().focused())&&focused.attr("style",this.attr("style")))):tip.length()&&!tail.length()?(proxied.call(this,ev),void((focused=ContentEdit.Root.get().focused())&&"P"===this._domElement.tagName&&(style=this.style("font-family"))&&ContentTools.Tools.FontPicker&&style!==ContentTools.Tools.FontPicker.defaultPFont&&focused.style("font-family",style))):void proxied.call(this,ev))}}(),ContentEdit.Text.prototype._onMouseDown=function(ev){if(ContentEdit.Text.__super__._onMouseDown.call(this,ev),clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(function(_this){return function(){return _this.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION),0===this.content.length()&&ContentEdit.Root.get().focused()===this)return ev.preventDefault(),document.activeElement!==this._domElement&&this._domElement.focus(),new ContentSelect.Range(0,0).select(this._domElement)},function(){var bringBackState=!1,mouseDownHandler=function(ev){var root,element;if(!ev.target._ceElement&&window.pbsSelectorMatches(ev.target,"[data-editable]")){if(root=ContentEdit.Root.get(),!(element=root.focused()))return;element.storeState(),bringBackState=!0}},mouseUpHandler=function(){var root,element;if(bringBackState){if(bringBackState=!1,root=ContentEdit.Root.get(),!(element=root.focused()))return;element.restoreState()}},proxiedFocus=ContentEdit.Text.prototype.focus,proxiedBlur=ContentEdit.Text.prototype.blur;ContentEdit.Text.prototype.focus=function(supressDOMFocus){var ret=proxiedFocus.call(this,supressDOMFocus);return document.addEventListener("mousedown",mouseDownHandler),document.addEventListener("mouseup",mouseUpHandler),ret},ContentEdit.Text.prototype.blur=function(){var ret=proxiedBlur.call(this);return document.removeEventListener("mousedown",mouseDownHandler),document.removeEventListener("mouseup",mouseUpHandler),ret}}(),function(){var syncProxy,keyDownProxy;syncProxy=ContentEdit.Text.prototype._syncContent,ContentEdit.Text.prototype._syncContent=function(){this._domElement.innerHTML.match(/^<br\/?>$/)&&(this._domElement.innerHTML=this._domElement.innerHTML.replace(/^<br\/?>$/,"")),syncProxy.call(this)},keyDownProxy=ContentEdit.Text.prototype._onKeyDown,ContentEdit.Text.prototype._onKeyDown=function(ev){this._domElement.innerHTML.match(/^<br\/?>$/)&&(this._domElement.innerHTML=this._domElement.innerHTML.replace(/^<br\/?>$/,"")),keyDownProxy.call(this,ev)}}(),function(){var proxiedBlur=ContentEdit.Text.prototype.blur;ContentEdit.Text.prototype.blur=function(){var innerHTML;return this._domElement&&(innerHTML=(innerHTML=(innerHTML=this._domElement.innerHTML).replace(/(\s|&nbsp;)+(<\/a>)/,"$2")).replace(/(<a\s[^>]+>)(&nbsp;|\s)+/,"$1"),this._domElement.innerHTML!==innerHTML&&(this._domElement.innerHTML=innerHTML,this._syncContent())),proxiedBlur.call(this)}}(),function(){var proxy=ContentEdit.Text.prototype._syncContent;ContentEdit.Text.prototype._syncContent=function(){return this._domElement.innerHTML.match(/<font(>|\s)/)&&(this.storeState(),this._domElement.innerHTML=this._domElement.innerHTML.replace(/<font(>|\s)/,"<span$1"),this._domElement.innerHTML.match(/<\/font>/)&&(this._domElement.innerHTML=this._domElement.innerHTML.replace(/<\/font>/,"</span>")),this._domElement.innerHTML.match(/color=['"][^'"]+['"]/)&&(this._domElement.innerHTML=this._domElement.innerHTML.replace(/color=['"]([^'"]+)['"]/,'style="color: $1"')),this.restoreState()),proxy.call(this)}}(),function(){var proxied=ContentEdit.Text.prototype._syncContent;ContentEdit.Text.prototype._syncContent=function(ev){return this._domElement&&void 0!==this._domElement.innerHTML?proxied.call(this,ev):this._flagIfEmpty()}}(),function(){var proxied=ContentEdit.Text.prototype.html;ContentEdit.Text.prototype.html=function(){var ret=proxied.call(this);return ret.match(/<p>[\s\n]*<\/p>/g)?"":ret.match(/<p data-placeholder="[^"]*">[\s\n]*<\/p>/g)?"":ret}}(),function(){var proxied=ContentEdit.Text.prototype._keyUp;ContentEdit.Text.prototype._keyUp=function(ev){var index,prevSibling;if(0!==ContentSelect.Range.query(this._domElement).get()[0])return proxied.call(this,ev);0!==(index=this.parent().children.indexOf(this))&&void 0!==(prevSibling=this.parent().children[index-1]).content?prevSibling.focus():ev.preventDefault()}}(),function(){var proxied=ContentEdit.Text.prototype._keyDown;ContentEdit.Text.prototype._keyDown=function(ev){var index,nextSibling,selection=ContentSelect.Range.query(this._domElement);if(!this._atEnd(selection))return proxied.call(this,ev);index=this.parent().children.indexOf(this),this.parent().children.length-1!==index&&void 0!==(nextSibling=this.parent().children[index+1]).content?nextSibling.focus():ev.preventDefault()}}(),function(){var proxied=ContentEdit.Text.prototype._keyReturn;ContentEdit.Text.prototype._keyReturn=function(ev){var element,selection,tip;return ev.preventDefault(),this.content.isWhitespace()?proxied.call(this,ev):(ContentSelect.Range.query(this._domElement),selection=ContentSelect.Range.query(this._domElement),tip=this.content.substring(0,selection.get()[0]),this.content.substring(selection.get()[1]),ev.shiftKey||tip.length()?proxied.call(this,ev):(element=new ContentEdit.Text("p",{},""),this.parent().attach(element,this.parent().children.indexOf(this)),void element.focus()))}}(),function(){var proxied=ContentEdit.Text.prototype._onKeyUp;ContentEdit.Text.prototype._onKeyUp=function(ev){var ret=proxied.call(this,ev);return 9===ev.keyCode&&"lorem"===this.content.text().toLowerCase()&&(this.content=new HTMLString.String("Lorem ipsum dolor sit amet, consectetur adipisicing elit. At dolor sed numquam? Sapiente autem adipisci, minus expedita enim, suscipit laboriosam deleniti possimus sequi pariatur explicabo numquam alias atque officia sit."),this.updateInnerHTML(),this.taint(),new ContentSelect.Range(this.content.length(),this.content.length()).select(this._domElement)),ret}}(),function(){var proxied=ContentEdit.Text.prototype.blur;ContentEdit.Text.prototype.blur=function(ev){return"lorem"===this.content.text().toLowerCase()&&(this.content=new HTMLString.String("Lorem ipsum dolor sit amet, consectetur adipisicing elit. At dolor sed numquam? Sapiente autem adipisci, minus expedita enim, suscipit laboriosam deleniti possimus sequi pariatur explicabo numquam alias atque officia sit."),this.updateInnerHTML(),this.taint(),new ContentSelect.Range(this.content.length(),this.content.length()).select(this._domElement)),proxied.call(this,ev)}}(),ContentEdit.Button=function(_super){function Button(tagName,attributes,content){Button.__super__.constructor.call(this,tagName,attributes,content)}return __extends(Button,_super),Button.create=function(){var a=document.createElement("A"),o=document.createElement("P");return o.setAttribute("data-ce-tag","button"),a.classList.add("pbs-button"),a.setAttribute("href",""),a.innerHTML=pbsParams.labels.button,o.appendChild(a),ContentEdit.Button.fromDOMElement(o)},Button.droppers=PBSEditor.allDroppers,Button.prototype.cssTypeName=function(){return"button"},Button.prototype.typeName=function(){return"Button"},Button.prototype.restoreState=function(){var ret;if(this._savedSelection){if(this.isMounted()&&this.isFocused())return this._domElement.querySelector(".pbs-button").setAttribute("contenteditable",""),ret=Button.__super__.restoreState.call(this),this._domElement.removeAttribute("contenteditable"),ret;this._savedSelection=void 0}},Button.prototype.drag=function(x,y){return this._domElement.querySelector(".pbs-button").removeAttribute("contenteditable"),Button.__super__.drag.call(this,x,y)},Button.prototype.blur=function(){return this.isMounted()&&(this._domElement.querySelector(".pbs-button").removeAttribute("contenteditable"),this._domElement.innerHTML.match(/(\s*<br>\s*)/g)&&(this._domElement.innerHTML=this._domElement.innerHTML.replace(/(\s*<br>\s*)/g,""),this._syncContent())),Button.__super__.blur.call(this)},Button.prototype.focus=function(supressDOMFocus){var ret;return this.isMounted()&&this._domElement.querySelector(".pbs-button").setAttribute("contenteditable",""),ret=Button.__super__.focus.call(this,supressDOMFocus),this.isMounted()&&(this._domElement.removeAttribute("contenteditable"),this._domElement.querySelector(".pbs-button").focus()),ret},Button.prototype._keyReturn=function(ev){var element,selection;if(ev.preventDefault(),this.content.isWhitespace())return Button.__super__._keyReturn.call(this,ev);ContentSelect.Range.query(this._domElement.querySelector(".pbs-button")),selection=ContentSelect.Range.query(this._domElement.querySelector(".pbs-button")),this.content.substring(0,selection.get()[0]).length()?(element=new ContentEdit.Text("p",{},""),this.parent().attach(element,this.parent().children.indexOf(this)+1),element.focus()):(element=new ContentEdit.Text("p",{},""),this.parent().attach(element,this.parent().children.indexOf(this)),element.focus())},Button.prototype.storeState=function(){if(this.isMounted()&&this.isFocused())return this._savedSelection=ContentSelect.Range.query(this._domElement.querySelector(".pbs-button"))},Button.prototype.restoreState=function(){if(this._savedSelection){if(this.isMounted()&&this.isFocused())return this._domElement.querySelector(".pbs-button").setAttribute("contenteditable",""),this._addCSSClass("ce-element--focused"),document.activeElement!==this.domElement().querySelector(".pbs-button")&&this.domElement().querySelector(".pbs-button").focus(),this._savedSelection.select(this._domElement.querySelector(".pbs-button")),this._savedSelection=void 0;this._savedSelection=void 0}},Button}(ContentEdit.Text),ContentEdit.TagNames.get().register(ContentEdit.Button,"button"),function(){var proxied=ContentEdit.Text.fromDOMElement;ContentEdit.Text.fromDOMElement=function(domElement){return domElement.firstChild&&domElement.firstChild.classList&&domElement.firstChild===domElement.lastChild&&"A"===domElement.firstChild.tagName&&domElement.firstChild.classList.contains("pbs-button")?(domElement.setAttribute("data-ce-tag","button"),ContentEdit.Button.fromDOMElement(domElement)):proxied.call(this,domElement)}}(),ContentEdit.Shortcode=function(_super){function Shortcode(tagName,attributes,content){this.sc_hash=attributes["data-shortcode"],this.sc_base=attributes["data-base"],this.sc_raw=Shortcode.atob(this.sc_hash),this.sc_prev_raw=this.sc_raw,this.model=new Backbone.Model({}),this.parseShortcode(),this.model.element=this,this.model.listenTo(this.model,"change",this.modelChanged.bind(this)),this._doubleClickCount=0,Shortcode.__super__.constructor.call(this,tagName,attributes),this._content=content}return __extends(Shortcode,_super),Shortcode.sc_raw="",Shortcode.sc_hash="",Shortcode.sc_base="",Shortcode.sc_prev_raw="",Shortcode.btoa=function(str){return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,function(match,p1){return String.fromCharCode("0x"+p1)}))},Shortcode.atob=function(str){return decodeURIComponent(Array.prototype.map.call(window.atob(str),function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join(""))},Shortcode.prototype.mount=function(){var ret=Shortcode.__super__.mount.call(this);return"0px"===getComputedStyle(this._domElement).height?this._domElement.classList.add("pbs--blank"):this._domElement.classList.remove("pbs--blank"),setTimeout(function(){this._domElement&&("0px"===getComputedStyle(this._domElement).height?this._domElement.classList.add("pbs--blank"):this._domElement.classList.remove("pbs--blank"))}.bind(this),1),ret},Shortcode.createShortcode=function(shortcode){var o=document.createElement("DIV");return o.setAttribute("data-ce-moveable",""),o.setAttribute("data-ce-tag","shortcode"),o.setAttribute("data-base",shortcode.shortcode.tag),o.setAttribute("data-shortcode",Shortcode.btoa(shortcode.shortcode.string())),ContentEdit.Shortcode.fromDOMElement(o)},Shortcode.fromDOMElement=function(domElement){var newElement=new this(domElement.tagName,this.getDOMElementAttributes(domElement),domElement.innerHTML);return PBSEditor._justAddedDesignElement&&newElement.ajaxUpdate(!0),newElement},Shortcode.prototype.convertToText=function(){var innerHTML=this._domElement.innerHTML,elem=Shortcode.__super__.convertToText.call(this,this.sc_raw);return elem.origShortcode=this.sc_raw,elem.origInnerHTML=innerHTML,elem.isShortcodeEditing=!0,elem},Shortcode.prototype.parseShortcode=function(){var attributeName,i,sc=wp.shortcode.next(this.sc_base,this.sc_raw,0);for(attributeName in sc.shortcode.attrs.named)sc.shortcode.attrs.named.hasOwnProperty(attributeName)&&this.model.set(attributeName,sc.shortcode.attrs.named[attributeName],{silent:!0});for(i=0;i<sc.shortcode.attrs.numeric.length;i++)this.model.set(i,sc.shortcode.attrs.numeric[i],{silent:!0});this.model.set("content",sc.shortcode.content,{silent:!0})},Shortcode.prototype._onDoubleClick=function(){ContentTools.EditorApp.get()._toolboxProperties.inspect(this)},Shortcode.prototype.cssTypeName=function(){return"shortcode"},Shortcode.prototype.typeName=function(){return"Shortcode"},Shortcode.prototype.clone=function(){var clone,newElement,index,root=ContentEdit.Root.get();root.focused()===this&&root.focused().blur(),(clone=document.createElement("div")).innerHTML=this.html(),newElement=Shortcode.fromDOMElement(clone.childNodes[0]),index=this.parent().children.indexOf(this),this.parent().attach(newElement,index+1),newElement.focus()},Shortcode.prototype.modelChanged=function(){var _this=this;this.updateSCRaw(),this.updateSCHash(),clearTimeout(this._scRefreshTrigger),this._scRefreshTrigger=setTimeout(function(){_this.ajaxUpdate()},500)},Shortcode.prototype.setSCAttr=function(name,value){this.model.set(name,value)},Shortcode.prototype.setSCContent=function(value){this.model.set("content",value)},Shortcode.prototype.updateSCRaw=function(){var keys,i,attrName,sc="";for(sc+="["+this.sc_base,keys=this.model.keys(),i=0;i<keys.length;i++)"content"!==(attrName=keys[i])&&(sc+=" "+attrName+'="'+(this.model.get(attrName)||"").replace(/\n/g,"<br>")+'"');sc+="]",this.model.get("content")&&(sc+=this.model.get("content")),sc+="[/"+this.sc_base+"]",this.sc_raw=sc},Shortcode.prototype.updateSCHash=function(){this.sc_hash=Shortcode.btoa(this.sc_raw),this.attr("data-shortcode",this.sc_hash)},Shortcode.prototype.unmount=function(){Shortcode.__super__.unmount.call(this),setTimeout(function(){this.runInitScripts()}.bind(this),100)},Shortcode.prototype.runInitScripts=function(){var i,map,ranInitCode=!1;if(this._scriptsToRun)for(i=0;i<this._scriptsToRun.length;i++)try{new Function(this._scriptsToRun[i])(),ranInitCode=!0}catch(err){console.log("PBS:",this.sc_base,"init code errored out.")}if(void 0!==pbsParams.shortcode_mappings[this.sc_base]&&void 0!==(map=pbsParams.shortcode_mappings[this.sc_base]).init_code)try{this._domElement?new Function(map.init_code).bind(this._domElement.firstChild)():new Function(map.init_code)(),ranInitCode=!0,wp.hooks.doAction("pbs.rects.changed")}catch(err){console.log("PBS:",this.sc_base,"init code errored out.")}ranInitCode?setTimeout(function(){this._domElement&&(this._content=this._domElement.innerHTML,wp.hooks.doAction("pbs.rects.changed"))}.bind(this),10):this._domElement&&(this._content=this._domElement.innerHTML),wp.hooks.doAction("pbs.rects.changed")},Shortcode.prototype.ajaxUpdate=function(forceUpdate){clearTimeout(this._ajaxUpdateTimeout),this._ajaxUpdateTimeout=setTimeout(function(){this._ajaxUpdate(forceUpdate)}.bind(this),500)},Shortcode.prototype._ajaxUpdate=function(forceUpdate){var payload,_this,request;(this.sc_prev_raw!==this.sc_raw||forceUpdate)&&((payload=new FormData).append("action","pbs_shortcode_render"),payload.append("shortcode",this.sc_hash),payload.append("nonce",pbsParams.nonce),this._domElement.classList.add("pbs--rendering"),_this=this,(request=new XMLHttpRequest).open("POST",window.location.href),request.onload=function(){var i,node,response,enqueued,dummyContainer,currentHead,enqueuedScriptsPending,scriptsToRun,scriptURL,styleURL,style;if(request.status>=200&&request.status<400){try{response=JSON.parse(request.responseText)}catch(err){return console.log("PBS: Error getting rendered shortcode"),_this._domElement.classList.remove("pbs--rendering"),_this._domElement.style.minHeight="",_this._domElement.style.marginBottom="",_this.sc_prev_raw=_this.sc_raw,void wp.hooks.doAction("pbs.rects.changed")}if(enqueued=response.scripts+response.styles,dummyContainer=document.createElement("div"),dummyContainer.innerHTML=enqueued.trim(),currentHead=document.querySelector("html").innerHTML,enqueuedScriptsPending=0,scriptsToRun=[],enqueued.trim().length)for(i=dummyContainer.childNodes.length-1;i>=0;i--)if(dummyContainer.childNodes[i].getAttribute){if("SCRIPT"===(node=dummyContainer.childNodes[i]).tagName){if(node.getAttribute("src")){scriptURL=node.getAttribute("src"),document.querySelector('script[src="'+scriptURL+'"]')||(enqueuedScriptsPending++,jQuery.getScript(node.getAttribute("src")).done(function(){enqueuedScriptsPending--}).fail(function(){enqueuedScriptsPending--}));continue}scriptsToRun.unshift(node.innerHTML);continue}if("LINK"===node.tagName&&"stylesheet"===node.getAttribute("rel")&&node.getAttribute("href")&&(styleURL=node.getAttribute("href"),document.querySelector('link[href="'+styleURL+'"]')))continue;-1===currentHead.indexOf(node.outerHTML)&&document.body.appendChild(node)}if(dummyContainer=document.createElement("div"),dummyContainer.innerHTML=response.output.trim(),!_this._domElement)return;if(_this._domElement.innerHTML="",dummyContainer.innerHTML.length)for(i=dummyContainer.childNodes.length-1;i>=0;i--)if(node=dummyContainer.childNodes[i],3===dummyContainer.childNodes[i].nodeType)_this._domElement.insertBefore(node,_this._domElement.firstChild);else{if("SCRIPT"===node.tagName){scriptsToRun.unshift(node.innerHTML);continue}_this._domElement.insertBefore(node,_this._domElement.firstChild)}if(_this._content=dummyContainer.innerHTML,scriptsToRun&&(_this._scriptsToRun=scriptsToRun,_this._scriptRunInterval=setInterval(function(){enqueuedScriptsPending||(this.runInitScripts(),clearInterval(this._scriptRunInterval))}.bind(_this),100)),_this.style("float",""),1===_this._domElement.children.length)try{"left"!==(style=getComputedStyle(_this._domElement.firstChild)).float&&"right"!==style.float||_this.style("float",style.float)}catch(err){}document.dispatchEvent(new CustomEvent("pbs:shortcode-render",{detail:document.querySelector(".pbs--rendering")}))}_this._domElement.classList.remove("pbs--rendering"),_this._domElement.classList.remove("pbs--blank"),_this._domElement.style.minHeight="",_this._domElement.style.marginBottom="",_this.sc_prev_raw=_this.sc_raw,"0px"===getComputedStyle(_this._domElement).height?_this._domElement.classList.add("pbs--blank"):_this._domElement.classList.remove("pbs--blank"),wp.hooks.doAction("pbs.rects.changed")},request.onerror=function(){_this._domElement.classList.remove("pbs--rendering"),_this._domElement.style.minHeight="",_this._domElement.style.marginBottom="",_this.sc_prev_raw=_this.sc_raw},request.send(payload))},Shortcode}(ContentEdit.StaticEditable),ContentEdit.TagNames.get().register(ContentEdit.Shortcode,"shortcode"),ContentEdit.Text.prototype.convertShortcodes=function(){var shortcodeRegex,shortcodeMatch,prevIndex,base,sc,i,isShortcode,elem,insertAt,parent,dom,minHeight,bottomMargin,doAjax,html=this.content.html(),textParts=[],shortcodes=[];if(""!==html.trim()&&(shortcodeRegex=/\[([^\/][^\s\]\[]+)[^\]]*\]/g,shortcodeMatch=shortcodeRegex.exec(html))){for(prevIndex=0;shortcodeMatch;)-1!==pbsParams.shortcodes.indexOf(shortcodeMatch[1])?shortcodeMatch.index<prevIndex?shortcodeMatch=shortcodeRegex.exec(html):(base=shortcodeMatch[1],sc=wp.shortcode.next(base,html,shortcodeMatch.index),textParts.push(html.substr(prevIndex,shortcodeMatch.index-prevIndex)),shortcodes.push(sc),prevIndex=shortcodeMatch.index+sc.content.length,shortcodeMatch=shortcodeRegex.exec(html)):shortcodeMatch=shortcodeRegex.exec(html);if(0!==shortcodes.length){for(textParts.push(html.substr(prevIndex)),insertAt=this.parent().children.indexOf(this),parent=this.parent(),(dom=this._domElement)&&dom.style.minHeight&&(minHeight=dom.style.minHeight,bottomMargin=dom.style.bottomMargin),i=0;i<textParts.length+shortcodes.length;i++)isShortcode=1==i%2,elem=null,0!==i?(isShortcode?elem=ContentEdit.Shortcode.createShortcode(shortcodes[Math.floor(i/2)]):textParts[i/2].trim()&&((elem=document.createElement("P")).innerHTML=textParts[i/2],elem=ContentEdit.Text.fromDOMElement(elem)),elem&&(insertAt++,parent.attach(elem,insertAt),1===i&&dom&&minHeight&&(elem._domElement.style.minHeight=minHeight,elem._domElement.style.bottomMargin=bottomMargin),"Shortcode"===elem.constructor.name&&(doAjax=!0,1===i&&elem.sc_raw===this.origShortcode&&(elem._domElement.innerHTML=this.origInnerHTML,elem._content=this.origInnerHTML,"0px"===getComputedStyle(elem._domElement).height?elem._domElement.classList.add("pbs--blank"):elem._domElement.classList.remove("pbs--blank"),doAjax=!1),doAjax&&elem.ajaxUpdate(!0)))):(this.content=new HTMLString.String(textParts[i],!0),this.updateInnerHTML(),this.taint());this.parent()&&this.content.isWhitespace()&&this.parent().detach(this)}}},function(){var proxied=ContentEdit.Text.prototype._keyReturn;ContentEdit.Text.prototype._keyReturn=function(ev){var ret;return this.isShortcodeEditing?(this.blur(),this.convertShortcodes()):(ret=proxied.call(this,ev),this.convertShortcodes(),ret)}}(),function(){var ready=function(){ContentEdit.Root.get().bind("blur",function(element){"Text"===element.constructor.name&&element.convertShortcodes()}),document.querySelector("#wpadminbar")&&document.querySelector("#wpadminbar").addEventListener("mouseover",function(){var focused=ContentEdit.Root.get().focused();focused&&"Text"===focused.constructor.name&&focused.content&&focused.content.html().match(/\[\w+[^\]]+\]/)&&focused.blur()})};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),function(){var ready=function(){var shortcodes=document.querySelectorAll('[data-name="main-content"] [data-shortcode]');Array.prototype.forEach.call(shortcodes,function(el){var style;if(1===el.children.length)try{"left"!==(style=getComputedStyle(el.firstChild)).float&&"right"!==style.float||(el.style.float=style.float)}catch(err){}})};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),ContentEdit.Hr=function(_super){function Hr(tagName,attributes){this.model=new Backbone.Model({}),Hr.__super__.constructor.call(this,tagName,attributes),this._content=""}return __extends(Hr,_super),Hr.prototype.blur=function(){var root=ContentEdit.Root.get();if(this.isFocused())return this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)},Hr.droppers=PBSEditor.allDroppers,Hr.prototype.focus=function(supressDOMFocus){var root;if(root=ContentEdit.Root.get(),!this.isFocused())return root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.isMounted()&&!supressDOMFocus&&this.domElement().focus(),root.trigger("focus",this)},Hr.prototype.cssTypeName=function(){return"hr"},Hr.prototype.typeName=function(){return"Horizontal Rule"},Hr.prototype._onDoubleClick=function(){this.inspect()},Hr}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.Hr,"hr"),ContentEdit.Embed=function(_super){function Embed(tagName,attributes,content){this.url=attributes["data-url"],this.model=new Backbone.Model({}),this._doubleClickCount=0,Embed.__super__.constructor.call(this,tagName,attributes),this._content=content}return __extends(Embed,_super),Embed.create=function(url){var o=document.createElement("DIV");return o.setAttribute("data-ce-moveable",""),o.setAttribute("data-ce-tag","embed"),o.setAttribute("data-url",url),ContentEdit.Embed.fromDOMElement(o)},Embed.prototype.mount=function(){var ret=Embed.__super__.mount.call(this);return this._domElement.innerHTML="",jQuery(this._domElement).html(this._content),wp.hooks.doAction("pbs.embed.mount",this),ret},Embed.prototype._onDoubleClick=function(){this.inspect()},Embed.prototype.cssTypeName=function(){return"embed"},Embed.prototype.typeName=function(){return"Embed"},Embed.prototype.updateEmbedContent=function(url){var request=new XMLHttpRequest,payload=new FormData;url||(url=this._domElement.getAttribute("data-url")),payload.append("post_ID",pbsParams.post_id),payload.append("type","embed"),payload.append("action","parse-embed"),payload.append("shortcode","[embed]"+url+"[/embed]"),request.open("POST",pbsParams.ajax_url),request.onload=function(){var response;if(request.status>=200&&request.status<400){if(!(response=JSON.parse(request.responseText)).success)return;jQuery(this._domElement).html("<p>"+response.data.body+"</p>"),this._content="<p>"+response.data.body+"</p>",this._domElement.classList.remove("pbs--rendering"),wp.hooks.doAction("pbs.embed.update_embed_content",this)}}.bind(this),request.onerror=function(){},request.send(payload)},Embed.updateEmbedContent=function(url,textElement){var payload=new FormData,request=new XMLHttpRequest;payload.append("post_ID",pbsParams.post_id),payload.append("type","embed"),payload.append("action","parse-embed"),payload.append("shortcode","[embed]"+url+"[/embed]"),request.open("POST",pbsParams.ajax_url),request.onload=function(){var response,elem,insertAt,parent;if(request.status>=200&&request.status<400){if(!(response=JSON.parse(request.responseText)).success)return;if(!textElement.parent())return;elem=ContentEdit.Embed.create(url),insertAt=textElement.parent().children.indexOf(textElement),(parent=textElement.parent()).attach(elem,insertAt),parent.detach(textElement),jQuery(elem._domElement).html("<p>"+response.data.body+"</p>"),elem._content="<p>"+response.data.body+"</p>",elem._domElement.classList.remove("pbs--rendering"),wp.hooks.doAction("pbs.embed.update_embed_content",elem)}},request.onerror=function(){},request.send(payload)},Embed}(ContentEdit.StaticEditable),ContentEdit.TagNames.get().register(ContentEdit.Embed,"embed"),ContentEdit.Text.prototype.convertOEmbedURLs=function(){var text;this.content.isWhitespace()||(text=this.content.text())&&(this.content.html().match(/<a[^>]+/g)||(text=text.trim())&&text.match(/^https?:\/\/[^\s/$.?#].[^\s]*$/)&&ContentEdit.Embed.updateEmbedContent(text,this))},function(){var ready=function(){ContentEdit.Root.get().bind("blur",function(element){"Text"===element.constructor.name&&element.convertOEmbedURLs()})};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),function(){var ready=function(){ContentTools.EditorApp.get().bind("stop",function(){var shortcodes=document.querySelectorAll('[data-ce-tag="embed"]');Array.prototype.forEach.call(shortcodes,function(el){var html=el.innerHTML;el.innerHTML="",jQuery(el).html(html)})})};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),ContentEdit.PreText.prototype.unhighlight=function(){this.updateInnerHTML()},ContentEdit.PreText.prototype.rehighlight=function(){this._domElement&&"undefined"!=typeof hljs&&(this.storeState(),this.removeAllCSSClasses(),hljs.highlightBlock(this._domElement),this.restoreState())},function(){var proxied=ContentEdit.PreText.prototype.html;ContentEdit.PreText.prototype.html=function(indent){return proxied.call(this,indent),this._cached=this._cached.replace(/<\/?\w+[^>]*>/g,""),indent+"<"+this._tagName+this._attributesToString()+">"+this._cached.replace(/\n/g,"\r\n")+"</"+this._tagName+">"}}(),function(){var proxied=ContentEdit.PreText.prototype.focus;ContentEdit.PreText.prototype.focus=function(){var ret=proxied.call(this);return this.unhighlight(),ret}}(),function(){var proxied=ContentEdit.PreText.prototype.mount;ContentEdit.PreText.prototype.mount=function(){var ret=proxied.call(this);return this.rehighlight(),ret}}(),function(){var proxied=ContentEdit.PreText.prototype.blur;ContentEdit.PreText.prototype.blur=function(){var ret=proxied.call(this);return this.rehighlight(),ret}}(),function(){var proxied=ContentEdit.PreText.fromDOMElement;ContentEdit.PreText.fromDOMElement=function(domElement){return domElement.innerHTML=domElement.innerHTML.replace(/<\/?\w+[^>]*>/g,""),proxied.call(this,domElement)}}(),function(){var ready=function(){ContentTools.EditorApp.get().bind("stop",function(){window.pbsInitAllPretext&&window.pbsInitAllPretext()})};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),function(){var proxied=ContentEdit.PreText.prototype._onKeyDown;ContentEdit.PreText.prototype._onKeyDown=function(ev){var selection,preserveWhitespace,insertAt;return 9===ev.keyCode&&(ev.preventDefault(),ContentSelect.Range.query(this._domElement),selection=ContentSelect.Range.query(this._domElement),preserveWhitespace=this.content.preserveWhitespace(),insertAt=selection.get()[1],this.content=this.content.insert(insertAt,new HTMLString.String("\t",preserveWhitespace),preserveWhitespace),this.updateInnerHTML(),insertAt+=1,(selection=new ContentSelect.Range(insertAt,insertAt)).select(this.domElement())),proxied.call(this,ev)}}(),function(){var editor=ContentTools.EditorApp.get();fluidvids&&fluidvids.render&&(wp.hooks.addAction("pbs.embed.mount",fluidvids.render),wp.hooks.addAction("pbs.embed.update_embed_content",fluidvids.render),editor.bind("stop",fluidvids.render),editor.bind("start",fluidvids.render))}(),function(){var proxy=ContentEdit.Element.prototype.mount;ContentEdit.Element.prototype.mount=function(){var ret=proxy.call(this);return fluidvids&&fluidvids.render&&(this._domElement.querySelector(".jetpack-video-wrapper")||fluidvids.render()),ret}}();var pbsTwitterMount=function(element){var tweetID,domElement=element._domElement||element;domElement.querySelector("[data-tweet-id]")&&(tweetID=domElement.querySelector("[data-tweet-id]").getAttribute("data-tweet-id"),domElement.innerHTML="",twttr.widgets.createTweet(tweetID,domElement))};wp.hooks.addAction("pbs.embed.mount",pbsTwitterMount),function(){var ready=function(){ContentTools.EditorApp.get().bind("stop",function(){var shortcodes=document.querySelectorAll("[data-tweet-id]");Array.prototype.forEach.call(shortcodes,function(el){pbsTwitterMount(el.parentNode)})})};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),ContentEdit.IFrame=function(_super){function IFrame(tagName,attributes,content){this.model=new Backbone.Model({}),IFrame.__super__.constructor.call(this,tagName,attributes),this._content=content}return __extends(IFrame,_super),IFrame.prototype.html=function(){return"<p>"+this._content+"</p>"},IFrame.prototype._onDoubleClick=function(){var html=this._domElement.innerHTML.replace(/</g,"&lt;").replace(/<p>|<\/p>/g,"").replace(/data-ce-tag=['"]iframe['"]/,"");this.convertToText(html,!1).isIframeEditing=!0},IFrame.prototype.cssTypeName=function(){return"iframe"},IFrame.prototype.typeName=function(){return"IFrame"},IFrame.convertTextToIFrame=function(html,textElement){var elem=new ContentEdit.IFrame("P",[],html),insertAt=textElement.parent().children.indexOf(textElement),parent=textElement.parent();parent.attach(elem,insertAt),parent.detach(textElement)},IFrame}(ContentEdit.StaticEditable),ContentEdit.TagNames.get().register(ContentEdit.IFrame,"iframe"),function(){var proxied=ContentEdit.Text.fromDOMElement;ContentEdit.Text.fromDOMElement=function(domElement){return domElement&&(domElement.children&&1===domElement.children.length&&domElement.firstChild.firstChild&&domElement.firstChild.classList.contains("fluidvids")&&"IFRAME"===domElement.firstChild.firstChild.tagName&&(domElement.replaceChild(domElement.firstChild.firstChild,domElement.firstChild),domElement.firstChild.classList.remove("fluidvids-item"),domElement.firstChild.removeAttribute("data-fluidvids")),domElement.children&&1===domElement.children.length&&"IFRAME"===domElement.firstChild.tagName)?new ContentEdit.IFrame(domElement.tagName,this.getDOMElementAttributes(domElement),domElement.innerHTML):proxied.call(this,domElement)}}(),ContentEdit.Text.prototype.convertIFrameTags=function(){var text;this.content.isWhitespace()||(text=this.content.text())&&(text=text.trim())&&text.match(/^\s*<iframe.*/)&&ContentEdit.IFrame.convertTextToIFrame(text,this)},function(){var ready=function(){ContentEdit.Root.get().bind("blur",function(element){"Text"===element.constructor.name&&element.convertIFrameTags()})};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),function(){var ready=function(){document.querySelector("#wpadminbar")&&document.querySelector("#wpadminbar").addEventListener("mouseover",function(){var focused=ContentEdit.Root.get().focused();focused&&"Text"===focused.constructor.name&&focused.content&&focused.content.text().match(/^\s*<iframe.*/)&&focused.blur()})};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),function(){var proxied=ContentEdit.Text.prototype._keyReturn;ContentEdit.Text.prototype._keyReturn=function(ev){if(!this.isIframeEditing)return proxied.call(this,ev);this.blur()}}(),ContentEdit.Div=function(_super){function Div(tagName,attributes){Div.__super__.constructor.call(this,tagName,attributes)}return __extends(Div,_super),Div.prototype.cssTypeName=function(){return"div"},Div.prototype.type=function(){return"Div"},Div.prototype.typeName=function(){return"Div"},Div.prototype._onMouseUp=function(ev){ev.target===this._domElement&&(Div.__super__._onMouseUp.call(this,ev),clearTimeout(this._dragTimeout),clearTimeout(this._doubleClickTimeout),this._doubleClickTimeout=setTimeout(function(_this){return function(){_this._doubleClickCount=0}}(this),500),this._doubleClickCount++)},Div.prototype._onMouseOut=function(ev){Div.__super__._onMouseOut.call(this,ev),clearTimeout(this._dragTimeout),this._doubleClickCount=0,clearTimeout(this._dragTimeout)},Div.prototype._onMouseDown=function(ev){ev.target===this._domElement&&(Div.__super__._onMouseDown.call(this,ev),clearTimeout(this._dragTimeout),this.domElement()===ev.target&&(ev.preventDefault(),this._dragTimeout=setTimeout(function(_this){return function(){return _this.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION),clearTimeout(this._doubleClickTimeout),this._doubleClickTimeout=setTimeout(function(_this){return function(){_this._doubleClickCount=0}}(this),500),3===++this._doubleClickCount&&(clearTimeout(this._dragTimeout),this._doubleClickCount=0,"function"==typeof this._onDoubleClick&&this._onDoubleClick&&this._onDoubleClick(ev))))},Div.prototype._onMouseOver=function(ev){ev.target===this._domElement&&Div.__super__._onMouseOver.call(this,ev)},Div.prototype._onMouseMove=function(ev){this._doubleClickCount=0,Div.__super__._onMouseMove.call(this,ev)},Div.prototype.attach=function(component,index){2===this.children.length&&void 0!==this.children[0].content&&this.children[0].content.isWhitespace()&&this.detach(this.children[0]),2===this.children.length&&void 0!==this.children[1].content&&this.children[1].content.isWhitespace()&&this.detach(this.children[1]),Div.__super__.attach.call(this,component,index)},Div.prototype.detach=function(element){ContentEdit.NodeCollection.prototype.detach.call(this,element),setTimeout(function(){0===this.children.length&&this.attach(new ContentEdit.Text("p"),0)}.bind(this),1)},Div.prototype._onDoubleClick=function(){this.inspect()},Div.prototype.focus=function(){var next=this.nextContent();next&&next.focus&&next.focus()},Div.prototype.blur=function(){var root;if(root=ContentEdit.Root.get(),this.isFocused())return this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this);this._domElement&&root.focused()&&root.focused()._domElement&&this._domElement.contains(root.focused()._domElement)&&root.focused().blur()},Div._dropInside=function(element,target,placement){var insertIndex=0;return"below"===placement[0]&&(insertIndex=target.children.length),target.attach(element,insertIndex)},Div.droppers=PBSEditor.allDroppers,Div._fromDOMElement=function(domElement){var cls,tagNames=ContentEdit.TagNames.get();if(domElement.getAttribute("data-ce-tag"))cls=tagNames.match(domElement.getAttribute("data-ce-tag"));else if(domElement.classList.contains("pbs-row"))cls=tagNames.match("row");else if(domElement.classList.contains("pbs-col"))cls=tagNames.match("column");else if(domElement.getAttribute("data-shortcode"))cls=tagNames.match("shortcode");else{if("DIV"===domElement.tagName)return null;cls=tagNames.match(domElement.tagName)}return cls.fromDOMElement(domElement)},Div.fromDOMElement=function(domElement){var c,childNode,childNodes,list,_i,_len,tagNames,element=this._fromDOMElement(domElement);if(element)return element;for(list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=function(){var _i,_len,_ref,_results;for(_results=[],_i=0,_len=(_ref=domElement.childNodes).length;_i<_len;_i++)c=_ref[_i],_results.push(c);return _results}(),tagNames=ContentEdit.TagNames.get(),_i=0,_len=childNodes.length;_i<_len;_i++)1===(childNode=childNodes[_i]).nodeType&&(element=(childNode.getAttribute("data-ce-tag")?tagNames.match(childNode.getAttribute("data-ce-tag")):tagNames.match(childNode.tagName)).fromDOMElement(childNode))&&list.attach(element);return 0===list.children.length&&list.attach(new ContentEdit.Text("p"),0),list},Div}(ContentEdit.ElementCollection),ContentEdit.TagNames.get().register(ContentEdit.Div,"div"),ContentEdit.DivRow=function(_super){function DivRow(tagName,attributes){DivRow.__super__.constructor.call(this,tagName,attributes),this.isCompundElement=!0}return __extends(DivRow,_super),DivRow.prototype.cssTypeName=function(){return"row"},DivRow.prototype.type=function(){return"DivRow"},DivRow.prototype.typeName=function(){return"Row"},DivRow.prototype._onMouseUp=function(ev){DivRow.__super__._onMouseUp.call(this,ev),clearTimeout(this._dragTimeout),this._checkForBetweenRowClick&&this.testClickBetweenRows(ev),clearTimeout(this._betweenRowSelectorTimeout)},DivRow.prototype._onMouseOut=function(ev){DivRow.__super__._onMouseOut.call(this,ev),clearTimeout(this._dragTimeout),this._checkForBetweenRowClick=!1,clearTimeout(this._betweenRowSelectorTimeout)},DivRow.prototype._onMouseMove=function(ev){var row,root=ContentEdit.Root.get();if(this._checkForBetweenRowClick=!1,clearTimeout(this._betweenRowSelectorTimeout),null!==root._dropTarget){if("DivCol"===root._dropTarget.constructor.name&&"DivRow"===root.dragging().constructor.name)return row=root._dropTarget.parent(),root._dropTarget._onMouseOut(ev),void row._onOver(ev);if(ev.target===root.dragging()._domElement)return root._dropTarget._removeCSSClass("ce-element--drop"),root._dropTarget._removeCSSClass("ce-element--drop-above"),root._dropTarget._removeCSSClass("ce-element--drop-below"),root._dropTarget._removeCSSClass("ce-element--drop-center"),root._dropTarget._removeCSSClass("ce-element--drop-left"),root._dropTarget._removeCSSClass("ce-element--drop-right"),void(root._dropTarget=null);if(pbsSelectorMatches(root._dropTarget._domElement,".ce-element--dragging *"))return root._dropTarget._removeCSSClass("ce-element--drop"),root._dropTarget._removeCSSClass("ce-element--drop-above"),root._dropTarget._removeCSSClass("ce-element--drop-below"),root._dropTarget._removeCSSClass("ce-element--drop-center"),root._dropTarget._removeCSSClass("ce-element--drop-left"),root._dropTarget._removeCSSClass("ce-element--drop-right"),void(root._dropTarget=null)}DivRow.__super__._onMouseMove.call(this,ev),clearTimeout(this._dragTimeout)},DivRow.prototype._onMouseDown=function(ev){if(DivRow.__super__._onMouseDown.call(this,ev),clearTimeout(this._dragTimeout),this._checkForBetweenRowClick=!0,clearTimeout(this._betweenRowSelectorTimeout),this._betweenRowSelectorTimeout=setTimeout(function(){this._checkForBetweenRowClick=!1}.bind(this),300),this.domElement()===ev.target)return ev.preventDefault(),this._dragTimeout=setTimeout(function(_this){return function(){return _this.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION)},DivRow.droppers=PBSEditor.allDroppers,DivRow.prototype.mount=function(){DivRow.__super__.mount.call(this),this.addCSSClass("pbs-row"),window._pbsFixRowWidth&&window._pbsFixRowWidth(this._domElement)},DivRow.fromDOMElement=function(domElement){var childNode,childNodes,list,_i,_len,tagNames,element;for(list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=domElement.children,tagNames=ContentEdit.TagNames.get(),_i=0,_len=childNodes.length;_i<_len;_i++)1===(childNode=childNodes[_i]).nodeType&&("div"===childNode.tagName.toLowerCase()||childNode.classList.contains("pbs-col"))&&(element=tagNames.match("column").fromDOMElement(childNode))&&list.attach(element);return list},DivRow.prototype.focus=function(){},DivRow.prototype.addNewColumn=function(index){var existingGap,i,currFlexBasis,col,p;for(void 0===index&&(index=this.children.length),existingGap=this.hasColumnGap(),i=0;i<this.children.length;i++)(currFlexBasis=this.children[i].style("flex-basis"))&&"0px"!==currFlexBasis||this.children[i].style("flex-basis",100/(this.children.length+1)+"%");return col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),col.attach(p),this.attach(col,index),col.style("flex-grow","1"),col.style("justify-content","center"),col.style("flex-basis",100/this.children.length+"%"),existingGap&&index!==this.children.length-1?col.style("margin-right",existingGap):existingGap&&this.children[index-1].style("margin-right",existingGap),col},DivRow.prototype.adjustColumnNumber=function(numColumns){if(this.children.length<numColumns)for(;this.children.length<numColumns;)this.addNewColumn();else if(this.children.length>numColumns)for(;this.children.length>numColumns;)this.children[numColumns].blurIfFocused(),this.children[numColumns-1].merge(this.children[numColumns])},DivRow.prototype.adjustColumns=function(columnEquation){var i,denom,grow,nums,highestDenom=1,arrWidths=columnEquation.replace(/(\s*\+\s*|\s+)/g," ").split(" ");for(this.adjustColumnNumber(arrWidths.length),i=0;i<arrWidths.length;i++)-1!==arrWidths[i].indexOf("/")&&(denom=parseInt(arrWidths[i].split("/")[1],10))>highestDenom&&(highestDenom=denom);for(i=0;i<arrWidths.length;i++)grow=1,grow=-1!==arrWidths[i].indexOf("/")?(nums=arrWidths[i].split("/"))[0]/nums[1]*highestDenom:parseInt(arrWidths[i],10),this.children[i].style("flex-grow",grow)},DivRow.prototype.clone=function(){var clone,newRow,index;return this.blurIfFocused(),clone=document.createElement("div"),clone.innerHTML=this.html(),newRow=ContentEdit.Div.fromDOMElement(clone.childNodes[0]),index=this.parent().children.indexOf(this),this.parent().attach(newRow,index+1),newRow.focus(),newRow},DivRow.prototype.getColumnEquation=function(){var col,colStyle,i,totalGrow=0,equation="";for(i=0;i<this.children.length;i++)col=this.children[i],colStyle=window.getComputedStyle(col._domElement),totalGrow+=parseFloat(colStyle["flex-grow"]);for(i=0;i<this.children.length;i++)col=this.children[i],colStyle=window.getComputedStyle(col._domElement),equation+=equation?" + ":"",equation+=parseFloat(colStyle["flex-grow"])+"/"+totalGrow;return equation},DivRow.prototype.blurIfFocused=function(){var currElem,root=ContentEdit.Root.get();if(root.focused())for(currElem=root.focused();currElem;){if(currElem===this)return void root.focused().blur();currElem=currElem.parent()}},DivRow.prototype.hasColumnGap=function(){var i,existingMargin="",currMargin="";for(i=0;i<this.children.length;i++)i<this.children.length-1?""===currMargin?existingMargin=currMargin=this.children[i]._domElement.style["margin-right"]:currMargin!==this.children[i]._domElement.style["margin-right"]&&(existingMargin=""):""!==this.children[i]._domElement.style["margin-right"]&&(existingMargin="");return existingMargin},DivRow.prototype.testClickBetweenRows=function(ev){var clickedOnTop,clickedOnBottom,index,doAddEmpty,p;if(ev.target._ceElement&&!("DivCol"!==ev.target._ceElement.constructor.name&&"DivRow"!==ev.target._ceElement.constructor.name||"DivCol"===ev.target._ceElement.constructor.name&&ev.target._ceElement.parent()!==this||"DivRow"===ev.target._ceElement.constructor.name&&ev.target._ceElement!==this||"Region"!==this.parent().constructor.name&&"DivCol"!==this.parent().constructor.name)){if(clickedOnTop=!1,clickedOnBottom=!1,ev.offsetY<10)clickedOnTop=!0;else{if(!(ev.offsetY>ev.target.offsetHeight-10))return;clickedOnBottom=!0}index=this.parent().children.indexOf(this),doAddEmpty=!0,clickedOnTop?(index&&"Text"===this.parent().children[index-1].type()&&(doAddEmpty=!1),doAddEmpty&&(p=new ContentEdit.Text("p",{},""),this.parent().attach(p,index),p.focus())):clickedOnBottom&&(index<this.parent().children.length-1&&"Text"===this.parent().children[index+1].type()&&(doAddEmpty=!1),doAddEmpty&&(p=new ContentEdit.Text("p",{},""),this.parent().attach(p,index+1),p.focus()))}},DivRow}(ContentEdit.ElementCollection),ContentEdit.TagNames.get().register(ContentEdit.DivRow,"row"),ContentEdit.DivCol=function(_super){function DivCol(tagName,attributes){DivCol.__super__.constructor.call(this,tagName,attributes)}return __extends(DivCol,_super),DivCol.prototype.cssTypeName=function(){return"col"},DivCol.prototype.type=function(){return"DivCol"},DivCol.prototype.typeName=function(){return"Column"},DivCol.prototype._onMouseUp=function(ev){DivCol.__super__._onMouseUp.call(this,ev),clearTimeout(this._dragTimeout)},DivCol.prototype._onMouseOut=function(ev){DivCol.__super__._onMouseOut.call(this,ev),clearTimeout(this._dragTimeout)},DivCol.prototype._onMouseDown=function(ev){if(DivCol.__super__._onMouseDown.call(this,ev),clearTimeout(this._dragTimeout),this.domElement()===ev.target)return ev.preventDefault(),this.draggableParent||(this.draggableParent=this.parent()),this._dragTimeout=setTimeout(function(_this){return function(){return _this.draggableParent.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION)},DivCol.prototype._onMouseMove=function(ev){DivCol.__super__._onMouseMove.call(this,ev),DivCol.__super__._onMouseOver.call(this,ev),clearTimeout(this._dragTimeout),ContentEdit.Root.get().dragging()&&ev.target===this._domElement?(this._onMouseOut(ev),this.parent()._onOver(ev),this.parent()._removeCSSClass("ce-element--over")):ev.target!==this._domElement&&this._removeCSSClass("ce-element--over")},DivCol.prototype._onKeyDown=function(ev){var index,parent;if(DivCol.__super__._onMouseDown.call(this,ev),190===ev.keyCode&&(ev.metaKey||ev.ctrlKey)&&ev.shiftKey)return index=this.parent().children.indexOf(this),this.blurIfFocused(),this.parent().addNewColumn(index+1).focus(),void ev.preventDefault();if(188===ev.keyCode&&(ev.metaKey||ev.ctrlKey)&&ev.shiftKey)return index=this.parent().children.indexOf(this),this.blurIfFocused(),(parent=this.parent()).detach(this),index>0&&parent&&parent.children.length&&index--,parent&&parent.children.length&&parent.children[index].focus(),void ev.preventDefault();if(ev.target._ceElement){if(-1!==ev.target._ceElement.constructor.name.toLowerCase().indexOf("list"))return;if(-1!==ev.target._ceElement.constructor.name.toLowerCase().indexOf("table"))return}9===ev.keyCode&&(!ev.shiftKey&&this.nextSibling()?(this.nextSibling().focus(),ev.stopPropagation()):ev.shiftKey&&this.previousSibling()&&(this.previousSibling().focus(),ev.stopPropagation()))},DivCol.droppers={},DivCol.prototype.attach=function(component,index){DivCol.__super__.attach.call(this,component,index),setTimeout(function(){this.cleanEmptyParagraphs()}.bind(this),10)},DivCol.prototype.cleanEmptyParagraphs=function(){var i,numEmpties=0,numNonEmpties=0;if(this.isMounted()){for(i=this.children.length-1;i>=0;i--)void 0!==this.children[i].content&&this.children[i].content.isWhitespace()?numEmpties++:numNonEmpties++;if(numEmpties>1)for(i=0;i<this.children.length;i++)void 0!==this.children[i].content&&this.children[i].content.isWhitespace()&&!this.children[i].isFocused()&&(numEmpties>1&&0===numNonEmpties?(this.detach(this.children[i]),numEmpties--):this.detach(this.children[i]),i--);if(numEmpties&&numNonEmpties)for(i=0;i<this.children.length;i++)void 0!==this.children[i].content&&this.children[i].content.isWhitespace()&&!this.children[i].isFocused()&&(this.detach(this.children[i]),i--)}},DivCol.prototype.mount=function(){DivCol.__super__.mount.call(this),this.addCSSClass("pbs-col"),this.cleanEmptyParagraphs()},DivCol.prototype.merge=function(element){var i,len=element.children.length;for(i=0;i<len;i++)this.attach(element.children[0]);for(element.parent().detach(element),i=(len=this.children.length)-1;i>=0;i--)this.children[i].content&&this.children[i].content.isWhitespace()&&this.detach(this.children[i]);return this.taint()},DivCol.fromDOMElement=function(domElement){var c,childNode,childNodes,list,_i,_len,tagNames,element;for(list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=function(){var _i,_len,_ref,_results;for(_results=[],_i=0,_len=(_ref=domElement.childNodes).length;_i<_len;_i++)c=_ref[_i],_results.push(c);return _results}(),tagNames=ContentEdit.TagNames.get(),_i=0,_len=childNodes.length;_i<_len;_i++)1===(childNode=childNodes[_i]).nodeType&&(element=(childNode.getAttribute("data-ce-tag")?tagNames.match(childNode.getAttribute("data-ce-tag")):tagNames.match(childNode.tagName)).fromDOMElement(childNode))&&list.attach(element);return 0===list.children.length&&list.attach(new ContentEdit.Text("p"),0),list},DivCol.prototype.focus=function(){var next=this.nextContent();next&&next.focus&&next.focus()},DivCol.prototype.clone=function(){var clone,newCol,index,existingGap=this.parent().hasColumnGap();return this.blurIfFocused(),clone=document.createElement("div"),clone.innerHTML=this.html(),newCol=ContentEdit.Div.fromDOMElement(clone.childNodes[0]),index=this.parent().children.indexOf(this),this.parent().attach(newCol,index+1),newCol.focus(),existingGap&&this.style("margin-right")!==existingGap&&this.style("margin-right",existingGap),newCol},DivCol.prototype.blurIfFocused=function(){var currElem,root=ContentEdit.Root.get();if(root.focused())for(currElem=root.focused();currElem;){if(currElem===this)return void root.focused().blur();currElem=currElem.parent()}},DivCol}(ContentEdit.Div),ContentEdit.TagNames.get().register(ContentEdit.DivCol,"column"),ContentEdit.Root.get().bind("drop",function(element,droppedElement){var col,i;if(null!==droppedElement&&null!==droppedElement.parent())if("DivCol"===droppedElement.parent().constructor.name||"Div"===droppedElement.parent().constructor.name)for(col=droppedElement.parent(),i=0;i<col.children.length;i++)null!==col.children[i].content&&void 0!==col.children[i].content&&col.children.length>1&&col.children[i].content.isWhitespace()&&col.children[i]!==element&&col.detach(col.children[i]);else if("DivRow"===droppedElement.parent().constructor.name)for(col=droppedElement,i=0;i<col.children.length;i++)null!==col.children[i].content&&void 0!==col.children[i].content&&col.children.length>1&&col.children[i].content.isWhitespace()&&col.children[i]!==element&&col.detach(col.children[i])}),ContentEdit.Root.get().bind("drop",function(element,droppedElement){null!==droppedElement&&null!==droppedElement.parent()&&"DivRow"===element.constructor.name&&("Div"!==element.parent().constructor.name&&"DivCol"!==element.parent().constructor.name||element.attr("data-width")&&(element.style("margin-right",""),element.style("margin-left",""),"full-width-retain-content"===element.attr("data-width")&&(element.style("padding-right",""),element.style("padding-left","")),element.removeAttr("data-width")))}),function(){var proxied=ContentEdit.Text.prototype.blur;ContentEdit.Text.prototype.blur=function(ev){var otherWhitespaces,otherNonWhitespaces,i,sibling;if(this.content.isWhitespace()&&this.parent()&&("Div"===this.parent().constructor.name||"DivCol"===this.parent().constructor.name)){for(otherWhitespaces=0,otherNonWhitespaces=0,i=0;i<this.parent().children.length;i++)(sibling=this.parent().children[i]).content&&sibling.content.isWhitespace()?otherWhitespaces++:otherNonWhitespaces++;if(1===otherWhitespaces&&0===otherNonWhitespaces){if(this.isMounted()&&this._syncContent(),this.isMounted()){try{this._domElement.blur()}catch(_error){_error}this._domElement.removeAttribute("contenteditable")}return ContentEdit.Text.__super__.blur.call(this)}}return proxied.call(this,ev)}}(),wp.hooks.addFilter("pbs.save",function(html){return html=html.replace(/(<[^>]+pbs-row[^>]+style=[^>]*[^-])(max-width:\s?[-0-9.\w]+;?\s?)([^>]+>)/g,"$1$3"),html=html.replace(/(<[^>]+pbs-row[^>]+style\=[^>]*[^-])(width:\s?[-0-9.\w]+;?\s?)([^>]+>)/g,"$1$3"),html=html.replace(/(<[^>]+pbs-row[^>]+style=[^>]*[^-])(left:\s?[-0-9.\w]+;?\s?)([^>]+>)/g,"$1$3"),html=html.replace(/(<div[^>]+>)\s+/gm,"$1"),html=html.replace(/\s+(<\/div>)/gm,"$1"),html=html.replace(/<[^>]+pbs-row[^>]+data-width\=["']full-width-retain-content["'][^>]+>/g,function(match){return match=match.replace(/(padding:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"padding-top: $2; padding-bottom: $4;"),match=match.replace(/(padding:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"padding-top: $2; padding-bottom: $4;"),match=match.replace(/(padding:\s?)([\d\w.]+)\s([\d\w.]+)[;"']/,"padding-top: $2; padding-bottom: $2;"),match=match.replace(/(padding:\s?)([\d\w.]+)[;"']/,"padding-top: $2; padding-bottom: $2;"),match=match.replace(/\s?padding-left:\s?[\d\w.]+;?\s?/g,""),match=match.replace(/\s?padding-right:\s?[\d\w.]+;?\s?/g,""),match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $4;"),match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $4;"),match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $2;"),match=match.replace(/(margin:\s?)([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $2;"),match=match.replace(/\s?margin-left:\s?[\d\w.-]+;?\s?/g,""),match=match.replace(/\s?margin-right:\s?[\d\w.-]+;?\s?/g,""),match=match.replace(/([^-])left:\s?[-\d\w.]+;?\s?/g,"$1")}),html=html.replace(/<[^>]+pbs-row[^>]+data-width\=["']full-width["'][^>]+>/g,function(match){return match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $4;"),match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $4;"),match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $2;"),match=match.replace(/(margin:\s?)([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $2;"),match=match.replace(/\s?margin-left:\s?[\d\w.-]+;?\s?/g,""),match=match.replace(/\s?margin-right:\s?[\d\w.-]+;?\s?/g,""),match=match.replace(/([^-])left:\s?[-\d\w.]+;?\s?/g,"$1")})}),function(){var _EditorApp=ContentTools.EditorApp.getCls(),proxied=_EditorApp.prototype.paste;_EditorApp.prototype.paste=function(element,clipboardData){var content,encodeHTML,i,insertAt,insertIn,insertNode,item,lastItem,line,lineLength,lines,type,_i,_len;if(content=clipboardData,lines=content.split("\n"),!(lines=lines.filter(function(line){return""!==line.trim()})))return proxied.call(this,element,clipboardData);if(encodeHTML=HTMLString.String.encode,"PreText"===(type=element.type())||"ListItemText"===type||"DivRow"!==element.parent().type())return proxied.call(this,element,clipboardData);if(lines.length>1||!element.content){for(insertAt=(insertIn=(insertNode=element).parent()).children.indexOf(insertNode)+1,i=_i=0,_len=lines.length;_i<_len;i=++_i)line=encodeHTML(line=lines[i]),lastItem=item=new ContentEdit.Text("p",{},line),insertIn.attach(item,insertAt+i);return lineLength=lastItem.content.length(),lastItem.focus(),lastItem.selection(new ContentSelect.Range(lineLength,lineLength))}return proxied.call(this,element,clipboardData)}}(),ContentEdit.Icon=function(_super){function Icon(tagName,attributes,content){attributes["data-ce-tag"]||(attributes["data-ce-tag"]="icon"),attributes.role||(attributes.role="presentation"),Icon.__super__.constructor.call(this,tagName,attributes),this._content=content}return __extends(Icon,_super),Icon.prototype.cssTypeName=function(){return"icon"},Icon.prototype.typeName=function(){return"Icon"},Icon.create=function(svg){var elem=document.createElement("DIV");return elem.style.height="100px",elem.style.width="100px",elem.innerHTML=svg,ContentEdit.IconLabel.fromDOMElement(elem)},Icon.fromDOMElement=function(domElement){return new this(domElement.tagName,this.getDOMElementAttributes(domElement),domElement.innerHTML)},Icon.droppers=PBSEditor.allDroppers,Icon.prototype.mount=function(){var ret=Icon.__super__.mount.call(this),svg=this._domElement.querySelector("svg");return svg.setAttribute("xmlns","http://www.w3.org/2000/svg"),svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),svg.innerHTML=svg.innerHTML.trim()+" ",this._content=this._domElement.innerHTML,ret},Icon.prototype.change=function(svg){var a=this._domElement.querySelector("a");a?a.innerHTML=svg.outerHTML:this._domElement.innerHTML=svg.outerHTML,this._content=this._domElement.innerHTML,this.taint()},Icon.prototype.blur=function(){var root=ContentEdit.Root.get();if(this.isFocused())return root._focused=null,root.trigger("blur",this)},Icon.prototype.focus=function(supressDOMFocus){var root=ContentEdit.Root.get();if(!this.isFocused())return root.focused()&&root.focused().blur(),root._focused=this,this.isMounted()&&!supressDOMFocus&&this.domElement().focus(),root.trigger("focus",this)},Icon.droppers=PBSEditor.allDroppers,Icon.prototype._onDoubleClick=function(){this.inspect()},Icon.prototype.getLink=function(){var a=this._domElement.querySelector("a");return a?{url:a.getAttribute("href"),target:a.getAttribute("target")||""}:{url:"",target:""}},Icon.prototype.setLink=function(url,target){var a,svg;url?(a=this._domElement.querySelector("a"))?(a.setAttribute("href",url),target?a.setAttribute("target",target):a.removeAttribute("target"),this._domElement.innerHTML=a.outerHTML,this._content=this._domElement.innerHTML,this.taint()):((a=document.createElement("A")).setAttribute("href",url),target&&a.setAttribute("target",target),(svg=this._domElement.querySelector("svg")).style.fill="",svg.removeAttribute("fill"),this._domElement.style.fill&&svg.setAttribute("fill",this._domElement.style.fill),a.appendChild(svg),this._domElement.appendChild(a),this._content=this._domElement.innerHTML,this.taint()):this.removeLink()},Icon.prototype.removeLink=function(){var svg;this._domElement.querySelector("a")&&(svg=this._domElement.querySelector("svg"),this._domElement.innerHTML=svg.outerHTML,this._content=this._domElement.innerHTML,this.taint())},Icon.prototype.removeFills=function(){var svgs=this._domElement.querySelectorAll("svg");this.style("fill",""),Array.prototype.forEach.call(svgs,function(svg){svg.style.fill="",svg.removeAttribute("fill")}),this._content=this._domElement.innerHTML,this.taint()},Icon.prototype.setFill=function(fill){var svgs=this._domElement.querySelectorAll("svg");this.style("fill",fill),Array.prototype.forEach.call(svgs,function(svg){svg.style.fill=fill,svg.setAttribute("fill",fill)}),this._content=this._domElement.innerHTML,this.taint()},Icon}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.Icon,"icon"),ContentEdit.Html=function(_super){function Html(tagName,attributes,content){this.model=new Backbone.Model({}),Html.__super__.constructor.call(this,tagName,attributes),this._content=content}return __extends(Html,_super),Html.prototype.openEditor=function(){PBSEditor.htmlFrame.open({title:pbsParams.labels.html,button:pbsParams.labels.html_frame_button,successCallback:function(frameView){var html=frameView.getHtml();this._domElement.innerHTML=html,this._content=html,this.attr("data-html",btoa(html)),html||(this.nextContent()?this.nextContent().focus():this.previousContent()&&this.previousContent().focus(),this.parent().detach(this))}.bind(this),openCallback:function(frameView){var content=this._content;this.attr("data-html")&&(content=atob(this.attr("data-html"))),frameView.setHtml(content)}.bind(this)})},Html.prototype._onDoubleClick=function(){this.inspect()},Html.prototype.cssTypeName=function(){return"html"},Html.prototype.typeName=function(){return"Html"},Html.prototype.focus=function(supressDOMFocus){var root;if(root=ContentEdit.Root.get(),!this.isFocused())return root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.isMounted()&&!supressDOMFocus&&this.domElement().focus(),root.trigger("focus",this)},Html.prototype.blur=function(){var root;return root=ContentEdit.Root.get(),this._removeCSSClass("ce-element--over"),this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)},Html.prototype._onMouseOver=function(ev){return Html.__super__._onMouseOver.call(this,ev),this._addCSSClass("ce-element--over")},Html}(ContentEdit.StaticEditable),ContentEdit.TagNames.get().register(ContentEdit.Html,"html"),wp.hooks.addFilter("pbs.toolbar.shortcode.label",function(scBase){return"pbs_sidebar"===scBase?pbsParams.labels.sidebar:scBase}),ContentEdit.Map=function(_super){function Map(tagName,attributes){attributes["data-ce-tag"]||(attributes["data-ce-tag"]="map"),this.model=new Backbone.Model({}),Map.__super__.constructor.call(this,tagName,attributes),this._content=""}return __extends(Map,_super),Map.prototype.blur=function(){var root=ContentEdit.Root.get();if(this.isFocused())return this._removeCSSClass("ce-element--over"),this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)},Map.prototype._onMouseOver=function(ev){return Map.__super__._onMouseOver.call(this,ev),this._addCSSClass("ce-element--over")},Map.prototype._onMouseUp=function(ev){Map.__super__._onMouseUp.call(this,ev),this.updateMapData(),this._removeCSSClass("pbs-map-editing"),this._dragging=!1,this._clicked=!1,clearInterval(this._forceCentered)},Map.prototype.updateMapData=function(){var latlng,center,zoom;!this._dragging&&this._domElement&&(center=(latlng=this._domElement.map.getCenter()).lat().toFixed(6)+", "+latlng.lng().toFixed(6),this.attr("data-center")!==center&&(this.attr("data-center",center),this.attr("data-lat",latlng.lat().toFixed(6)),this.attr("data-lng",latlng.lng().toFixed(6)),this.model.set("data-center",center),this._domElement.map.marker&&this._domElement.map.marker.setPosition(this._domElement.map.getCenter()))),zoom=this._domElement.map.getZoom(),parseInt(this.attr("data-zoom"),10)!==zoom&&(this.attr("data-zoom",zoom),this.model.trigger("change",this.model))},Map.prototype._onMouseDown=function(ev){return this._clicked=!0,this.focus(),clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(function(_this){return function(){return _this._dragging=!0,_this.drag(ev.pageX,ev.pageY)}}(this),2*ContentEdit.DRAG_HOLD_DURATION)},Map.prototype._onMouseMove=function(ev){this._dragging||clearTimeout(this._dragTimeout),!this._dragging&&this._clicked&&this._addCSSClass("pbs-map-editing"),Map.__super__._onMouseMove.call(this,ev)},Map.droppers=PBSEditor.allDroppers,Map.prototype.focus=function(supressDOMFocus){var root;if(root=ContentEdit.Root.get(),!this.isFocused())return root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.isMounted()&&!supressDOMFocus&&this.domElement().focus(),root.trigger("focus",this)},Map.prototype.cssTypeName=function(){return"map"},Map.prototype.typeName=function(){return"Map"},Map.prototype.mount=function(){var ret=Map.__super__.mount.call(this);return window.initPBSMaps(this._domElement,function(){google.maps.event.addListener(this._domElement.map,"zoom_changed",_.throttle(function(){this.updateMapData()}.bind(this),2)),google.maps.event.addListener(this._domElement.map,"drag",_.throttle(function(){this.updateMapData()}.bind(this),2)),google.maps.event.addListener(this._domElement.map,"dblclick",_.throttle(function(){this._onDoubleClick()}.bind(this),2)),this._domElement.map.setOptions({scrollwheel:!1,keyboardShortcuts:!1,fullscreenControl:!1,disableDoubleClickZoom:!0})}.bind(this)),ret},Map.prototype.unmount=function(){return"undefined"!=typeof google&&google.maps.event.clearInstanceListeners(this._domElement.map),Map.__super__.unmount.call(this)},Map.create=function(){var o=document.createElement("DIV");return o.setAttribute("data-ce-tag","map"),o.setAttribute("data-ce-moveable",""),ContentEdit.Map.fromDOMElement(o)},Map.prototype._onDoubleClick=function(){this.inspect()},Map}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.Map,"map"),function(){var ready=function(){var mapRefreshInterval,editor=ContentTools.EditorApp.get();window.initPBSMaps&&editor.bind("stop",window.initPBSMaps),window.pbsMapsReCenter&&(editor.bind("start",function(){mapRefreshInterval=setInterval(function(){document.querySelector(".ce-element--dragging")||document.querySelector(".pbs-map-editing")||window.pbsMapsReCenter()},1e3)}),editor.bind("stop",function(){clearInterval(mapRefreshInterval)}))};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),ContentEdit.Tabs=function(_super){function Tabs(tagName,attributes){Tabs.__super__.constructor.call(this,tagName,attributes),this.isCompundElement=!0}return __extends(Tabs,_super),Tabs.prototype.cssTypeName=function(){return"tabs"},Tabs.prototype.type=function(){return"Tabs"},Tabs.prototype.typeName=function(){return"Tabs"},Tabs.fromDOMElement=function(domElement){var c,childNode,childNodes,list,_i,_len,tagNames,element,pInputs=domElement.querySelector('p > [data-ce-tag="tabradio"]');for(pInputs&&pInputs.parentNode.parentNode===domElement&&(pInputs.parentNode.outerHTML=pInputs.parentNode.innerHTML),list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=function(){var _i,_len,_ref,_results;for(_results=[],_i=0,_len=(_ref=domElement.childNodes).length;_i<_len;_i++)c=_ref[_i],_results.push(c);return _results}(),tagNames=ContentEdit.TagNames.get(),_i=0,_len=childNodes.length;_i<_len;_i++)1===(childNode=childNodes[_i]).nodeType&&(element=(childNode.getAttribute("data-ce-tag")?tagNames.match(childNode.getAttribute("data-ce-tag")):tagNames.match(childNode.tagName)).fromDOMElement(childNode))&&list.attach(element);return list},Tabs.prototype.detachTabAndContent=function(tab){var inputID=tab._domElement.getAttribute("for"),inputElem=this._domElement.querySelector('[id="'+inputID+'"]')._ceElement,tabID=inputElem.attr("data-tab"),tabRow=this._domElement.querySelector('[data-panel="'+tabID+'"]')._ceElement;return inputElem.parent().detach(inputElem),tab.parent().detach(tab),tabRow.parent().detach(tabRow),this.reIndexTabs(),tabRow},Tabs.prototype.attachTabAndContent=function(tab,index,row){for(var radio,tabsID=this._domElement.getAttribute("class").match(/pbs-tabs-(\w+)/)[0],tabIndex=this.numTabs()+1,hash=window.PBSEditor.generateHash();document.querySelector('[id="pbs-tab-'+hash+'"]');)hash=window.PBSEditor.generateHash();(radio=document.createElement("input")).classList.add("pbs-tab-state"),radio.setAttribute("type","radio"),radio.setAttribute("name",tabsID),radio.setAttribute("id","pbs-tab-"+hash),radio.setAttribute("data-tab",tabIndex),radio.setAttribute("data-ce-tag","static"),this.attach(ContentEdit.Static.fromDOMElement(radio),0),tab.attr("for","pbs-tab-"+hash),row.attr("data-panel",tabIndex),this._domElement.querySelector(".pbs-tab-tabs")._ceElement.attach(tab,index),this._domElement.querySelector(".pbs-tab-panels")._ceElement.attach(row)},Tabs.prototype.reIndexTabs=function(){var i,radio,numTabs=this._domElement.querySelectorAll(".pbs-tab-state").length;for(i=1;i<=numTabs;i++)(radio=this._domElement.querySelector('[data-tab="'+i+'"]'))||(radio=this._domElement.querySelector('[data-tab="'+(i+1)+'"]'))&&(radio._ceElement.attr("data-tab",i),this._domElement.querySelector('[data-panel="'+(i+1)+'"]')._ceElement.attr("data-panel",i))},Tabs.prototype.getOpenTab=function(){var radio=this._domElement.querySelector(".pbs-tab-state:checked")._ceElement,panel=this._domElement.querySelector('[data-panel="'+radio.attr("data-tab")+'"]');return panel||(panel=this._domElement.querySelector("[data-panel]")),panel._ceElement},Tabs.prototype.numTabs=function(){return this._domElement.querySelectorAll(".pbs-tab-state").length},Tabs.prototype.addTab=function(){var tab,tabContainer,panelContainer,row,col,p,firstTab=this._domElement.querySelector(".pbs-tab-state")._ceElement,radioID="pbs-tab-"+window.PBSEditor.generateHash(),tabNum=this.numTabs()+1,radio=new ContentEdit.TabRadio("input",{"data-ce-tag":"tabradio",class:"pbs-tab-state","data-tab":tabNum,id:radioID,name:firstTab.attr("name"),type:"radio"});this.attach(radio,0),tab=new ContentEdit.Tab("label",{"data-ce-tag":"tab",for:radioID},"<span>New Tab</span>"),(tabContainer=this._domElement.querySelector(".pbs-tab-tabs")._ceElement).attach(tab,tabContainer.children.length),tabContainer.children.length&&tab.attr("style",tabContainer.children[0].attr("style")),panelContainer=this._domElement.querySelector(".pbs-tab-panels")._ceElement,row=new ContentEdit.DivRow("div",{"data-panel":tabNum}),panelContainer.attach(row),col=new ContentEdit.DivCol("div"),row.attach(col),p=new ContentEdit.Text("p",{},""),col.attach(p),tab.openTab(),p.focus()},Tabs.prototype.removeTab=function(tab){var radio,otherTab,focusTo;void 0===tab&&(radio=this._domElement.querySelector(".pbs-tab-state:checked")._ceElement,tab=this._domElement.querySelector('label[for="'+radio.attr("id")+'"]')._ceElement),(otherTab=tab.nextSibling())||(otherTab=tab.previousSibling()),this.detachTabAndContent(tab),otherTab?otherTab.openTab():(this.blur(),(focusTo=this.nextSibling())||(focusTo=this.previousSibling()),focusTo&&focusTo.focus(),this.parent().detach(this))},Tabs.prototype.mount=function(){var ret=Tabs.__super__.mount.call(this),radios=this._domElement.querySelectorAll('[data-ce-tag="tabradio"]'),newRadioGroupName="pbs-tab-"+window.PBSEditor.generateHash();return Array.prototype.forEach.call(radios,function(el,i){var radio,radioID,label,newRadioID;radioID=(radio=el._ceElement).attr("id"),radio.checked=0===i,document.querySelectorAll('[id="'+radioID+'"]').length&&(label=this._domElement.querySelector('[for="'+radioID+'"]')._ceElement,newRadioID="pbs-tab-"+window.PBSEditor.generateHash(),radio.attr("id",newRadioID),radio.attr("name",newRadioGroupName),label.attr("for",newRadioID))}.bind(this)),radios.length&&(radios[0].checked=!0),ret},Tabs.prototype.clone=function(){var newTabs=Tabs.__super__.clone.call(this),id=this._domElement.querySelector(".pbs-tab-active").getAttribute("for");return this._domElement.querySelector('[id="'+id+'"]').checked=!0,newTabs},Tabs.droppers=PBSEditor.allDroppers,Tabs}(ContentEdit.Div),ContentEdit.TagNames.get().register(ContentEdit.Tabs,"tabs"),ContentEdit.Tab=function(_super){function Tab(tagName,attributes,content){Tab.__super__.constructor.call(this,tagName,attributes,content)}return __extends(Tab,_super),Tab.prototype.cssTypeName=function(){return"tab"},Tab.prototype.type=function(){return"Tab"},Tab.prototype.typeName=function(){return"Tab"},Tab.prototype.parentTab=function(){return this.parent().parent()},Tab.prototype.setActiveTab=function(){var activeTab=this.parentTab()._domElement.querySelector(".pbs-tab-tabs .pbs-tab-active");activeTab&&activeTab._ceElement.removeCSSClass("pbs-tab-active"),this.addCSSClass("pbs-tab-active")},Tab.prototype._onMouseDown=function(ev){return setTimeout(function(){this.setActiveTab()}.bind(this),1),ev.stopPropagation(),Tab.__super__._onMouseDown.call(this,ev)},Tab.prototype.openTab=function(){this.parentTab()._domElement.querySelector('[id="'+this.attr("for")+'"]').checked=!0,this.setActiveTab()},Tab._dropTab=function(element,target,placement){var originalTabElement,otherTab,tabRow,insertIndex=target.parent().children.indexOf(target);return"left"!==placement[1]&&(insertIndex+=1),element.parent()!==target.parent()?(originalTabElement=element.parentTab(),(otherTab=element.previousSibling())||(otherTab=element.nextSibling()),tabRow=element.parentTab().detachTabAndContent(element),target.parentTab().attachTabAndContent(element,insertIndex,tabRow),element.openTab(),void(otherTab?otherTab.openTab():originalTabElement.parent().detach(originalTabElement))):(element.parent().detach(element),target.parent().attach(element,insertIndex))},Tab.prototype._onMouseOver=function(ev){return ContentEdit.Root.get().dragging()&&this.openTab(),Tab.__super__._onMouseOver.call(this,ev)},Tab.droppers={Tab:Tab._dropTab},Tab.placements=["left","right"],Tab.prototype.focus=function(){return this.openTab(),Tab.__super__.focus.call(this)},Tab.prototype._keyReturn=function(ev){var next;ev.preventDefault(),(next=this.nextSibling())&&next.focus()},Tab.prototype.isLastTab=function(){return this.parent().children.indexOf(this)===this.parent().children.length-1},Tab.prototype.getMatchingPanel=function(){var inputID=this.attr("for"),tabID=this.parentTab()._domElement.querySelector('[id="'+inputID+'"]')._ceElement.attr("data-tab");return this.parentTab()._domElement.querySelector('[data-panel="'+tabID+'"]')._ceElement},Tab.prototype.html=function(){var r,ret=Tab.__super__.html.call(this);return 0===this.parent().children.indexOf(this)?ret.match(/pbs-tab-active/)||(r=new RegExp("(<"+this._tagName+"[^>]+class=['\"])"),ret.match(r)?ret=ret.replace(r,"$1pbs-tab-active "):(r=new RegExp("(<"+this._tagName+")"),ret=ret.replace(r,'$1 class="pbs-tab-active"'))):ret=(ret=ret.replace(/\s*pbs-tab-active\s*/g,"")).replace(/\s*class=[\'\"][\'\"]/g,""),ret},Tab.prototype._keyLeft=function(ev){var selection;return 0===this.parent().children.indexOf(this)&&0===(selection=ContentSelect.Range.query(this._domElement)).get()[0]&&selection.isCollapsed()&&this._keyUp(ev),Tab.__super__._keyLeft.call(this,ev)},Tab.prototype._keyUp=function(ev){var selection,tabs,index,elem,p;if(0===this.parent().children.indexOf(this)&&0===(selection=ContentSelect.Range.query(this._domElement)).get()[0]&&selection.isCollapsed()){if(tabs=this.parent().parent(),(index=tabs.parent().children.indexOf(tabs))>0&&tabs.parent().children[index-1].content)return(elem=tabs.parent().children[index-1]).focus(),(selection=new ContentSelect.Range(elem.content.length(),elem.content.length())).select(elem.domElement());p=new ContentEdit.Text("p",{},""),tabs.parent().attach(p,index),p.focus()}return Tab.__super__._keyUp.call(this,ev)},Tab.prototype._keyDown=function(ev){var selection;if(this.parent().children.indexOf(this)===this.parent().children.length-1){if(selection=ContentSelect.Range.query(this._domElement),!this._atEnd(selection)||!selection.isCollapsed())return;if(this._atEnd(selection))return ev.preventDefault(),void this.getMatchingPanel().children[0].children[0].focus()}return Tab.__super__._keyDown.call(this,ev)},Tab.prototype._keyRight=function(ev){var selection=ContentSelect.Range.query(this._domElement);if(this._atEnd(selection)&&selection.isCollapsed())return this.isLastTab()?(ev.preventDefault(),void this.getMatchingPanel().children[0].children[0].focus()):Tab.__super__._keyRight.call(this,ev)},Tab}(ContentEdit.Text),ContentEdit.TagNames.get().register(ContentEdit.Tab,"tab"),ContentEdit.TabContainer=function(_super){function TabContainer(tagName,attributes){TabContainer.__super__.constructor.call(this,tagName,attributes)}return __extends(TabContainer,_super),TabContainer.prototype.cssTypeName=function(){return"tabcontainer"},TabContainer.prototype.type=function(){return"TabContainer"},TabContainer.prototype.typeName=function(){return"TabContainer"},TabContainer._dropOutside=function(element,target,placement){var insertIndex;return element.parent().detach(element),insertIndex=target.parent().parent().children.indexOf(target.parent()),"below"===placement[0]&&(insertIndex+=1),target.parent().parent().attach(element,insertIndex)},TabContainer.prototype._onOver=function(ev){var root,ret=TabContainer.__super__._onOver.call(this,ev);return ret?(root=ContentEdit.Root.get(),this._removeCSSClass("ce-element--drop"),this.parent()._addCSSClass("ce-element--drop"),root._dropTarget=this.parent()):ret},TabContainer.droppers={"*":TabContainer._dropOutside},TabContainer.prototype._onMouseUp=function(ev){TabContainer.__super__._onMouseUp.call(this,ev),clearTimeout(this._dragTimeout)},TabContainer.prototype._onMouseOut=function(ev){TabContainer.__super__._onMouseOut.call(this,ev),clearTimeout(this._dragTimeout)},TabContainer.prototype._onMouseDown=function(ev){if(TabContainer.__super__._onMouseDown.call(this,ev),clearTimeout(this._dragTimeout),this.domElement()===ev.target)return ev.preventDefault(),this.draggableParent||(this.draggableParent=this.parent()),this._dragTimeout=setTimeout(function(_this){return function(){return _this.draggableParent.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION)},TabContainer.prototype._onDoubleClick=function(){this.inspect()},TabContainer.fromDOMElement=function(domElement){var c,childNode,childNodes,list,_i,_len,tagNames,element;for(list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=function(){var _i,_len,_ref,_results;for(_results=[],_i=0,_len=(_ref=domElement.childNodes).length;_i<_len;_i++)c=_ref[_i],_results.push(c);return _results}(),tagNames=ContentEdit.TagNames.get(),_i=0,_len=childNodes.length;_i<_len;_i++)1===(childNode=childNodes[_i]).nodeType&&(element=(childNode.getAttribute("data-ce-tag")?tagNames.match(childNode.getAttribute("data-ce-tag")):tagNames.match(childNode.tagName)).fromDOMElement(childNode))&&list.attach(element);return list},TabContainer}(ContentEdit.Div),ContentEdit.TagNames.get().register(ContentEdit.TabContainer,"tabcontainer"),ContentEdit.TabPanelContainer=function(_super){function TabPanelContainer(tagName,attributes){TabPanelContainer.__super__.constructor.call(this,tagName,attributes)}return __extends(TabPanelContainer,_super),TabPanelContainer.prototype.cssTypeName=function(){return"tabpanelcontainer"},TabPanelContainer.prototype.type=function(){return"TabPanelContainer"},TabPanelContainer.prototype.typeName=function(){return"TabPanelContainer"},TabPanelContainer.fromDOMElement=function(domElement){var c,childNode,childNodes,list,_i,_len,tagNames,element;for(list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=function(){var _i,_len,_ref,_results;for(_results=[],_i=0,_len=(_ref=domElement.childNodes).length;_i<_len;_i++)c=_ref[_i],_results.push(c);return _results}(),tagNames=ContentEdit.TagNames.get(),_i=0,_len=childNodes.length;_i<_len;_i++)1===(childNode=childNodes[_i]).nodeType&&(element=(childNode.getAttribute("data-ce-tag")?tagNames.match(childNode.getAttribute("data-ce-tag")):tagNames.match(childNode.tagName)).fromDOMElement(childNode))&&list.attach(element);return list},TabPanelContainer}(ContentEdit.Div),ContentEdit.TagNames.get().register(ContentEdit.TabPanelContainer,"tabpanelcontainer"),ContentEdit.TabRadio=function(_super){function TabRadio(tagName,attributes){TabRadio.__super__.constructor.call(this,tagName,attributes)}return __extends(TabRadio,_super),TabRadio.prototype.cssTypeName=function(){return"tabradio"},TabRadio.prototype.type=function(){return"TabRadio"},TabRadio.prototype.typeName=function(){return"TabRadio"},TabRadio.prototype.mount=function(){var ret=TabRadio.__super__.mount.call(this);return this._domElement.setAttribute("disabled","disabled"),ret},TabRadio.prototype.unmount=function(){return this._domElement.removeAttribute("disabled"),TabRadio.__super__.unmount.call(this)},TabRadio}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.TabRadio,"tabradio"),wp.hooks.addFilter("pbs.overlay.margin_top.can_apply",function(apply,element){var parent;return!(element&&element._domElement&&element._domElement.parentNode&&element._domElement.parentNode.classList&&(parent=element._domElement.parentNode).classList&&parent.classList.contains("pbs-tab-tabs"))&&apply}),wp.hooks.addFilter("pbs.overlay.margin_bottom.can_apply",function(apply,element){var parent;return!(element&&element._domElement&&element._domElement.parentNode&&element._domElement.parentNode.classList&&(parent=element._domElement.parentNode).classList&&parent.classList.contains("pbs-tab-tabs"))&&apply}),function(){var proxied=ContentEdit.DivCol.prototype._onMouseDown;ContentEdit.DivCol.prototype._onMouseDown=function(ev){return this.parent().parent()._domElement.classList.contains("pbs-tab-panels")&&(this.draggableParent=this.parent().parent().parent()),proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.DivRow.prototype._onOver;ContentEdit.DivRow.prototype._onOver=function(ev){var root,ret=proxied.call(this,ev);return ret&&"TabPanelContainer"===this.parent().constructor.name?(root=ContentEdit.Root.get(),this._removeCSSClass("ce-element--drop"),this.parent().parent()._addCSSClass("ce-element--drop"),root._dropTarget=this.parent().parent()):ret}}();var _pbsToolbarImageHasTextContent,_pbsToolbarImageGetParent,_pbsUpdateNonCaptionedImage,_pbsToolbarImageGetParent,_pbsImageGetMetaData,_pbsUpdateNonCaptionedImageCTElement,root=ContentEdit.Root.get();root._overrideImageOnStopResizing=root._onStopResizing,root._onStopResizing=function(ev){var match;return"Image"===this._resizing.constructor.name&&((match=this._resizing._attributes.class.match(/size-\w+/))&&this._resizing.removeCSSClass(match[0]),this._resizing.style("height","auto")),this._overrideImageOnStopResizing(ev)}.bind(root),ContentEdit.Image.prototype._onDblclick=function(){this.inspect()},ContentEdit.Image.prototype.openMediaManager=function(closeCallback){var frame=wp.media.editor.open("edit",{frame:"image",state:"image-details",metadata:_pbsImageGetMetaData(this._domElement)});frame.state("image-details").on("update",function(imageData){_pbsUpdateNonCaptionedImageCTElement(this,imageData)}.bind(this)),frame.state("replace-image").on("replace",function(imageData){_pbsUpdateNonCaptionedImageCTElement(this,imageData)}.bind(this)),frame.on("close",function(){wp.media.editor.remove("edit"),frame.detach(),closeCallback&&setTimeout(closeCallback,1)})},ContentEdit.Image.prototype._removeDOMEventListeners=function(){this._domElement.removeEventListener("dblclick",this._onDblClickBound),window.removeEventListener("keydown",this._onKeyDownBound)},ContentEdit.Image.prototype.mount=function(){var i,responsiveAttributes,classes,parentWidth,imageWidth,imageHeight,ratio,load,ret;if(this._attributes)for(responsiveAttributes=["srcset","sizes","data-lazy-loaded","data-lazy-src","data-pin-nopin","src-orig","scale"],i=0;i<responsiveAttributes.length;i++)this._attributes[responsiveAttributes[i]]&&delete this._attributes[responsiveAttributes[i]];this._attributes&&this._attributes.class&&-1!==(classes=this._attributes.class.split(" ")).indexOf("alignnone")&&(classes[classes.indexOf("alignnone")]="aligncenter",this._attributes.class=classes.join(" ")),this._domElement=document.createElement("img");for(i in this._attributes)this._attributes.hasOwnProperty(i)&&this._attributes[i]&&this._domElement.setAttribute(i,this._attributes[i]);return this._onDblClickBound=this._onDblclick.bind(this),this._domElement.addEventListener("dblclick",this._onDblClickBound),this._onKeyDownBound=this._onKeyDown.bind(this),window.addEventListener("keydown",this._onKeyDownBound),this._attributes.height&&this._attributes.width&&(parentWidth=window.pbsGetBoundingClientRect(this.parent()._domElement).width,imageWidth=parseInt(this._attributes.width,10),imageHeight=parseInt(this._attributes.height,10),imageWidth>parentWidth&&(ratio=imageHeight/imageWidth,imageHeight=(imageWidth=parentWidth)*ratio),this._domElement.style.height=imageHeight+"px",this._domElement.style.width=imageWidth+"px",this._domElement.classList.add("pbs-image-loading"),load=function(){this._domElement&&(this._domElement.style.height="",this._domElement.style.width="",this._domElement.classList.remove("pbs-image-loading"),this._domElement.removeEventListener("load",load))}.bind(this),this._domElement.addEventListener("load",load)),ret=ContentEdit.Image.__super__.mount.call(this),wp.hooks.doAction("pbs.image.mounted"),ret},ContentEdit.Image.prototype._onKeyDown=function(ev){16!==ev.keyCode&&91!==ev.keyCode&&93!==ev.keyCode&&(ev.ctrlKey||ev.metaKey||-1===["input","select","textarea","button"].indexOf(ev.target.tagName.toLowerCase())&&this.isFocused()&&(ev.preventDefault(),ContentTools.Tools.Paragraph.apply(this,null,function(){})))},ContentEdit.Image._dropBoth=function(element,target,placement){var insertIndex;return element.parent().detach(element),insertIndex=target.parent().children.indexOf(target),"below"===placement[0]&&"center"===placement[1]&&(insertIndex+=1),element.removeCSSClass("alignleft"),element.removeCSSClass("alignright"),element.removeCSSClass("aligncenter"),element.removeCSSClass("alignnone"),-1!==["left","right","center"].indexOf(placement[1])&&element.addCSSClass("align"+placement[1]),target.parent().attach(element,insertIndex)},ContentEdit.Image.droppers={Image:ContentEdit.Image._dropBoth,PreText:ContentEdit.Image._dropBoth,Static:ContentEdit.Image._dropBoth,Text:ContentEdit.Image._dropBoth},wp.hooks.addFilter("pbs.shortcode.allow_raw_edit",function(allow,scBase,element){var target,frame;return"caption"===scBase?(target=element._domElement.querySelector("img"),(frame=wp.media.editor.open("edit",{frame:"image",state:"image-details",metadata:_pbsImageGetMetaData(target)})).state("image-details").on("update",function(imageData){_pbsUpdateNonCaptionedImage(target,imageData)}),frame.state("replace-image").on("replace",function(imageData){_pbsUpdateNonCaptionedImage(target,imageData)}),frame.on("close",function(){wp.media.editor.remove("edit"),frame.detach()}),!1):allow}),_pbsToolbarImageHasTextContent=function(node){return node&&!(!node.textContent&&!node.innerText)},_pbsToolbarImageGetParent=function(node,className){for(;node&&node.parentNode;){if(node.className&&-1!==(" "+node.className+" ").indexOf(" "+className+" "))return node;node=node.parentNode}return!1},_pbsUpdateNonCaptionedImage=function(imageNode,imageData){var key,classes,node,id,attrs,linkAttrs,width,height,align,oldA,linkNode,i,textElement,currElement,parent,index,scData,newElem,shortcode;(classes=imageData.extraClasses.split(" "))||(classes=[]),imageData.caption||classes.push("align"+imageData.align),imageData.attachment_id&&(classes.push("wp-image-"+imageData.attachment_id),imageData.size&&"custom"!==imageData.size&&classes.push("size-"+imageData.size)),width=imageData.width,height=imageData.height,"custom"===imageData.size&&(width=imageData.customWidth,height=imageData.customHeight),attrs={src:imageData.url,width:width||null,height:height||null,alt:imageData.alt,title:imageData.title||null,class:classes.join(" ")||null};for(key in attrs)attrs.hasOwnProperty(key)&&imageNode.setAttribute(key,attrs[key]);if(linkAttrs={href:imageData.linkUrl,rel:imageData.linkRel||null,target:imageData.linkTargetBlank?"_blank":null,class:imageData.linkClassName||null},imageNode.parentNode&&"A"===imageNode.parentNode.nodeName&&!_pbsToolbarImageHasTextContent(imageNode.parentNode))if(imageData.linkUrl)for(key in linkAttrs)linkAttrs.hasOwnProperty(key)&&null!==linkAttrs[key]&&imageNode.parentNode.setAttribute(key,linkAttrs[key]);else(oldA=imageNode.parentNode).parentNode.insertBefore(imageNode,oldA),oldA.parentNode.removeChild(oldA);else if(imageData.linkUrl){(linkNode=_pbsToolbarImageGetParent(imageNode,"a"))&&imageNode.parentNode.insertBefore(linkNode,imageNode.nextSibling),linkNode=document.createElement("a");for(i in linkAttrs)linkAttrs.hasOwnProperty(i)&&null!==linkAttrs[i]&&linkNode.setAttribute(i,linkAttrs[i]);imageNode.parentNode.insertBefore(linkNode,imageNode),linkNode.appendChild(imageNode)}for(_pbsToolbarImageGetParent(imageNode,".mceTemp"),textElement=null,currElement=node=imageNode.parentNode&&"A"===imageNode.parentNode.nodeName&&!_pbsToolbarImageHasTextContent(imageNode.parentNode)?imageNode.parentNode:imageNode;currElement;){if(currElement._ceElement){textElement=currElement._ceElement;break}currElement=currElement.parentNode}imageData.caption?(id=imageData.attachment_id?"attachment_"+imageData.attachment_id:null,align="align"+(imageData.align||"none"),scData={tag:"caption",type:"closed",content:node.outerHTML+" "+imageData.caption,attrs:{id:id,align:align,width:width}},shortcode=new wp.shortcode(scData).string(),index=(parent=textElement.parent()).children.indexOf(textElement),shortcode=wp.shortcode.next("caption",shortcode,0),newElem=ContentEdit.Shortcode.createShortcode(shortcode),parent.attach(newElem,index),parent.detach(textElement),newElem.ajaxUpdate(!0),newElem.focus(),textElement=newElem):(index=(parent=textElement.parent()).children.indexOf(textElement),newElem=ContentEdit.Image.fromDOMElement(node),parent.attach(newElem,index),parent.detach(textElement),newElem.focus())},_pbsToolbarImageGetParent=function(node,className){for(;node&&node.parentNode;){if(node.className&&-1!==(" "+node.className+" ").indexOf(" "+className+" "))return node;node=node.parentNode}return!1},_pbsUpdateNonCaptionedImageCTElement=function(imageNode,imageData){var classes,id,attrs,linkAttrs,width,height,align,cls,i,key,scData,shortcode,newElem,index;for((classes=imageData.extraClasses.split(" "))||(classes=[]),imageData.caption||classes.push("align"+imageData.align),imageData.attachment_id&&(classes.push("wp-image-"+imageData.attachment_id),imageData.size&&"custom"!==imageData.size&&classes.push("size-"+imageData.size)),width=imageData.width,height=imageData.height,"custom"===imageData.size&&(width=imageData.customWidth,height=imageData.customHeight),attrs={src:imageData.url,width:width||null,height:height||null,alt:imageData.alt,title:imageData.title||null,class:classes.join(" ")||null},imageNode._aspectRatio=height/width,imageNode.size([width,height]),(cls=imageNode.attr("class").match(/wp-image-\d+/))&&imageNode.removeCSSClass(cls[0]),(cls=imageNode.attr("class").match(/size-\w+/))&&imageNode.removeCSSClass(cls[0]),imageNode.removeCSSClass("alignleft"),imageNode.removeCSSClass("alignright"),imageNode.removeCSSClass("aligncenter"),imageNode.removeCSSClass("alignnone"),i=0;i<classes.length;i++)classes[i]&&imageNode.addCSSClass(classes[i]);for(key in attrs)attrs.hasOwnProperty(key)&&"class"!==key&&(null!==attrs[key]?imageNode.attr(key,attrs[key]):imageNode.removeAttr(key));if(linkAttrs={href:imageData.linkUrl,rel:imageData.linkRel||null,target:imageData.linkTargetBlank?"_blank":null,class:imageData.linkClassName||null},imageNode.a)if(imageData.linkUrl)for(key in linkAttrs)linkAttrs.hasOwnProperty(key)&&(null!==linkAttrs[key]?imageNode.a[key]=linkAttrs[key]:delete imageNode.a[key]);else imageNode.a=null;else if(imageData.linkUrl){imageNode.a={};for(key in linkAttrs)linkAttrs.hasOwnProperty(key)&&null!==linkAttrs[key]&&(imageNode.a[key]=linkAttrs[key])}if(imageData.caption)return id=imageData.attachment_id?"attachment_"+imageData.attachment_id:null,align="align"+(imageData.align||"none"),scData={tag:"caption",type:"closed",content:imageNode.html()+" "+imageData.caption,attrs:{id:id,align:align,width:width}},shortcode=new wp.shortcode(scData),newElem=ContentEdit.Shortcode.createShortcode(wp.shortcode.next("caption",shortcode.string(),0)),index=imageNode.parent().children.indexOf(imageNode),imageNode.parent().attach(newElem,index),imageNode.parent().detach(imageNode),void newElem.ajaxUpdate(!0)},_pbsImageGetMetaData=function(img){var i,aClasses,metadata,width,height,captionClassName,captionBlock,classes,c,caption,link,attachmentID=img.getAttribute("class").match(/wp-image-(\d+)/),align=img.getAttribute("class").match(/align(\w+)/),size=img.getAttribute("class").match(/size-(\w+)/),tmpClasses=img.getAttribute("class").split(" "),extraClasses=[],classRegex=/wp-image-\d+|align\w+|size-\w+|ce-element[-\w]*/;if(img._ceElement&&img._ceElement.a&&img._ceElement.a.class)for(aClasses=img._ceElement.a.class.split(" "),i=0;i<aClasses.length;i++)aClasses[i].match(classRegex)||extraClasses.push(aClasses[i]);for(i=0;i<tmpClasses.length;i++)tmpClasses[i].match(classRegex)||extraClasses.push(tmpClasses[i]);for((metadata={attachment_id:!!attachmentID&&attachmentID[1],size:size?size[1]:"custom",caption:"",align:align?align[1]:"none",extraClasses:extraClasses.join(" "),link:!1,linkUrl:"",linkClassName:"",linkTargetBlank:!1,linkRel:"",title:""}).url=img.getAttribute("src"),metadata.alt=img.getAttribute("alt"),metadata.title=img.getAttribute("title"),width=img.getAttribute("width"),height=img.getAttribute("height"),metadata.customWidth=metadata.width=width,metadata.customHeight=metadata.height=height,captionClassName=[],captionBlock=img.parentNode;null!==captionBlock&&void 0!==captionBlock.classList&&!captionBlock.classList.contains("wp-caption");)captionBlock=captionBlock.parentNode;if(captionBlock&&captionBlock.classList){for(classes=captionBlock.classList,i=0;i<classes.length;i++)c=classes.item(i),/^align/.test(c)?metadata.align=c.replace("align",""):c&&"wp-caption"!==c&&captionClassName.push(c);metadata.captionClassName=captionClassName.join(" "),(caption=captionBlock.querySelector(".wp-caption-text"))&&(metadata.caption=caption.innerHTML.replace(/<br[^>]*>/g,"$&\n").replace(/^<p>/,"").replace(/<\/p>$/,""))}return img.parentNode&&"A"===img.parentNode.nodeName&&(link=img.parentNode,metadata.linkUrl=link.getAttribute("href"),metadata.linkTargetBlank="_blank"===link.getAttribute("target"),metadata.linkRel=link.getAttribute("rel"),metadata.linkClassName=link.className),img._ceElement&&img._ceElement.a&&(metadata.linkUrl=img._ceElement.a.href,metadata.linkTargetBlank="_blank"===img._ceElement.a.target,metadata.linkRel=img._ceElement.a.rel,metadata.linkClassName=img._ceElement.a.class),metadata},function(){var ready=function(){var editableArea,selector,el,mainImageNode,p,startingIndex,endingIndex,tip,tail,newContent,clonedPNode;if(document.querySelector('[data-name="main-content"]')){for(editableArea=document.querySelector('[data-name="main-content"]'),selector="a:not([data-ce-tag]) > img.alignright, a:not([data-ce-tag]) > img.alignleft, a:not([data-ce-tag]) > img.aligncenter, a:not([data-ce-tag]) > img.alignnone, p > img.alignright, p > img.alignleft, p > img.aligncenter, p > img.alignnone";editableArea.querySelector(selector);)mainImageNode=el=editableArea.querySelector(selector),"A"===el.parentNode.tagName&&(mainImageNode=el.parentNode).setAttribute("data-ce-tag","img"),"P"===mainImageNode.parentNode.tagName&&(endingIndex=(startingIndex=(p=mainImageNode.parentNode).innerHTML.indexOf(mainImageNode.outerHTML))+mainImageNode.outerHTML.length,tip=p.innerHTML.substr(0,startingIndex).trim(),tail=p.innerHTML.substr(endingIndex).trim(),newContent="",""!==tip&&((clonedPNode=p.cloneNode()).innerHTML=tip,newContent+=clonedPNode.outerHTML),newContent+=mainImageNode.outerHTML,""!==tail&&((clonedPNode=p.cloneNode()).innerHTML=tail,newContent+=clonedPNode.outerHTML),p.outerHTML=newContent);for(;editableArea.querySelector('img ~ br, [data-ce-tag="img"] ~ br');)editableArea.querySelector('img ~ br, [data-ce-tag="img"] ~ br').remove()}};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),wp.hooks.addFilter("pbs.save",function(html){return html=html.replace(/\sdata-ce-tag=["']img["']/g,""),html=html.replace(/(<a[^>]*)\sclass((\s|>)[^>]*>)/g,"$1$2"),html=html.replace(/((<a[^>]+>\s*)?<img[^>]*>(\s*<\/a>)?)\s*(<p[^\w>]*>)/g,"$4$1"),html=html.replace(/(<[^pa][^>]*>\s*)(<img[^>]*>)/g,"$1<p>$2</p>"),html=html.replace(/(<[^p][^>]*>\s*)(<a[^>]+>\s*<img[^>]*>\s*<\/a>)/g,"$1<p>$2</p>"),html=html.replace(/((<a[^>]+>\s*)?<img[^>]*>(\s*<\/a>)?)\s*(<br[^>]*>)*/g,"$1")}),wp.hooks.addFilter("pbs.toolbar.shortcode.label",function(scBase){return"pbs_widget"===scBase?pbsParams.labels.widget:scBase}),wp.hooks.addFilter("pbs.inspector.do_add_section_options",function(doContinue,optionName,model,divGroup,element,toolboxUI){return"widgetSettings"===optionName&&model&&model.attributes&&model.attributes.widget&&((doContinue=!!document.querySelector("#tmpl-pbs-widget-"+model.attributes.widget))||toolboxUI.addGenericShortcodeOptions(divGroup,element)),doContinue}),ContentEdit.Spacer=function(_super){function Spacer(tagName,attributes){attributes||(attributes={}),attributes["data-ce-tag"]||(attributes["data-ce-tag"]="spacer"),this.model=new Backbone.Model({}),Spacer.__super__.constructor.call(this,tagName,attributes),this._content=""}return __extends(Spacer,_super),Spacer.prototype.blur=function(){var root=ContentEdit.Root.get();if(this.isFocused())return this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)},Spacer.droppers=PBSEditor.allDroppers,Spacer.prototype.focus=function(supressDOMFocus){var root;if(root=ContentEdit.Root.get(),!this.isFocused())return root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.isMounted()&&!supressDOMFocus&&this.domElement().focus(),root.trigger("focus",this)},Spacer.prototype.cssTypeName=function(){return"spacer"},Spacer.prototype.typeName=function(){return"Spacer"},Spacer}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.Spacer,"spacer"),HTMLString.String.prototype.removeStyle=function(){var c,from,i,to,_i,newString,z,currentStyles,newStyles,styleName=null;if(from=arguments[0],to=arguments[1],arguments.length>=3&&(styleName=arguments[2]),!styleName)return this;for(to<0&&(to=this.length()+to+1),from<0&&(from=this.length()+from),newString=this.copy(),i=_i=from;from<=to?_i<to:_i>to;i=from<=to?++_i:--_i)if((c=newString.characters[i])._tags.length)for(z=c._tags.length-1;z>=0;z--)"a"!==c.tags()[z].name()&&(currentStyles=window.cssToStyleObject(c.tags()[0].attr("style")))[styleName]&&(delete currentStyles[styleName],newStyles=window.cssToStyleString(currentStyles),newString.characters[i]._tags[0].attr("style",newStyles),"span"===newString.characters[i]._tags[0].name()&&""===newString.characters[i]._tags[0].attr("style").trim()&&newString.characters[i].removeTags());return newString.optimize(),newString},HTMLString.String.prototype.removeStyles=function(){var z,c,from,i,newString,to,_i,attr,attrsToKeep;for(from=arguments[0],to=arguments[1],arguments[2],arguments[3],to<0&&(to=this.length()+to+1),from<0&&(from=this.length()+from),newString=this.copy(),i=_i=from;from<=to?_i<to:_i>to;i=from<=to?++_i:--_i)if((c=newString.characters[i])._tags.length)for(z=c._tags.length-1;z>=0;z--)if("a"===c.tags()[z].name()){attrsToKeep={};for(attr in c.tags()[z]._attributes)c.tags()[z]._attributes.hasOwnProperty(attr)&&(-1!==["href","target","title","contenteditable"].indexOf(attr)?attrsToKeep[attr]=c.tags()[z]._attributes[attr]:"class"===attr&&-1!==c.tags()[z]._attributes[attr].indexOf("pbs-button")&&(attrsToKeep.class="pbs-button"));newString.characters[i].removeTags(c.tags()[z]),newString.characters[i].addTags(new HTMLString.Tag("a",attrsToKeep))}else newString.characters[i].removeTags(c.tags()[z]);return newString.optimize(),newString},HTMLString.String.prototype.hasStyle=function(){var c,from,i,to,_i,currentStyles,styleName=null;for(from=arguments[0],to=arguments[1],arguments.length>=3&&(styleName=arguments[2]),to<0&&(to=this.length()+to+1),from<0&&(from=this.length()+from),i=_i=from;from<=to?_i<to:_i>to;i=from<=to?++_i:--_i)if((c=this.characters[i])&&c._tags.length)if(styleName){if(void 0!==(currentStyles=window.cssToStyleObject(c.tags()[0].attr("style")))[styleName])return currentStyles[styleName]}else{if(-1!==["b","strong","i","em"].indexOf(c.tags()[0].name()))return!0;if(c.tags()[0].attr("style"))return!0}return!1},HTMLString.String.prototype.style=function(){var c,from,i,newString,tags,to,_i,newStyles,tagName,dummy,isBr,z,currentStyles,styleName,applyStyle,k;for(from=arguments[0],to=arguments[1],tagName=arguments[2],newStyles=arguments[3],tags=new HTMLString.Tag("span"),to<0&&(to=this.length()+to+1),from<0&&(from=this.length()+from),(dummy=document.createElement(tagName)).style.display="none",document.body.appendChild(dummy),newString=this.copy(),i=_i=from;from<=to?_i<to:_i>to;i=from<=to?++_i:--_i){for((c=newString.characters[i])._tags.length||c.addTags(tags),isBr=!1,z=0;z<c._tags.length;z++)if("br"===c._tags[z].name()){isBr=!0;break}if(!isBr){currentStyles=window.cssToStyleObject(c.tags()[0].attr("style"));for(styleName in newStyles){if(newStyles.hasOwnProperty(styleName)&&newStyles[styleName]){for("string"==typeof newStyles[styleName]?newStyles[styleName]=["",newStyles[styleName]]:""!==newStyles[styleName][0]&&newStyles[styleName].unshift(""),newStyles[styleName][newStyles[styleName].length-1],k=0;k<newStyles[styleName].length;k++)applyStyle=newStyles[styleName][k];currentStyles[styleName]=applyStyle}else delete currentStyles[styleName];""===currentStyles[styleName]&&delete currentStyles[styleName]}newString.characters[i]._tags[0].attr("style",window.cssToStyleString(currentStyles)),"span"===newString.characters[i]._tags[0].name()&&""===newString.characters[i]._tags[0].attr("style").trim()&&newString.characters[i].removeTags()}}return document.body.removeChild(dummy),newString.optimize(),newString},HTMLString.String.prototype.getStyle=function(styleName,element){var nodeToCheck,nodeHTML,foundNode,i,style,styleRegex,match,dashedStyleName=styleName;if(styleName=styleName.replace(/-([a-z])/g,function(m,w){return w.toUpperCase()}),nodeToCheck=element._domElement,nodeHTML=this.html(),foundNode=!1,0===nodeHTML.indexOf("<"))for(i=0;i<element._domElement.children.length;i++)if(element._domElement.children[i].outerHTML===nodeHTML){nodeToCheck=element._domElement.children[i],foundNode=!0;break}if(!foundNode&&0===nodeHTML.indexOf("<")){if(1===nodeToCheck.firstChild.nodeType&&""!==(style=nodeToCheck.firstChild.style[dashedStyleName]))return style;if(styleRegex=new RegExp("(<\\w+[^>]+style=[^>]*[^-]"+dashedStyleName+':\\s*)([^;"]+)'),match=nodeHTML.match(styleRegex))return match[2]}return nodeToCheck.style[styleName]?nodeToCheck.style[styleName]:window.pbsGetComputedStyle(nodeToCheck)[styleName]},HTMLString.Character.prototype.addTags=function(){var tag,tags,_i,_len,_results;for(_results=[],_i=0,_len=(tags=1<=arguments.length?__slice.call(arguments,0):[]).length;_i<_len;_i++)tag=tags[_i],Array.isArray(tag)||(tag.selfClosing()?this.isTag()||this._tags.unshift(tag.copy()):_results.push(this._tags.push(tag.copy())));return _results},function(){var proxy=HTMLString.String.prototype.html;HTMLString.String.prototype.html=function(){return proxy.call(this).replace(/(<[^>]+)\scontenteditable(=['"](.*?)['"])?([^>]*>)/g,"$1$4")}}(),function(){var ready=function(){wp.media.frames.pbsSelectImage=wp.media({title:pbsParams.labels.select_image,multiple:!1,library:{type:"image"},button:{text:pbsParams.labels.use_selected_image}}),PBSEditor.openMediaManager=function(callback,selectedImageID){wp.media.frames.pbsSelectImage.callback=function(){var selection,ret;wp.media.frames.pbsSelectImage.off("close",wp.media.frames.pbsSelectImage.callback),wp.media.frames.pbsSelectImage.off("select",wp.media.frames.pbsSelectImage.callback),(selection=wp.media.frames.pbsSelectImage.state().get("selection"))&&(ret=null,selection.each(function(attachment){ret=attachment}),ret&&callback(ret))},wp.media.frames.pbsSelectImage.on("close",wp.media.frames.pbsSelectImage.callback),wp.media.frames.pbsSelectImage.on("select",wp.media.frames.pbsSelectImage.callback),wp.media.frames.pbsSelectImage._onOpen=function(){var selection,attachment;if(wp.media.frames.pbsSelectImage.off("open",wp.media.frames.pbsSelectImage._onOpen),selection=wp.media.frames.pbsSelectImage.state().get("selection")){for(;selection.length;)selection.remove(selection.first());selectedImageID&&(attachment=wp.media.attachment(selectedImageID))&&selection.add(attachment)}},wp.media.frames.pbsSelectImage.on("open",wp.media.frames.pbsSelectImage._onOpen),wp.media.frames.pbsSelectImage.open()}};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),function(){var ready=function(){var appendWidgetTemplates,storedWidgetHash,storedWidgets,payload,xhr;document.querySelector('[data-name="main-content"]')&&(appendWidgetTemplates=function(ajaxResponse){var dummy=document.createElement("DIV");for(localStorage.setItem("pbs_get_widget_templates_hash",pbsParams.widget_list_hash),localStorage.setItem("pbs_get_widget_templates",ajaxResponse),dummy.innerHTML=ajaxResponse;dummy.firstChild;)document.body.appendChild(dummy.firstChild)},storedWidgetHash=localStorage.getItem("pbs_get_widget_templates_hash"),storedWidgets=localStorage.getItem("pbs_get_widget_templates"),storedWidgetHash===pbsParams.widget_list_hash&&storedWidgets?appendWidgetTemplates(storedWidgets):((payload=new FormData).append("action","pbs_get_widget_templates"),payload.append("nonce",pbsParams.nonce),(xhr=new XMLHttpRequest).onload=function(){xhr.status>=200&&xhr.status<400&&appendWidgetTemplates(xhr.responseText)},xhr.open("POST",pbsParams.ajax_url),xhr.send(payload)))};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),window.PBSEditor.ToolboxFormatting=function(){function ToolboxFormatting(tools){this._tools=tools,this._toolUIs={}}return ToolboxFormatting.createDiv=function(classArray){var i,div=document.createElement("DIV");for(i=0;i<classArray.length;i++)div.classList.add(classArray[i]);return div},ToolboxFormatting.getInstance=function(tools){return this._toolbox||this.init(tools),this._toolbox},ToolboxFormatting.init=function(tools){return this._toolbox=new this(tools),this._toolbox.mount()},ToolboxFormatting.destroy=function(){this._toolbox.unmount(),this._toolbox=null},ToolboxFormatting.prototype.getTool=function(name){return this._toolUIs[name]?this._toolUIs[name]:null},ToolboxFormatting.prototype.isShown=function(){return this._domElement.classList.contains("ct-widget--active")},ToolboxFormatting.prototype.toggle=function(){return this.isShown()?this.hide():this.show(),this},ToolboxFormatting.prototype.show=function(){return this.isShown()?this:(this._domElement.classList.add("ct-widget--active"),this.updateTools(),this)},ToolboxFormatting.prototype.hide=function(){return this.isShown()?(this._domElement.classList.remove("ct-widget--active"),this):this},ToolboxFormatting.prototype.mount=function(){var domToolGroup,i,tool,toolGroup,toolName,_i,_j,_len,_len1,_ref,premiumProp;for(this._domElement=this.constructor.createDiv(["pbs-toolbox-bar","ct-widget","ct-toolbox"]),document.body.appendChild(this._domElement),i=_i=0,_len=(_ref=this._tools).length;_i<_len;i=++_i)for(toolGroup=_ref[i],domToolGroup=this.constructor.createDiv(["ct-tool-group"]),this._domElement.appendChild(domToolGroup),_j=0,_len1=toolGroup.length;_j<_len1;_j++)"|"!==(toolName=toolGroup[_j])?pbsParams.is_lite&&window.PBSEditor.premiumTools&&(premiumProp=window.PBSEditor.premiumTools[toolName])?((tool=ContentTools.ToolShelf.fetch("premium-formatting")).icon=toolName,"object"==typeof premiumProp?premiumProp.label&&(tool.label=premiumProp.label):tool.label=premiumProp,this._toolUIs[toolName]=new ContentTools.ToolUI(tool),this._toolUIs[toolName].mount(domToolGroup),this._toolUIs[toolName]._domElement.classList.add("pbs-premium-flag"),"object"==typeof premiumProp&&premiumProp.callback&&premiumProp.callback(this._toolUIs[toolName])):(tool=ContentTools.ToolShelf.fetch(toolName),this._toolUIs[toolName]=new ContentTools.ToolUI(tool),this._toolUIs[toolName].mount(domToolGroup),this._toolUIs[toolName].disabled(!0)):(tool=this.constructor.createDiv(["pbs-tool-sep"]),domToolGroup.appendChild(tool));return this._addDOMEventListeners()},ToolboxFormatting.prototype.unmount=function(){return this._removeDOMEventListeners()},ToolboxFormatting.prototype.updateTools=function(){return this._updateTimeout?this:(this._updateTimeout=setTimeout(function(){var element,name,selection;selection=!(!(element=ContentEdit.Root.get().focused())||!element.selection)&&element.selection();for(name in this._toolUIs)this._toolUIs[name].update(element,selection);this._updateTimeout=null}.bind(this),50),this)},ToolboxFormatting.prototype.keyUp=function(ev){(ev.metaKey||ev.ctrlKey)&&this.updateTools(),-1!==[40,37,39,38,9,8,46,13,16,91,18].indexOf(ev.keyCode)&&this.updateTools()},ToolboxFormatting.prototype._addDOMEventListeners=function(){return this._updateToolsBound||(this._updateToolsBound=this.updateTools.bind(this)),this._keyupBound||(this._keyupBound=this.keyUp.bind(this)),wp.hooks.addAction("pbs.shortcut.keyup",this._updateToolsBound),document.addEventListener("keyup",this._keyupBound),document.addEventListener("mouseup",this._updateToolsBound),ContentEdit.Root.get().bind("attach",this._updateToolsBound),ContentEdit.Root.get().bind("focus",this._updateToolsBound),ContentEdit.Root.get().bind("blur",this._updateToolsBound),ContentEdit.Root.get().bind("detach",this._updateToolsBound),this},ToolboxFormatting.prototype._removeDOMEventListeners=function(){return wp.hooks.removeAction("pbs.shortcut.keyup",this._updateToolsBound),document.addEventListener("keyup",this._keyupBound),document.addEventListener("mouseup",this._updateToolsBound),ContentEdit.Root.get().bind("attach",this._updateToolsBound),ContentEdit.Root.get().bind("focus",this._updateToolsBound),ContentEdit.Root.get().bind("blur",this._updateToolsBound),ContentEdit.Root.get().bind("detach",this._updateToolsBound),this._updateToolsBound=null,this._keyupBound=null,this},ToolboxFormatting}(),wp.hooks.addAction("pbs.init",function(){window.PBSEditor.ToolboxFormatting.getInstance(window.PBSEditor.formattingTools)}),wp.hooks.addAction("pbs.start",function(){window.PBSEditor.ToolboxFormatting.getInstance().show().updateTools()}),wp.hooks.addAction("pbs.stop",function(){window.PBSEditor.ToolboxFormatting.getInstance().hide()}),ContentTools.Tools.Bold.label=pbsParams.labels.bold,ContentTools.Tools.Italic.label=pbsParams.labels.italic,ContentTools.Tools.Link.label=pbsParams.labels.link,ContentTools.Tools.AlignLeft.label=pbsParams.labels.align_left,ContentTools.Tools.AlignCenter.label=pbsParams.labels.align_center,ContentTools.Tools.AlignRight.label=pbsParams.labels.align_right,ContentTools.Tools.OrderedList.label=pbsParams.labels.numbered_list,ContentTools.Tools.UnorderedList.label=pbsParams.labels.bullet_list,ContentTools.Tools.Indent.label=pbsParams.labels.indent,ContentTools.Tools.Unindent.label=pbsParams.labels.unindent,ContentTools.Tools.Undo.label=pbsParams.labels.undo,ContentTools.Tools.Redo.label=pbsParams.labels.redo,window.PBSEditor.ToolboxElements=function(_super){function ToolboxElements(tools){ToolboxElements.__super__.constructor.call(this),this._tools=tools,this._toolUIs={}}return __extends(ToolboxElements,_super),ToolboxElements.prototype.show=function(){return this.isShown()?this:(ToolboxElements.__super__.show.call(this),this._domElement.scrollTop=0,wp.hooks.doAction("pbs.tool.popup.open",this),this)},ToolboxElements.prototype.updateTools=function(){},ToolboxElements.prototype.mount=function(){var domToolGroup,i,tool,toolGroup,toolName,_i,_j,_len,_len1,_ref,note,label;for(this._domElement=this.constructor.createDiv(["pbs-interactive-elements-group","pbs-toolbox-elements","ct-widget","ct-toolbox"]),document.body.appendChild(this._domElement),(note=this.constructor.createDiv(["pbs-toolbox-elements-note"])).innerHTML=pbsParams.labels.drag_an_element,this._domElement.appendChild(note),i=_i=0,_len=(_ref=this._tools).length;_i<_len;i=++_i)for(toolGroup=_ref[i],domToolGroup=this.constructor.createDiv(["ct-tool-group"]),this._domElement.appendChild(domToolGroup),_j=0,_len1=toolGroup.length;_j<_len1;_j++)if(toolName=toolGroup[_j],pbsParams.is_lite&&window.PBSEditor.premiumElements&&window.PBSEditor.premiumElements[toolName])(tool=ContentTools.ToolShelf.fetch("premium-formatting")).icon=toolName,tool.buttonName=window.PBSEditor.premiumElements[toolName],tool.label="",this._toolUIs[toolName]=new ContentTools.ToolUI(tool),this._toolUIs[toolName].mount(domToolGroup),this._toolUIs[toolName]._domElement.setAttribute("title","Premium Element"),this._toolUIs[toolName]._domElement.classList.add("pbs-premium-flag");else{try{tool=ContentTools.ToolShelf.fetch(toolName)}catch(err){(label=this.constructor.createDiv(["ct-tool","pbs-element-label"])).innerHTML=toolName,domToolGroup.appendChild(label);continue}this._toolUIs[toolName]=new ContentTools.ToolUI(tool),this._toolUIs[toolName].mount(domToolGroup)}return this._addDOMEventListeners()},ToolboxElements.prototype.closeWhenLeaving=function(){PBS.isEditing&&this.hide()},ToolboxElements.prototype.closeWhenClickingOutside=function(ev){PBS.isEditing&&(this._domElement===ev.target||this._domElement.contains(ev.target)||this.hide())},ToolboxElements.prototype.openWhenHoverOnSide=function(ev){PBS.isEditing&&ev.screenX<=5&&ev.screenY>70&&this.show()},ToolboxElements.prototype._addDOMEventListeners=function(){return this._closeWhenLeavingBound||(this._closeWhenLeavingBound=this.closeWhenLeaving.bind(this)),this._closeWhenClickingOutsideBound||(this._closeWhenClickingOutsideBound=this.closeWhenClickingOutside.bind(this)),this._openWhenHoverOnSideBound||(this._openWhenHoverOnSideBound=this.openWhenHoverOnSide.bind(this)),this._domElement.addEventListener("mouseleave",this._closeWhenLeavingBound),document.body.addEventListener("mousedown",this._closeWhenClickingOutsideBound),document.body.addEventListener("mouseup",this._closeWhenClickingOutsideBound),document.body.addEventListener("keydown",this._closeWhenClickingOutsideBound),document.body.addEventListener("mousemove",this._openWhenHoverOnSideBound),this},ToolboxElements.prototype._removeDOMEventListeners=function(){return this._domElement.removeEventListener("mouseleave",this._closeWhenLeavingBound),document.body.removeEventListener("mousedown",this._closeWhenClickingOutsideBound),document.body.removeEventListener("mouseup",this._closeWhenClickingOutsideBound),document.body.removeEventListener("keydown",this._closeWhenClickingOutsideBound),document.body.removeEventListener("mousemove",this._openWhenHoverOnSideBound),this},ToolboxElements}(window.PBSEditor.ToolboxFormatting),wp.hooks.addAction("pbs.init",function(){window.PBSEditor.ToolboxElements.getInstance(window.PBSEditor.insertElements)}),wp.hooks.addAction("pbs.stop",function(){window.PBSEditor.ToolboxElements.getInstance().hide()}),function(){var proxied=ContentTools.ToolUI.prototype._onMouseLeave;ContentTools.ToolUI.prototype._onMouseLeave=function(ev){var element;if(this._mouseDown&&this._domElement.classList.contains("pbs-tool-large")){if(pbsParams.is_lite&&window.PBSEditor.premiumElements&&(window.PBSEditor.premiumElements[this.tool.tagName]||window.PBSEditor.premiumElements[this.tool.icon.toLowerCase()]))return ev.stopPropagation(),ev.preventDefault(),proxied.call(this,ev);ContentEdit.Root.get().focused()&&ContentEdit.Root.get().focused().blur(),element=new ContentEdit.NewElementDragHelper(this.tool),ContentTools.EditorApp.get().regions()["main-content"].attach(element),element.drag(ev.screenX,ev.screenY+window.pbsScrollY()),ev.stopPropagation(),ev.preventDefault()}return proxied.call(this,ev)}}(),ContentEdit.NewElementDragHelper=function(_super){function NewElementDragHelper(tool,attributes){NewElementDragHelper.__super__.constructor.call(this,"div",attributes),this._content="",this.tool=tool}return __extends(NewElementDragHelper,_super),NewElementDragHelper.droppers=PBSEditor.allDroppers,NewElementDragHelper.prototype.typeName=function(){return this.tool.label},NewElementDragHelper.prototype.drop=function(element,placement){var index;if(!element)return ContentEdit.Root.get().cancelDragging(),void this.parent().detach(this);index=element.parent().children.indexOf(element),index+="above"===placement[0]?0:1,this.tool.createNew(element.parent(),index),this.parent().detach(this)},NewElementDragHelper}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.NewElementDragHelper,"NewElementDragHelper"),ContentTools.ToolboxPropertiesUI=function(_super){function ToolboxPropertiesUI(tools){this._onClose=__bind(this._onClose,this),ToolboxPropertiesUI.__super__.constructor.call(this,tools)}return __extends(ToolboxPropertiesUI,_super),ToolboxPropertiesUI.prototype.isDragging=function(){return ToolboxPropertiesUI.__super__.isDragging.call(this)},ToolboxPropertiesUI.prototype.show=function(){if(this.isMounted()||this.mount(),this.hasContents)return this.addCSSClass("ct-widget--active")},ToolboxPropertiesUI.prototype.isOpen=function(){return this._domElement.classList.contains("ct-widget--active")},ToolboxPropertiesUI.prototype.hide=function(){this.isMounted()&&(this.removeCSSClass("ct-widget--active"),this._domElement.classList.remove("pbs-scroll-move"),this._element=null),window.removeEventListener("scroll",this._scrollLocationUpdateBound),clearInterval(this._scrollUpdateTimeout),this._scrollUpdateTimeout=null},ToolboxPropertiesUI.prototype.tools=function(tools){return ToolboxPropertiesUI.__super__.tools.call(this,tools)},ToolboxPropertiesUI.prototype.mount=function(){var domToolGroup,i,tool,toolGroup,toolName,_i,_j,_len,_len1,_ref;for(this._domElement=this.constructor.createDiv(["pbs-toolbox-properties","ct-widget","ct-toolbox"]),this.parent().domElement().appendChild(this._domElement),this._domGrip=document.createElement("DIV"),this._domTabs=this.constructor.createDiv(["pbs-toolbox-tabs"]),this._domElement.appendChild(this._domTabs),this._domSections=this.constructor.createDiv(["pbs-toolbox-sections"]),this._domElement.appendChild(this._domSections),this._domResize=this.constructor.createDiv(["pbs-toolbox-resizer"]),this._domElement.appendChild(this._domResize),this._applyActionButtonVisibility=this.applyActionButtonVisibility.bind(this),wp.hooks.addAction("pbs.option.changed",this._applyActionButtonVisibility),i=_i=0,_len=(_ref=this._tools).length;_i<_len;i=++_i)for(toolGroup=_ref[i],domToolGroup=this.constructor.createDiv(["ct-tool-group"]),this._domElement.appendChild(domToolGroup),_j=0,_len1=toolGroup.length;_j<_len1;_j++)toolName=toolGroup[_j],tool=ContentTools.ToolShelf.fetch(toolName),this._toolUIs[toolName]=new ContentTools.ToolUI(tool),this._toolUIs[toolName].mount(domToolGroup),this._toolUIs[toolName].bind("apply",function(_this){return function(){return _this.updateTools()}}(this));return this._addDOMEventListeners()},ToolboxPropertiesUI.prototype.updateTools=function(){return ToolboxPropertiesUI.__super__.updateTools.call(this)},ToolboxPropertiesUI.prototype.unmount=function(){return wp.hooks.removeAction("pbs.option.changed",this._applyActionButtonVisibility),ToolboxPropertiesUI.__super__.unmount.call(this)},ToolboxPropertiesUI.prototype._addDOMEventListeners=function(){this._onResizeBound=this._onResize.bind(this),this._onResizeMoveBound=this._onResizeMove.bind(this),this._onResizeStopBound=this._onResizeStop.bind(this),this._domResize.addEventListener("mousedown",this._onResizeBound),ToolboxPropertiesUI.__super__._addDOMEventListeners.call(this)},ToolboxPropertiesUI.prototype._onResize=function(ev){ev.preventDefault(),ev.stopPropagation(),document.body.addEventListener("mousemove",this._onResizeMoveBound),document.body.addEventListener("mouseup",this._onResizeStopBound),this._resizeStart=ev.screenY,this._resizeOrigHeight=this._domElement.getBoundingClientRect().height},ToolboxPropertiesUI.prototype._onResizeMove=function(ev){ev.preventDefault(),ev.stopPropagation(),this._domElement.style.transition="none",this._domElement.style.height=this._resizeOrigHeight+(ev.screenY-this._resizeStart)+"px"},ToolboxPropertiesUI.prototype._onResizeStop=function(ev){ev.preventDefault(),ev.stopPropagation(),document.body.removeEventListener("mousemove",this._onResizeMoveBound),document.body.removeEventListener("mouseup",this._onResizeStopBound),this._domElement.style.transition=""},ToolboxPropertiesUI.prototype._repositionOn=function(element){var elemRect,inspectorRect;this.isMounted()&&(window.innerWidth<=800||element._domElement&&this._domElement&&(elemRect=window.pbsGetBoundingClientRect(element._domElement),inspectorRect=window.pbsGetBoundingClientRect(this._domElement),fastdom.measure(function(){var windowHeight=window.innerHeight,windowWidth=window.innerWidth,elemLeft=elemRect.left,elemRight=elemRect.right,elemTop=elemRect.top,elemWidth=elemRect.width,elemHeight=elemRect.height,inspectorWidth=inspectorRect.width,spaceAbove=elemTop-77,spaceBelow=windowHeight-elemTop-elemHeight/3,spaceLeft=elemLeft,spaceRight=windowWidth-elemRight,inspectorHeight=.4*windowHeight-77<350?350:.4*windowHeight-77,inspectorFullHeight=windowHeight-40-77;fastdom.mutate(function(){var newInspectorLeft,newInspectorTop,newInspectorHeight,percentage=50,arrowLocation="center";spaceRight-40>inspectorWidth?(this._domElement.style.left=elemRight+20+"px",this._domElement.style.height=inspectorFullHeight+"px",arrowLocation="left",newInspectorTop=97,newInspectorHeight=inspectorFullHeight):spaceLeft-40>inspectorWidth?(this._domElement.style.left=elemLeft-inspectorWidth-20+"px",arrowLocation="right",newInspectorTop=97,newInspectorHeight=inspectorFullHeight):(newInspectorLeft=elemLeft+elemWidth/2-inspectorWidth/2,this._domElement.style.left=newInspectorLeft+"px",arrowLocation="down",newInspectorTop=null,newInspectorHeight=inspectorHeight,newInspectorLeft<20?this._domElement.style.left="20px":newInspectorLeft+inspectorWidth>windowWidth-20&&(this._domElement.style.left=windowWidth-inspectorWidth-20+"px")),"right"!==arrowLocation&&"left"!==arrowLocation||(percentage=(elemTop+elemHeight/2-newInspectorTop)/newInspectorHeight,(percentage=10*Math.round(10*percentage))<0?percentage=0:percentage>90&&(percentage=90)),"right"!==arrowLocation&&"left"!==arrowLocation&&(elemTop>windowHeight?(newInspectorTop=windowHeight-inspectorHeight-20,arrowLocation="down"):elemTop+elemHeight<75?(newInspectorTop=97,arrowLocation="up"):spaceAbove>inspectorHeight?(newInspectorTop=40,arrowLocation="down",newInspectorHeight=spaceAbove):windowHeight-elemTop-elemHeight>inspectorHeight?(newInspectorTop=elemTop+elemHeight+20,arrowLocation="up",newInspectorHeight=windowHeight-elemTop-elemHeight-30):spaceBelow>inspectorHeight?(newInspectorTop=windowHeight-inspectorHeight-10,arrowLocation="up"):(newInspectorTop=40,arrowLocation="down")),this._domElement.setAttribute("data-arrow-location",arrowLocation),this._domElement.setAttribute("data-location-percentage",percentage),this._domElement.style.height=newInspectorHeight+"px",null!==newInspectorTop&&(this._domElement.style.top=newInspectorTop+"px")}.bind(this))}.bind(this))))},ToolboxPropertiesUI.prototype._contain=function(){},ToolboxPropertiesUI.prototype._removeDOMEventListeners=function(){ToolboxPropertiesUI.__super__._removeDOMEventListeners.call(this)},ToolboxPropertiesUI.prototype._onClose=function(){if(this.isMounted())return this.hide()},ToolboxPropertiesUI.prototype._onDrag=function(ev){return ToolboxPropertiesUI.__super__._onDrag.call(this,ev)},ToolboxPropertiesUI.prototype._onStartDragging=function(ev){return ToolboxPropertiesUI.__super__._onStartDragging.call(this,ev)},ToolboxPropertiesUI.prototype._onStopDragging=function(ev){return ToolboxPropertiesUI.__super__._onStopDragging.call(this,ev)},ToolboxPropertiesUI.prototype.inspect=function(element){this._inspectElement(element),this._repositionOn(element),this.show(),this._element=element,setTimeout(function(){this._domElement.classList.contains("ct-widget--active")&&this._repositionOn(this._element)}.bind(this),1e3),this._scrollLocationUpdateBound=this.scrollLocationUpdate.bind(this),window.addEventListener("scroll",this._scrollLocationUpdateBound)},ToolboxPropertiesUI.prototype.scrollLocationUpdate=function(){this._scrollUpdateTimeout||(this._domElement.classList.add("pbs-scroll-move"),this._scrollUpdateTimeout=setTimeout(function(){this._element&&(this._repositionOn(this._element),this._scrollUpdateTimeout=null)}.bind(this),400))},ToolboxPropertiesUI.prototype._addTab=function(label,element){var tab=document.createElement("DIV");tab.classList.add("pbs-toolbox-tab"),tab.innerHTML=label,tab.setAttribute("data-name",element.constructor.name),this._domTabs.appendChild(tab),tab._targetElement=element,tab._toolbox=this,1===this._domTabs.children.length&&tab.classList.add("pbs-toolbox-tab-shown"),tab.addEventListener("click",function(){var visibleSection,visibleTab=this.parentNode.querySelector(".pbs-toolbox-tab-shown");visibleTab&&visibleTab.classList.remove("pbs-toolbox-tab-shown"),this.classList.add("pbs-toolbox-tab-shown"),(visibleSection=this.parentNode.parentNode.querySelector(".pbs-toolbox-section-shown"))&&visibleSection.classList.remove("pbs-toolbox-section-shown"),this.parentNode.parentNode.querySelector('.pbs-toolbox-section[data-name="'+this.getAttribute("data-name")+'"]').classList.add("pbs-toolbox-section-shown"),this._toolbox._element=this._targetElement,this._toolbox._repositionOn(this._targetElement)}.bind(tab)),tab.addEventListener("mouseenter",function(tab,element){this.highlightElement(element,tab)}.bind(this,tab,element)),tab.addEventListener("mouseleave",function(tab,element){this.unhighlightElement(element,tab)}.bind(this,tab,element))},ToolboxPropertiesUI.prototype._removeTab=function(name){var removeMe=this._domTabs.querySelector('[data-name="'+name+'"]');removeMe&&this._domTabs.removeChild(removeMe)},ToolboxPropertiesUI.prototype.clickActionButton=function(ev){ev.preventDefault(),this.onClick(this.element,ev.target)},ToolboxPropertiesUI.prototype.addActionButtons=function(container,element){var i,actionButtons,button;if(window.pbsElementActionButtons[element.constructor.name])for((actionButtons=window.pbsElementActionButtons[element.constructor.name]).sort(function(a,b){return a.priority-b.priority}),i=0;i<actionButtons.length;i++)(button=document.createElement("BUTTON")).setAttribute("data-tooltip",actionButtons[i].name),container.appendChild(button),button.action=actionButtons[i],button.element=element,button.container=container,actionButtons[i].element=element,actionButtons[i].id&&button.classList.add("pbs-action-"+actionButtons[i].id),actionButtons[i].onClick&&button.addEventListener("click",this.clickActionButton.bind(actionButtons[i])),"function"==typeof actionButtons[i].visible&&(actionButtons[i].visible(element,button)||button.classList.add("pbs-action-button-hide"))},ToolboxPropertiesUI.prototype.addSection=function(label,element,optionIndex){var section,numWithGroups,numNoGroup,k,note,shortcodeBase,shortcodeProperties,heading,shortcodeNote,currElemModel,actionPanel,sectionInner;if(this.hasContents=!0,this._addTab(label,element),(section=document.createElement("DIV")).classList.add("pbs-toolbox-section"),section.setAttribute("data-name",element.constructor.name),this._domSections.appendChild(section),1===this._domSections.children.length&&section.classList.add("pbs-toolbox-section-shown"),(sectionInner=document.createElement("DIV")).classList.add("pbs-toolbox-section-inner"),section.appendChild(sectionInner),(actionPanel=document.createElement("DIV")).classList.add("pbs-toolbox-actions"),section.appendChild(actionPanel),section=sectionInner,this.addActionButtons(actionPanel,element),"Shortcode"===element.constructor.name&&void 0===PBSInspectorOptions.Shortcode[element.sc_base]&&void 0!==pbsParams.shortcode_mappings&&void 0!==pbsParams.shortcode_mappings[element.sc_base]&&this.createShortcodeMappingOptions&&this.createShortcodeMappingOptions(element.sc_base),"Shortcode"===element.constructor.name){if(shortcodeBase=element.sc_base,void 0!==(shortcodeProperties=PBSInspectorOptions.Shortcode[shortcodeBase])&&void 0!==shortcodeProperties.hidden&&shortcodeProperties.hidden)return;if(void 0!==shortcodeProperties&&void 0!==shortcodeProperties.options){for(numWithGroups=0,numNoGroup=0,k=0;k<shortcodeProperties.options.length;k++)shortcodeProperties.options[k].group?numWithGroups++:numNoGroup++;if(numWithGroups&&numNoGroup)for(k=0;k<shortcodeProperties.options.length;k++)shortcodeProperties.options[k].group||(shortcodeProperties.options[k].group=pbsParams.labels.general);for(k=0;k<shortcodeProperties.options.length;k++)this.addSectionOptions(section,shortcodeProperties.options[k],element);shortcodeProperties.options.length||((note=document.createElement("DIV")).innerHTML=pbsParams.labels.no_attributes_available,note.classList.add("pbs-shortcode-no-options"),section.appendChild(note))}else(heading=document.createElement("DIV")).innerHTML=pbsParams.labels.note_options_are_detected,section.appendChild(heading),this.addGenericShortcodeOptions(section,element);(shortcodeNote=document.createElement("DIV")).classList.add("pbs-inspector-shortcode-note"),shortcodeNote.innerHTML=pbsParams.labels.note_shortcode_not_appearing,section.appendChild(shortcodeNote)}else if(void 0!==PBSInspectorOptions[optionIndex]){for(element.model?(currElemModel=element.model).set("element",element):currElemModel=new Backbone.Model({element:element}),numWithGroups=0,numNoGroup=0,k=0;k<PBSInspectorOptions[optionIndex].options.length;k++)PBSInspectorOptions[optionIndex].options[k].group?numWithGroups++:numNoGroup++;if(numWithGroups&&numNoGroup)for(k=0;k<PBSInspectorOptions[optionIndex].options.length;k++)PBSInspectorOptions[optionIndex].options[k].group||(PBSInspectorOptions[optionIndex].options[k].group=pbsParams.labels.general);for(k=0;k<PBSInspectorOptions[optionIndex].options.length;k++)this.addSectionOptions(section,PBSInspectorOptions[optionIndex].options[k],element,currElemModel);PBSInspectorOptions[optionIndex].onMouseEnter&&section.addEventListener("mouseenter",function(e){PBSInspectorOptions[optionIndex].onMouseEnter(this,e)}.bind(element)),PBSInspectorOptions[optionIndex].onMouseLeave&&section.addEventListener("mouseleave",function(e){PBSInspectorOptions[optionIndex].onMouseLeave(this,e)}.bind(element)),void 0!==PBSInspectorOptions[optionIndex].footer&&Math.random()>.5&&((note=document.createElement("DIV")).innerHTML=PBSInspectorOptions[optionIndex].footer,note.classList.add("pbs-group-footer"),section.appendChild(note))}},ToolboxPropertiesUI.prototype.removeSection=function(name){var removeMe;this._removeTab(name),(removeMe=this._domSections.querySelector('[data-name="'+name+'"]'))&&this._domSections.removeChild(removeMe)},ToolboxPropertiesUI.prototype.removeAllSections=function(){for(this.clearSections();this._domTabs.firstChild;)this._domTabs.removeChild(this._domTabs.firstChild);for(;this._domSections.firstChild;)this._domSections.removeChild(this._domSections.firstChild)},ToolboxPropertiesUI.prototype._inspectElement=function(element){var closeButton,groups,options,inspectedElementNames=[];if(this._element!==element){for(this.hasContents=!1,this.removeAllSections();element.nodeType&&!element._ceElement&&"BODY"!==element.tagName;)this.addOptions(element),element=element.parentNode;for(element._ceElement&&(element=element._ceElement);element&&element.type;)-1===inspectedElementNames.indexOf(element.constructor.name)&&(this.addOptions(element),inspectedElementNames.push(element.constructor.name),"DivRow"===element.constructor.name&&inspectedElementNames.push("DivCol")),element=element.parent();pbsParams.is_lite&&(groups=this._domElement.querySelectorAll("[data-collapse-group]"),Array.prototype.forEach.call(groups,function(group){var numOptions=group.querySelectorAll(".pbs-tool-option:not(.pbs-collapsable-title)").length,numPremiumOptions=group.querySelectorAll(".pbs-tool-option.pbs-premium-flag").length,title=group.firstChild;numOptions>0&&numOptions===numPremiumOptions&&(title.classList.add("pbs-premium-flag"),title.parentNode.classList.add("pbs-premium-flag-container"))})),groups=this._domElement.querySelectorAll("[data-collapse-group]"),Array.prototype.forEach.call(groups,function(group){var allHidden=!0;options=group.querySelectorAll(".pbs-tool-option:not(.pbs-collapsable-title)"),Array.prototype.forEach.call(options,function(option){"none"!==option.style.display&&(allHidden=!1)}),allHidden&&(group.style.display="none")}),(closeButton=document.createElement("BUTTON")).classList.add("pbs-toolbox-close"),this._domTabs.appendChild(closeButton),closeButton.addEventListener("click",function(){this.hide()}.bind(this))}},ToolboxPropertiesUI.prototype.addOptions=function(element){var index,optionIndex=element.constructor.name,matched=!1,label=optionIndex;if(!window.PBSInspectorOptions[element.constructor.name]&&element.nodeType){for(index in window.PBSInspectorOptions)if(window.PBSInspectorOptions.hasOwnProperty(index)&&window.pbsSelectorMatches(element,index)){optionIndex=index,matched=!0;break}if(!matched)return}window.PBSInspectorOptions[optionIndex]&&(label=window.PBSInspectorOptions[optionIndex].label,"Shortcode"===element.constructor.name&&(label=element.constructor.name,"pbs_widget"===element.sc_base?label="Widget":"pbs_sidebar"===element.sc_base&&(label="Sidebar")),this.addSection(label,element,optionIndex))},ToolboxPropertiesUI.prototype.addOption=function(){},ToolboxPropertiesUI.prototype.highlightElement=function(element){var rect;element._domElement&&(rect=window.pbsGetBoundingClientRect(element._domElement),this._highlighter&&(this._highlighter.parentNode.removeChild(this._highlighter),this._highlighter=null),this._highlighter=document.createElement("DIV"),this._highlighter.classList.add("pbs-inspector-element-highlighter"),this._highlighter.style.top=rect.top-77+window.pbsScrollY()+"px",this._highlighter.style.left=rect.left+"px",this._highlighter.style.width=rect.width+"px",this._highlighter.style.height=rect.height+"px",setTimeout(function(){this._highlighter&&this._highlighter.classList.add("pbs-show")}.bind(this),10),document.body.appendChild(this._highlighter))},ToolboxPropertiesUI.prototype.unhighlightElement=function(){this._highlighter&&(this._highlighter.parentNode.removeChild(this._highlighter),this._highlighter=null)},ToolboxPropertiesUI.prototype.applyActionButtonVisibility=function(){var buttons=this._domElement.querySelectorAll(".pbs-toolbox-actions > *");Array.prototype.forEach.call(buttons,function(button){button.action&&"function"==typeof button.action.visible&&(button.action.visible(button.element,button)?button.classList.remove("pbs-action-button-hide"):button.classList.add("pbs-action-button-hide"))})},ToolboxPropertiesUI}(ContentTools.ToolboxUI),function(){var unmountProxy,startProxy,stopProxy,_EditorApp=ContentTools.EditorApp.getCls(),proxied=_EditorApp.prototype.init;_EditorApp.prototype.init=function(queryOrDOMElements,namingProp){proxied.call(this,queryOrDOMElements,namingProp),this._toolboxProperties=new ContentTools.ToolboxPropertiesUI([]),this.attach(this._toolboxProperties)},unmountProxy=_EditorApp.prototype.unmount,_EditorApp.prototype.unmount=function(){unmountProxy.call(this),this.isMounted()&&(this._toolboxProperties=null)},startProxy=_EditorApp.prototype.start,_EditorApp.prototype.start=function(){startProxy.call(this),this._toolboxProperties.isMounted()||this._toolboxProperties.mount()},stopProxy=_EditorApp.prototype.stop,_EditorApp.prototype.stop=function(){stopProxy.call(this),this._toolboxProperties.hide()}}(),function(){var hideInspectorBound,openInspectorHandler=function(ev){var domElement=ev.target;if(!domElement._ceElement)for(;"BODY"!==domElement.tagName&&!domElement._ceElement;){if(domElement.classList&&ContentTools.EditorApp.get()._toolboxProperties.isOpen()&&domElement.classList.contains("pbs-toolbar-tool")&&domElement.classList.contains("pbs-toolbar-tool-settings"))return;if(!(domElement=domElement.parentNode))return}if(domElement&&"BODY"!==domElement.tagName&&domElement._ceElement){if((!domElement._ceElement||ContentTools.EditorApp.get()._toolboxProperties.isOpen())&&ContentTools.EditorApp.get()._toolboxProperties.isOpen()){if(ev.target===ContentTools.EditorApp.get()._toolboxProperties._domElement)return;ContentTools.EditorApp.get()._toolboxProperties._domElement.contains(ev.target)||ContentTools.EditorApp.get()._toolboxProperties._element!==domElement._ceElement&&ContentTools.EditorApp.get()._toolboxProperties.hide()}}else ContentTools.EditorApp.get()._toolboxProperties.isOpen()&&(ContentTools.EditorApp.get()._toolboxProperties._domElement.contains(ev.target)||window.pbsSelectorMatches(ev.target,".media-modal, .media-modal *, .media-modal-backdrop, #wp-link-backdrop, #wp-link-wrap, #wp-link-wrap *")||ContentTools.EditorApp.get()._toolboxProperties.hide())},editor=ContentTools.EditorApp.get();editor.bind("start",function(){document.body.addEventListener("mousedown",openInspectorHandler),hideInspectorBound=ContentTools.EditorApp.get()._toolboxProperties.hide.bind(ContentTools.EditorApp.get()._toolboxProperties),wp.hooks.addAction("pbs.tool.popup.open",hideInspectorBound)}),editor.bind("stop",function(){document.body.removeEventListener("mousedown",openInspectorHandler),wp.hooks.removeAction("pbs.tool.popup.open",hideInspectorBound)})}();var ready;ready=function(){var editor=ContentTools.EditorApp.get();editor&&(editor.bind("start",function(){document.querySelector("#wp-admin-bar-pbs_page_templates").addEventListener("click",openPageTemplates),isBlankPage()&&document.querySelector("#wp-admin-bar-pbs_page_templates").dispatchEvent(new CustomEvent("click"))}),editor.bind("end",function(){document.querySelector("#wp-admin-bar-pbs_page_templates").removeEventListener("click",openPageTemplates)}))},"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready);var _pbsCreatedViews,elemName,PBSInspectorOptions={Shortcode:{}};if(function(){var ready=function(){var editor,stopBodyScroll;document.querySelector('[data-name="main-content"]')&&(editor=ContentTools.EditorApp.get(),stopBodyScroll=function(ev){var $this=jQuery(this),scrollTop=this.scrollTop,scrollHeight=this.scrollHeight,height=$this.height(),delta="DOMMouseScroll"===ev.type?-40*ev.originalEvent.detail:ev.originalEvent.wheelDelta,up=delta>0,prevent=function(){return ev.stopPropagation(),ev.preventDefault(),ev.returnValue=!1,!1};return!up&&-delta>scrollHeight-height-scrollTop?($this.scrollTop(scrollHeight),prevent()):up&&delta>scrollTop?($this.scrollTop(0),prevent()):void 0},editor.bind("start",function(){jQuery("body").on("DOMMouseScroll mousewheel",".pbs-toolbox-elements, .pbs-toolbox-section-inner",stopBodyScroll)}),editor.bind("stop",function(){jQuery("body").off("DOMMouseScroll mousewheel",".pbs-toolbox-elements, .pbs-toolbox-section-inner",stopBodyScroll)}))};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),function(){var ready=function(){document.addEventListener("keyup",function(ev){PBS.isEditing&&window.pbsSelectorMatches(ev.target,'[data-name="main-content"] *')&&ContentTools.EditorApp.get()._toolboxProperties.hide()}),ContentEdit.Root.get().bind("blur",function(){}),ContentEdit.Root.get().bind("drag",function(){wp.hooks.doAction("pbs.tool.popup.open")}),ContentEdit.Root.get().bind("drop",function(){})};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),window.PBSEditor.createGroupTip=function(text){var tipText,tip=document.createElement("span");return tip.classList.add("pbs-group-tip"),tip.innerHTML="?",(tipText=document.createElement("span")).classList.add("pbs-group-tip-details"),tipText.innerHTML=text,tip.appendChild(tipText),tip},_pbsCreatedViews=[],ContentTools.ToolboxPropertiesUI.prototype.addSectionOptions=function(divGroup,option,element,model){var matchesAnOptionType,type,optionName,id,optionWrapper,subGroupName,subGroup,firstSubGroup,o;void 0===model&&(model=element.model),matchesAnOptionType=null,void 0!==option.type&&(matchesAnOptionType=Object.keys(PBSOption).some(function(name){return name.toLowerCase()===option.type.toLowerCase().replace(/_/g,"")})),matchesAnOptionType||(option.type="Text"),type=option.type.toLowerCase().replace(/_/g,"");for(optionName in PBSOption)if(PBSOption.hasOwnProperty(optionName)&&type===optionName.toLowerCase()){if(id=optionName.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),element.constructor.name&&(id=element.constructor.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+"-"+option.id),(optionWrapper=document.createElement("DIV")).classList.add("ct-tool"),"button"!==type&&optionWrapper.classList.add("pbs-tool-option"),option.class&&optionWrapper.setAttribute("class",optionWrapper.getAttribute("class")+" "+option.class),optionName&&optionWrapper.classList.add("pbs-"+optionName.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()),option.id&&optionWrapper.setAttribute("id",id),option.group?(subGroupName=option.group.toLowerCase().trim().replace(/\"/g,""),subGroup=divGroup.querySelector('[data-subgroup="'+subGroupName+'"]'),divGroup.classList.add("pbs-has-group"),subGroup||((subGroup=document.createElement("DIV")).setAttribute("data-subgroup",subGroupName),divGroup.appendChild(subGroup),"default"!==option.group&&(subGroup.innerHTML='<div class="pbs-option-subtitle pbs-tool-option">'+option.group+"</div>",subGroup.firstChild.classList.add("pbs-collapsable-title"),subGroup.setAttribute("data-collapse-group",element.constructor.name.toLowerCase()),divGroup.querySelectorAll("[data-subgroup]").length>1&&window.pbsCollapseSection(subGroup))),subGroup.appendChild(optionWrapper),option["group-tip"]&&(subGroup.querySelector(".pbs-group-tip-details")?subGroup.querySelector(".pbs-group-tip-details").innerHTML=option["group-tip"]:subGroup.querySelector(".pbs-option-subtitle").appendChild(window.PBSEditor.createGroupTip(option["group-tip"])))):(firstSubGroup=divGroup.querySelector("[data-subgroup]"))?divGroup.insertBefore(optionWrapper,firstSubGroup):divGroup.appendChild(optionWrapper),!wp.hooks.applyFilters("pbs.inspector.do_add_section_options",!0,optionName,model,divGroup,element,this))return;return o=new PBSOption[optionName]({optionSettings:option,model:model,el:optionWrapper}),pbsParams.is_lite&&o.dummy&&o.el.classList.add("pbs-premium-flag"),_pbsCreatedViews.push(o.render()),o.optionSettings&&"function"==typeof o.optionSettings.visible&&(o.optionSettings.visible(o.model.get("element"))?o.$el.show():o.$el.hide()),divGroup.view=o,void this.applyOptionDependencies(o)}},function(){var ready=function(){wp.hooks.addAction("pbs.option.changed",function(){var i,option;for(i=0;i<_pbsCreatedViews.length;i++)(option=_pbsCreatedViews[i]).optionSettings&&"function"==typeof option.optionSettings.visible&&(option.optionSettings.visible(option.model.get("element"))?option.$el.fadeIn():option.$el.hide(),option.$el.parent().is(":visible")&&(option.$el.parent().find(".pbs-tool-option:not(.pbs-collapsable-title):visible").length?option.$el.parent().fadeIn():option.$el.parent().hide()))})};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),ContentTools.ToolboxPropertiesUI.prototype.applyOptionDependencies=function(view){var depends;view.optionSettings.depends&&("number"!=typeof(depends=view.optionSettings.depends).length&&(depends=[depends]),view.listenTo(view.model,"change",function(){var i,id,value,currentValue,makeVisible,k,brokenByUnmatch,onceMatched,allNegatives,text,matches,operator,num,allTrue,allConditions=[];for(i=0;i<depends.length;i++)if(depends[i].id&&depends[i].value){if(id=depends[i].id,value=depends[i].value,currentValue=this.model.get(id),makeVisible=!1,"string"==typeof value&&("__not_empty"===value.toLowerCase().trim()||"__empty"===value.toLowerCase().trim()||value.match(/^(>=?|<=?|==|!=)(.*)/)||(value=[value])),!1===value||"string"==typeof value&&"false"===value.toLowerCase().trim())void 0===currentValue?makeVisible=!0:"string"==typeof currentValue&&"false"===currentValue.toLowerCase().trim()?makeVisible=!0:"string"==typeof currentValue&&""===currentValue.toLowerCase().trim()?makeVisible=!0:"boolean"!=typeof currentValue||currentValue?currentValue||(makeVisible=!0):makeVisible=!0;else if(!0===value||"string"==typeof value&&"true"===value.toLowerCase().trim())"string"==typeof currentValue&&"true"===currentValue.toLowerCase().trim()?makeVisible=!0:"boolean"==typeof currentValue&&currentValue?makeVisible=!0:currentValue&&(makeVisible=!0);else if("object"==typeof value&&"number"==typeof value.length){for(brokenByUnmatch=!1,onceMatched=!1,allNegatives=!0,k=0;k<value.length;k++)if(!value[k].match(/^!(.*)/)){allNegatives=!1;break}for(k=0;k<value.length;k++)if(value[k].match(/^!(.*)/)){if(text=value[k].match(/^!(.*)/),(text=text[1])===currentValue){brokenByUnmatch=!0;break}}else if(value[k]===currentValue){onceMatched=!0;break}allNegatives&&!brokenByUnmatch?makeVisible=!0:!brokenByUnmatch&&onceMatched&&(makeVisible=!0)}else"__not_empty"===value.toLowerCase().trim()?"string"==typeof currentValue&&""!==currentValue.trim()?makeVisible=!0:"boolean"==typeof currentValue&&currentValue&&(makeVisible=!0):"__empty"===value.toLowerCase().trim()?void 0===currentValue?makeVisible=!0:""===currentValue.trim()&&(makeVisible=!0):value.match(/^(>=?|<=?|==|!=)(.*)/)&&(operator=(matches=value.match(/^(>=?|<=?|==|!=)(.*)/))[1],num=(num=matches[2]).match(/\./)?parseFloat(num):parseInt(num,10),currentValue=void 0===currentValue?0:currentValue.match(/\./)?parseFloat(currentValue):parseInt(currentValue,10),makeVisible="<"===operator?currentValue<num:"<="===operator?currentValue<=num:">"===operator?currentValue>num:">="===operator?currentValue>=num:"!="===operator?currentValue!==num:currentValue===num);allConditions.push(makeVisible)}for(allTrue=!0,i=0;i<allConditions.length;i++)allConditions[i]||(allTrue=!1);allTrue?this.$el.fadeIn():this.$el.fadeOut()}),view.model.trigger("change",view.model))},ContentTools.ToolboxPropertiesUI.prototype.addGenericShortcodeOptions=function(divGroup,element){var view,keys,i,attributeName,note,hasOptions=!1;for(divGroup.classList.add("pbs-shortcode-generic"),keys=element.model.keys(),i=0;i<keys.length;i++)"content"!==(attributeName=keys[i])&&(view=new PBSOption.GenericOption({attribute:attributeName,model:element.model}),_pbsCreatedViews.push(view.render()),divGroup.appendChild(view.el),hasOptions=!0);element.model.get("content")&&(view=new PBSOption.GenericOption({attribute:"content",model:element.model}),_pbsCreatedViews.push(view.render()),divGroup.appendChild(view.el),hasOptions=!0),hasOptions||((note=document.createElement("DIV")).innerHTML=pbsParams.labels.shortcodes_not_attributes_detected,note.classList.add("pbs-shortcode-no-options"),divGroup.appendChild(note))},ContentTools.ToolboxPropertiesUI.prototype._addSection=function(domElement){var currElem,i,k,group,heading,label,currDomElement,matchedPattern,pattern,root,element,hierarchy,finishedClasses,elem,note,finishedElemTypes,currElemModel,elemType,groupClasses,shortcodeProperties,shortcodeBase,doneTypes=[];if(this._previouslySelectedElement!==domElement){if(this._newGroups=[],this._currentGroupIndex=0,void 0===this._oldGroups&&(this._oldGroups=[],ContentTools.EditorApp.get().bind("start",function(){this._oldGroups=[]}.bind(this))),this._previouslySelectedElement=domElement,void 0===this._domInspectorGroups&&(this._domInspectorGroups=[]),domElement){for(currDomElement=null;domElement;){if(domElement.tagName&&"DIV"!==domElement.tagName&&window.pbsSelectorMatches(domElement,'[data-name="main-content"] *')){currDomElement=domElement;break}domElement=domElement.parentNode}if(matchedPattern="",label="",currDomElement)for(pattern in PBSInspectorOptions)if(PBSInspectorOptions.hasOwnProperty(pattern))try{window.pbsSelectorMatches(domElement,pattern)&&(matchedPattern=pattern)}catch(err){}if(matchedPattern)for(PBSInspectorOptions[matchedPattern].label&&(label=PBSInspectorOptions[matchedPattern].label),label||(label=matchedPattern),(group=this.constructor.createDiv(["ct-tool-group","pbs-inspector-group","pbs-dom-group"])).groupType=matchedPattern,(heading=document.createElement("DIV")).classList.add("pbs-group-title"),heading.classList.add("pbs-collapsable-title"),heading.classList.add("pbs-dom-title"),heading.innerHTML=pbsParams.labels.inspector_title.replace("%s",label),group.insertBefore(heading,group.firstChild),wp.hooks.doAction("inspector.group_title.create",group),this.placeGroup(group),currElemModel=new Backbone.Model({element:currDomElement}),i=0;i<PBSInspectorOptions[matchedPattern].options.length;i++)this.addSectionOptions(group,PBSInspectorOptions[matchedPattern].options[i],currDomElement,currElemModel)}if(root=ContentEdit.Root.get(),element=root.focused()){for(currElem=element,hierarchy=[],finishedClasses=[];currElem&&"Region"!==currElem.constructor.name;)-1===finishedClasses.indexOf(currElem.constructor.name)&&(hierarchy.push(currElem),finishedClasses.push(currElem.constructor.name)),currElem=currElem.parent();for(i=0;i<hierarchy.length;i++)if("DivRow"===hierarchy[i].constructor.name){elem=hierarchy[i],hierarchy.splice(i,1),hierarchy.push(elem);break}for(i=0;i<hierarchy.length;i++)if("DivCol"===hierarchy[i].constructor.name){elem=hierarchy[i],hierarchy.splice(i,1),hierarchy.push(elem);break}for(finishedElemTypes=[],i=0;i<hierarchy.length;i++)if(currElem=hierarchy[i],elemType=currElem.constructor.name,elemType=wp.hooks.applyFilters("pbs.inspector.elemtype",elemType,currElem),-1===finishedElemTypes.indexOf(elemType)){if(finishedElemTypes.push(elemType),"Shortcode"===elemType)label=(label=currElem._domElement.getAttribute("data-base")).replace(/[-_]/g," ").replace(/\b[a-z]/g,function(letter){return letter.toUpperCase()}),void 0===PBSInspectorOptions.Shortcode[currElem.sc_base]&&void 0!==pbsParams.shortcode_mappings&&void 0!==pbsParams.shortcode_mappings[currElem.sc_base]&&this.createShortcodeMappingOptions&&this.createShortcodeMappingOptions(currElem.sc_base),void 0!==PBSInspectorOptions.Shortcode[currElem.sc_base]&&void 0!==PBSInspectorOptions.Shortcode[currElem.sc_base].label&&(label=PBSInspectorOptions.Shortcode[currElem.sc_base].label);else{if(void 0===PBSInspectorOptions[elemType]||-1!==doneTypes.indexOf(elemType))continue;label=currElem.typeName(),PBSInspectorOptions[elemType].label&&(label=PBSInspectorOptions[elemType].label)}if(groupClasses=["ct-tool-group","pbs-inspector-group","pbs-"+currElem.cssTypeName()+"-group"],"Shortcode"===elemType&&groupClasses.push("pbs-shortcode-"+currElem.sc_base+"-group"),group=this.constructor.createDiv(groupClasses),group.groupType=elemType,(heading=document.createElement("DIV")).classList.add("pbs-group-title"),heading.classList.add("pbs-collapsable-title"),heading.classList.add("pbs-"+currElem.cssTypeName()+"-title"),heading.innerHTML=pbsParams.labels.inspector_title.replace("%s",label),group.insertBefore(heading,group.firstChild),wp.hooks.doAction("inspector.group_title.create",group),this.placeGroup(group),"Shortcode"===elemType){if(shortcodeBase=currElem.sc_base,void 0!==(shortcodeProperties=PBSInspectorOptions.Shortcode[shortcodeBase])&&"string"!==shortcodeProperties.hidden&&shortcodeProperties.hidden)continue;if(void 0!==shortcodeProperties&&void 0!==shortcodeProperties.options){for(k=0;k<shortcodeProperties.options.length;k++)this.addSectionOptions(group,shortcodeProperties.options[k],currElem);shortcodeProperties.desc&&(heading.innerHTML+="<span>"+shortcodeProperties.desc+"</span>"),shortcodeProperties.options.length||((note=document.createElement("DIV")).innerHTML=pbsParams.labels.no_attributes_available,note.classList.add("pbs-shortcode-no-options"),group.appendChild(note))}else this.addGenericShortcodeOptions(group,currElem),heading.innerHTML+="<span>"+pbsParams.labels.note_options_are_detected+"</span>";(note=document.createElement("DIV")).classList.add("pbs-inspector-shortcode-note"),note.innerHTML=pbsParams.labels.note_shortcode_not_appearing,group.appendChild(note)}else{if(void 0===PBSInspectorOptions[elemType]||-1!==doneTypes.indexOf(elemType))continue;for(currElem.model?(currElemModel=currElem.model).set("element",currElem):currElemModel=new Backbone.Model({element:currElem}),k=0;k<PBSInspectorOptions[elemType].options.length;k++)this.addSectionOptions(group,PBSInspectorOptions[elemType].options[k],currElem,currElemModel);void 0!==PBSInspectorOptions[elemType].footer&&Math.random()>.5&&((note=document.createElement("DIV")).innerHTML=PBSInspectorOptions[elemType].footer,note.classList.add("pbs-group-footer"),group.appendChild(note)),wp.hooks.doAction("pbs.inspector.add_section",group,label)}}for(this.clearOldGroups();this._newGroups.length;)this._oldGroups.push(this._newGroups.pop())}}},ContentTools.ToolboxPropertiesUI.prototype.clearOldGroups=function(){var i,oldGroup;for(i=0;i<this._oldGroups.length;i++)(oldGroup=this._oldGroups[i]).view,oldGroup.style.height=window.getComputedStyle(oldGroup).height,oldGroup.style.webkitTransition="height .3s ease-in-out",oldGroup.style.mozTransition="height .3s ease-in-out",oldGroup.style.msTransition="height .3s ease-in-out",oldGroup.style.transition="height .3s ease-in-out",oldGroup.style.overflow="hidden",oldGroup.offsetHeight,oldGroup.style.height=0,oldGroup.addEventListener("transitionend",function transitionEnd(event){"height"===event.propertyName&&(this.removeEventListener("transitionend",transitionEnd,!1),void 0!==this.view&&this.view.remove(),this.parentNode.removeChild(this))}.bind(oldGroup),!1),setTimeout(function(){void 0!==this.view&&this.view.remove(),this.parentNode&&this.parentNode.removeChild(this)}.bind(oldGroup),350);this._oldGroups=[]},ContentTools.ToolboxPropertiesUI.prototype.clearSections=function(){for(var o,elemToRemove;_pbsCreatedViews.length>0;)(o=_pbsCreatedViews.pop())&&o.remove();if(this._domInspectorGroups)for(;this._domInspectorGroups.length;)(elemToRemove=this._domInspectorGroups.shift()).parentNode.removeChild(elemToRemove);this._previouslySelectedElement=null},ContentTools.ToolboxPropertiesUI.prototype.placeGroup=function(group){var i,oldGroup,startHeight;for(this._newGroups.push(group),i=0;i<this._oldGroups.length;i++)if((oldGroup=this._oldGroups[i]).groupType===group.groupType)return startHeight=getComputedStyle(oldGroup).height,group.style.overflow="hidden",group.style.height=startHeight,void 0!==oldGroup.view&&oldGroup.view.remove(),this._domElement.replaceChild(group,oldGroup),this._currentGroupIndex=i+1,this._oldGroups.splice(i,1),void setTimeout(function(){var endHeight,didTransition;this.style.height="auto",endHeight=getComputedStyle(this).height,this.classList.contains("pbs-collapse")&&(endHeight=getComputedStyle(this.querySelector(".pbs-group-title")).height),this.style.height=startHeight,this.offsetHeight,this.style.webkitTransition="height .3s ease-in-out",this.style.mozTransition="height .3s ease-in-out",this.style.msTransition="height .3s ease-in-out",this.style.transition="height .3s ease-in-out",this.style.overflow="hidden",this.style.height=endHeight,didTransition=!1,this.addEventListener("transitionend",function transitionEnd(event){"height"===event.propertyName&&(this.style.webkitTransition="",this.style.mozTransition="",this.style.msTransition="",this.style.transition="",this.classList.contains("pbs-collapse")||(this.style.height="auto",this.style.overflow="visible"),didTransition=!0,this.removeEventListener("transitionend",transitionEnd,!1))},!1),setTimeout(function(){!didTransition&&this&&(this.classList.contains("pbs-collapse")||(this.style.height="auto",this.style.overflow="visible"))}.bind(this),350)}.bind(group),1);group.style.height=0,group.style.overflow="hidden",this._domElement.insertBefore(group,this._domElement.querySelectorAll(".ct-tool-group")[this._currentGroupIndex+1]),this._currentGroupIndex++,setTimeout(function(){var endHeight;this.style.height="auto",endHeight=getComputedStyle(this).height,this.classList.contains("pbs-collapse")&&(endHeight=getComputedStyle(this.querySelector(".pbs-group-title")).height),this.style.height=0,this.offsetHeight,this.style.webkitTransition="height .3s ease-in-out",this.style.mozTransition="height .3s ease-in-out",this.style.msTransition="height .3s ease-in-out",this.style.transition="height .3s ease-in-out",this.style.overflow="hidden",this.style.height=endHeight,this.addEventListener("transitionend",function transitionEnd(event){"height"===event.propertyName&&(this.style.webkitTransition="",this.style.mozTransition="",this.style.msTransition="",this.style.transition="",this.classList.contains("pbs-collapse")||(this.style.height="auto",this.style.overflow="visible"),this.removeEventListener("transitionend",transitionEnd,!1))},!1)}.bind(group),1)},window.pbsElementsWithInspector=[],window.pbsAddInspector=function(elemName,args){var i,argName,options,container=PBSInspectorOptions;if("object"==typeof args)if("object"!=typeof elemName)if(void 0!==args.is_shortcode&&args.is_shortcode?container=PBSInspectorOptions.Shortcode:-1===window.pbsElementsWithInspector.indexOf(elemName)&&window.pbsElementsWithInspector.push(elemName),void 0!==container[elemName]){for(argName in args)if(args.hasOwnProperty(argName))if("options"!==argName)container[elemName][argName]=args[argName];else for(options=args[argName],i=0;i<options.length;i++)container[elemName].options.push(options[i])}else container[elemName]=args;else for(i=0;i<elemName.length;i++)window.pbsAddInspector(elemName[i],args)},window.pbsRemoveInspector=function(elemName){var i,container=PBSInspectorOptions;if("object"!=typeof elemName)void 0!==PBSInspectorOptions.Shortcode[elemName]&&(container=PBSInspectorOptions.Shortcode),void 0!==container[elemName]&&delete container[elemName];else for(i=0;i<elemName.length;i++)window.pbsRemoveInspector(elemName[i])},window.pbsElementActionButtons=[],window.pbsAddActionButtons=function(elemName,args){var i=0;if("object"==typeof args)if(window.pbsElementActionButtons[elemName]||(window.pbsElementActionButtons[elemName]=[]),Array.isArray(args))for(i=0;i<args.length;i++)void 0===args[i].priority&&(args[i].priority=10),window.pbsElementActionButtons[elemName].push(args[i]);else void 0===args.priority&&(args.priority=10),window.pbsElementActionButtons[elemName].push(args)},window.pbsRemoveActionButtons=function(elemName,actionName){var i;if(window.pbsElementActionButtons[elemName])for(i=0;i<window.pbsElementActionButtons[elemName].length;i++)if(window.pbsElementActionButtons[elemName].name&&window.pbsElementActionButtons[elemName].name===actionName){window.pbsElementActionButtons[elemName].splice(i,1);break}},pbsParams.additional_shortcodes)for(elemName in pbsParams.additional_shortcodes)pbsParams.additional_shortcodes.hasOwnProperty(elemName)&&(PBSInspectorOptions.Shortcode[elemName]=pbsParams.additional_shortcodes[elemName]);window.pbsCollapseSection=function(section){var openSections,prevHeight,endHeight;section.classList.contains("pbs-collapse")?(section.getAttribute("data-collapse-group")&&(openSections=document.querySelectorAll('[data-collapse-group="'+section.getAttribute("data-collapse-group")+'"]:not(.pbs-collapse)'),Array.prototype.forEach.call(openSections,function(el){window.pbsCollapseSection(el)})),prevHeight=section.style.height,section.style.height="auto",endHeight=getComputedStyle(section).height,section.style.height=prevHeight,section.offsetHeight,section.style.webkitTransition="height .3s ease-in-out",section.style.mozTransition="height .3s ease-in-out",section.style.msTransition="height .3s ease-in-out",section.style.transition="height .3s ease-in-out",section.style.overflow="hidden",section.style.height=endHeight,section.addEventListener("transitionend",function transitionEnd(event){"height"===event.propertyName&&(section.style.webkitTransition="",section.style.mozTransition="",section.style.msTransition="",section.style.transition="",section.style.height="auto",section.style.overflow="visible",section.removeEventListener("transitionend",transitionEnd,!1))},!1),section.classList.remove("pbs-collapse"),section.getAttribute("class").replace(/\s*(ct-tool-group|pbs-collapse|pbs-inspector-group)\s*/g,"")):(section.style.height=window.getComputedStyle(section).height,section.style.webkitTransition="height .3s ease-in-out",section.style.mozTransition="height .3s ease-in-out",section.style.msTransition="height .3s ease-in-out",section.style.transition="height .3s ease-in-out",section.style.overflow="hidden",section.offsetHeight,section.style.height="38px",section.addEventListener("transitionend",function transitionEnd(event){"height"===event.propertyName&&section.removeEventListener("transitionend",transitionEnd,!1)},!1),section.classList.add("pbs-collapse"),section.getAttribute("class").replace(/\s*(ct-tool-group|pbs-collapse|pbs-inspector-group)\s*/g,""))},window.pbsOpenAllSections=function(){var sections=document.querySelectorAll(".ct-tool-group");Array.prototype.forEach.call(sections,function(el){el.classList.contains("pbs-collapse")&&window.pbsCollapseSection(el)})},window.pbsOnlyOpenSection=function(sectionClass){var sections=document.querySelectorAll(".ct-tool-group");Array.prototype.forEach.call(sections,function(el){sectionClass&&el.classList.contains(sectionClass)?el.classList.contains("pbs-collapse")&&window.pbsCollapseSection(el):el.classList.contains("pbs-collapse")||window.pbsCollapseSection(el)})},function(){var ready=function(){document.querySelector('[data-name="main-content"]')&&document.addEventListener("click",function(ev){var section=ev.target;if(ev.target.classList&&!ev.target.classList.contains("pbs-collapsable-title")){if(!ev.target.parentNode)return;if(!ev.target.parentNode.classList)return;if(!ev.target.parentNode.classList.contains("pbs-collapsable-title"))return;section=ev.target.parentNode.parentNode}else section=ev.target.parentNode;window.pbsCollapseSection(section)})};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),function(){var proxied=ContentTools.Tools.Remove.apply;ContentTools.Tools.Remove.apply=function(element,selection,callback){document.activeElement&&-1!==["INPUT","TEXTAREA"].indexOf(document.activeElement.tagName)||proxied.call(element,selection,callback)}}();var PBSOption={},PBSBaseView=Backbone.View.extend({initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.optionSettings.initialize&&this.optionSettings.initialize(this.model.get("element"),this),this.optionSettings.visible&&(this._visibleBound=this._visible.bind(this),wp.hooks.addAction("pbs.option.changed",this._visibleBound),this._visible()),Backbone.View.prototype.initialize.call(this,options)},_visible:function(){this.optionSettings.visible(this.model.get("element"))?this.$el.show():this.$el.hide()},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return data.value="",this.optionSettings.value?data.value=this.optionSettings.value(this.model.get("element")):this.optionSettings.id&&(data.value=this.model.get(this.optionSettings.id)),this.$el.html()?this.$el.find('input[type="text"]').val()!==data.value&&this.$el.find('input[type="text"]').val(data.value):this.$el.html(this.template(data)),this},remove:function(){this.optionSettings.visible&&wp.hooks.removeAction("pbs.option.changed",this._visibleBound),Backbone.View.prototype.remove.apply(this)}});PBSOption.widgetSettings=Backbone.View.extend({className:"pbs-tool-option",events:{"change input":"attributeChanged","keyup input":"attributeChanged","change textarea":"attributeChanged","keyup textarea":"attributeChanged",'click input[type="radio"]':"attributeChanged",'click input[type="checkbox"]':"attributeChanged","change select":"attributeChanged","keyup select":"attributeChanged"},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.attribute=_.clone(options.attribute),void 0===this.model.attributes.widget&&(this.model.attributes.widget="WP_Widget_Text"),this.template=wp.template("pbs-widget-"+this.model.attributes.widget)},render:function(){var attributeName,widgetInfo,option,fields,data=_.extend({},this.model.attributes,this.optionSettings);this.$el.html(this.template(data)),widgetInfo=pbsParams.widget_list[this.model.attributes.widget];for(attributeName in this.model.attributes)this.model.attributes.hasOwnProperty(attributeName)&&(option=this.el.querySelector("#widget-"+widgetInfo.id_base+"--"+attributeName))&&("TEXTAREA"===option.tagName?option.value=this.model.attributes[attributeName].replace(/<br>/g,"\n"):"INPUT"===option.tagName&&"checkbox"===option.getAttribute("type")?this.model.attributes[attributeName]&&(option.checked=!0):option.value=this.model.attributes[attributeName]);return fields=this.el.querySelectorAll("[id^=widget-"+widgetInfo.id_base+"--]"),Array.prototype.forEach.call(fields,function(el){this.attributeChanged({target:el})}.bind(this)),this},attributeChanged:function(e){var widgetInfo=pbsParams.widget_list[this.model.attributes.widget],attribute=e.target.getAttribute("id").replace("widget-"+widgetInfo.id_base+"--","");"INPUT"===e.target.tagName&&"checkbox"===e.target.getAttribute("type")?this.model.set(attribute,e.target.checked?e.target.value:""):this.model.set(attribute,e.target.value)}}),PBSOption.Button=PBSBaseView.extend({events:{click:"click",mouseenter:"mouseenter",mouseleave:"mouseleave",mousedown:"mousedown",mouseup:"mouseup"},initialize:function(options){PBSBaseView.prototype.initialize.call(this,options),this.attribute=_.clone(options.attribute),this._canApplyUpdater()},render:function(){return this.optionSettings.name&&this.el.setAttribute("data-tooltip",this.optionSettings.name),this.optionSettings.render&&this.optionSettings.render(this.model.get("element"),this),this._tooltipUpdater(),this._isAppliedUpdater(),this._canApplyUpdater(),this},click:function(){this.el.classList.contains("ct-tool--disabled")||(this.optionSettings.click&&this.optionSettings.click(this.model.get("element"),this),this._tooltipUpdater(),this._isAppliedUpdater(),this._canApplyUpdater(),this._selectedElement&&this._selectedElement.restoreState&&this._selectedElement.restoreState())},updateTooltip:function(value){if(value||(value=""),window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown){if(this.optionSettings["tooltip-reset"])return void this.el.setAttribute("data-tooltip",this.optionSettings["tooltip-reset"].replace("{0}",value))}else if(window.PBSEditor.isCtrlDown){if(this.optionSettings["tooltip-down"])return void this.el.setAttribute("data-tooltip",this.optionSettings["tooltip-down"].replace("{0}",value))}else if(this.optionSettings.tooltip)return void this.el.setAttribute("data-tooltip",this.optionSettings.tooltip.replace("{0}",value));this.optionSettings.tooltip?this.el.setAttribute("data-tooltip",this.optionSettings.tooltip):this.optionSettings.name&&this.el.setAttribute("data-tooltip",this.optionSettings.name)},_tooltipUpdater:function(){this.optionSettings.tooltipValue&&this.model.get("element")?this.updateTooltip(this.optionSettings.tooltipValue(this.model.get("element"),this)):this.updateTooltip()},updateIsApplied:function(value){this.el.classList.remove("ct-tool--applied"),value&&this.el.classList.add("ct-tool--applied")},_canApplyUpdater:function(){this.el.classList.remove("ct-tool--disabled"),this.optionSettings.canApply&&this.model.get("element")&&this.model.get("element")._domElement&&(this.optionSettings.canApply(this.model.get("element"),this)||this.el.classList.add("ct-tool--disabled"))},_isAppliedUpdater:function(){this.optionSettings.isApplied&&this.model.get("element")&&this.model.get("element")._domElement&&this.updateIsApplied(this.optionSettings.isApplied(this.model.get("element"),this))},mouseenter:function(){this.optionSettings.mouseenter&&this.model.get("element")&&this.model.get("element")._domElement&&this.optionSettings.mouseenter(this.model.get("element"),this),this.optionSettings.hold&&(clearTimeout(this._holdTimeout),clearInterval(this._holdInterval)),this.model.get("element")&&this.model.get("element")._domElement&&this.model.get("element")._domElement.classList.add("ce-element--over"),this._tooltipUpdaterInterval=setInterval(this._tooltipUpdater.bind(this),100)},mouseleave:function(){this.optionSettings.mouseleave&&this.model.get("element")&&this.model.get("element")._domElement&&this.optionSettings.mouseleave(this.model.get("element"),this),this.optionSettings.hold&&(clearTimeout(this._holdTimeout),clearInterval(this._holdInterval)),this.model.get("element")&&this.model.get("element")._domElement&&this.model.get("element")._domElement.classList.remove("ce-element--over"),clearInterval(this._tooltipUpdaterInterval)},mousedown:function(){var selectedElement=ContentEdit.Root.get().focused();selectedElement&&selectedElement.storeState&&selectedElement.storeState(),selectedElement&&(this._selectedElement=selectedElement),this.optionSettings.hold&&(clearTimeout(this._holdTimeout),clearInterval(this._holdInterval),this._holdTimeout=setTimeout(function(){this._holdInterval=setInterval(function(){this.optionSettings.hold(this.model.get("element"),this),this._tooltipUpdater(),this._isAppliedUpdater()}.bind(this),30)}.bind(this),500))},mouseup:function(){this.optionSettings.hold&&(clearTimeout(this._holdTimeout),clearInterval(this._holdInterval))}}),PBSOption.GenericOption=Backbone.View.extend({template:wp.template("pbs-shortcode-generic-option"),className:"pbs-tool-option",events:{"change input":"attributeChanged","keyup input":"attributeChanged","change textarea":"attributeChanged","keyup textarea":"attributeChanged"},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.attribute=_.clone(options.attribute),"content"===this.attribute&&(this.template=wp.template("pbs-shortcode-generic-content"))},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return data.value=this.model.get(this.attribute),data.attr=this.attribute,this.$el.html(this.template(data)),this},attributeChanged:function(e){this.model.set(this.attribute,e.target.value)}}),PBSOption.Border=Backbone.View.extend({template:wp.template("pbs-option-border"),events:{"change select":"styleChanged","change .width":"widthChanged","keyup .width":"widthChanged","change .radius":"radiusChanged","keyup .radius":"radiusChanged","click .pbs-color-preview":"togglePicker","change .pbs-color-popup input":"colorChanged","keyup .pbs-color-popup input":"colorChanged"},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.randomID=this.optionSettings.id+"-"+_.random(0,1e4),this._hidePickerBound=this.hidePicker.bind(this),document.querySelector(".ct-toolbox").addEventListener("mouseleave",this._hidePickerBound)},render:function(){var _this,i,styles,stylesToAdd,data=_.extend({},this.model.attributes,this.optionSettings);for(data.id=this.randomID,styles=window.getComputedStyle(this.model.get("element")._domElement),stylesToAdd=["border-color","border-style","border-width","border-radius"],i=0;i<stylesToAdd.length;i++)this.model.set(stylesToAdd[i],styles[stylesToAdd[i]],{silent:!0});return this.$el.html(this.template(data)),_this=this,jQuery("#"+this.randomID).iris({defaultColor:!0,change:function(){_this.colorChanged()},clear:function(){},hide:!1,palettes:["#282425","#3d3a3b","#555152","#6b6969","#838181","#9b999a","#b4b1b2","#cccbcb","#e5e4e4","#ffffff","#fd3d3f","#f70363","#eb389a","#a812a9","#7330b0","#4b4bae","#1490ec","#00a4ed","#00bacf","#009586","#e1d6b8","#5b7b88","#7c554a","#fe5234","#fe9631","#fec03b","#fbec57","#c2dd52","#75c457","#12b059"]}),this},remove:function(){jQuery("#"+this.randomID).iris("destroy"),document.querySelector(".ct-toolbox").removeEventListener("mouseleave",this._hidePickerBound),Backbone.View.prototype.remove.call(this)},colorChanged:function(){var inputColor=this.el.querySelector(".pbs-color-popup input").value,color=jQuery(this.el.querySelector("#"+this.randomID)).iris("color");"transparent"!==inputColor&&""!==inputColor||(color=inputColor),this.model.get("element").style("border-color",color),"transparent"===color&&(color=""),this.el.querySelector(".pbs-color-preview .pbs-color-preview-color").style.background=color},styleChanged:function(e){var newBorder,allBordersZero;this.model.get("element").style("border-style",e.target.value),newBorder="0px","none"!==e.target.value&&(newBorder="1px"),allBordersZero=!0,parseInt(this.model.get("border-top-width"),10)&&(allBordersZero=!1),parseInt(this.model.get("border-right-width"),10)&&(allBordersZero=!1),parseInt(this.model.get("border-bottom-width"),10)&&(allBordersZero=!1),parseInt(this.model.get("border-left-width"),10)&&(allBordersZero=!1),(allBordersZero&&"none"!==e.target.value||"none"===e.target.value)&&(this.model.set("border-top-width",newBorder),this.model.set("border-right-width",newBorder),this.model.set("border-bottom-width",newBorder),this.model.set("border-left-width",newBorder),this.model.get("element").style("border-width",newBorder),this.model.trigger("change",this.model))},widthChanged:function(e){var value=e.target.value;isNaN(value)||""===value.trim()||(value+="px"),this.model.get("element").style("border-width",value)},radiusChanged:function(e){var value=e.target.value;isNaN(value)||""===value.trim()||(value+="px"),this.model.get("element").style("border-radius",value)},togglePicker:function(){"block"===this.el.querySelector(".pbs-color-popup").style.display?this.el.querySelector(".pbs-color-popup").style.display="":this.el.querySelector(".pbs-color-popup").style.display="block"},hidePicker:function(){this.el.querySelector(".pbs-color-popup").style.display=""}}),PBSOption.Color=PBSBaseView.extend({template:wp.template("pbs-option-color"),events:{mouseenter:"mouseenter",mouseleave:"mouseleave","change input":"selectChanged","keyup input":"selectChanged","click .pbs-color-preview":"togglePicker","mousedown .iris-square-handle":"mousedownPicker","mouseup .iris-square-handle":"mouseupPicker","click .iris-square-handle":"irisHandleClick"},initialize:function(options){PBSBaseView.prototype.initialize.call(this,options),this.randomID=this.optionSettings.id+"-"+_.random(0,1e4),this.optionSettings.value&&this.model.set(this.optionSettings.id,this.optionSettings.value(this.model.get("element"))),this._hidePickerBound=this.hidePicker.bind(this),document.querySelector(".ct-toolbox").addEventListener("mouseleave",this._hidePickerBound),this._canApplyUpdater()},_canApplyUpdater:function(){this.el.classList.remove("ct-tool--disabled"),this.optionSettings.canApply&&(this.optionSettings.canApply(this.model.get("element"),this)||this.el.classList.add("ct-tool--disabled"))},updateColor:function(color){this.el.querySelector(".pbs-color-preview-color").style.background!==color&&(this.el.querySelector(".pbs-color-preview-color").style.background=color,this.el.querySelector("input").value=color,jQuery("#"+this.randomID).iris("color",color))},irisHandleClick:function(ev){ev.preventDefault()},render:function(){var _this,data=_.extend({},this.model.attributes,this.optionSettings);return data.id=this.randomID,this.optionSettings.value?data.value=this.optionSettings.value(this.model.get("element")):this.optionSettings.id&&(data.value=this.model.get(this.optionSettings.id)),this.$el.html(this.template(data)),_this=this,jQuery("#"+this.randomID).iris({defaultColor:!0,change:function(){_this._justInit?_this.selectChanged():_this._justInit=!0},clear:function(){},hide:!1,palettes:["#282425","#3d3a3b","#555152","#6b6969","#838181","#9b999a","#b4b1b2","#cccbcb","#e5e4e4","#ffffff","#fd3d3f","#f70363","#eb389a","#a812a9","#7330b0","#4b4bae","#1490ec","#00a4ed","#00bacf","#009586","#e1d6b8","#5b7b88","#7c554a","#fe5234","#fe9631","#fec03b","#fbec57","#c2dd52","#75c457","#12b059"]}),this._canApplyUpdater(),this},remove:function(){jQuery("#"+this.randomID).iris("destroy"),document.querySelector(".ct-toolbox").removeEventListener("mouseleave",this._hidePickerBound),PBSBaseView.prototype.remove.call(this)},selectChanged:function(forceColor){var input=this.el.querySelector("input"),color=jQuery(input).iris("color");forceColor&&(color=input.value),""!==input.value&&"transparent"!==input.value||(color=input.value),this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),color,this),this.optionSettings.id&&this.model.set(this.optionSettings.id,color),"transparent"===color&&(color=""),this.el.querySelector(".pbs-color-preview-color").style.background=color,wp.hooks.doAction("pbs.option.changed")},togglePicker:function(){var input,popup,otherPopups;if(window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown)return input=this.el.querySelector("input"),input.value="",this.selectChanged(),void jQuery("#"+this.randomID).iris("color","transparent");popup=this.el.querySelector(".pbs-color-popup"),otherPopups=document.querySelectorAll(".pbs-color-popup"),Array.prototype.forEach.call(otherPopups,function(el){el!==popup&&(el.style.display="")}),"block"===popup.style.display?popup.style.display="":(popup.style.display="block",this.$el.find('input[type="text"]').select())},hidePicker:function(){this.el.querySelector(".pbs-color-popup").style.display=""},mouseenter:function(){this.optionSettings.mouseenter&&this.optionSettings.mouseenter(this.model.get("element"),this)},mouseleave:function(){this.optionSettings.mouseleave&&this.optionSettings.mouseleave(this.model.get("element"),this)},mousedownPicker:function(){ContentTools.EditorApp.get().history.stopWatching()},mouseupPicker:function(){ContentTools.EditorApp.get().history.watch()}}),PBSOption.ColorButton=PBSOption.Color.extend({}),PBSOption.Select=PBSBaseView.extend({template:wp.template("pbs-option-select"),events:{"change select":"selectChanged"},initialize:function(options){var value;PBSBaseView.prototype.initialize.call(this,options),this.listenTo(this.model,"change",this.render),this.optionSettings.value?this.model.set(this.optionSettings.id,this.optionSettings.value(this.model.get("element"))):(value=this.model.element.model.attributes[this.optionSettings.id]||"",this.model.set(this.optionSettings.id,value))},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return this.optionSettings.value?data.value=this.optionSettings.value(this.model.get("element"),this):data.value=this.model.element.model.attributes[this.optionSettings.id]||"",this.$el.html(this.template(data)),this},selectChanged:function(e){this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),e.target.value,this),this.model.set(this.optionSettings.id,e.target.value),wp.hooks.doAction("pbs.option.changed")}}),PBSOption.Checkbox=PBSBaseView.extend({template:wp.template("pbs-option-checkbox"),events:{"change input":"selectChanged"},initialize:function(options){PBSBaseView.prototype.initialize.call(this,options),void 0===this.optionSettings.checked&&(this.optionSettings.checked=!0),this.listenTo(this.model,"change",this.render),this.optionSettings.value&&this.model.set(this.optionSettings.id,this.optionSettings.value(this.model.get("element")))},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return data.value="",this.optionSettings.value?data.value=this.optionSettings.value(this.model.get("element")):this.optionSettings.id&&(data.value=this.model.get(this.optionSettings.id)),this.$el.html()?this.$el.find('input[type="checkbox"]')[0].checked=data.value===this.optionSettings.checked:this.$el.html(this.template(data)),this},selectChanged:function(e){var value=!1;this.optionSettings.unchecked&&(value=this.optionSettings.unchecked),e.target.checked&&(value=!0,this.optionSettings.checked&&(value=this.optionSettings.checked)),this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),value,this),this.model.set(this.optionSettings.id,value),wp.hooks.doAction("pbs.option.changed")},click:function(e){this.optionSettings.click&&this.optionSettings.click(this.model.get("element"),e.target.value)}}),PBSOption.Text=PBSBaseView.extend({template:wp.template("pbs-option-text"),events:{"change input":"selectChanged","keyup input":"selectChanged","click input":"click"},initialize:function(options){PBSBaseView.prototype.initialize.call(this,options),this.listenTo(this.model,"change",this.render),this.optionSettings.value&&this.model.set(this.optionSettings.id,this.optionSettings.value(this.model.get("element")))},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return data.value="",this.optionSettings.value?data.value=this.optionSettings.value(this.model.get("element")):this.optionSettings.id&&(data.value=this.model.get(this.optionSettings.id)),this.$el.html()?this.$el.find('input[type="text"]').val()!==data.value&&this.$el.find('input[type="text"]').val(data.value):this.$el.html(this.template(data)),this},selectChanged:function(e){this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),e.target.value,this),this.model.set(this.optionSettings.id,e.target.value),wp.hooks.doAction("pbs.option.changed")},click:function(e){this.optionSettings.click&&this.optionSettings.click(this.model.get("element"),e.target.value)}}),PBSOption.Textarea=PBSOption.Text.extend({template:wp.template("pbs-option-textarea"),events:{"change textarea":"selectChanged","keyup textarea":"selectChanged","click textarea":"click"}}),PBSOption.Link=PBSOption.Text.extend({template:wp.template("pbs-option-link"),events:{'click input[type="button"]':"click","change input":"selectChanged","keyup input":"selectChanged"},render:function(){var value,data=_.extend({},this.model.attributes,this.optionSettings);return data.value="",this.optionSettings.value?data.value=this.optionSettings.value(this.model.get("element")):this.optionSettings.id&&(data.value=this.model.get(this.optionSettings.id)),value="object"==typeof data.value?data.value.url:data.value,this.$el.html()?this.$el.find('input[type="text"]').val()!==value&&this.$el.find('input[type="text"]').val(value):this.$el.html(this.template(data)),this},click:function(){var value,target=null,url="";this.optionSettings.value?value=this.optionSettings.value(this.model.get("element")):this.optionSettings.id&&(value=this.model.get(this.optionSettings.id)),"object"==typeof value?(url=value.url,"undefined"!==value.target&&(target=value.target)):url=value,window.pbsLinkFrame.open({url:url,text:"",target:target,hasText:!1,hasNewWindow:"object"==typeof value&&"undefined"!==value.target},function(url,text,target){this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),url,target),this.$el.find('input[type="text"]').val(url)}.bind(this))}}),PBSOption.Number=PBSOption.Text.extend({template:wp.template("pbs-option-number"),initialize:function(options){PBSOption.Text.prototype.initialize.call(this,options),this.optionSettings.maxFunction&&(this._boundMaxUpdate=this.maxUpdate.bind(this),wp.hooks.addAction("pbs.option.changed",this._boundMaxUpdate))},maxUpdate:function(){var slider,input,left,min,newMax;this.optionSettings.maxFunction&&(newMax=this.optionSettings.maxFunction(this.model.get("element")),this.optionSettings.max!==newMax&&(this.optionSettings.max=newMax,this.$el.html()&&(slider=this.$el.find(".pbs-option-number-slider"),(input=this.$el.find("input")).attr("max",this.optionSettings.max),slider.slider("option","max",this.optionSettings.max),(left=(parseFloat(input.val())-(min=parseFloat(input.attr("min"))))/(this.optionSettings.max-min)*100)>100&&(left=100),this.$el.find(".ui-slider-handle").css("left",left+"%"))))},render:function(){var slider,value,input;return this.maxUpdate(),this.$el.html()?(this.optionSettings.value&&(value=this.optionSettings.value(this.model.get("element")),slider=this.$el.find(".pbs-option-number-slider"),input=this.$el.find("input"),slider.slider("value").toString()!==value.toString()&&slider.slider("value",value),input.val(value)),this):(this.optionSettings.value&&(input=this.$el.find("input"),value=this.optionSettings.value(this.model.get("element")),input.val(value)),PBSOption.Number.__super__.render.call(this),input=this.$el.find("input"),this.$el.find(".pbs-option-number-slider").slider({range:"min",max:parseFloat(input.attr("max")),min:parseFloat(input.attr("min")),step:parseFloat(input.attr("step")),value:input.val(),animate:"fast",change:function(event,ui){clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(ui){var input=this.$el.find("input");ui.value!==parseFloat(input.val())&&input.val(ui.value).trigger("change")}.bind(this,ui),60)}.bind(this),slide:function(event,ui){clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(ui){var input=this.$el.find("input");ui.value!==parseFloat(input.val())&&input.val(ui.value).trigger("change")}.bind(this,ui),60)}.bind(this)}).disableSelection(),this)},selectChanged:function(e){var slider,input,inputVal;PBSOption.Number.__super__.selectChanged.call(this,e),slider=this.$el.find(".pbs-option-number-slider"),inputVal=(input=this.$el.find("input")).val(),"keyup"===e.type&&""!==inputVal&&slider.slider("value").toString()!==input.val().toString()&&slider.slider("value",input.val()),""===inputVal&&input.val(""),this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),inputVal,this),wp.hooks.doAction("pbs.option.changed")},remove:function(){this.optionSettings.maxFunction&&wp.hooks.removeAction("pbs.option.changed",this._boundMaxUpdate),PBSOption.Number.__super__.remove.call(this)}}),PBSOption.File=PBSOption.Text.extend({template:wp.template("pbs-option-file"),multiple:!1,events:{"change input":"selectChanged","click button":"openImagePicker"},openImagePicker:function(){var frame=wp.media({title:pbsParams.labels.s_attribute.replace("%s",this.optionSettings.name),multiple:this.multiple,button:{text:pbsParams.labels.select_file}});return frame.on("open",function(){}.bind(this)),frame.on("select",function(){var value="";frame.state().get("selection").each(function(attachment){void 0!==attachment.attributes.url&&(value=attachment.attributes.url)}.bind(this)),this.$el.find('input[type="text"]').val(value),this.model.set(this.optionSettings.id,value),this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),value,this),wp.hooks.doAction("pbs.option.changed"),frame.off("select")}.bind(this)),frame.open(),!1}}),PBSOption.Image=PBSOption.Text.extend({template:wp.template("pbs-option-image"),multiple:!1,events:{"change input":"selectChanged","click .pbs-image-preview":"openImagePicker","click .pbs-image-preview-remove":"removeImage"},render:function(){var ret,imageIDsToAjaxLoad,ajaxToGetImageURL=!1;return this.$el.html()||(ajaxToGetImageURL=!0),ret=PBSOption.Image.__super__.render.call(this),ajaxToGetImageURL&&(imageIDsToAjaxLoad="",this.$el.find('.pbs-image-preview:not([data-id=""])').each(function(){var imageID=this.getAttribute("data-id");imageID.match(/^[\d,]+$/)?PBSOption.Image._imageURLs.hasOwnProperty(imageID)?this.style.backgroundImage="url("+PBSOption.Image._imageURLs[imageID]+")":(imageIDsToAjaxLoad+=imageIDsToAjaxLoad?",":"",imageIDsToAjaxLoad+=imageID):this.style.backgroundImage=imageID.match(/url\(/)?imageID:"url("+imageID+")"}),imageIDsToAjaxLoad&&PBSOption.Image.doAjaxToGetImageURLs(imageIDsToAjaxLoad)),ret},openImagePicker:function(){var frame=wp.media({title:pbsParams.labels.s_attribute.replace("%s",this.optionSettings.name),multiple:this.multiple,library:{type:"image"},button:{text:pbsParams.labels.select_image}});return frame.on("open",function(){var i,selection,attachment,imageIDs=this.model.get(this.optionSettings.id)||"";for(imageIDs=imageIDs.split(","),selection=frame.state().get("selection"),i=0;i<imageIDs.length;i++)attachment=wp.media.attachment(imageIDs[i]),selection.add(attachment?[attachment]:[])}.bind(this)),frame.on("select",function(){var selection=frame.state().get("selection"),value="",attachmentURLs=[],attachmentIDs=[],useURLs=!1;this.$el.find(".pbs-image-preview").remove(),void 0!==this.optionSettings.urls&&this.optionSettings.urls&&(useURLs=!0),selection.each(function(attachment){var image;void 0!==attachment.attributes.sizes&&(image=attachment.attributes.sizes.full,void 0!==attachment.attributes.sizes.medium&&(image=attachment.attributes.sizes.medium),jQuery("<div></div>").addClass("pbs-image-preview").css("backgroundImage","url("+image.url+")").attr("data-id",attachment.id).attr("data-url",attachment.attributes.sizes.full.url).append(jQuery("<div></div>").addClass("pbs-image-preview-remove")).appendTo(this.$el),attachmentURLs.push(attachment.attributes.sizes.full.url),attachmentIDs.push(attachment.id),value+=value?",":"",value+=useURLs?attachment.attributes.sizes.full.url:attachment.id,PBSOption.Image._imageURLs[attachment.id]=image.url)}.bind(this)),this.model.set(this.optionSettings.id,value),this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),useURLs?attachmentURLs:attachmentIDs,useURLs?attachmentIDs:attachmentURLs,this),wp.hooks.doAction("pbs.option.changed"),frame.off("select")}.bind(this)),frame.open(),!1},removeImage:function(e){var value="",removeMe=e.target.parentNode.getAttribute("data-id"),useURLs=!1,attachmentIDs=[],attachmentURLs=[];return void 0!==this.optionSettings.urls&&this.optionSettings.urls&&(useURLs=!0),this.multiple&&this.$el.find(".pbs-image-preview").each(function(){this.getAttribute("data-id")!==removeMe&&(value+=value?",":"",value+=this.getAttribute("data-id"),attachmentIDs.push(this.getAttribute("data-id")),attachmentURLs.push(this.getAttribute("data-url")?this.getAttribute("data-url"):this.getAttribute("data-id")))}),e.target.parentNode.parentNode.removeChild(e.target.parentNode),(!this.multiple||this.multiple&&!this.$el.find(".pbs-image-preview").length)&&jQuery("<div></div>").addClass("pbs-image-preview").attr("data-id","").appendTo(this.$el),this.model.set(this.optionSettings.id,value),this.optionSettings.remove&&this.optionSettings.remove(this.model.get("element"),useURLs?attachmentURLs:attachmentIDs,this),wp.hooks.doAction("pbs.option.changed"),!1}}),PBSOption.Image._imageURLs={},PBSOption.Image.doAjaxToGetImageURLs=function(imageIDs){void 0===PBSOption.Image._imageIDsToAjax&&(PBSOption.Image._imageIDsToAjax=""),imageIDs.match(/^[\d,]+$/)&&(PBSOption.Image._imageIDsToAjax+=PBSOption.Image._imageIDsToAjax?",":"",PBSOption.Image._imageIDsToAjax+=imageIDs,clearTimeout(PBSOption.Image._doAjaxToGetImageURLsTimeout),PBSOption.Image._doAjaxToGetImageURLsTimeout=setTimeout(function(){PBSOption.Image._doAjaxToGetImageURLs()},50))},PBSOption.Image._doAjaxToGetImageURLs=function(){var i,payload,request,imageIDs=PBSOption.Image._imageIDsToAjax||"";for(imageIDs=imageIDs.split(","),i=0;i<imageIDs.length;i++)jQuery(".pbs-tool-option .pbs-image-preview[data-id="+imageIDs[i]+"]").addClass("pbs-loading");(payload=new FormData).append("action","pbs_get_attachment_urls"),payload.append("image_ids",PBSOption.Image._imageIDsToAjax),payload.append("nonce",pbsParams.nonce),(request=new XMLHttpRequest).open("POST",pbsParams.ajax_url),request.onload=function(){var i,response;if(request.status>=200&&request.status<400)try{for(response=JSON.parse(request.responseText),i=0;i<imageIDs.length;i++)void 0!==response[imageIDs[i]]?(jQuery(".pbs-tool-option .pbs-image-preview[data-id="+imageIDs[i]+"]").css("backgroundImage","url("+response[imageIDs[i]]+")"),PBSOption.Image._imageURLs[imageIDs[i]]=response[imageIDs[i]]):jQuery(".pbs-tool-option .pbs-image-preview[data-id="+imageIDs[i]+"]").addClass("pbs-ajax-error")}catch(e){for(i=0;i<imageIDs.length;i++)jQuery(".pbs-tool-option .pbs-image-preview[data-id="+imageIDs[i]+"]").addClass("pbs-ajax-error")}for(i=0;i<imageIDs.length;i++)jQuery(".pbs-tool-option .pbs-image-preview[data-id="+imageIDs[i]+"]").removeClass("pbs-loading");PBSOption.Image._imageIDsToAjax=""},request.onerror=function(){var i;for(i=0;i<imageIDs.length;i++)jQuery(".pbs-tool-option .pbs-image-preview[data-id="+imageIDs[i]+"]").removeClass("pbs-loading");PBSOption.Image._imageIDsToAjax=""},request.send(payload)},PBSOption.Images=PBSOption.Image.extend({multiple:"toggle"}),PBSOption.MarginsAndPaddings=Backbone.View.extend({template:wp.template("pbs-option-margins-and-paddings"),events:{"keyup input":"inputChanged","change input":"inputChanged","blur input":"fixBlankValue","keydown input":"incrementDecrementValue"},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.listenTo(this.model,"change",this.render)},render:function(){var i,data,element=this.model.get("element")._domElement,styles=window.getComputedStyle(element),stylesToAdd=["margin-top","margin-right","margin-bottom","margin-left","border-top-width","border-right-width","border-bottom-width","border-left-width","padding-top","padding-right","padding-bottom","padding-left"];for(i=0;i<stylesToAdd.length;i++)element.style[stylesToAdd[i]]?this.model.set(stylesToAdd[i],element.style[stylesToAdd[i]],{silent:!0}):this.model.set(stylesToAdd[i],styles[stylesToAdd[i]],{silent:!0});return"full-width-retain-content"===element.getAttribute("data-width")||"full-width"===element.getAttribute("data-width")?("full-width-retain-content"===this.model.get("width")?this.model.set("disableHorizontalPaddings",!0):this.model.unset("disableHorizontalPaddings"),"full-width-retain-content"===this.model.get("width")||"full-width"===this.model.get("width")?this.model.set("disableHorizontalMargins",!0):this.model.unset("disableHorizontalMargins")):(this.model.unset("disableHorizontalPaddings"),this.model.unset("disableHorizontalMargins")),data=_.extend({},this.model.attributes,this.optionSettings),this.$el.html(this.template(data)),this},inputChanged:function(e){var value=e.target.value,styleName=e.target.getAttribute("data-style");isNaN(value)||""===value.trim()||(value+="px"),this.model.get("element").style(styleName,value),this.model.set(styleName,value,{silent:!0})},incrementDecrementValue:function(e){var match=/^(\-?\d+)([^\d]*)$/.exec(e.target.value);!match||38!==e.which&&40!==e.which||(38===e.which?(match[1]++,(e.ctrlKey||e.metaKey||e.shiftKey)&&(match[1]++,match[1]++,match[1]++,match[1]++)):(match[1]--,(e.ctrlKey||e.metaKey||e.shiftKey)&&(match[1]--,match[1]--,match[1]--,match[1]--)),e.target.value=match[1]+match[2],e.target.dispatchEvent(new CustomEvent("change")))},fixBlankValue:function(e){var style=e.target.getAttribute("data-style"),styleCamel=style.replace(/-([a-z])/g,function(m,w){return w.toUpperCase()}),cssValue=this.model.get("element")._domElement.style[styleCamel];cssValue||(cssValue=window.getComputedStyle(this.model.get("element")._domElement)[style]),e.target.value=cssValue,this.model.set(style,cssValue,{silent:!0})}}),PBSOption.CustomClass=Backbone.View.extend({template:wp.template("pbs-option-text"),events:{"change input":"selectChanged","keyup input":"selectChanged"},getClasses:function(){var i,classes,currentClasses,staticClassRegex,element=this.model.get("element");if(void 0===element.attr("class"))return"";if(classes=element.attr("class"),this.optionSettings.ignoredClasses)for(currentClasses=classes.trim().split(" "),classes="",this.staticClasses=[],staticClassRegex=new RegExp(this.optionSettings.ignoredClasses,"i"),i=0;i<currentClasses.length;i++)staticClassRegex.test(currentClasses[i])?this.staticClasses.push(currentClasses[i]):(classes+=0===classes.length?"":" ",classes+=currentClasses[i]);return classes},change:function(element,value){var i,currentClasses,newClasses;if(value=value.toLowerCase(),void 0!==element.attr("class"))for(currentClasses=element.attr("class").split(" "),i=0;i<currentClasses.length;i++)element.removeCSSClass(currentClasses[i]);if(""!==value.trim())for(newClasses=value.trim().split(" "),i=0;i<newClasses.length;i++)element.addCSSClass(newClasses[i]);if(this.staticClasses.length)for(i=0;i<this.staticClasses.length;i++)element.addCSSClass(this.staticClasses[i]);element.taint()},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.staticClasses=[],this.optionSettings.initialize&&this.optionSettings.initialize(this.model.get("element"),this),this.listenTo(this.model,"change",this.render),this.model.set(this.optionSettings.id,this.getClasses(this.model.get("element")))},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return data.value=this.getClasses(this.model.get("element")),this.$el.html(this.template(data)),this},selectChanged:function(e){this.change(this.model.get("element"),e.target.value),this.model.set(this.optionSettings.id,e.target.value)}}),PBSOption.CustomID=Backbone.View.extend({template:wp.template("pbs-option-text"),events:{"change input":"selectChanged","keyup input":"selectChanged"},getID:function(){var element=this.model.get("element");return void 0===element.attr("id")?"":element.attr("id")},change:function(element,value){element.attr("id",value),element.taint()},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.staticClasses=[],this.optionSettings.initialize&&this.optionSettings.initialize(this.model.get("element"),this),this.listenTo(this.model,"change",this.render),this.model.set(this.optionSettings.id,this.getID(this.model.get("element")))},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return data.value=this.getID(this.model.get("element")),this.$el.html(this.template(data)),this},selectChanged:function(e){this.change(this.model.get("element"),e.target.value),this.model.set(this.optionSettings.id,e.target.value)}}),PBSOption.Button2=PBSBaseView.extend({template:wp.template("pbs-option-button2"),events:{'click input[type="button"]':"click"},render:function(){var data;return this.$el.html()||(data=_.extend({},this.model.attributes,this.optionSettings),this.$el.html(this.template(data))),this.optionSettings.disabled&&(this.optionSettings.disabled(this.model.get("element"),this)?this.$el.find('[type="button"]').removeAttr("disabled"):this.$el.find('[type="button"]').attr("disabled","disabled")),this},click:function(e){this.optionSettings.click&&this.optionSettings.click(this.model.get("element"),e.target.value,this)}}),PBSOption.Dummy=PBSBaseView.extend({dummy:!0,template:wp.template("pbs-dummy-option-text"),render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return this.$el.html()||this.$el.html(this.template(data)),this}}),PBSOption.TextDummy=PBSOption.Dummy.extend({template:wp.template("pbs-dummy-option-text")}),PBSOption.NumberDummy=PBSOption.Dummy.extend({template:wp.template("pbs-dummy-option-number")}),PBSOption.ColorDummy=PBSOption.Dummy.extend({template:wp.template("pbs-dummy-option-color")}),PBSOption.SelectDummy=PBSOption.Dummy.extend({template:wp.template("pbs-dummy-option-select")}),PBSOption.CheckboxDummy=PBSOption.Dummy.extend({template:wp.template("pbs-dummy-option-checkbox")}),PBSOption.Button2Dummy=PBSOption.Dummy.extend({template:wp.template("pbs-dummy-option-button2")}),PBSOption.ImageDummy=PBSOption.Dummy.extend({template:wp.template("pbs-dummy-option-image")}),PBSOption.TextareaDummy=PBSOption.Dummy.extend({template:wp.template("pbs-dummy-option-textarea")}),PBSOption.FileDummy=PBSOption.Dummy.extend({template:wp.template("pbs-dummy-option-file")});var options=[];options.push({name:pbsParams.labels.edit_image,button:pbsParams.labels.open_media_manager,type:"button2",class:"primary",group:pbsParams.labels.general,click:function(element){element.openMediaManager(function(){wp.hooks.doAction("pbs.option.changed")})}},{value:function(element){return{url:element.a?element.a.href||"":"",target:element.a?element.a.target||"":""}},change:function(element,url,target){element.a||(element.a={}),element.a.href=url,element.a.target=target?"_blank":""},name:pbsParams.labels.link,type:"link",placeholder:"http://",group:pbsParams.labels.general},{options:{alignleft:pbsParams.labels.left,aligncenter:pbsParams.labels.none_centered,alignright:pbsParams.labels.right},value:function(element){return element._domElement.classList.contains("alignleft")?"alignleft":element._domElement.classList.contains("alignright")?"alignright":"aligncenter"},change:function(element,value){element.removeCSSClass("alignleft"),element.removeCSSClass("alignright"),element.removeCSSClass("aligncenter"),element.removeCSSClass("alignnone"),element.addCSSClass(value)},name:pbsParams.labels.float,type:"select"},{name:pbsParams.labels.border_radius,type:"number",step:"1",min:"0",max:"1000",maxFunction:function(element){return parseInt(parseInt(element._domElement.getBoundingClientRect().height,10)/2+1,10)},value:function(element){var size=parseInt(element._domElement.style["border-radius"],10);return isNaN(size)?0:size},change:function(element,value){element.style("border-radius",value+"px")}},{name:pbsParams.labels.shadows,type:pbsParams.is_lite?"selectDummy":"select",group:pbsParams.labels.shadows},{name:pbsParams.labels.shadow_strength,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.shadows}),window.pbsAddInspector("Image",{label:pbsParams.labels.image,options:options}),(options=[]).push({name:pbsParams.labels.icon_frame_change_title,button:pbsParams.labels.pick_an_icon,type:"button2",class:"primary",group:pbsParams.labels.general,click:function(element){PBSEditor.iconFrame.open({title:pbsParams.labels.choose_icon,button:pbsParams.labels.choose_icon,successCallback:function(frameView){element.change(frameView.selected.firstChild)}})}},{name:pbsParams.labels.link,type:pbsParams.is_lite?"textDummy":"link",placeholder:"http://",desc:pbsParams.labels.desc_icon_url,group:pbsParams.labels.general},{name:pbsParams.labels.icon_color,type:"color",group:pbsParams.labels.general,value:function(element){return element._domElement.style.fill},change:function(element,value){element.removeFills(),element.setFill(value)}}),options.push({name:pbsParams.labels.background_color,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.general},{name:pbsParams.labels.padding,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.general,unit:pbsParams.labels.px},{name:pbsParams.labels.border_radius,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.general,unit:pbsParams.labels.px},{name:pbsParams.labels.tooltip_text,type:pbsParams.is_lite?"textDummy":"text",desc:pbsParams.labels.desc_icon_tooltip,group:pbsParams.labels.tooltip},{name:pbsParams.labels.tooltip_location,type:pbsParams.is_lite?"selectDummy":"select",group:pbsParams.labels.tooltip},{name:pbsParams.labels.background_color,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.tooltip},{name:pbsParams.labels.text_color,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.tooltip},{name:pbsParams.labels.toggle_shadow,type:pbsParams.is_lite?"checkboxDummy":"checkbox",group:pbsParams.labels.tooltip},{name:pbsParams.labels.width,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.tooltip,unit:pbsParams.labels.px},{name:pbsParams.labels.padding,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.tooltip,unit:pbsParams.labels.px},{name:pbsParams.labels.border_radius,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.tooltip,unit:pbsParams.labels.px}),window.pbsAddInspector("Icon",{label:pbsParams.labels.icon,onMouseEnter:function(element){element._addCSSClass("ce-element--over")},onMouseLeave:function(element){element._removeCSSClass("ce-element--over")},options:options}),window.pbsAddInspector("pbs_widget",{is_shortcode:!0,label:pbsParams.labels.widget,desc:pbsParams.labels.widget_inspector_desc,options:[{type:"widgetSettings"}]}),window.pbsAddInspector("pbs_sidebar",{is_shortcode:!0,label:pbsParams.labels.sidebar,desc:pbsParams.labels.sidebar_inspector_desc,options:[{type:"select",name:pbsParams.labels.select_a_sidebar,id:"id",options:pbsParams.sidebar_list,desc:pbsParams.sidebar_label_id}]}),(options=[]).push({name:pbsParams.labels.row_width,desc:pbsParams.labels.desc_row_width,type:"select",group:pbsParams.labels.general_and_style,options:{"":pbsParams.labels.normal_width,"full-width-retain-content":pbsParams.labels.full_width_retained_content_width,"full-width":pbsParams.labels.full_width},getRootRow:function(element){for(var rootRow=element,currElem=element._domElement;currElem&&currElem._ceElement;)currElem.classList.contains("pbs-row")&&(rootRow=currElem._ceElement),currElem=currElem.parentNode;return rootRow},value:function(element){return element._domElement.getAttribute("data-width")||""},render:function(element,view){var val=view.optionSettings.getRootRow(element)._domElement.getAttribute("data-width");val||(val=""),view.el.classList.remove("full"),view.el.classList.remove("full-retain"),"full-width"===val?view.el.classList.add("full"):"full-width-retain-content"===val&&view.el.classList.add("full-retain"),view.model.set(view.optionSettings.id,val)},change:function(element,value,view){var rootRow=view.optionSettings.getRootRow(element);rootRow.style("margin-left",""),rootRow.style("margin-right",""),rootRow.style("padding-left",""),rootRow.style("padding-right",""),view.el.classList.remove("full"),view.el.classList.remove("full-retain"),"full-width"===value?view.el.classList.add("full"):"full-width-retain-content"===value&&view.el.classList.add("full-retain"),rootRow.attr("data-width",value),window._pbsFixRowWidth(rootRow._domElement),rootRow.taint(),view.model.set(view.optionSettings.id,value)},visible:function(element){return"Region"===element.parent().type()}},{name:pbsParams.labels.background_color,type:"color",group:pbsParams.labels.general_and_style,initialize:function(element,view){view.listenTo(view.model,"change:background-color",view.render)},value:function(element){return element._domElement.style.backgroundColor||""},change:function(element,value){var bgImage=element._domElement.style["background-image"],url=bgImage.match(/url\([^\)]+\)/i)||"";element.style("background-color",value),-1!==bgImage.indexOf("gradient")&&element.style("background-image","linear-gradient("+value+", "+value+"), "+url)}},{name:pbsParams.labels.background_image,type:"image",group:pbsParams.labels.general_and_style,value:function(element){var matches;return element._domElement.style.backgroundImage&&(matches=element._domElement.style.backgroundImage.match(/url\([^,$]+/))?matches[0]:""},change:function(element,attachmentIDs,attachmentURLs){var i,background,backgrounds="";for(i=0;i<attachmentURLs.length;i++)backgrounds+=backgrounds?",":"",backgrounds+="url("+attachmentURLs[i]+")";(background=element.style("background-image")).match(/url\(/)?(background=background.replace(/url\([^\)]+\)/,backgrounds),element.style("background-image",background)):element.style("background-image",backgrounds)},remove:function(element,attachmentIDs,view){element.style("background-image",""),view.model.set("background-image","")}}),options.push({name:pbsParams.labels.toggle_background_image_tint,desc:pbsParams.labels.desc_background_tint,type:pbsParams.is_lite?"checkboxDummy":"checkbox",group:pbsParams.labels.general_and_style},{name:pbsParams.labels.background_size,type:pbsParams.is_lite?"numberDummy":"number",desc:pbsParams.labels.desc_background_size,group:pbsParams.labels.general_and_style},{options:{"":pbsParams.labels.normal_background_image,fixed:pbsParams.labels.fixed_background_image,parallax:pbsParams.labels.parallax_image,kenburns:"Ken Burns Slider",video:pbsParams.labels.video_background_youtube_vimeo,"video-html5":pbsParams.labels.video_background_uploaded},name:pbsParams.labels.background_image_type,type:pbsParams.is_lite?"selectDummy":"select",group:pbsParams.labels.general_and_style},{name:pbsParams.labels.parallax,type:pbsParams.is_lite?"numberDummy":"number",desc:pbsParams.labels.desc_parallax,group:pbsParams.labels.general_and_style},{placeholder:"http://",name:pbsParams.labels.video_background,type:pbsParams.is_lite?"textDummy":"text",desc:pbsParams.labels.desc_video_background,group:pbsParams.labels.general_and_style,class:"field-pbs-video-url"},{name:pbsParams.labels.webm_video,type:pbsParams.is_lite?"fileDummy":"file",desc:pbsParams.labels.desc_webm_video,group:pbsParams.labels.general_and_style,class:"field-pbs-video-webm"},{name:pbsParams.labels.mp4_video,type:pbsParams.is_lite?"fileDummy":"file",desc:pbsParams.labels.desc_mp4_video,group:pbsParams.labels.general_and_style,class:"field-pbs-video-mp4"},{name:pbsParams.labels.kenburns_images,type:pbsParams.is_lite?"imageDummy":"images",desc:pbsParams.labels.desc_kenburns_images,group:pbsParams.labels.general_and_style,urls:!0},{name:pbsParams.labels.full_height,type:"checkbox",group:pbsParams.labels.general_and_style,value:function(element){return"100vh"===element._domElement.style["min-height"]},change:function(element,value){element.style("min-height",value?"100vh":"")},visible:function(element){return"Region"===element.parent().type()}},{name:pbsParams.labels.text_color,desc:pbsParams.labels.note_overridden_by_elements,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.general_and_style},{name:pbsParams.labels.column_gap,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.general_and_style,unit:pbsParams.labels.px}),options.push({name:pbsParams.labels.border_radius,type:"number",group:pbsParams.labels.borders,step:"1",min:"0",max:"1000",unit:pbsParams.labels.px,maxFunction:function(element){return parseInt(parseInt(element._domElement.getBoundingClientRect().height,10)/2+1,10)},value:function(element){var size=parseInt(element._domElement.style["border-radius"],10);return isNaN(size)?0:size},change:function(element,value){element.style("border-radius",value+"px")}},{name:pbsParams.labels.border_style,type:"select",group:pbsParams.labels.borders,options:{"":pbsParams.labels.none,solid:pbsParams.labels.solid,dashed:pbsParams.labels.dashed,dotted:pbsParams.labels.dotted},value:function(element){return element._domElement.style["border-style"]},change:function(element,value,view){element.style("border-style",value),value?(""!==element._domElement.style["border-width"]&&"transparent"!==element._domElement.style["border-width"]||(element.style("border-width","1px"),view.model.set("border-width","1")),""!==element._domElement.style["border-color"]&&"0px"!==element._domElement.style["border-color"]||(element.style("border-color","#000000"),view.model.set("border-color","#000000"))):(element.style("border-width",""),element.style("border-color",""),view.model.set("border-width",""),view.model.set("border-color",""))}},{name:pbsParams.labels.border_color,type:"color",group:pbsParams.labels.borders,initialize:function(element,view){view.listenTo(view.model,"change:border-color",view.render)},value:function(element){return element._domElement.style.borderColor||""},change:function(element,value){element.style("border-color",value)},visible:function(element){return!!element._domElement.style["border-style"]}},{name:pbsParams.labels.border_thickness,type:"number",group:pbsParams.labels.borders,step:"1",min:"0",max:"20",unit:pbsParams.labels.px,initialize:function(element,view){view.listenTo(view.model,"change:border-width",view.render)},value:function(element){var size=parseInt(element._domElement.style["border-width"],10);return isNaN(size)?0:size},change:function(element,value){element.style("border-width",value+"px")},visible:function(element){return!!element._domElement.style["border-style"]}}),options.push({visible:function(element){return"Carousel"!==element.parent().constructor.name},name:pbsParams.labels.shadows,type:pbsParams.is_lite?"selectDummy":"select",group:pbsParams.labels.shadows},{name:pbsParams.labels.shadow_strength,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.shadows},{name:pbsParams.labels.overflow_hidden,type:pbsParams.is_lite?"checkboxDummy":"checkbox",group:pbsParams.labels.advanced,desc:pbsParams.labels.desc_overflow_hidden}),window.pbsAddInspector("DivRow",{label:pbsParams.labels.row,options:options}),window.pbsAddActionButtons("DivRow",[{id:"add",name:pbsParams.labels.add_column,visible:function(element){return"Toggle"!==element.parent().constructor.name},onClick:function(element){var root=ContentEdit.Root.get();root.focused()&&root.focused().blur&&root.focused().blur(),element.addNewColumn(1)}},{id:"clone",name:pbsParams.labels.clone_row,visible:function(element){return!element.parent()._domElement.classList.contains("glide__slide")&&("TabPanelContainer"!==element.parent().constructor.name&&"Toggle"!==element.parent().constructor.name)},onClick:function(element){var newRow=element.clone();window._pbsFixRowWidth(newRow._domElement)}}]),(options=[]).push({name:pbsParams.labels.background_color,type:"color",group:pbsParams.labels.general,initialize:function(element,view){view.listenTo(view.model,"change:background-color",view.render)},value:function(element){return element._domElement.style.backgroundColor||""},change:function(element,value){var bgImage=element._domElement.style["background-image"],url=bgImage.match(/url\([^\)]+\)/i)||"";element.style("background-color",value),-1!==bgImage.indexOf("gradient")&&element.style("background-image","linear-gradient("+value+", "+value+"), "+url)}},{name:pbsParams.labels.background_image,type:"image",group:pbsParams.labels.general,value:function(element){var matches;return element._domElement.style.backgroundImage?(matches=element._domElement.style.backgroundImage.match(/url\([^,$]+/))?matches[0]:element._domElement.style.backgroundImage:""},change:function(element,attachmentIDs,attachmentURLs){var i,background,backgrounds="";for(i=0;i<attachmentURLs.length;i++)backgrounds+=backgrounds?",":"",backgrounds+="url("+attachmentURLs[i]+")";(background=element.style("background-image")).match(/url\(/)?(background=background.replace(/url\([^\)]+\)/,backgrounds),element.style("background-image",background)):element.style("background-image",backgrounds)},remove:function(element,attachmentIDs,view){element.style("background-image",""),view.model.set("background-image","")}}),options.push({name:pbsParams.labels.toggle_background_image_tint,desc:pbsParams.labels.desc_background_tint,type:pbsParams.is_lite?"checkboxDummy":"checkbox",group:pbsParams.labels.general},{name:pbsParams.labels.background_size,type:pbsParams.is_lite?"numberDummy":"number",desc:pbsParams.labels.desc_background_size,group:pbsParams.labels.general,unit:pbsParams.labels.px},{name:pbsParams.labels.content_orientation,type:pbsParams.is_lite?"selectDummy":"select",desc:pbsParams.labels.desc_content_orientation,group:pbsParams.labels.alignment},{name:pbsParams.labels.vertical_column_alignment,type:pbsParams.is_lite?"selectDummy":"select",desc:pbsParams.labels.desc_vertical_column_alignment,group:pbsParams.labels.alignment},{name:pbsParams.labels.vertical_content_alignment,type:pbsParams.is_lite?"selectDummy":"select",desc:pbsParams.labels.desc_vertical_content_alignment,group:pbsParams.labels.alignment},{name:pbsParams.labels.horizontal_content_alignment,type:pbsParams.is_lite?"selectDummy":"select",desc:pbsParams.labels.desc_horizontal_content_alignment,group:pbsParams.labels.alignment},{name:pbsParams.labels.border_radius,type:"number",group:pbsParams.labels.borders,step:"1",min:"0",max:"1000",unit:pbsParams.labels.px,maxFunction:function(element){return parseInt(parseInt(element._domElement.getBoundingClientRect().height,10)/2+1,10)},value:function(element){var size=parseInt(element._domElement.style["border-radius"],10);return isNaN(size)?0:size},change:function(element,value){element.style("border-radius",value+"px")}},{name:pbsParams.labels.border_style,type:"select",group:pbsParams.labels.borders,options:{"":pbsParams.labels.none,solid:pbsParams.labels.solid,dashed:pbsParams.labels.dashed,dotted:pbsParams.labels.dotted},value:function(element){return element._domElement.style["border-style"]},change:function(element,value,view){element.style("border-style",value),value?(""!==element._domElement.style["border-width"]&&"transparent"!==element._domElement.style["border-width"]||(element.style("border-width","1px"),view.model.set("border-width","1")),""!==element._domElement.style["border-color"]&&"0px"!==element._domElement.style["border-color"]||(element.style("border-color","#000000"),view.model.set("border-color","#000000"))):(element.style("border-width",""),element.style("border-color",""),view.model.set("border-width",""),view.model.set("border-color",""))}},{name:pbsParams.labels.border_color,type:"color",group:pbsParams.labels.borders,initialize:function(element,view){view.listenTo(view.model,"change:border-color",view.render)},value:function(element){return element._domElement.style.borderColor||""},change:function(element,value){element.style("border-color",value)},visible:function(element){return!!element._domElement.style["border-style"]}},{name:pbsParams.labels.border_thickness,type:"number",group:pbsParams.labels.borders,step:"1",min:"0",max:"20",unit:pbsParams.labels.px,initialize:function(element,view){view.listenTo(view.model,"change:border-width",view.render)},value:function(element){var size=parseInt(element._domElement.style["border-width"],10);return isNaN(size)?0:size},change:function(element,value){element.style("border-width",value+"px")},visible:function(element){return!!element._domElement.style["border-style"]}}),options.push({visible:function(element){return!element.parent().parent()||!element.parent().parent().constructor.name||"Carousel"!==element.parent().parent().constructor.name},name:pbsParams.labels.shadows,type:pbsParams.is_lite?"selectDummy":"select",group:pbsParams.labels.shadows},{name:pbsParams.labels.shadow_strength,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.shadows},{name:pbsParams.labels.overflow_hidden,type:pbsParams.is_lite?"checkboxDummy":"checkbox",group:pbsParams.labels.advanced,desc:pbsParams.labels.desc_overflow_hidden}),window.pbsAddInspector("DivCol",{label:pbsParams.labels.column,options:options}),window.pbsAddActionButtons("DivCol",[{id:"add",name:pbsParams.labels.add_column,visible:function(element){return"TabPanelContainer"!==element.parent().constructor.name&&"Toggle"!==element.parent().constructor.name},onClick:function(element){var root,index;(root=ContentEdit.Root.get()).focused()&&root.focused().blur&&root.focused().blur(),index=element.parent().children.indexOf(element)+1,element.parent().addNewColumn(index)}},{id:"clone",name:pbsParams.labels.clone_column,visible:function(element){return"Toggle"!==element.parent().constructor.name},onClick:function(element){element.clone()}}]),window.pbsAddInspector("List",{label:pbsParams.labels.list,options:[{name:pbsParams.labels.font_size,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.general,unit:pbsParams.labels.px},{name:pbsParams.labels.line_height,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.general,unit:pbsParams.labels.em},{name:pbsParams.labels.bullet_icon,button:pbsParams.labels.pick_an_icon,type:pbsParams.is_lite?"button2Dummy":"button2",group:pbsParams.labels.bullet},{name:pbsParams.labels.reset_bullet_icon,button:pbsParams.labels.remove_icon,type:pbsParams.is_lite?"button2Dummy":"button2",group:pbsParams.labels.bullet},{name:pbsParams.labels.icon_color,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.bullet},{name:pbsParams.labels.icon_size,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.bullet,unit:pbsParams.labels.em},{name:pbsParams.labels.horizontal_offset,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.bullet,unit:pbsParams.labels.px}]}),ContentTools.ToolboxUI.prototype.createShortcodeMappingOptions=function(shortcodeTag){var i,opts,options,value,label,attribute,attributes=[],typesDone=[],map=pbsParams.shortcode_mappings[shortcodeTag],name=map.name;name||(name=shortcodeTag),name=name.replace(/[-_]/g," ").replace(/\b[a-z]/g,function(letter){return letter.toUpperCase()});for(attribute in map.attributes){if(options=map.attributes[attribute],options.desc=options.description||"",options.id=options.attribute,options.type_orig=options.type,options.first_of_type=-1===typesDone.indexOf(options.type),typesDone.push(options.type),"iframe"===options.type&&(options.attribute=""),void 0!==options.name&&options.name||(options.name=options.attribute,options.name=options.name.replace(/[-_]/g," ").replace(/\b[a-z]/g,function(letter){return letter.toUpperCase()})),pbsParams.is_lite)if("color"===options.type)options.type="text";else if("dropdown_post"===options.type)options.type="text";else if("dropdown_post_type"===options.type)options.type="text";else if("boolean"===options.type)options.type="text";else if("number"===options.type)options.type="text";else if("dropdown"===options.type)options.type="text";else if("select"===options.type)options.type="text";else if("iframe"===options.type)continue;if("boolean"===options.type)options.type="checkbox",options.checked=options.extra_boolean_checked||"true",options.unchecked=options.extra_boolean_unchecked||"false";else if("number"===options.type)options.min=options.extra_num_min||0,options.max=options.extra_num_max||1e3,options.step=options.extra_num_step||1;else if("multicheck"===options.type)for(options.options={},opts=options.extra_dropdown.split(/\n/)||{},i=0;i<opts.length;i++)value=opts[i].substr(0,opts[i].indexOf(",")),label=opts[i].substr(opts[i].indexOf(",")+1),options.options[value]=label;else if("multicheck_post_type"===options.type)options.type="multicheck",options.options=pbsParams.post_types;else if("dropdown"===options.type)for(options.type="select",options.options={"":" "+pbsParams.labels.select_one+" "},opts=options.extra_dropdown.split(/\n/)||{},i=0;i<opts.length;i++)value=opts[i].substr(0,opts[i].indexOf(",")),label=opts[i].substr(opts[i].indexOf(",")+1),options.options[value]=label;else if("dropdown_post_type"===options.type){options.type="select",options.options={"":" "+pbsParams.labels.select_a_post_type+" "};for(i in pbsParams.post_types)options.options[i]=pbsParams.post_types[i]}else if("dropdown_post"===options.type)options.type="select_post",options.post_type=options.extra||"post";else if("dropdown_db"===options.type)options.type="select_db",options.db_table=options.extra_db_table||"posts",options.db_field_id=options.extra_db_value||"ID",options.db_field_label=options.extra_db_label||"post_title",options.db_where_column=options.extra_db_where_field,options.db_where_value=options.extra_db_where_value;else if("iframe"===options.type){if(options.url=options.extra_url,!options.url)continue;options.button=options.extra_button||pbsParams.labels.open}else"content"===options.type&&(options.type="textarea");attributes.push(options)}window.pbsAddInspector(shortcodeTag,{is_shortcode:!0,label:name,desc:map.description||"",options:attributes})},window.pbsAddActionButtons("Shortcode",{id:"sc_edit_raw",name:pbsParams.labels.edit_shortcode,onClick:function(element){ContentTools.EditorApp.get()._toolboxProperties.hide(),element.convertToText()},priority:3}),(options=[]).push({name:pbsParams.labels.latitude_longitude_and_address,type:"text",desc:pbsParams.labels.latitude_longitude_desc,initialize:function(element,view){view.listenTo(view.model,"change:data-center",view.render)},value:function(element){return element.attr("data-center")},change:_.debounce(function(element,value,view){var center,latLonMatch;element.attr("data-center")!==value&&(element.attr("data-center",value),view.$el.find("input").removeClass("pbs-option-error"),center=value.trim()||"37.09024, -95.712891",element._domElement.map.marker&&(element._domElement.map.marker.setMap(null),delete element._domElement.map.marker),(latLonMatch=center.match(/^([-+]?\d{1,2}([.]\d+)?)\s*,?\s*([-+]?\d{1,3}([.]\d+)?)$/))?(element.attr("data-lat",latLonMatch[1]),element.attr("data-lng",latLonMatch[3]),center={lat:parseFloat(latLonMatch[1]),lng:parseFloat(latLonMatch[3])},element._domElement.map.setCenter(center),element.attr("data-marker-image")?element._domElement.map.marker=new google.maps.Marker({position:element._domElement.map.getCenter(),map:element._domElement.map,icon:element.attr("data-marker-image")}):element.attr("data-marker")&&(element._domElement.map.marker=new google.maps.Marker({position:element._domElement.map.getCenter(),map:element._domElement.map}))):(new google.maps.Geocoder).geocode({address:center},function(results,status){status===google.maps.GeocoderStatus.OK?(element.attr("data-lat",results[0].geometry.location.lat()),element.attr("data-lng",results[0].geometry.location.lng()),center={lat:results[0].geometry.location.lat(),lng:results[0].geometry.location.lng()},element._domElement.map.setCenter(center),element.attr("data-marker-image")?element._domElement.map.marker=new google.maps.Marker({position:element._domElement.map.getCenter(),map:element._domElement.map,icon:element.attr("data-marker-image")}):element.attr("data-marker")&&(element._domElement.map.marker=new google.maps.Marker({position:element._domElement.map.getCenter(),map:element._domElement.map}))):view.$el.find("input").addClass("pbs-option-error")}))},300)},{name:pbsParams.labels.map_controls,type:"checkbox",value:function(element){return!element._domElement.getAttribute("data-disable-ui")},change:function(element,value){element.attr("data-disable-ui",value?"1":""),element._domElement.map.setOptions({disableDefaultUI:!value})}},{name:pbsParams.labels.map_marker,type:"checkbox",value:function(element){return!!element._domElement.getAttribute("data-marker")},change:function(element,value){element._domElement.map.marker&&(element._domElement.map.marker.setMap(null),delete element._domElement.map.marker),value?(element.attr("data-marker","1"),element._domElement.map.marker=new google.maps.Marker({position:element._domElement.map.getCenter(),map:element._domElement.map})):(element.attr("data-marker",""),element.attr("data-marker-image",""))}}),options.push({name:pbsParams.labels.custom_map_marker,type:pbsParams.is_lite?"imageDummy":"image"},{name:pbsParams.labels.tint_map,type:pbsParams.is_lite?"colorDummy":"color"},{name:pbsParams.labels.custom_map_styles,type:pbsParams.is_lite?"textareaDummy":"textarea",desc:pbsParams.labels.custom_map_styles_desc}),window.pbsAddInspector("Map",{label:pbsParams.labels.map,options:options}),(options=[]).push({name:pbsParams.labels.vertical_tabs,type:pbsParams.is_lite?"checkboxDummy":"checkbox"},{name:pbsParams.labels.tab_alignment,type:pbsParams.is_lite?"selectDummy":"select"},{name:pbsParams.labels.tab_style,type:pbsParams.is_lite?"selectDummy":"select",group:pbsParams.labels.tab_styles},{name:pbsParams.labels.border_thickness,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.tab_styles,unit:pbsParams.labels.px},{name:pbsParams.labels.border_color,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.tab_styles},{name:pbsParams.labels.border_color,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.tab_styles},{name:pbsParams.labels.active_tab_background_color,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.tab_styles},{name:pbsParams.labels.active_tab_text_color,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.tab_styles},{name:pbsParams.labels.inactive_tab_text_color,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.tab_styles},{name:pbsParams.labels.tab_content_background_color,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.tab_styles},{name:pbsParams.labels.tab_content_text_color,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.tab_styles}),window.pbsAddInspector("Tabs",{label:pbsParams.labels.tabs,options:options}),(options=[]).push({name:pbsParams.labels.count_up_time,type:pbsParams.is_lite?"numberDummy":"number",unit:pbsParams.labels.ms,group:pbsParams.labels.count_up},{name:pbsParams.labels.count_up_delay,type:pbsParams.is_lite?"numberDummy":"number",unit:pbsParams.labels.ms,group:pbsParams.labels.count_up}),window.pbsAddInspector("Text",{label:pbsParams.labels.text,options:options}),(options=[]).push({name:pbsParams.labels.edit_html,button:pbsParams.labels.edit,type:"button2",class:"primary",group:pbsParams.labels.general,click:function(element){element.openEditor()}}),window.pbsAddInspector("Html",{label:pbsParams.labels.icon,options:options}),(options=[]).push({name:pbsParams.labels.color,type:"color",group:pbsParams.labels.general,value:function(element){var color=getComputedStyle(element._domElement).background,match=color.match(/linear-gradient\((.*?)(rgba?\([^\)]+\)|#\w+)/i);if(!match)return"";for(color=match[2];color.match(/(rgba\(\s*\d+,\s*\d+,\s*\d+,\s*\d+.\d{2})\d+/i);)color=color.replace(/(rgba\(\s*\d+,\s*\d+,\s*\d+,\s*\d+.\d{2})\d+/i,"$1");return color},change:function(element,value){var size=getComputedStyle(element._domElement).backgroundSize;"1"===(size=size.match(/(\d+)/)[1])&&element.style("background-size","auto 10px"),element.style("background-image","linear-gradient(0deg, transparent 45%, "+value+" 45%, "+value+" 55%, transparent 55%)")}},{step:"1",min:"5",max:"100",value:function(element){return parseInt(element._domElement.style.width,10)||"100"},change:function(element,value){element.style("width",value+"%")},name:pbsParams.labels.width,type:"number",unit:"%"},{step:"1",min:"1",max:"10",value:function(element){var size=getComputedStyle(element._domElement).backgroundSize;return(size=size.match(/(\d+)/)[1])/5-1},change:function(element,value){var color=getComputedStyle(element._domElement).backgroundImage;color=color.match(/linear-gradient\((.*?)(rgba?\([^\)]+\)|#\w+)/i)[2],element.style("background-image","linear-gradient(0deg, transparent 45%, "+color+" 45%, "+color+" 55%, transparent 55%)"),element.style("background-size","auto "+5*(parseInt(value,10)+1)+"px")},name:pbsParams.labels.thickness,type:"number"},{options:{left:pbsParams.labels.left,center:pbsParams.labels.center,right:pbsParams.labels.right},value:function(element){var styles=getComputedStyle(element._domElement),marginLeft=styles.marginLeft,marginRight=styles.marginRight;return"0px"===marginLeft&&"0px"!==marginRight?"left":"0px"!==marginLeft&&"0px"===marginRight?"right":"center"},change:function(element,value){"left"===value?(element.style("marginRight","auto"),element.style("marginLeft","0px")):"right"===value?(element.style("marginRight","0px"),element.style("marginLeft","auto")):(element.style("marginRight","auto"),element.style("marginLeft","auto"))},name:pbsParams.labels.alignment,type:"select"}),window.pbsAddInspector("Hr",{label:pbsParams.labels.horizontal_rule,options:options}),(options=[]).push({value:function(element){return element._domElement.getAttribute("data-url")||""},change:function(element,value){value!==element.attr("data-url")&&(element.attr("data-url",value),element.updateEmbedContent(value))},placeholder:"https://www.youtube.com/watch?v=dQw4w9WgXcQ",name:pbsParams.labels.embedded_url,type:"text",desc:pbsParams.labels.desc_embedded_url,group:pbsParams.labels.general}),window.pbsAddInspector("Embed",{label:pbsParams.labels.embed,options:options});var i,exceptElements=["Embed"];!function(){var options=[];for(options.push({name:pbsParams.labels.animation,type:pbsParams.is_lite?"selectDummy":"select",group:pbsParams.labels.entrance_animation},{name:pbsParams.labels.animation_speed,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.entrance_animation,unit:pbsParams.labels.ms},{name:pbsParams.labels.animation_start_delay,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.entrance_animation,unit:pbsParams.labels.ms,desc:pbsParams.labels.desc_animation_start_delay},{name:pbsParams.labels.option_elastic_animation_name,type:pbsParams.is_lite?"checkboxDummy":"checkbox",group:pbsParams.labels.entrance_animation},{name:pbsParams.labels.option_play_animation_once_name,type:pbsParams.is_lite?"checkboxDummy":"checkbox",group:pbsParams.labels.entrance_animation},{name:pbsParams.labels.custom_class,type:pbsParams.is_lite?"textDummy":"text",group:pbsParams.labels.advanced,desc:pbsParams.labels.desc_custom_class,placeholder:".my-custom-class"},{name:pbsParams.labels.custom_id,type:pbsParams.is_lite?"textDummy":"text",group:pbsParams.labels.advanced,desc:pbsParams.labels.desc_custom_id,placeholder:"#my-custom-id"}),i=0;i<window.pbsElementsWithInspector.length;i++)ContentEdit[window.pbsElementsWithInspector[i]]&&-1===exceptElements.indexOf(window.pbsElementsWithInspector[i])&&window.pbsAddInspector(window.pbsElementsWithInspector[i],{options:options})}(),ContentTools.Tools.ElementButton=function(_super){function ElementButton(){return ElementButton.__super__.constructor.apply(this,arguments)}return __extends(ElementButton,_super),ElementButton.canApply=function(){return!0},ElementButton.isApplied=function(){return!1},ElementButton}(ContentTools.Tool),function(){var proxied2,proxied=ContentTools.ToolUI.prototype.disabled;ContentTools.ToolUI.prototype.disabled=function(disabledState){if(!this._domElement.classList.contains("pbs-tool-large"))return proxied.call(this,disabledState)},proxied2=ContentTools.ToolUI.prototype._onMouseUp,ContentTools.ToolUI.prototype._onMouseUp=function(ev){return this._domElement.classList.contains("pbs-tool-large")?(this._mouseDown=!1,this.removeCSSClass("ct-tool--down")):proxied2.call(this,ev)}}(),function(){var proxied=ContentTools.ToolUI.prototype.mount;ContentTools.ToolUI.prototype.mount=function(domParent,before){var label,ret=proxied.call(this,domParent,before);return this.tool.buttonName&&(this._domElement.classList.add("pbs-tool-large"),(label=document.createElement("div")).classList.add("pbs-tool-title"),label.textContent=this.tool.buttonName,this._domElement.appendChild(label)),ret}}(),ContentTools.Tools.Heading._canApply=ContentTools.Tools.Heading.canApply,ContentTools.Tools.Heading.canApply=function(element,selection){var origReturn=ContentTools.Tools.Heading._canApply(element,selection);return"ListItemText"!==element.constructor.name&&(void 0!==element.content&&element.parent().tagName?origReturn||"div"===element.parent().tagName():origReturn)},ContentTools.Tools.Paragraph.isApplied=function(element){return element.tagName()===this.tagName},ContentTools.Tools.UnorderedList.canApply=function(element,selection){var ret=ContentTools.Tools.Bold.canApply(element,selection);return!(!element.parent()||!element.parent().tagName||"li"!==element.parent().tagName())||ret},ContentTools.Tools.OrderedList.canApply=ContentTools.Tools.UnorderedList.canApply,ContentTools.Tools.UnorderedList.isApplied=function(element){return!!(element.parent()&&element.parent().parent()&&element.parent().parent().tagName&&element.parent().parent().tagName()===this.listTag)},ContentTools.Tools.OrderedList.isApplied=ContentTools.Tools.UnorderedList.isApplied,function(){var proxied=ContentTools.Tools.UnorderedList.apply;ContentTools.Tools.UnorderedList.apply=function(element,selection,callback){var listItemText,listItem,list,ret,prevFontFamily,prevFontName;return element._domElement&&(prevFontFamily=element._domElement.style.fontFamily,prevFontName=element._domElement.getAttribute("data-font-family")),this.isApplied(element)?element.parent().unindent():"ListItem"===element.parent().type()||element.content?(ret=proxied.call(this,element,selection,callback),element.parent()&&"ListItem"===element.parent().type()&&ContentEdit.Root.get().trigger("focus",element)):(listItemText=new ContentEdit.ListItemText(""),(listItem=new ContentEdit.ListItem).attach(listItemText),(list=new ContentEdit.List(this.listTag,{})).attach(listItem),element.parent().attach(list,element.parent().children.indexOf(element)+1),listItemText.focus(),ret=callback(!0)),prevFontFamily&&ContentTools.Tools.FontPicker&&ContentTools.Tools.FontPicker.selectFont(prevFontName,prevFontFamily),ret}}(),function(){var proxied=ContentTools.Tools.OrderedList.apply;ContentTools.Tools.OrderedList.apply=function(element,selection,callback){var listItemText,listItem,list,prevFontFamily,prevFontName;element._domElement&&(prevFontFamily=element._domElement.style.fontFamily,prevFontName=element._domElement.getAttribute("data-font-family")),this.isApplied(element)?element.parent().unindent():"ListItem"===element.parent().type()||element.content?(proxied.call(this,element,selection,callback),element.parent()&&"ListItem"===element.parent().type()&&ContentEdit.Root.get().trigger("focus",element)):(listItemText=new ContentEdit.ListItemText(""),(listItem=new ContentEdit.ListItem).attach(listItemText),(list=new ContentEdit.List(this.listTag,{})).attach(listItem),element.parent().attach(list,element.parent().children.indexOf(element)+1),listItemText.focus(),callback(!0)),prevFontFamily&&ContentTools.Tools.FontPicker&&ContentTools.Tools.FontPicker.selectFont(prevFontName,prevFontFamily)}}(),ContentTools.Tools.Preformatted.canApply=function(element,selection){return ContentTools.Tools.Heading1.canApply(element,selection)},function(){var proxied=ContentTools.Tools.Preformatted.apply;ContentTools.Tools.Preformatted.apply=function(element,selection,callback){var heading;if(!this.isApplied(element))return element.content?proxied.call(this,element,selection,callback):(heading=new ContentEdit.Text(this.tagName),element.parent().attach(heading,element.parent().children.indexOf(element)+1),heading.focus(),callback(!0))}}(),ContentTools.Tools.Preformatted.isApplied=function(element){return element.tagName()===this.tagName},ContentTools.Tools.Bold.canApply=function(element,selection){return!!element.content&&selection},ContentTools.Tools.Bold.isApplied=function(element,selection){var _ref,styledString,fontWeight,fontWeightNum,from=0,to=0;return!(void 0===element.content||!element.content.length())&&(selection&&(from=(_ref=selection.get())[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),styledString=element.content.substring(from,to),fontWeight=styledString.getStyle("font-weight",element),!(!styledString.hasTags("strong",!0)&&!styledString.hasTags("b",!0))||(fontWeightNum=parseInt(fontWeight,10),isNaN(fontWeightNum)?"bold"===fontWeight:fontWeightNum>400))},ContentTools.Tools.Bold.apply=function(element,selection,callback){var _ref,styledString,fontWeight,defaultFontWeight,newStyle,from=0,to=0;return this.tagName="span",element.storeState(),selection&&(from=(_ref=selection.get())[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),(styledString=element.content.substring(from,to)).hasTags("strong",!0)?element.content=element.content.unformat(from,to,new HTMLString.Tag("strong")):styledString.hasTags("b",!0)?element.content=element.content.unformat(from,to,new HTMLString.Tag("b")):("normal"===(fontWeight=(fontWeight=styledString.getStyle("font-weight",element))&&"normal"!==fontWeight?isNaN(parseInt(fontWeight,10))?"normal":parseInt(fontWeight,10)<=400?"bold":"normal":"bold")&&(defaultFontWeight=element.defaultStyle("font-weight"),isNaN(parseInt(defaultFontWeight,10))||parseInt(defaultFontWeight,10)<400&&(fontWeight=defaultFontWeight)),newStyle={"font-weight":fontWeight},element.content=element.content.style(from,to,element._tagName,newStyle)),element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},ContentTools.Tools.Italic.canApply=function(element,selection){return ContentTools.Tools.Bold.canApply(element,selection)},ContentTools.Tools.Italic.isApplied=function(element,selection){var _ref,styledString,fontStyle,from=0,to=0;return!(void 0===element.content||!element.content.length())&&(selection&&(from=(_ref=selection.get())[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),styledString=element.content.substring(from,to),fontStyle=styledString.getStyle("font-style",element),!(!styledString.hasTags("em",!0)&&!styledString.hasTags("i",!0))||"italic"===fontStyle)},ContentTools.Tools.Italic.apply=function(element,selection,callback){var _ref,styledString,fontStyle,newStyle,from=0,to=0;return this.tagName="span",element.storeState(),selection&&(from=(_ref=selection.get())[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),(styledString=element.content.substring(from,to)).hasTags("em",!0)?element.content=element.content.unformat(from,to,new HTMLString.Tag("em")):styledString.hasTags("i",!0)?element.content=element.content.unformat(from,to,new HTMLString.Tag("i")):(newStyle={"font-style":fontStyle=(fontStyle=styledString.getStyle("font-style",element))&&"normal"!==fontStyle?"normal":"italic"},element.content=element.content.style(from,to,element._tagName,newStyle)),element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},ContentTools.Tools.Link.isApplied=function(element,selection){var from,to,_ref;return"Image"===element.constructor.name?element.a:selection?!(void 0===element.content||!element.content.length())&&(_ref=selection.get(),from=_ref[0],to=_ref[1],from===to&&(to+=1),element.content.slice(from,to).hasTags(this.tagName,!0)):void 0},function(){var proxied=ContentTools.Tools.Paragraph.apply;ContentTools.Tools.Paragraph.apply=function(element,selection,callback){var app,forceAdd,paragraph,region;if(app=ContentTools.EditorApp.get(),forceAdd=app.ctrlDown(),ContentTools.Tools.Heading.canApply(element)&&!forceAdd);else if("DivCol"===element.parent().constructor.name||"Div"===element.parent().constructor.name)return region=element.parent(),paragraph=new ContentEdit.Text("p"),region.attach(paragraph,region.children.indexOf(element)+1),paragraph.focus(),callback(!0);return proxied.call(this,element,selection,callback)}}(),function(){var proxied=ContentTools.ToolUI.prototype._onMouseDown;ContentTools.ToolUI.prototype._onMouseDown=function(ev){var interval,element,selection,ret=proxied.call(this,ev);if(!this.tool.doHold)return ret;if(clearTimeout(this._holdTimeout),clearInterval(this._holdInterval),interval=30,this.tool.holdInterval&&(interval=this.tool.holdInterval),this._mouseDown){if(!(element=ContentEdit.Root.get().focused())||!element.isMounted())return;selection=null,element.selection&&(selection=element.selection()),this._holdTimeout=setTimeout(function(){this._holdInterval=setInterval(function(){this.tool.doHold(element,selection)}.bind(this),interval)}.bind(this),500)}return ret}}(),function(){var proxied=ContentTools.ToolUI.prototype._onMouseUp;ContentTools.ToolUI.prototype._onMouseUp=function(ev){return clearTimeout(this._holdTimeout),clearInterval(this._holdInterval),proxied.call(this,ev)}}(),ContentTools.Tool.refreshTooltip=function(value){var tooltip,buttonElement=window.PBSEditor.getToolUI(this.icon)._domElement;value||(value=""),tooltip=window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown?this.labelReset.replace("{0}",value):window.PBSEditor.isCtrlDown?this.labelDown.replace("{0}",value):this.label.replace("{0}",value),buttonElement.getAttribute("data-tooltip")!==tooltip&&buttonElement.setAttribute("data-tooltip",tooltip)},function(){ContentTools.Tools.Table.apply;ContentTools.Tools.Table.apply=function(element,selection,callback){},ContentTools.Tools.Table.premium=!0,ContentTools.Tools.Table.buttonName=pbsParams.labels.table,ContentTools.Tools.Table.label=pbsParams.labels.table}(),function(){var proxied=ContentEdit.Element.prototype.mount;ContentEdit.Element.prototype.mount=function(){var ret;return this._domElement||(this._domElement=document.createElement(this.tagName())),this._domElement.classList.add("pbs-will-mount"),ret=proxied.call(this),setTimeout(function(){this._domElement&&(this._domElement.classList.add("pbs-will-mount"),this._domElement.classList.add("pbs-is-mounting"))}.bind(this),10),setTimeout(function(){this._domElement&&(this._domElement.classList.remove("pbs-will-mount"),this._domElement.classList.remove("pbs-is-mounting"))}.bind(this),450),ret}}(),ContentTools.Tools.BasePopup=function(_super){function BasePopup(){return BasePopup.__super__.constructor.apply(this,arguments)}return __extends(BasePopup,_super),BasePopup.displayRule="block",BasePopup.mountPopup=function(){this.popup=document.createElement("DIV"),this._ceElement._domElement.classList.add("pbs-md-modal"),this._ceElement._domElement.appendChild(this.popup),document.body.addEventListener("mousedown",function(e){if(this.isOpen()){if("INPUT"===e.target.tagName)return;if(this._ceElement._domElement.contains(e.target)||this.hidePopup(),e.target.classList&&e.target.classList.contains("ct-tool"))return void this.hidePopup()}}.bind(this)),wp.hooks.addAction("pbs.tool.popup.open",function(toolOpened){this!==toolOpened&&this.hidePopup()}.bind(this))},BasePopup.hidePopup=function(){setTimeout(function(){this&&this._ceElement&&(this._ceElement._domElement.querySelector("div").style.display="")}.bind(this),150),this._ceElement._domElement.classList.remove("pbs-md-modal-show")},BasePopup.isOpen=function(){return this._ceElement._domElement.querySelector("div").style.display===this.displayRule},BasePopup.showPopup=function(){this._ceElement._domElement.querySelector("div").style.display=this.displayRule,setTimeout(function(){this&&this._ceElement&&this._ceElement._domElement.classList.add("pbs-md-modal-show")}.bind(this),10),wp.hooks.doAction("pbs.tool.popup.open",this)},BasePopup}(ContentTools.Tool),function(){var proxied=ContentTools.ToolUI.prototype.mount;ContentTools.ToolUI.prototype.mount=function(domParent,before){var ret=proxied.call(this,domParent,before);return this.tool._ceElement=this,void 0!==this.tool.mountPopup&&this.tool.mountPopup(),ret}}(),function(){var proxied=ContentTools.ToolUI.prototype._addDOMEventListeners;ContentTools.ToolUI.prototype._addDOMEventListeners=function(){if(void 0===this.tool.mountPopup)return proxied.call(this);this._domElement.addEventListener("mousedown",function(e){e.target.classList.contains("ct-tool")&&e.preventDefault()}),this._domElement.addEventListener("click",function(e){this._ceElement._domElement.classList.contains("ct-tool--disabled")||this._ceElement.tool.popup.contains(e.target)||""===this._ceElement._domElement.querySelector("div").style.display&&this.showPopup()}.bind(this.tool))}}(),ContentTools.Tools.Shortcode=function(_super){function Shortcode(){return Shortcode.__super__.constructor.apply(this,arguments)}return __extends(Shortcode,_super),ContentTools.ToolShelf.stow(Shortcode,"shortcode"),Shortcode.label=pbsParams.labels.shortcode,Shortcode.icon="shortcode",Shortcode.tagName="shortcode",Shortcode.buttonName=pbsParams.labels.shortcode,Shortcode.apply=function(element,selection,callback){var mainRegion,parent=null,index=0,root=ContentEdit.Root.get();return root.focused()?index=(parent=root.focused().parent()).children.indexOf(root.focused())+1:(mainRegion=ContentTools.EditorApp.get().regions()["main-content"]).children&&(parent=mainRegion.children[0].parent()),this.createNew(parent,index),callback(!0)},Shortcode.createNew=function(parent,index){PBSEditor.shortcodeFrame.open({title:pbsParams.labels.insert_shortcode,button:pbsParams.labels.insert_shortcode,successCallback:function(view){var elem,base=view.selected.getAttribute("data-shortcode-tag"),shortcodeRaw=this.createInsertedShortcode(base),shortcode=wp.shortcode.next(base,shortcodeRaw,0),isMapped=pbsParams.shortcode_mappings[base];elem=isMapped?ContentEdit.Shortcode.createShortcode(shortcode):new ContentEdit.Text("p",{},shortcode.shortcode.string()),parent.attach(elem,index),isMapped?elem.ajaxUpdate(!0):(elem.origShortcode="",elem.origInnerHTML="",elem.isShortcodeEditing=!0),elem.focus()}.bind(this)})},Shortcode.createInsertedShortcode=function(base){var editor,i,option,scData={tag:base,type:"closed",content:"",attrs:{}};if(void 0===PBSInspectorOptions.Shortcode[base]&&void 0!==pbsParams.shortcode_mappings&&void 0!==pbsParams.shortcode_mappings[base]&&(editor=ContentTools.EditorApp.get())._toolbox.createShortcodeMappingOptions&&editor._toolbox.createShortcodeMappingOptions(base),PBSInspectorOptions.Shortcode[base]&&PBSInspectorOptions.Shortcode[base].options)for(i=0;i<PBSInspectorOptions.Shortcode[base].options.length;i++)(option=PBSInspectorOptions.Shortcode[base].options[i]).id&&("content"===option.id?scData.content=option.default||"":scData.attrs[option.id]=option.default||"");return new wp.shortcode(scData).string()},Shortcode}(ContentTools.Tools.ElementButton),ContentTools.Tools.Heading1=function(_super){function Heading1(){return Heading1.__super__.constructor.apply(this,arguments)}return __extends(Heading1,_super),ContentTools.ToolShelf.stow(Heading1,"h1"),Heading1.label=pbsParams.labels.heading_label.replace("%d","1"),Heading1.icon="h1",Heading1.tagName="h1",Heading1.canApply=function(element,selection){return"ListItemText"!==element.constructor.name&&("TableCellText"!==element.constructor.name&&ContentTools.Tools.Paragraph.canApply(element,selection))},Heading1.apply=function(element,selection,callback){var heading;if(!this.isApplied(element))return element.content?Heading1.__super__.constructor.apply.call(this,element,selection,callback):(heading=new ContentEdit.Text(this.tagName),element.parent().attach(heading,element.parent().children.indexOf(element)+1),heading.focus(),callback(!0))},Heading1.isApplied=function(element){return element.tagName()===this.tagName},Heading1}(ContentTools.Tools.Heading),ContentTools.Tools.Heading2=function(_super){function Heading2(){return Heading2.__super__.constructor.apply(this,arguments)}return __extends(Heading2,_super),ContentTools.ToolShelf.stow(Heading2,"h2"),Heading2.label=pbsParams.labels.heading_label.replace("%d","2"),Heading2.icon="h2",Heading2.tagName="h2",Heading2}(ContentTools.Tools.Heading1),ContentTools.Tools.Heading3=function(_super){function Heading3(){return Heading3.__super__.constructor.apply(this,arguments)}return __extends(Heading3,_super),ContentTools.ToolShelf.stow(Heading3,"h3"),Heading3.label=pbsParams.labels.heading_label.replace("%d","3"),Heading3.icon="h3",Heading3.tagName="h3",Heading3}(ContentTools.Tools.Heading1),ContentTools.Tools.Heading4=function(_super){function Heading4(){return Heading4.__super__.constructor.apply(this,arguments)}return __extends(Heading4,_super),ContentTools.ToolShelf.stow(Heading4,"h4"),Heading4.label=pbsParams.labels.heading_label.replace("%d","4"),Heading4.icon="h4",Heading4.tagName="h4",Heading4}(ContentTools.Tools.Heading1),ContentTools.Tools.Heading5=function(_super){function Heading5(){return Heading5.__super__.constructor.apply(this,arguments)}return __extends(Heading5,_super),ContentTools.ToolShelf.stow(Heading5,"h5"),Heading5.label=pbsParams.labels.heading_label.replace("%d","5"),Heading5.icon="h5",Heading5.tagName="h5",Heading5}(ContentTools.Tools.Heading1),ContentTools.Tools.Heading6=function(_super){function Heading6(){return Heading6.__super__.constructor.apply(this,arguments)}return __extends(Heading6,_super),ContentTools.ToolShelf.stow(Heading6,"h6"),Heading6.label=pbsParams.labels.heading_label.replace("%d","6"),Heading6.icon="h6",Heading6.tagName="h6",Heading6}(ContentTools.Tools.Heading1),ContentTools.Tools.Blockquote=function(_super){function Blockquote(){return Blockquote.__super__.constructor.apply(this,arguments)}return __extends(Blockquote,_super),ContentTools.ToolShelf.stow(Blockquote,"blockquote"),Blockquote.label=pbsParams.labels.blockquote,Blockquote.icon="blockquote",Blockquote.tagName="blockquote",Blockquote}(ContentTools.Tools.Heading1),ContentTools.Tools.ClearFormatting=function(_super){function ClearFormatting(){return ClearFormatting.__super__.constructor.apply(this,arguments)}return __extends(ClearFormatting,_super),ContentTools.ToolShelf.stow(ClearFormatting,"clear-formatting"),ClearFormatting.label=pbsParams.labels.clear_formatting,ClearFormatting.icon="clear-formatting",ClearFormatting.tagName="span",ClearFormatting.canApply=function(element,selection){var _ref,from=0,to=0;return!!ContentTools.Tools.Bold.canApply(element,selection)&&(!(void 0===element.content||!element.content.length())&&(selection&&(from=(_ref=selection.get())[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),!!element.content.hasStyle(from,to)||(!(!element._domElement||!element._domElement.getAttribute("style"))||(!!ContentTools.Tools.Align.isApplied(element,selection)||!(void 0===ContentTools.Tools.LineHeight||!ContentTools.Tools.LineHeight.isApplied(element))))))},ClearFormatting.apply=function(element,selection,callback){var from,to,_ref;return element.storeState(),selection&&(from=(_ref=selection.get())[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),element.content=element.content.removeStyles(from,to),void 0!==ContentTools.Tools.LineHeight&&ContentTools.Tools.LineHeight.apply(element,selection,function(){},"reset"),void 0!==ContentTools.Tools.FontPicker&&ContentTools.Tools.FontPicker.apply(element,selection,function(){},"reset"),ContentTools.Tools.Align._apply("reset"),element.removeAttr("style"),element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},ClearFormatting}(ContentTools.Tool),ContentTools.Tools.Code=function(_super){function Code(){return Code.__super__.constructor.apply(this,arguments)}return __extends(Code,_super),ContentTools.ToolShelf.stow(Code,"code"),Code.label=pbsParams.labels.code,Code.icon="code",Code.tagName="code",Code.canApply=function(element,selection){var _ref,from,to;return!!selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1],from!==to)},Code.apply=function(element,selection,callback){var from,to,_ref;return element.storeState(),_ref=selection.get(),from=_ref[0],to=_ref[1],this.isApplied(element,selection)?element.content=element.content.unformat(from,to,new HTMLString.Tag(this.tagName)):element.content=element.content.format(from,to,new HTMLString.Tag(this.tagName)),element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},Code.isApplied=function(element,selection){var from,to,_ref;return!!selection&&(!(void 0===element.content||!element.content.length())&&(_ref=selection.get(),from=_ref[0],to=_ref[1],from===to&&(to+=1),element.content.slice(from,to).hasTags(this.tagName,!0)))},Code}(ContentTools.Tools.Bold),ContentTools.Tools.Embed=function(_super){function Embed(){return Embed.__super__.constructor.apply(this,arguments)}return __extends(Embed,_super),ContentTools.ToolShelf.stow(Embed,"embed"),Embed.label=pbsParams.labels.embed,Embed.icon="embed",Embed.tagName="div",Embed.buttonName=pbsParams.labels.embed,Embed.canApply=function(){return!0},Embed.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return this.createNew(element.parent(),index),callback(!0)},Embed.createNew=function(parent,index){var embed=ContentEdit.Embed.create("https://wordpress.org/plugins/page-builder-sandwich/");parent.attach(embed,index),embed.updateEmbedContent()},Embed}(ContentTools.Tool),ContentTools.Tools.Color=function(_super){function Color(){return Color.__super__.constructor.apply(this,arguments)}return __extends(Color,_super),ContentTools.ToolShelf.stow(Color,"color"),Color.label=pbsParams.labels.color,Color.icon="color",Color.tagName="span",Color.canApply=function(element,selection){selection&&selection.isCollapsed();var from,to,_ref,selectedContent,matches,s,color="";return!!element.content&&(selection&&!selection.isCollapsed()?(from=(_ref=selection.get())[0])===(to=_ref[1])&&(to+=1):(from=0,to=element.content.length()),selectedContent=element.content.slice(from,to).html(),(matches=selectedContent.match(/^<span[^>]style[^>]+['"\s;]color:\s?([#().,\w]+)/))&&(color=matches[1]),color||(void 0===this._defaultBodyTextColor&&(s=getComputedStyle(document.body),this._defaultBodyTextColor=s.color),color=this._defaultBodyTextColor),this._ceElement._domElement.style.backgroundColor!==color&&(this._ceElement._domElement.style.backgroundColor=color),color?window.PBSEditor.getToolUI(this.icon)._domElement.setAttribute("data-tooltip",this.label+": "+color):window.PBSEditor.getToolUI(this.icon)._domElement.setAttribute("data-tooltip",this.label),color)},Color.isApplied=function(){return!1},Color.applyColor=function(color,element,selection){var _ref,from,to;element.isMounted()&&(selection&&(from=(_ref=selection.get())[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),element.content=element.content.style(from,to,element._tagName,{color:color}),element.updateInnerHTML(),element.taint(),element.restoreState())},Color.apply=function(element,selection,callback){var currColor;return this.rememberedSelection&&(selection=this.rememberedSelection),currColor=jQuery(this._ceElement._domElement.querySelector("input")).iris("color"),""===this._ceElement._domElement.querySelector("input").value&&(currColor=""),this.applyColor(currColor,element,selection),wp.hooks.doAction("pbs.tool.color.applied",element),callback(!0)},Color.mountPopup=function(){var _this=this,o=document.createElement("INPUT");Color.__super__.constructor.mountPopup.call(this),o.addEventListener("mousedown",function(){var _ref,from,to,element=ContentEdit.Root.get().focused(),selection=null;element.selection&&(selection=element.selection()),from=(_ref=selection.get())[0],to=_ref[1],0===from&&0===to||(_this.rememberedSelection=selection)}),o.addEventListener("keyup",function(e){""===e.target.value&&(_this.selectedColor=e.target.value,_this._ceElement._mouseDown=!0,_this._ceElement._onMouseUp(),jQuery(_this._ceElement._domElement.querySelector("input")).iris("color",_this.selectedColor),e.target.focus())}),o.classList.add("color-picker"),o.setAttribute("data-alpha","true"),this.popup.appendChild(o),jQuery(o).iris({defaultColor:this._ceElement._domElement.style.backgroundColor,change:function(event){_this._ceElement._justShowedPicker||(_this.selectedColor=event.target.value,_this._ceElement._mouseDown=!0,_this._ceElement._onMouseUp(event)),_this._ceElement._justShowedPicker=void 0},clear:function(){},hide:!1,palettes:["#282425","#3d3a3b","#555152","#6b6969","#838181","#9b999a","#b4b1b2","#cccbcb","#e5e4e4","#ffffff","#fd3d3f","#f70363","#eb389a","#a812a9","#7330b0","#4b4bae","#1490ec","#00a4ed","#00bacf","#009586","#e1d6b8","#5b7b88","#7c554a","#fe5234","#fe9631","#fec03b","#fbec57","#c2dd52","#75c457","#12b059"]})},Color.hidePopup=function(){Color.__super__.constructor.hidePopup.call(this),this.rememberedSelection=null},Color.showPopup=function(){var element,elements;Color.__super__.constructor.showPopup.call(this),this._ceElement._domElement.querySelector("input").value=this._ceElement._domElement.style.backgroundColor,this._ceElement._justShowedPicker=!0,jQuery(this._ceElement._domElement.querySelector("input")).iris("color",this._ceElement._domElement.style.backgroundColor),(element=ContentEdit.Root.get().focused()).selection&&(this._ceElement.tool.rememberedSelection=element.selection()),this._ceElement._domElement.querySelector("input").focus(),this._ceElement._domElement.querySelector("input").select(),elements=this._ceElement._domElement.querySelectorAll(".iris-palette"),Array.prototype.forEach.call(elements,function(el){void 0===el._pbsInitDone&&(el._pbsInitDone=!0,el.addEventListener("mousedown",function(e){e.preventDefault()}))})},Color}(ContentTools.Tools.BasePopup),ContentTools.Tools.TwoColumn=function(_super){function OneColumn(){return OneColumn.__super__.constructor.apply(this,arguments)}return __extends(OneColumn,_super),ContentTools.ToolShelf.stow(OneColumn,"onecolumn"),OneColumn.label=pbsParams.labels.one_column,OneColumn.icon="onecolumn",OneColumn.tagName="onecolumn",OneColumn.buttonName=pbsParams.labels.one_column,OneColumn.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return element.blur(),this.createNew(element.parent(),index),callback(!0)},OneColumn.createNew=function(parent,index){var row=new ContentEdit.DivRow("div"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},"");parent.attach(row,index),row.attach(col),col.attach(p),p.focus(),col.style("justify-content","center"),row.style("min-height","200px"),wp.hooks.doAction("pbs.tool.row.applied",row)},OneColumn}(ContentTools.Tools.ElementButton),ContentTools.Tools.TwoColumn=function(_super){function TwoColumn(){return TwoColumn.__super__.constructor.apply(this,arguments)}return __extends(TwoColumn,_super),ContentTools.ToolShelf.stow(TwoColumn,"twocolumn"),TwoColumn.label=pbsParams.labels.two_column,TwoColumn.icon="twocolumn",TwoColumn.tagName="twocolumn",TwoColumn.buttonName=pbsParams.labels.two_column,TwoColumn.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return element.blur(),this.createNew(element.parent(),index),callback(!0)},TwoColumn.createNew=function(parent,index){var row=new ContentEdit.DivRow("div"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},"");parent.attach(row,index),row.attach(col),col.attach(p),p.focus(),col.style("flex-basis","50%"),col.style("justify-content","center"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),col.style("flex-basis","50%"),col.style("justify-content","center"),row.style("min-height","200px")},TwoColumn}(ContentTools.Tools.ElementButton),ContentTools.Tools.ThreeColumn=function(_super){function ThreeColumn(){return ThreeColumn.__super__.constructor.apply(this,arguments)}return __extends(ThreeColumn,_super),ContentTools.ToolShelf.stow(ThreeColumn,"threecolumn"),ThreeColumn.label=pbsParams.labels.three_column,ThreeColumn.icon="threecolumn",ThreeColumn.tagName="threecolumn",ThreeColumn.buttonName=pbsParams.labels.three_column,ThreeColumn.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return element.blur(),this.createNew(element.parent(),index),callback(!0)},ThreeColumn.createNew=function(parent,index){var row=new ContentEdit.DivRow("div"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},"");parent.attach(row,index),row.attach(col),col.attach(p),p.focus(),col.style("flex-basis","33.33%"),col.style("justify-content","center"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),col.style("flex-basis","33.33%"),col.style("justify-content","center"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),col.style("flex-basis","33.33%"),col.style("justify-content","center"),row.style("min-height","200px")},ThreeColumn}(ContentTools.Tools.ElementButton),ContentTools.Tools.FourColumn=function(_super){function FourColumn(){return FourColumn.__super__.constructor.apply(this,arguments)}return __extends(FourColumn,_super),ContentTools.ToolShelf.stow(FourColumn,"fourcolumn"),FourColumn.label=pbsParams.labels.four_column,FourColumn.icon="fourcolumn",FourColumn.tagName="fourcolumn",FourColumn.buttonName=pbsParams.labels.four_column,FourColumn.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return element.blur(),this.createNew(element.parent(),index),callback(!0)},FourColumn.createNew=function(parent,index){var row=new ContentEdit.DivRow("div"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},"");parent.attach(row,index),row.attach(col),col.attach(p),p.focus(),col.style("flex-basis","25%"),col.style("justify-content","center"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),col.style("flex-basis","25%"),col.style("justify-content","center"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),col.style("flex-basis","25%"),col.style("justify-content","center"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),col.style("flex-basis","25%"),col.style("justify-content","center"),row.style("min-height","200px")},FourColumn}(ContentTools.Tools.ElementButton),ContentTools.Tools.InsertElement=function(_super){function InsertElement(){return InsertElement.__super__.constructor.apply(this,arguments)}return __extends(InsertElement,_super),ContentTools.ToolShelf.stow(InsertElement,"insertElement"),InsertElement.label="",InsertElement.icon="insert-element",InsertElement.className="",InsertElement.apply=function(element,selection,callback){return window.PBSEditor.ToolboxElements&&window.PBSEditor.ToolboxElements.getInstance().toggle(),callback(!0)},InsertElement.canApply=function(){return!0},InsertElement}(ContentTools.Tool),function(){var proxied=ContentTools.ToolUI.prototype.mount;ContentTools.ToolUI.prototype.mount=function(domParent,before){var ret=proxied.call(this,domParent,before);return this._domElement.classList.contains("ct-tool--insert-element")&&(this._domElement.innerHTML="<span>"+pbsParams.labels.add_element+"</span>",this._toolboxElementsHoverShow=function(){window.PBSEditor.ToolboxElements&&window.PBSEditor.ToolboxElements.getInstance().show()},this._domElement.addEventListener("mouseenter",this._toolboxElementsHoverShow),this._toolboxElementsLeaveHide=function(ev){var toolbox=window.PBSEditor.ToolboxElements;toolbox&&(toolbox=toolbox.getInstance(),ev.relatedTarget?toolbox._domElement.contains(ev.relatedTarget)||toolbox._domElement===ev.relatedTarget||toolbox.hide():toolbox.hide())},this._domElement.addEventListener("mouseleave",this._toolboxElementsLeaveHide)),ret}}(),function(){var proxied=ContentTools.ToolUI.prototype.unmount;ContentTools.ToolUI.prototype.unmount=function(t,e){return this._domElement.classList.contains("ct-tool--insert-element")&&(this._domElement.removeEventListener("mouseenter",this._toolboxElementsHoverShow),this._domElement.removeEventListener("mouseleave",this._toolboxElementsLeaveHide)),proxied.call(this,t,e)}}();var defaultAlign;!function(){var ready=function(){defaultAlign=getComputedStyle(document.querySelector("html")).textAlign};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),ContentTools.Tools.Align=function(_super){function Align(){return Align.__super__.constructor.apply(this,arguments)}return __extends(Align,_super),Align.displayRule="flex",ContentTools.ToolShelf.stow(Align,"align"),Align.label=pbsParams.labels.alignment,Align.labelDown=pbsParams.labels.alignment,Align.labelReset=pbsParams.labels.reset_alignment,Align.labelLeft=pbsParams.labels.align_left,Align.labelCenter=pbsParams.labels.align_center,Align.labelRight=pbsParams.labels.align_right,Align.labelJustify=pbsParams.labels.justify,Align.icon="align",Align.tagName="span",Align.canApply=function(element,selection){return"Icon"===element.constructor.name||ContentTools.Tools.Bold.canApply(element,selection)},Align.isApplied=function(element){var align;return"Icon"===element.constructor.name?element.hasCSSClass("alignleft")||element.hasCSSClass("alignright")||element.hasCSSClass("aligncenter"):(align=element.style("textAlign"),!!(window.pbsIsRTL()||"start"!==align&&"left"!==align||"start"!==defaultAlign&&"left"!==defaultAlign)&&(!window.pbsIsRTL()||"start"!==align&&"right"!==align||"start"!==defaultAlign&&"right"!==defaultAlign))},Align.apply=function(element,selection,callback){return callback(!0)},Align._apply=function(alignment,button){var element=ContentEdit.Root.get().focused();button&&(button.classList.contains(".ct-tool--disabled")||button.classList.contains("ct-tool--applied"))||("Icon"===element.constructor.name?(element.removeCSSClass("alignleft"),element.removeCSSClass("alignright"),element.removeCSSClass("aligncenter"),element.removeCSSClass("alignnone"),"reset"!==alignment&&element.addCSSClass("align"+alignment)):"reset"!==alignment?element.style("textAlign",alignment):element.style("textAlign",""),button&&(button.parentNode.querySelector(".ct-tool--applied").classList.remove("ct-tool--applied"),button.classList.add("ct-tool--applied")))},Align.mountPopup=function(){var alignLeft=document.createElement("DIV"),alignCenter=document.createElement("DIV"),alignRight=document.createElement("DIV"),alignJustify=document.createElement("DIV");Align.__super__.constructor.mountPopup.call(this),alignLeft.classList.add("ct-tool"),alignCenter.classList.add("ct-tool"),alignRight.classList.add("ct-tool"),alignJustify.classList.add("ct-tool"),alignLeft.classList.add("ct-tool--align-left"),alignCenter.classList.add("ct-tool--align-center"),alignRight.classList.add("ct-tool--align-right"),alignJustify.classList.add("ct-tool--align-justify"),alignLeft.setAttribute("data-tooltip",this.labelLeft),alignCenter.setAttribute("data-tooltip",this.labelCenter),alignRight.setAttribute("data-tooltip",this.labelRight),alignJustify.setAttribute("data-tooltip",this.labelJustify),this.popup.appendChild(alignLeft),this.popup.appendChild(alignCenter),this.popup.appendChild(alignRight),this.popup.appendChild(alignJustify),this.alignLeft=alignLeft,this.alignCenter=alignCenter,this.alignRight=alignRight,this.alignJustify=alignJustify,alignLeft.addEventListener("click",function(e){this._apply("left",e.target)}.bind(this)),alignCenter.addEventListener("click",function(e){this._apply("center",e.target)}.bind(this)),alignRight.addEventListener("click",function(e){this._apply("right",e.target)}.bind(this)),alignJustify.addEventListener("click",function(e){this._apply("justify",e.target)}.bind(this))},Align.showPopup=function(){var _ref,element=ContentEdit.Root.get().focused();Align.__super__.constructor.showPopup.call(this),"ListItemText"!==(_ref=element.type())&&"TableCellText"!==_ref||(element=element.parent()),this.alignLeft.classList.remove("ct-tool--applied"),this.alignCenter.classList.remove("ct-tool--applied"),this.alignRight.classList.remove("ct-tool--applied"),this.alignJustify.classList.remove("ct-tool--applied"),"Icon"===element.constructor.name?(element.hasCSSClass("alignleft")?this.alignLeft.classList.add("ct-tool--applied"):element.hasCSSClass("alignright")?this.alignRight.classList.add("ct-tool--applied"):this.alignCenter.classList.add("ct-tool--applied"),this.alignJustify.classList.add("ct-tool--disabled")):("left"===element.style("textAlign")||"start"===element.style("textAlign")?this.alignLeft.classList.add("ct-tool--applied"):"right"===element.style("textAlign")||"end"===element.style("textAlign")?this.alignRight.classList.add("ct-tool--applied"):"center"===element.style("textAlign")?this.alignCenter.classList.add("ct-tool--applied"):"justify"===element.style("textAlign")&&this.alignJustify.classList.add("ct-tool--applied"),this.alignJustify.classList.remove("ct-tool--disabled"))},Align}(ContentTools.Tools.BasePopup),ContentTools.Tools.Spacer=function(_super){function Spacer(){return Spacer.__super__.constructor.apply(this,arguments)}return __extends(Spacer,_super),ContentTools.ToolShelf.stow(Spacer,"spacer"),Spacer.label=pbsParams.labels.spacer,Spacer.icon="spacer",Spacer.tagName="div",Spacer.buttonName=pbsParams.labels.spacer,Spacer.canApply=function(){return!0},Spacer.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return this.createNew(element.parent(),index),callback(!0)},Spacer.createNew=function(parent,index){var spacer=new ContentEdit.Spacer("div");parent.attach(spacer,index)},Spacer}(ContentTools.Tool),ContentTools.Tools.Sidebar=function(_super){function Sidebar(){return Sidebar.__super__.constructor.apply(this,arguments)}return __extends(Sidebar,_super),ContentTools.ToolShelf.stow(Sidebar,"sidebar"),Sidebar.label=pbsParams.labels.sidebar_or_widget_area,Sidebar.icon="sidebar",Sidebar.tagName="sidebar",Sidebar.buttonName=pbsParams.labels.sidebar,Sidebar.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return this.createNew(element.parent(),index),callback(!0)},Sidebar.createNew=function(parent,index){var sidebarID,shortcode,newElem,defaultSidebar="";for(sidebarID in pbsParams.sidebar_list)if(sidebarID&&pbsParams.sidebar_list.hasOwnProperty(sidebarID)){defaultSidebar=sidebarID;break}shortcode=wp.shortcode.next("pbs_sidebar",'[pbs_sidebar id="'+defaultSidebar+'"][/pbs_sidebar]',0),newElem=ContentEdit.Shortcode.createShortcode(shortcode),parent.attach(newElem,index),newElem.ajaxUpdate(!0),newElem.focus()},Sidebar}(ContentTools.Tools.ElementButton);var oneRem;!function(){var ready=function(){oneRem=parseInt(getComputedStyle(document.querySelector("html")).fontSize,10)};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),ContentTools.Tools.FontSizeUp=function(_super){function FontSizeUp(){return FontSizeUp.__super__.constructor.apply(this,arguments)}return __extends(FontSizeUp,_super),ContentTools.ToolShelf.stow(FontSizeUp,"font-size-up"),FontSizeUp.label=pbsParams.labels.increase_font_size+" {0}",FontSizeUp.labelDown=pbsParams.labels.increase_font_size+" {0}",FontSizeUp.labelReset=pbsParams.labels.reset_font_size,FontSizeUp.icon="font-size-up",FontSizeUp.tagName="span",FontSizeUp.canApply=function(element,selection){return ContentTools.Tools.Bold.canApply(element,selection)},FontSizeUp.isApplied=function(element,selection){var _ref,fontSize,from=0,to=0;return!(void 0===element.content||!element.content.length())&&(selection&&(from=(_ref=selection.get())[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),-1!==(fontSize=element.content.substring(from,to).getStyle("font-size",element)).indexOf("vw")?(fontSize=/(-?\s?[\d\.]+)vw/gi.exec(fontSize)[1].replace(/ /,""),this.refreshTooltip((oneRem+window.innerWidth*fontSize/100).toFixed(1)+"px")):-1!==fontSize.indexOf("px")&&this.refreshTooltip(fontSize.replace(/px/i,"")+"px"),element.content.hasStyle(from,to,"font-size"))},FontSizeUp.doHold=function(element,selection){return this.apply(element,selection,function(){})},FontSizeUp.apply=function(element,selection,callback,force){var _ref,from,to,fontSize,newStyle;return element.storeState(),selection&&(from=(_ref=selection.get())[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),-1!==(fontSize=element.content.substring(from,to).getStyle("font-size",element)).indexOf("vw")?(fontSize=/(-?\s?[\d\.]+)vw/gi.exec(fontSize)[1].replace(/ /,""),fontSize=parseFloat(fontSize)):fontSize=(parseFloat(fontSize)/oneRem-1)*oneRem/(window.innerWidth/100),"reset"===force||window.PBSEditor.isShiftDown&&window.PBSEditor.isCtrlDown?fontSize=0:fontSize+=.05,fontSize=parseFloat(fontSize.toFixed(2)),newStyle={"font-size":"calc(1rem + "+fontSize+"vw)"},element.content=element.content.style(from,to,element._tagName,newStyle),element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},FontSizeUp}(ContentTools.Tool),ContentTools.Tools.FontSizeDown=function(_super){function FontSizeDown(){return FontSizeDown.__super__.constructor.apply(this,arguments)}return __extends(FontSizeDown,_super),ContentTools.ToolShelf.stow(FontSizeDown,"font-size-down"),FontSizeDown.label=pbsParams.labels.decrease_font_size+" {0}",FontSizeDown.labelDown=pbsParams.labels.decrease_font_size+" {0}",FontSizeDown.labelReset=pbsParams.labels.reset_font_size,FontSizeDown.icon="font-size-down",FontSizeDown.tagName="span",FontSizeDown.canApply=function(element,selection){return ContentTools.Tools.Bold.canApply(element,selection)},FontSizeDown.isApplied=function(element,selection){var _ref,fontSize,from=0,to=0;return!(void 0===element.content||!element.content.length())&&(selection&&(from=(_ref=selection.get())[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),-1!==(fontSize=element.content.substring(from,to).getStyle("font-size",element)).indexOf("vw")?(fontSize=/(-?\s?[\d\.]+)vw/gi.exec(fontSize)[1].replace(/ /,""),this.refreshTooltip((oneRem+window.innerWidth*fontSize/100).toFixed(1)+"px")):-1!==fontSize.indexOf("px")&&this.refreshTooltip(fontSize.replace(/px/i,"")+"px"),element.content.hasStyle(from,to,"font-size"))},FontSizeDown.doHold=function(element,selection){return this.apply(element,selection,function(){})},FontSizeDown.apply=function(element,selection,callback,force){var _ref,from,to,fontSize,newStyle,sign="+";return element.storeState(),selection&&(from=(_ref=selection.get())[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),-1!==(fontSize=element.content.substring(from,to).getStyle("font-size",element)).indexOf("vw")?(fontSize=/(-?\s?[\d\.]+)vw/gi.exec(fontSize)[1].replace(/ /,""),fontSize=parseFloat(fontSize)):fontSize=(parseFloat(fontSize)/oneRem-1)*oneRem/(window.innerWidth/100),"reset"===force||window.PBSEditor.isShiftDown&&window.PBSEditor.isCtrlDown?fontSize=0:fontSize>-.5&&(fontSize-=.05),(fontSize=parseFloat(fontSize.toFixed(2)))?(fontSize<0&&(sign="-",fontSize*=-1),newStyle={"font-size":"calc(1rem "+sign+" "+fontSize+"vw)"},element.content=element.content.style(from,to,element._tagName,newStyle)):element.content=element.content.removeStyle(from,to,"font-size"),element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},FontSizeDown}(ContentTools.Tool),ContentTools.Tools.Hr=function(_super){function Hr(){return Hr.__super__.constructor.apply(this,arguments)}return __extends(Hr,_super),ContentTools.ToolShelf.stow(Hr,"hr"),Hr.label=pbsParams.labels.horizontal_rule,Hr.icon="hr",Hr.tagName="hr",Hr.buttonName=pbsParams.labels.horizontal_rule,Hr.canApply=function(){return!0},Hr.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return this.createNew(element.parent(),index),callback(!0)},Hr.createNew=function(parent,index){var hr=new ContentEdit.Hr("hr");parent.attach(hr,index)},Hr}(ContentTools.Tool),ContentTools.Tools.Icon=function(_super){function Icon(){return Icon.__super__.constructor.apply(this,arguments)}return __extends(Icon,_super),ContentTools.ToolShelf.stow(Icon,"icon"),Icon.label=pbsParams.labels.icon,Icon.icon="icon",Icon.tagName="icon",Icon.buttonName=pbsParams.labels.icon,Icon.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return this.createNew(element.parent(),index),callback(!0)},Icon.createNew=function(parent,index){var newElem=new ContentEdit.Icon("div",{style:"fill: #5b7b88"},'<svg viewBox="0 0 24 28"><path d="M16 14q0-1.656-1.172-2.828T12 10t-2.828 1.172T8 14t1.172 2.828T12 18t2.828-1.172T16 14zm8-1.703v3.469q0 .187-.125.359t-.313.203l-2.891.438q-.297.844-.609 1.422.547.781 1.672 2.156.156.187.156.391t-.141.359q-.422.578-1.547 1.687t-1.469 1.109q-.187 0-.406-.141l-2.156-1.687q-.688.359-1.422.594-.25 2.125-.453 2.906-.109.438-.562.438h-3.469q-.219 0-.383-.133t-.18-.336l-.438-2.875q-.766-.25-1.406-.578L5.655 23.75q-.156.141-.391.141-.219 0-.391-.172-1.969-1.781-2.578-2.625-.109-.156-.109-.359 0-.187.125-.359.234-.328.797-1.039t.844-1.102q-.422-.781-.641-1.547l-2.859-.422q-.203-.031-.328-.195t-.125-.367v-3.469q0-.187.125-.359t.297-.203l2.906-.438q.219-.719.609-1.437-.625-.891-1.672-2.156-.156-.187-.156-.375 0-.156.141-.359.406-.562 1.539-1.68t1.477-1.117q.203 0 .406.156l2.156 1.672q.688-.359 1.422-.594.25-2.125.453-2.906.109-.437.562-.437h3.469q.219 0 .383.133t.18.336l.438 2.875q.766.25 1.406.578l2.219-1.672q.141-.141.375-.141.203 0 .391.156 2.016 1.859 2.578 2.656.109.125.109.344 0 .187-.125.359-.234.328-.797 1.039t-.844 1.102q.406.781.641 1.531l2.859.438q.203.031.328.195t.125.367z"></path></svg>');parent.attach(newElem,index)},Icon}(ContentTools.Tools.ElementButton),function(){var proxied=ContentTools.Tools.Link.canApply;ContentTools.Tools.Link.canApply=function(element,selection){var _ref,from,to,ret=proxied.call(this,element,selection);return!(ret||!element.content||!selection||(_ref=selection.get(),from=_ref[0],to=_ref[1],from!==to))||ret}}(),ContentTools.Tools.Link.getSelectedLink=function(element,from,to){if(from<element.content.characters.length&&from>=0&&element.content.characters[from].hasTags("a"))for(;from>0;)if(from--,!element.content.characters[from].hasTags("a")){from++;break}if(to<element.content.characters.length&&to>=0&&element.content.characters[to].hasTags("a"))for(;to<element.content.characters.length&&element.content.characters[to].hasTags("a");)to++;return{from:from,to:to}},ContentTools.Tools.Link.apply=function(element,selection,callback){var hasText,_ref,from,to,selected,tag,url="",target="",text="",existingClass="",existingStyles="";return"Image"===element.constructor.name?element.a&&(url=element.a.href,target=element.a.target||""):(from=(_ref=selection.get())[0],to=_ref[1],from=(selected=this.getSelectedLink(element,from,to)).from,to=selected.to,selection=new ContentSelect.Range(from,to),(tag=this.getTag(element,selection))&&(tag.attr("href")&&(url=tag.attr("href")),tag.attr("target")&&(target=tag.attr("target")),tag.attr("class")&&(existingClass=tag.attr("class")),tag.attr("style")&&(existingStyles=tag.attr("style"))),text=(text=element.content.unformat(from,to,"a")).slice(from,to)),element.storeState&&element.storeState(),hasText=!1,"Image"!==element.constructor.name&&text.html().trim()===text.text().trim()?(hasText=!0,text=text.text()):text="",this.element=element,this.selection=selection,this.existingClass=existingClass,this.existingStyles=existingStyles,this.type=this.name,window.pbsLinkFrame.open({text:text,url:url,target:""!==target,hasText:hasText},ContentTools.Tools.Link._apply.bind(this)),callback(!0)},ContentTools.Tools.Link._apply=function(url,text,target){var _ref,from,to,args,content,tip,tail,element=this.element,selection=this.selection,existingClass=this.existingClass,existingStyles=this.existingStyles,linkType=this.name;"Image"===element.constructor.name?(element.a||(element.a={}),element.a.href=url,element.a.target=target?"_blank":""):(from=(_ref=selection.get())[0],to=_ref[1],element.content=element.content.unformat(from,to,"a"),url?(args={href:url},target&&(args.target="_blank"),existingClass&&(args.class=existingClass),existingStyles&&(args.style=existingStyles),args=wp.hooks.applyFilters("pbs.tool."+linkType.toLowerCase()+".args",args),document.querySelector("#wp-link-wrap").classList.contains("has-text-field")&&""===text.trim()&&(text=url),text?(content=(content=new HTMLString.String(text,"PreText"===element.constructor.name)).format(0,content.characters.length,new HTMLString.Tag("a",args)),tip=element.content.substring(0,selection.get()[0]),tail=element.content.substring(selection.get()[1]),element.content=tip.concat(content),element.content=element.content.concat(tail,!1),from===to&&(to+=content.length())):element.content=element.content.format(from,to,new HTMLString.Tag("a",args))):element.content=element.content.unformat(from,to,"a")),wp.hooks.doAction("pbs.tool."+linkType.toLowerCase()+".applied",element,from,to),"Image"!==element.constructor.name&&(element.updateInnerHTML(),element.taint(),element.restoreState&&element.restoreState())},ContentTools.Tools.Link.getTag=function(element,selection){var c,from,tag,to,_i,_j,_len,_len1,_ref,_ref1,_ref2;if("Image"===element.constructor.name){if(element.a)return element.a}else for(from=(_ref=selection.get())[0],to=_ref[1],_i=0,_len=(_ref1=element.content.slice(from,to).characters).length;_i<_len;_i++)if((c=_ref1[_i]).hasTags("a"))for(_j=0,_len1=(_ref2=c.tags()).length;_j<_len1;_j++)if("a"===(tag=_ref2[_j]).name())return tag;return null},ContentTools.Tools.Widget=function(_super){function Widget(){return Widget.__super__.constructor.apply(this,arguments)}return __extends(Widget,_super),ContentTools.ToolShelf.stow(Widget,"widget"),Widget.label=pbsParams.labels.widget,Widget.icon="widget",Widget.tagName="widget",Widget.buttonName=pbsParams.labels.widget,Widget.apply=function(element,selection,callback){var mainRegion,index,root=ContentEdit.Root.get(),elemFocused=null;return root.focused()?elemFocused=root.focused():(mainRegion=ContentTools.EditorApp.get().regions()["main-content"]).children&&(elemFocused=mainRegion.children[0]),index=elemFocused.parent().children.indexOf(elemFocused)+1,this.createNew(elemFocused.parent(),index),callback(!0)},Widget.createNew=function(parent,index){PBSEditor.widgetFrame.open({title:pbsParams.labels.insert_widget,button:pbsParams.labels.insert_widget,successCallback:function(view){var shortcodeRaw='[pbs_widget widget="'+view.selected.getAttribute("data-widget-slug")+'" ]',shortcode=wp.shortcode.next("pbs_widget",shortcodeRaw,0),elem=ContentEdit.Shortcode.createShortcode(shortcode);parent.attach(elem,index),elem.focus(),setTimeout(function(){elem.ajaxUpdate(!0)},20)}})},Widget}(ContentTools.Tools.ElementButton),ContentTools.Tools.Text=function(_super){function Text(){return Text.__super__.constructor.apply(this,arguments)}return __extends(Text,_super),ContentTools.ToolShelf.stow(Text,"text"),Text.label=pbsParams.labels.text,Text.icon="text",Text.tagName="p",Text.shortcut="",Text.buttonName=pbsParams.labels.text,Text.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return this.createNew(element.parent(),index),callback(!0)},Text.createNew=function(parent,index){var newElem=new ContentEdit.Text("p",{},pbsParams.labels.your_text_here);parent.attach(newElem,index),newElem.focus(),newElem.selection(new ContentSelect.Range(0,newElem.content.length()))},Text}(ContentTools.Tools.ElementButton),ContentTools.Tools.Html=function(_super){function Html(){return Html.__super__.constructor.apply(this,arguments)}return __extends(Html,_super),ContentTools.ToolShelf.stow(Html,"html"),Html.label=pbsParams.labels.html,Html.icon="html",Html.tagName="html",Html.buttonName=pbsParams.labels.html,Html.apply=function(element,selection,callback){var mainRegion,dummy,elem,index,root=ContentEdit.Root.get(),elemFocused=null;return root.focused()?elemFocused=root.focused():(mainRegion=ContentTools.EditorApp.get().regions()["main-content"]).children&&(elemFocused=mainRegion.children[0]),(dummy=document.createElement("DIV")).setAttribute("data-ce-tag","html"),elem=ContentEdit.Html.fromDOMElement(dummy),index=elemFocused.parent().children.indexOf(elemFocused),elemFocused.parent().attach(elem,index+1),elem.focus(),elem.openEditor(),callback(!0)},Html.createNew=function(parent,index){var elem,dummy=document.createElement("DIV");dummy.setAttribute("data-ce-tag","html"),elem=ContentEdit.Html.fromDOMElement(dummy),parent.attach(elem,index),elem.focus(),elem.openEditor()},Html}(ContentTools.Tools.ElementButton),ContentTools.Tools.Map=function(_super){function Map(){return Map.__super__.constructor.apply(this,arguments)}return __extends(Map,_super),ContentTools.ToolShelf.stow(Map,"map"),Map.label=pbsParams.labels.map,Map.icon="map",Map.tagName="div",Map.shortcut="",Map.buttonName=pbsParams.labels.google_map,Map.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return this.createNew(element.parent(),index),callback(!0)},Map.createNew=function(parent,index){var newElem=ContentEdit.Map.create();parent.attach(newElem,index),newElem.focus()},Map}(ContentTools.Tools.ElementButton),ContentTools.Tools.Tabs=function(_super){function Tabs(){return Tabs.__super__.constructor.apply(this,arguments)}return __extends(Tabs,_super),ContentTools.ToolShelf.stow(Tabs,"tabs"),Tabs.label=pbsParams.labels.tabs,Tabs.icon="tabs",Tabs.tagName="tabs",Tabs.buttonName=pbsParams.labels.tabs,Tabs.apply=function(element,selection,callback){var index;if(window.pbsSelectorMatches(element._domElement,'[data-ce-tag="tabs"] *'))for(;element&&"Tabs"!==element.constructor.name;)element=element.parent();return index=element.parent().children.indexOf(element)+1,this.createNew(element.parent(),index),callback(!0)},Tabs.createNew=function(parent,index){for(var newElem,elem,hash,hashes=[];hashes.length<4;)hash=window.PBSEditor.generateHash(),document.querySelector(".pbs-tabs-"+hash)||document.querySelector('[id="pbs-tabs-'+hash+'"]')||-1===hashes.indexOf(hash)&&hashes.push(hash);(elem=document.createElement("div")).classList.add("pbs-tabs-"+hashes[0]),elem.setAttribute("data-ce-tag","tabs"),elem.innerHTML='<input class="pbs-tab-state" type="radio" name="pbs-tabs-'+hashes[0]+'" id="pbs-tab-'+hashes[1]+'" data-tab="1" data-ce-tag="tabradio" checked /><input class="pbs-tab-state" type="radio" name="pbs-tabs-'+hashes[0]+'" id="pbs-tab-'+hashes[2]+'" data-tab="2" data-ce-tag="tabradio" /><input class="pbs-tab-state" type="radio" name="pbs-tabs-'+hashes[0]+'" id="pbs-tab-'+hashes[3]+'" data-tab="3" data-ce-tag="tabradio" /><div class="pbs-tab-tabs" data-ce-tag="tabcontainer"><label for="pbs-tab-'+hashes[1]+'" data-ce-tag="tab" class="pbs-tab-active"><span style="font-weight: bold;">Tab 1</span></label><label for="pbs-tab-'+hashes[2]+'" data-ce-tag="tab"><span style="font-weight: bold;">Tab 2</span></label><label for="pbs-tab-'+hashes[3]+'" data-ce-tag="tab"><span style="font-weight: bold;">Tab 3</span></label></div><div class="pbs-tab-panels" data-ce-tag="tabpanelcontainer"><div class="pbs-row" data-panel="1"><div class="pbs-col"><p>Tab 1 content</p></div></div><div class="pbs-row" data-panel="2"><div class="pbs-col"><p>Tab 2 content</p></div></div><div class="pbs-row" data-panel="3"><div class="pbs-col"><p>Tab 3 content</p></div></div></div>',newElem=ContentEdit.Tabs.fromDOMElement(elem),parent.attach(newElem,index),newElem.focus()},Tabs}(ContentTools.Tools.ElementButton),ContentTools.Tools.LineHeight=function(_super){function LineHeight(){return LineHeight.__super__.constructor.apply(this,arguments)}return __extends(LineHeight,_super),ContentTools.ToolShelf.stow(LineHeight,"line-height"),LineHeight.label=pbsParams.labels.increase_line_height+" {0}",LineHeight.labelDown=pbsParams.labels.decrease_line_height+" {0}",LineHeight.labelReset=pbsParams.labels.reset_line_height,LineHeight.icon="line-height",LineHeight.tagName="span",LineHeight.displayRule="flex",LineHeight.canApply=function(element,selection){return ContentTools.Tools.Bold.canApply(element,selection)},LineHeight.isApplied=function(element){return this.refreshTooltip(element._domElement.style.lineHeight),!!element._domElement.style.lineHeight},LineHeight.getDefaultLineHeight=function(element){var baseStyles,defaultLineHeight=element.defaultStyle("line-height");return defaultLineHeight&&(baseStyles=window.getComputedStyle(element._domElement),defaultLineHeight=-1!==defaultLineHeight.indexOf("px")?parseInt(defaultLineHeight,10)/parseInt(baseStyles["font-size"],10):parseFloat(defaultLineHeight),defaultLineHeight=Math.round(10*defaultLineHeight)/10),defaultLineHeight},LineHeight.getCurrentLineHeight=function(element){var baseStyles,style=element.style("line-height");return-1!==style.indexOf("em")?style=parseFloat(style):(baseStyles=window.getComputedStyle(element._domElement),style=parseInt(style,10)/parseInt(baseStyles["font-size"],10)),Math.round(10*style)/10},LineHeight.apply=function(element,selection,callback,force){var style,defaultStyle;return element.storeState(),style=this.getCurrentLineHeight(element),defaultStyle=this.getDefaultLineHeight(element),style=Math.round(10*style),"up"===force?(style++,style/=10):"reset"===force||window.PBSEditor.isShiftDown&&window.PBSEditor.isCtrlDown?style=defaultStyle:"down"===force||window.PBSEditor.isCtrlDown?(style--,style/=10):(style++,style/=10),defaultStyle===style?style="":style+="em",element.style("line-height",style),callback(!0)},LineHeight.doHold=function(element,selection){return this.apply(element,selection,function(){})},LineHeight.mountPopup=function(){var change,label=document.createElement("SPAN"),slider=document.createElement("DIV"),input=document.createElement("INPUT");LineHeight.__super__.constructor.mountPopup.call(this),label.innerHTML="em",this.popup.appendChild(slider),this.popup.appendChild(input),this.popup.appendChild(label),jQuery(slider).slider({range:"min",max:4,min:0,step:.1,animate:"fast",change:function(event,ui){var input=this._ceElement._domElement.querySelector("input"),value=parseFloat(ui.value);(0===value||isNaN(value))&&(value=""),value!==input.value&&(input.value=value,input.dispatchEvent(new CustomEvent("change")))}.bind(this),slide:function(event,ui){var input=this._ceElement._domElement.querySelector("input"),value=parseFloat(ui.value);(0===value||isNaN(value))&&(value=""),value!==input.value&&(input.value=value,input.dispatchEvent(new CustomEvent("change")))}.bind(this)}),change=function(ev){var element=ContentEdit.Root.get().focused(),value=ev.target.value;"0"===value&&(value=""),value?element.style("line-height",value+"em"):element.style("line-height","")},input.addEventListener("change",change),input.addEventListener("keyup",change)},LineHeight.showPopup=function(){var element,value;LineHeight.__super__.constructor.showPopup.call(this),element=ContentEdit.Root.get().focused(),value=this.getCurrentLineHeight(element),jQuery(this._ceElement._domElement).find("div div:eq(0)").slider("value",value),this._ceElement._domElement.querySelector("input").value=value,this._ceElement._domElement.querySelector("input").focus(),this._ceElement._domElement.querySelector("input").select()},LineHeight}(ContentTools.Tools.BasePopup);var toolMediaFrame,imageInserted,boundInsertHandler;wp.media.view.settings.post&&(wp.media.view.settings.post.id=pbsParams.post_id),ContentTools.Tools.pbsMedia=function(_super){function pbsMedia(){return pbsMedia.__super__.constructor.apply(this,arguments)}return __extends(pbsMedia,_super),ContentTools.ToolShelf.stow(pbsMedia,"pbs-media"),pbsMedia.label=pbsParams.labels.media,pbsMedia.icon="image",pbsMedia.buttonName=pbsParams.labels.media,pbsMedia.apply=function(element,selection){var elem;this._isOpen()||(elem=ContentEdit.Root.get().focused(),ContentSelect.Range.query(elem._domElement),selection=ContentSelect.Range.query(elem._domElement),window._tempSelection=selection,this.createNew(element.parent(),elem.parent().children.indexOf(elem)+1))},pbsMedia.createNew=function(parent,index){this._attachToParent=parent,this._attachIndex=index,window._pbsAddMediaOrigInsert=wp.media.editor.insert,wp.media.editor.insert=this.pbsAddMediaOverrideInsert.bind(this),toolMediaFrame=wp.media.editor.open(),boundInsertHandler||(boundInsertHandler=pbsMedia.insertHandler.bind(this)),toolMediaFrame.on("insert",boundInsertHandler)},pbsMedia.insertHandler=function(g){var size=g.single().attributes.sizes[toolMediaFrame.$el.find('[name="size"]').val()],img=document.createElement("IMG");img.setAttribute("height",size.height),img.setAttribute("width",size.width),img.classList.add("aligncenter"),img.classList.add("ce-element"),img.classList.add("ce-element--type-image"),img.classList.add("wp-image-"+pbsParams.dummy_image_id),img.setAttribute("data-ce-size","w "+size.width+" x h 1"),img.setAttribute("alt",""),imageInserted=ContentEdit.Image.fromDOMElement(img),this._attachToParent.attach(imageInserted,this._attachIndex),toolMediaFrame.off("insert",boundInsertHandler)},pbsMedia._isOpen=function(){var el;return!!wp.media.editor.get()&&!(0===(el=wp.media.editor.get().el).offsetWidth&&0===el.offsetHeight)},pbsMedia.pbsAddMediaOverrideInsert=function(html){var base,shortcode,dummy,newElem;html.match(/^\[/)?(base=(base=html.match(/^\[(\w+)/))[1],shortcode=wp.shortcode.next(base,html,0),newElem=ContentEdit.Shortcode.createShortcode(shortcode),imageInserted&&(this._attachToParent.detach(imageInserted),imageInserted=null),this._attachToParent.attach(newElem,this._attachIndex),newElem.ajaxUpdate(!0)):((dummy=document.createElement("p")).innerHTML=html,newElem=ContentEdit.Image.fromDOMElement(dummy.firstChild),imageInserted&&(this._attachToParent.detach(imageInserted),imageInserted=null),newElem&&this._attachToParent.attach(newElem,this._attachIndex)),wp.media.editor.insert=window._pbsAddMediaOrigInsert,delete window._pbsAddMediaOrigInsert},pbsMedia}(ContentTools.Tools.ElementButton),function(){var dragEnterHandler=function(ev){var i,elem,mediaModals,allModalsHidden,isFile;if(isFile=!0,ev.dataTransfer&&ev.dataTransfer.types)for(isFile=!1,i=0;i<ev.dataTransfer.types.length;i++)"Files"===ev.dataTransfer.types[i]&&(isFile=!0);isFile&&(mediaModals=document.querySelectorAll('[tabindex="0"] .media-modal'),allModalsHidden=!0,Array.prototype.forEach.call(mediaModals,function(el){0!==el.offsetHeight&&(allModalsHidden=!1)}),allModalsHidden&&(elem=ContentEdit.Root.get().focused())&&window.PBSEditor.getToolUI("pbs-media").apply(elem,null))},ready=function(){var editor=ContentTools.EditorApp.get();editor.bind("start",function(){document.addEventListener("dragenter",dragEnterHandler)}),editor.bind("stop",function(){document.removeEventListener("dragenter",dragEnterHandler)})};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),ContentTools.Tools.Table.canApply=function(){return!0},ContentTools.Tools.Table.createNew=function(parent,index){var app,dialog,modal,table;return app=ContentTools.EditorApp.get(),modal=new ContentTools.ModalUI,table=null,(dialog=new ContentTools.TableDialog(table)).bind("cancel",function(){dialog.unbind("cancel"),modal.hide(),dialog.hide()}),dialog.bind("save",function(_this){return function(tableCfg){dialog.unbind("save"),table=_this._createTable(tableCfg),parent.attach(table,index),table.firstSection().children[0].children[0].children[0].focus(),modal.hide(),dialog.hide()}}(this)),app.attach(modal),app.attach(dialog),modal.show(),dialog.show()},ContentTools.Tools.Underline=function(_super){function Underline(){return Underline.__super__.constructor.apply(this,arguments)}return __extends(Underline,_super),ContentTools.ToolShelf.stow(Underline,"underline"),Underline.label=pbsParams.labels.underline,Underline.icon="underline",Underline.tagName="span",Underline.shortcut="ctrl+u",Underline.canApply=function(element,selection){return ContentTools.Tools.Bold.canApply(element,selection)},Underline.isApplied=function(element,selection){var _ref,from=0,to=0;return!(void 0===element.content||!element.content.length())&&(selection&&(from=(_ref=selection.get())[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),"underline"===element.content.substring(from,to).getStyle("text-decoration",element))},Underline.apply=function(element,selection,callback){var from,to,_ref,style,newStyle;return element.storeState(),_ref=selection.get(),from=_ref[0],to=_ref[1],from===to&&(from=0,to=element.content.length()),style=element.content.substring(from,to).getStyle("text-decoration",element),style=style&&"none"!==style&&"line-through"!==style?"none":"underline",newStyle={"text-decoration":style},element.content=element.content.style(from,to,element._tagName,newStyle),element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},Underline}(ContentTools.Tool),ContentTools.Tools.paragraphPicker=function(_super){function paragraphPicker(){return paragraphPicker.__super__.constructor.apply(this,arguments)}return __extends(paragraphPicker,_super),ContentTools.ToolShelf.stow(paragraphPicker,"paragraphPicker"),paragraphPicker.label=pbsParams.labels.text_style,paragraphPicker.icon="paragraph-picker",paragraphPicker.tagName="p",paragraphPicker.types={p:{className:"Paragraph",label:pbsParams.labels.paragraph},h1:{className:"Heading1",label:pbsParams.labels.heading_1},h2:{className:"Heading2",label:pbsParams.labels.heading_2},h3:{className:"Heading3",label:pbsParams.labels.heading_3},h4:{className:"Heading4",label:pbsParams.labels.heading_4},h5:{className:"Heading5",label:pbsParams.labels.heading_5},h6:{className:"Heading6",label:pbsParams.labels.heading_6},blockquote:{className:"Blockquote",label:'"'+pbsParams.labels.blockquote+'"'},pre:{className:"Preformatted",label:pbsParams.labels.preformatted}},paragraphPicker.canApply=function(element){var tag;if(this.types.hasOwnProperty(element.tagName())){for(tag in this.types)this.types.hasOwnProperty(tag)&&element.tagName()!==tag&&this._ceElement._domElement.classList.contains("pbs-paragraph-picker-type-"+tag)&&this._ceElement._domElement.classList.remove("pbs-paragraph-picker-type-"+tag);this._ceElement._domElement.classList.contains("pbs-paragraph-picker-type-"+element.tagName())||(this._ceElement._domElement.classList.add("pbs-paragraph-picker-type-"+element.tagName()),this._ceElement._domElement.firstChild.textContent=this.types[element.tagName()].label)}return"LABEL"!==element._domElement.tagName&&void 0!==element},paragraphPicker.isApplied=function(){return!this._ceElement._domElement.classList.contains("pbs-paragraph-picker-type-p")},paragraphPicker.apply=function(element,selection,callback){return this.applyTag(element,this._selectedType,selection,callback)},paragraphPicker.applyTag=function(element,tag,selection,callback){var app,forceAdd,paragraph,region,prevColor,prevFontFamily,prevFontName;(app=ContentTools.EditorApp.get())._ctrlDown=!1,forceAdd=app.ctrlDown(),element.storeState&&element.storeState(),!pbsParams.is_lite&&selection&&ContentTools.Tools.LineHeight.apply(element,selection,function(){},"reset"),prevColor=ContentTools.Tools.Color.canApply(element,selection),prevFontFamily=element._domElement.style.fontFamily,prevFontName=element._domElement.getAttribute("data-font-family"),ContentTools.Tools.ClearFormatting.apply(element,selection,function(){}),ContentTools.Tools.Heading.canApply(element)&&!forceAdd?ContentTools.Tools[paragraphPicker.types[tag].className].apply(element,selection,callback):("Region"!==element.parent().type()&&(element=element.closest(function(node){return"Region"===node.parent().type()})),region=element.parent(),paragraph=new ContentEdit.Text(tag),region.attach(paragraph,region.children.indexOf(element)+1),paragraph.focus(),callback(!0)),prevColor!==element.defaultStyle("color")&&ContentTools.Tools.Color.applyColor(prevColor,element,selection),prevFontFamily&&ContentTools.Tools.FontPicker&&ContentTools.Tools.FontPicker.selectFont(prevFontName,prevFontFamily),element.restoreState&&element.restoreState()},paragraphPicker.mountPopup=function(){var tag,label;this._ceElement._domElement.innerHTML=pbsParams.labels.paragraph,paragraphPicker.__super__.constructor.mountPopup.call(this);for(tag in this.types)this.types.hasOwnProperty(tag)&&((label=document.createElement(tag)).innerHTML=this.types[tag].label,label.setAttribute("data-tag",tag),label.setAttribute("data-class",this.types[tag].className),this.popup.appendChild(label),label.addEventListener("mousedown",function(ev){ev.preventDefault(),this._selectedType=ev.target.getAttribute("data-tag"),this._selectedClass=ev.target.getAttribute("data-class"),this._ceElement._mouseDown=!0,this._ceElement._onMouseUp(),this.hidePopup()}.bind(this)))},paragraphPicker}(ContentTools.Tools.BasePopup),ContentTools.Tools.Strikethrough=function(_super){function Strikethrough(){return Strikethrough.__super__.constructor.apply(this,arguments)}return __extends(Strikethrough,_super),ContentTools.ToolShelf.stow(Strikethrough,"strikethrough"),Strikethrough.label=pbsParams.labels.strikethrough,Strikethrough.icon="strikethrough",Strikethrough.tagName="span",Strikethrough.canApply=function(element,selection){return ContentTools.Tools.Bold.canApply(element,selection)},Strikethrough.isApplied=function(element,selection){var _ref,from=0,to=0;return!(void 0===element.content||!element.content.length())&&(selection&&(from=(_ref=selection.get())[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),"line-through"===element.content.substring(from,to).getStyle("text-decoration",element))},Strikethrough.apply=function(element,selection,callback){var from,to,_ref,style,newStyle;return element.storeState(),_ref=selection.get(),from=_ref[0],to=_ref[1],from===to&&(from=0,to=element.content.length()),style=element.content.substring(from,to).getStyle("text-decoration",element),style=style&&"none"!==style&&"underline"!==style?"none":"line-through",newStyle={"text-decoration":style},element.content=element.content.style(from,to,element._tagName,newStyle),element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},Strikethrough}(ContentTools.Tool),ContentTools.Tools.Uppercase=function(_super){function Uppercase(){return Uppercase.__super__.constructor.apply(this,arguments)}return __extends(Uppercase,_super),ContentTools.ToolShelf.stow(Uppercase,"uppercase"),Uppercase.label=pbsParams.labels.uppercase,Uppercase.labelReset=pbsParams.labels.reset_case,Uppercase.icon="uppercase",Uppercase.tagName="span",Uppercase.canApply=function(element,selection){return ContentTools.Tools.Bold.canApply(element,selection)},Uppercase.isApplied=function(element,selection){var _ref,from=0,to=0;return!(void 0===element.content||!element.content.length())&&(selection&&(from=(_ref=selection.get())[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),element.content.hasStyle(from,to,"text-transform"))},Uppercase.apply=function(element,selection,callback){var from,to,_ref,style,newStyle;return element.storeState(),_ref=selection.get(),from=_ref[0],to=_ref[1],from===to&&(from=0,to=element.content.length()),style=element.content.substring(from,to).getStyle("text-transform",element),style=style&&"none"!==style&&"lowercase"!==style?"none":"uppercase",newStyle={"text-transform":style},element.content=element.content.style(from,to,element._tagName,newStyle),element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},Uppercase}(ContentTools.Tool);var redoKey,code,matches,key,sc;PBSEditor.shortcuts={"ctrl+r":function(element,selection){ContentTools.Tools.Align.canApply(element,selection)&&ContentTools.Tools.Align._apply("right")},"ctrl+u":function(element,selection,callback){ContentTools.Tools.Underline.canApply(element,selection)&&ContentTools.Tools.Underline.apply(element,selection,callback)},"ctrl+e":function(element,selection){ContentTools.Tools.Align.canApply(element,selection)&&ContentTools.Tools.Align._apply("center")},"ctrl+l":function(element,selection){ContentTools.Tools.Align.canApply(element,selection)&&ContentTools.Tools.Align._apply("left")},"ctrl+j":function(element,selection){ContentTools.Tools.Align.canApply(element,selection)&&ContentTools.Tools.Align._apply("justify")},"ctrl+i":function(element,selection,callback){ContentTools.Tools.Italic.canApply(element,selection)&&ContentTools.Tools.Italic.apply(element,selection,callback)},"ctrl+b":function(element,selection,callback){ContentTools.Tools.Bold.canApply(element,selection)&&ContentTools.Tools.Bold.apply(element,selection,callback)},"ctrl+k":function(element,selection,callback){ContentTools.Tools.Link.canApply(element,selection)&&ContentTools.Tools.Link.apply(element,selection,callback)},"ctrl+shift+k":function(element,selection,callback){ContentTools.Tools.Button.canApply(element,selection)&&ContentTools.Tools.Button.apply(element,selection,callback)},"ctrl+p":function(element,selection,callback){ContentTools.Tools.paragraphPicker.applyTag(element,"p",selection,callback)},"ctrl+1":function(element,selection,callback){ContentTools.Tools.paragraphPicker.applyTag(element,"h1",selection,callback)},"ctrl+2":function(element,selection,callback){ContentTools.Tools.paragraphPicker.applyTag(element,"h2",selection,callback)},"ctrl+3":function(element,selection,callback){ContentTools.Tools.paragraphPicker.applyTag(element,"h3",selection,callback)},"ctrl+4":function(element,selection,callback){ContentTools.Tools.paragraphPicker.applyTag(element,"h4",selection,callback)},"ctrl+.":function(element,selection,callback){ContentTools.Tools.UnorderedList.canApply(element,selection)&&ContentTools.Tools.UnorderedList.apply(element,selection,callback)},"ctrl+/":function(element,selection,callback){ContentTools.Tools.OrderedList.canApply(element,selection)&&ContentTools.Tools.OrderedList.apply(element,selection,callback)},"ctrl+=":function(element,selection,callback){ContentTools.Tools.FontSizeUp.canApply(element,selection)&&ContentTools.Tools.FontSizeUp.apply(element,selection,callback,"up")},"ctrl+-":function(element,selection,callback){ContentTools.Tools.FontSizeDown.canApply(element,selection)&&ContentTools.Tools.FontSizeDown.apply(element,selection,callback,"down")},"ctrl+o":function(element,selection,callback){ContentTools.Tools.Code.canApply(element,selection)&&ContentTools.Tools.Code.apply(element,selection,callback)},"ctrl+z":function(){ContentTools.Tools.Undo.apply(null,null,function(){})},"ctrl+m":function(element,selection,callback){ContentTools.Tools.pbsMedia.apply(element,selection,callback)}},redoKey=-1!==navigator.appVersion.indexOf("Mac")?"ctrl+shift+z":"ctrl+y",PBSEditor.shortcuts[redoKey]=function(){ContentTools.Tools.Redo.apply(null,null,function(){})},ContentTools.Tools.paragraphPicker.label+=" (ctrl+p/1/2/3)",ContentTools.Tools.Bold.label+=" (ctrl+b)",ContentTools.Tools.Italic.label+=" (ctrl+i)",ContentTools.Tools.Underline.label+=" (ctrl+u)",ContentTools.Tools.Link.label+=" (ctrl+k)",ContentTools.Tools.Align.labelLeft+=" (ctrl+l)",ContentTools.Tools.Align.labelCenter+=" (ctrl+e)",ContentTools.Tools.Align.labelRight+=" (ctrl+r)",ContentTools.Tools.Align.labelJustify+=" (ctrl+j)",ContentTools.Tools.Code.label+=" (ctrl+o)",ContentTools.Tools.UnorderedList.label+=" (ctrl+.)",ContentTools.Tools.OrderedList.label+=" (ctrl+/)",ContentTools.Tools.Undo.label+=" (ctrl+z)",ContentTools.Tools.Redo.label+=" ("+redoKey+")",PBSEditor._shortcuts={};for(code in PBSEditor.shortcuts)if(PBSEditor.shortcuts.hasOwnProperty(code)){if(!(matches=code.match(/(^.*\+)([^+]*)$/)).length)continue;switch(key=matches[1],sc=matches[2]){case"space":sc=32;break;case"up":sc=38;break;case"right":sc=39;break;case"down":sc=40;break;case"left":sc=37;break;case"tab":sc=9;break;case"enter":sc=13;break;case".":sc=190;break;case"/":sc=191;break;case"=":sc=187;break;case"-":sc=189;break;case"delete":sc=8}"number"==typeof sc?key+=sc:(sc=sc.match(/[a-z]/)?sc.toUpperCase():sc,key+=sc.charCodeAt(0)),PBSEditor._shortcuts[key]=PBSEditor.shortcuts[code]}PBSEditor.shortcuts=PBSEditor._shortcuts,PBSEditor._shortcuts=null,function(){var getShortcutKey=function(ev){var key="";if((ev.metaKey||ev.ctrlKey)&&(key+="ctrl"),ev.shiftKey&&(key+=key?"+":"",key+="shift"),key)return key+="+"+ev.keyCode},shortcutListener=function(ev){var key,element,selection=null;if(PBS.isEditing)if(key=getShortcutKey(ev),element=ContentEdit.Root.get().focused(),wp.hooks.applyFilters("pbs.shortcuts",!1,key,element))ev.preventDefault();else if(element)return PBSEditor.shortcuts[key]?(element.selection&&(selection=element.selection()),ev.preventDefault(),PBSEditor.shortcuts[key](element,selection,function(){}),wp.hooks.doAction("pbs.shortcut.keyup"),ev.preventDefault(),void ev.stopPropagation()):void 0},ready=function(){document.addEventListener("keydown",shortcutListener)};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),function(){var ready=function(){document.addEventListener("keydown",function(ev){var element;ContentTools.EditorApp.get();window.innerWidth<=800||(PBS.isEditing?!ev.metaKey&&!ev.ctrlKey||83!==ev.keyCode&&27!==ev.keyCode?(ev.metaKey||ev.ctrlKey)&&ev.shiftKey&&82===ev.keyCode&&(ev.preventDefault(),location.reload()):(ev.preventDefault(),(element=ContentEdit.Root.get().focused())&&element.blur(),83===ev.keyCode?PBS.save():PBS.cancel()):(ev.metaKey||ev.ctrlKey)&&69===ev.keyCode&&(PBS.edit(),ev.preventDefault()))})};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),ContentTools.Tools.PremiumFormatting=function(_super){function PremiumFormatting(){return PremiumFormatting.__super__.constructor.apply(this,arguments)}return __extends(PremiumFormatting,_super),ContentTools.ToolShelf.stow(PremiumFormatting,"premium-formatting"),PremiumFormatting.label="",PremiumFormatting.labelReset="",PremiumFormatting.icon="",PremiumFormatting.canApply=function(element,selection){return ContentTools.Tools.Bold.canApply(element,selection)},PremiumFormatting.isApplied=function(){return!1},PremiumFormatting.apply=function(element,selection,callback){return callback(!0)},PremiumFormatting}(ContentTools.Tool),PBSModal.PremiumFeaturesModal=class extends PBSModal.Modal{constructor(){super("pbs-learn-premium-elements")}init(){super.init(),this.element.querySelector(".pbs-flags-button").addEventListener("click",function(){var payload=new FormData,request=new XMLHttpRequest;document.body.classList.toggle("pbs-hide-premium-flags"),payload.append("hide",document.body.classList.contains("pbs-hide-premium-flags")?"1":""),payload.append("action","premium_flag_toggle"),payload.append("nonce",pbsParams.nonce),request.open("POST",pbsParams.ajax_url),request.send(payload)})}},PBSModal.LearnPremiumModal=class extends PBSModal.Modal{constructor(){super("pbs-learn-premium"),this.carousel=null,this.indicators=[],this.slides=[],this.switcher=null}init(){var i;if(super.init(),this.carousel=this.element.querySelector(".pbs-learn-carousel"),this.carousel)for(this.slides=this.carousel.querySelectorAll(".pbs-learn-slide"),this.indicators=this.carousel.querySelectorAll(".pbs-learn-indicators label"),i=0;i<this.indicators.length;i++)this.indicators[i].querySelector("input").addEventListener("change",this.thumbClickHandler.bind(this));this.setSlide(0)}carouselHide(num){this.indicators[num].setAttribute("data-state",""),this.slides[num].setAttribute("data-state",""),this.slides[num].style.opacity=0}carouselShow(num){this.indicators[num].checked=!0,this.indicators[num].setAttribute("data-state","active"),this.slides[num].setAttribute("data-state","active"),this.slides[num].style.opacity=1}thumbClickHandler(ev){var slide=parseInt(ev.target.getAttribute("data-slide"),10)-1;this.setSlide(slide)}setSlide(slide){var i;for(i=0;i<this.indicators.length;i++)this.indicators[i].setAttribute("data-state",""),this.slides[i].setAttribute("data-state",""),this.carouselHide(i);this.indicators[slide].setAttribute("data-state","active"),this.slides[slide].setAttribute("data-state","active"),this.carouselShow(slide),clearInterval(this.switcher),this.switcher=null}switchSlide(){var i,nextSlide=0;for(i=0;i<this.indicators.length;i++)"active"===this.indicators[i].getAttribute("data-state")&&i!==this.indicators.length-1&&(nextSlide=i+1),this.carouselHide(i);this.carouselShow(nextSlide)}show(){super.show(),this.setSlide(0),this.switcher&&clearInterval(this.switcher),this.switcher=setInterval(function(){this.switchSlide()}.bind(this),7e3)}hide(){super.hide(),this.switcher&&clearInterval(this.switcher),this.switcher=null}},new function(){var ready=function(){var premiumModal,premiumFlagModal,goPremiumButton;!pbsParams.show_premium_flags&&pbsParams.is_lite&&document.body.classList.add("pbs-hide-premium-flags"),pbsParams.is_lite&&((premiumModal=new PBSModal.LearnPremiumModal).init(),(goPremiumButton=document.querySelector("#wp-admin-bar-pbs_go_premium"))&&goPremiumButton.addEventListener("click",function(){premiumModal.show()}),(premiumFlagModal=new PBSModal.PremiumFeaturesModal).init(),document.addEventListener("click",function(ev){window.pbsSelectorMatches(ev.target,".pbs-premium-flag:not(.pbs-collapsable-title), .pbs-premium-flag:not(.pbs-collapsable-title) *")&&premiumFlagModal.show()}))};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)},PBSModal.IntroTourModal=class extends PBSModal.Modal{constructor(){super("pbs-intro-tour")}init(){}show(){super.init(),super.show()}hide(){super.hide(),super.destroy()}},new function(){var ready=function(){if(pbsParams.do_intro){var modal=new PBSModal.IntroTourModal;modal.init(),wp.hooks.addAction("pbs.start",function(){if(localStorage){if(localStorage.getItem("pbs_did_intro_v4"))return;localStorage.setItem("pbs_did_intro_v4",1)}modal.show(),payload=new FormData,payload.append("action","pbs_did_tour"),payload.append("nonce",pbsParams.nonce),xhr=new XMLHttpRequest,xhr.open("POST",pbsParams.ajax_url),xhr.send(payload)})}};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)},function(){var ready=function(){jQuery(document).on("heartbeat-send",function(e,data){PBS.isEditing&&(data.tracking_interval=wp.heartbeat.interval())})};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),function(){var ready=function(){pbsParams.tracking_opted_in&&wp.hooks.addAction("pbs.save.payload.after",function(payload){var xhrTracking=new XMLHttpRequest;xhrTracking.open("POST",pbsParams.ajax_url),payload.set("action","pbs_save_content_tracking"),xhrTracking.send(payload)})};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),function(){var proxied=jQuery.fn.is;jQuery.fn.is=function(selector){var elem,ret=proxied.call(this,selector);return ret&&'<div tabindex="0"></div>'===(elem=this[0]).outerHTML?!!(elem.offsetWidth||elem.offsetHeight||elem.getClientRects().length):ret}}(),function(){var ready=function(){function checkHeartbeat(){var xhr,payload=new FormData;payload.append("action","pbs_heartbeat_check"),payload.append("post_id",pbsParams.post_id),payload.append("nonce",pbsParams.nonce),payload.append("media_manager_editor_nonce",wp.media.view.settings.nonce.sendToEditor),(xhr=new XMLHttpRequest).onload=function(){var response,data,div;xhr.status>=200&&xhr.status<400&&(response=JSON.parse(xhr.responseText))&&(response.post_lock&&(data={avatar:response.post_lock_avatar,avatar2x:response.post_lock_avatar2x,author_name:response.post_lock_author_name},(div=document.createElement("DIV")).innerHTML=wp.template("pbs-heartbeat-locked")(data),div.setAttribute("id","pbs-post-locked-dialog"),document.body.appendChild(div),modalIsOpen=!0,document.querySelector(".pbs-post-locked-back").addEventListener("click",function(ev){ev.preventDefault(),modalIsOpen=!1,doRemovePostLock=!1,PBS.cancel(),div.parentNode.removeChild(div)}),document.querySelector(".pbs-post-locked-takeover").addEventListener("click",function(ev){ev.preventDefault(),modalIsOpen=!1,overridePostLock(),div.parentNode.removeChild(div)})),response.nonce&&(pbsParams.nonce=response.nonce),response.media_manager_editor_nonce&&(wp.media.view.settings.nonce.sendToEditor=response.media_manager_editor_nonce))}.bind(this),xhr.onerror=function(){},xhr.open("POST",pbsParams.ajax_url),xhr.send(payload)}function removePostLock(){var xhr,payload=new FormData;payload.append("action","pbs_remove_post_lock"),payload.append("post_id",pbsParams.post_id),payload.append("nonce",pbsParams.nonce),(xhr=new XMLHttpRequest).open("POST",pbsParams.ajax_url),xhr.send(payload)}function overridePostLock(){var xhr,payload=new FormData;payload.append("action","pbs_override_post_lock"),payload.append("post_id",pbsParams.post_id),payload.append("nonce",pbsParams.nonce),(xhr=new XMLHttpRequest).open("POST",pbsParams.ajax_url),xhr.send(payload)}function doAutosave(){var content,xhr,payload=new FormData;payload.append("action","pbs_autosave"),payload.append("post_id",pbsParams.post_id),payload.append("nonce",pbsParams.nonce),content=PBS.controller.contentProvider.content,content=wp.hooks.applyFilters("pbs.save",content),payload.append("content",content),(xhr=new XMLHttpRequest).open("POST",pbsParams.ajax_url),xhr.send(payload)}var lastAutosave,loginListenerInterval,loginListener,startLoginListener,modalIsOpen,doRemovePostLock;wp.heartbeat&&(wp.heartbeat.interval(120),lastAutosave=+new Date,loginListenerInterval=null,loginListener=function(){var authCheckWrapper=document.querySelector("#wp-auth-check-wrap");authCheckWrapper?authCheckWrapper.classList.contains("hidden")&&(clearInterval(loginListenerInterval),modalIsOpen=!1,wp.heartbeat.connectNow()):(clearInterval(loginListenerInterval),modalIsOpen=!1)},startLoginListener=function(){clearInterval(loginListenerInterval),loginListenerInterval=setInterval(loginListener,500)},modalIsOpen=!1,jQuery(document).on("heartbeat-send",function(e,data){var autosaveDiff,autosaveInterval;PBS.isEditing&&(data["wp-refresh-post-nonces"]={post_id:pbsParams.post_id},data.pbs_nonce=pbsParams.nonce,data.media_manager_editor_nonce=wp.media.view.settings.nonce.sendToEditor,data.post_id=pbsParams.post_id,modalIsOpen||(autosaveDiff=(+new Date-lastAutosave)/1e3,autosaveInterval=15,pbsParams.autosave_interval&&(autosaveInterval=60*parseInt(pbsParams.autosave_interval,10)),autosaveDiff>autosaveInterval&&(lastAutosave=+new Date,data.content=PBS.controller.contentProvider.content,data.content=wp.hooks.applyFilters("pbs.save",data.content))))}),jQuery(document).on("heartbeat-tick",function(e,data){var nonces,templateData,div;if(PBS.isEditing){if(!1===data["wp-auth-check"])return modalIsOpen=!0,void startLoginListener();data["wp-refresh-post-nonces"]&&((nonces=data["wp-refresh-post-nonces"]).heartbeatNonce&&(window.heartbeatSettings.nonce=nonces.heartbeatNonce),nonces.pbs_nonce_new&&(pbsParams.nonce=nonces.pbs_nonce_new),data.media_manager_editor_nonce_new&&(wp.media.view.settings.nonce.sendToEditor=data.media_manager_editor_nonce_new)),data.pbs_nonce_new&&(pbsParams.nonce=data.pbs_nonce_new),data.media_manager_editor_nonce_new&&(wp.media.view.settings.nonce.sendToEditor=data.media_manager_editor_nonce_new),modalIsOpen||data.has_post_lock&&(document.querySelector("#pbs-post-locked-dialog")||(doAutosave(),templateData={avatar:data.post_lock_avatar,avatar2x:data.post_lock_avatar2x,author_name:data.post_lock_author_name},(div=document.createElement("DIV")).innerHTML=wp.template("pbs-heartbeat-takeover")(templateData),div.setAttribute("id","pbs-post-locked-dialog"),document.body.appendChild(div),modalIsOpen=!0,document.querySelector(".pbs-post-takeover-refresh").addEventListener("click",function(ev){ev.preventDefault(),modalIsOpen=!1,doRemovePostLock=!1,ContentTools.EditorApp.get().stop(),window.location.reload(),div.parentNode.removeChild(div)})))}}),doRemovePostLock=!0,ContentTools.EditorApp.get().bind("start",function(){wp.heartbeat.interval(15),checkHeartbeat(),doRemovePostLock=!0}),ContentTools.EditorApp.get().bind("stop",function(){wp.heartbeat.interval(120),doRemovePostLock&&removePostLock()}))};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),window.PBSEditor||(window.PBSEditor={}),window.PBSEditor.hexToRgb=function(hex){var shorthandRegex,result,isRGB=hex.match(/rgba?\(\s*([\d]+)\s*,\s*([\d]+)\s*,\s*([\d]+)\s*/);return isRGB?{r:parseInt(isRGB[1],10),g:parseInt(isRGB[2],10),b:parseInt(isRGB[3],10)}:(shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,hex=hex.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b}),(result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex))?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null)},window.PBSEditor.rgbToHex=function(r,g,b){return"#"+r.toString(16)+g.toString(16)+b.toString(16)},window.PBSEditor.rgbToHsl=function(r,g,b){var max,h,s,l,min,d;if(r/=255,g/=255,b/=255,max=Math.max(r,g,b),min=Math.min(r,g,b),l=(max+min)/2,max===min)h=s=0;else{switch(d=max-min,s=l>.5?d/(2-max-min):d/(max+min),max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}return{h:h,s:s,l:l}},function(){var refreshPageWithIframe=function(){var search=window.location.search;-1===search.indexOf("pbs_iframe")&&(search+=search?"&":"?",search+="pbs_iframe=1",window.location.search=search)};wp.hooks.addFilter("pbs.edit.continue",function(doContinue){return window.parent.pbsGoResponsive?doContinue:(localStorage&&localStorage.setItem("pbs-open-"+pbsParams.post_id,"1"),refreshPageWithIframe(),!1)})}(),function(){var ready=function(){document.querySelector("#wp-admin-bar-pbs_responsive_phone")&&document.querySelector("#wp-admin-bar-pbs_responsive_phone").addEventListener("click",function(ev){ev.preventDefault(),window.parent&&window.parent.pbsGoResponsive("phone")}),document.querySelector("#wp-admin-bar-pbs_responsive_tablet")&&document.querySelector("#wp-admin-bar-pbs_responsive_tablet").addEventListener("click",function(ev){ev.preventDefault(),window.parent&&window.parent.pbsGoResponsive("tablet")}),document.querySelector("#wp-admin-bar-pbs_responsive_desktop")&&document.querySelector("#wp-admin-bar-pbs_responsive_desktop").addEventListener("click",function(ev){ev.preventDefault(),window.parent&&window.parent.pbsGoResponsive("desktop")}),ContentTools.EditorApp.get().bind("stop",function(){window.parent&&window.parent.pbsGoResponsive("desktop")})};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),window.parent.pbsGoResponsive&&(window.onunload=function(){window.top.postMessage("pbs_iframe_change","*")}),function(){var _Root=ContentEdit.Root.get(),proxiedStartDragging=_Root.startDragging;_Root.startDragging=function(element,x,y){if(!(window.innerWidth<=800))return proxiedStartDragging.call(this,element,x,y)}}(),function(){var proxy=ContentEdit.Image.prototype.openMediaManager;ContentEdit.Image.prototype.openMediaManager=function(closeCallback){window.innerWidth<=800||proxy.call(this,closeCallback)}}(),window.pbsSwitchResponsiveStyles=function(screenSize,oldScreenSize){var styles,sizes,style,selector,elements,i;if(screenSize!==oldScreenSize){styles={"margin-top":'.pbs-main-wrapper [style*="margin:"], .pbs-main-wrapper [style*="margin-top:"]',"margin-bottom":'.pbs-main-wrapper [style*="margin:"], .pbs-main-wrapper [style*="margin-bottom:"]'},sizes=["tablet","phone"];for(style in styles)if(styles.hasOwnProperty(style)){for(selector=styles[style],i=0;i<sizes.length;i++)selector+=", [data-pbs-"+sizes[i]+"-"+style+"]";elements=document.querySelectorAll(selector),Array.prototype.forEach.call(elements,function(el){var element=el._ceElement;element&&(element.style(style)&&element.attr("data-pbs-"+oldScreenSize+"-"+style,element.style(style)),element.attr("data-pbs-"+screenSize+"-"+style)?element.style(style,element.attr("data-pbs-"+screenSize+"-"+style)):"phone"===screenSize&&element.attr("data-pbs-tablet-"+style)?element.style(style,element.attr("data-pbs-tablet-"+style)):element.attr("data-pbs-desktop-"+style)?element.style(style,element.attr("data-pbs-desktop-"+style)):element.style(style,""),element.attr("data-pbs-phone-"+style)===element.attr("data-pbs-tablet-"+style)&&element.removeAttr("data-pbs-phone-"+style),element.attr("data-pbs-tablet-"+style)===element.attr("data-pbs-desktop-"+style)&&element.removeAttr("data-pbs-tablet-"+style))}),"desktop"===screenSize&&(elements=document.querySelectorAll("[data-pbs-"+screenSize+"-"+style+"]"),Array.prototype.forEach.call(elements,function(el){var element=el._ceElement;element&&element.removeAttr("data-pbs-"+screenSize+"-"+style)}))}setTimeout(function(){wp.hooks.doAction("pbs.iframe.resized")},850)}},window.PBSEditor.isEditing=function(){return console.log("window.PBSEditor.isEditing() is deprecated, use the property PBS.isEditing instead."),PBS.isEditing},window.PBSEditor.formattingTools=[[]],window.PBSEditor.formattingTools[0].push("insertElement","paragraphPicker","|","font-picker","|","color","bold","italic","underline","strikethrough","link","align","|","uppercase","font-size-down","font-size-up","line-height"),window.PBSEditor.premiumTools={"font-picker":{label:pbsParams.labels.font+"  ("+pbsParams.labels.premium+")",callback:function(elem){elem._domElement.innerHTML=pbsParams.labels.select_font}}},window.PBSEditor.formattingTools[0].push("code","|","unordered-list","ordered-list","indent","unindent","|","clear-formatting","undo","redo"),window.PBSEditor.insertElements=[[]],pbsParams.is_lite?window.PBSEditor.insertElements[0].push("onecolumn","twocolumn","threecolumn","fourcolumn","text","pbs-media","icon","hr","spacer","shortcode","widget","sidebar","embed","html","map","tabs","icon-label","button","carousel","table","toggle",pbsParams.labels.special_elements,"woocommerce","acf","nextgen","contact-form7","events-calendar","instagram-feed","predesigned","countup","countdown","page-heading","social-icons","call-to-action","contact-details","pricing-table","image-box","newsletter","testimonial","featurette","team-members","gallery"):window.PBSEditor.insertElements[0].push("onecolumn","twocolumn","threecolumn","fourcolumn","text","pbs-media","button","icon","hr","spacer","shortcode","widget","sidebar","embed","html","map","icon-label","carousel","tabs","table","toggle",pbsParams.labels.special_elements,"woocommerce","acf","nextgen","contact-form7","events-calendar","instagram-feed","predesigned","countup","countdown","page-heading","social-icons","call-to-action","contact-details","pricing-table","image-box","newsletter","testimonial","featurette","team-members","gallery"),pbsParams.has_woocommerce||window.PBSEditor.insertElements[0].splice(window.PBSEditor.insertElements[0].indexOf("woocommerce"),1),pbsParams.has_nextgen_gallery||window.PBSEditor.insertElements[0].splice(window.PBSEditor.insertElements[0].indexOf("nextgen"),1),pbsParams.has_events_calendar||window.PBSEditor.insertElements[0].splice(window.PBSEditor.insertElements[0].indexOf("events-calendar"),1),pbsParams.has_acf||window.PBSEditor.insertElements[0].splice(window.PBSEditor.insertElements[0].indexOf("acf"),1),pbsParams.has_wpcf7||window.PBSEditor.insertElements[0].splice(window.PBSEditor.insertElements[0].indexOf("contact-form7"),1),pbsParams.has_instagram_feed||window.PBSEditor.insertElements[0].splice(window.PBSEditor.insertElements[0].indexOf("instagram-feed"),1),window.PBSEditor.premiumElements={button:pbsParams.labels.button,carousel:pbsParams.labels.carousel,newsletter:pbsParams.labels.newsletter,table:pbsParams.labels.table,predesigned:pbsParams.labels.pre_designed_sections,toggle:pbsParams.labels.toggle,countdown:pbsParams.labels.countdown,countup:pbsParams.labels.count_up,"icon-label":pbsParams.labels.icon_label,woocommerce:pbsParams.labels.woocommerce,acf:pbsParams.labels.advanced_custom_fields,nextgen:pbsParams.labels.nextgen,"contact-form7":pbsParams.labels.contact_form7,"events-calendar":pbsParams.labels.events_calendar,"instagram-feed":pbsParams.labels.instagram_feed,"page-heading":pbsParams.labels.page_heading,"call-to-action":pbsParams.labels.call_to_action,testimonial:pbsParams.labels.testimonial,"contact-details":pbsParams.labels.contact_details,"pricing-table":pbsParams.labels.pricing_table,"image-box":pbsParams.labels.image_box,"social-icons":pbsParams.labels.social_icons,featurette:pbsParams.labels.featurette,"team-members":pbsParams.labels.team_members,gallery:pbsParams.labels.gallery},ContentTools.DEFAULT_TOOLS=[[]],window.PBSEditor.toolHeadings=[],function(){var done=!1,ready=function(){done||(done=!0,initPBS(),new PBSEditor.OverlayColumn,new PBSEditor.OverlayRow,new PBSEditor.OverlayElement,new PBSEditor.ToolbarElement,new PBSEditor.ToolbarImage,new PBSEditor.ToolbarHtml,new PBSEditor.ToolbarIframe,new PBSEditor.ToolbarEmbed,new PBSEditor.ToolbarMap,new PBSEditor.ToolbarIcon,new PBSEditor.ToolbarShortcode,new PBSEditor.ToolbarRow,new PBSEditor.ToolbarColumn,new PBSEditor.ToolbarNewsletter,new PBSEditor.ToolbarList,new PBSEditor.ToolbarTabContainer,new PBSEditor.ToolbarTable,new PBSEditor.ToolbarTitle,new PBSEditor.ToolbarHr,new PBSEditor.ToolbarSpacer,new PBSEditor.ToolbarButton,pbsParams.is_lite,new PBSEditor.TooltipLink,new PBSEditor.TooltipInput,new PBSEditor.TooltipTab)};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}();